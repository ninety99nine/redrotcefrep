import{P as I}from"./Pill-CHeiffHO.js";import{I as T}from"./Input-D4bxWOlL.js";import{L as B}from"./Loader-Dvrn4ogS.js";import{B as V}from"./Button-BtGfnYDo.js";import{S as N}from"./Skeleton-BYb8KvFB.js";import{a as j}from"./stringUtils-Bvzw0-oW.js";import{M as F}from"./MyCartButton-BH2KaED5.js";import{c as i,a as p,g as f,F as _,e as m,d as y,b as r,f as v,r as g,o as a,m as z,v as q,t as c,i as x,w as M,k as E}from"./app-Db6d8eSP.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as U}from"./image-_IEdZ5tx.js";import"./Popover-DtqKmQ9T.js";import"./Tooltip-Bf4GUCHE.js";import"./Copy-DPmUtyus.js";import"./ShineEffect-B9CikJiy.js";import"./createLucideIcon-gPidoUUU.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-CMycWXoI.js";import"./circle-check-DKc1TKPe.js";import"./circle-alert-D1pEDTPn.js";import"./x-CdcN8VHc.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Drawer-DYUAAZlv.js";import"./shopping-cart-SIrgk7gU.js";const A={inject:["formState","orderState","storeState","notificationState"],components:{Pill:I,Image:U,Input:T,Loader:B,Button:V,Skeleton:N,MyCartButton:F},data(){return{products:[],categories:[],searchTerm:null,lastSearchTerm:null,checkedCategories:[],isLoadingProducts:!1,isLoadingCategories:!1,hasLoadedInitialProducts:!1}},watch:{store(o,s){!s&&o&&this.setup()},searchTerm(){this.showProducts()},categoryIds(){this.showProducts()}},computed:{store(){return this.storeState.store},shoppingCart(){return this.orderState.shoppingCart},isLoadingStore(){return this.storeState.isLoadingStore},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},hasProducts(){return this.products.length>0},hasCategories(){return this.categories.length>0},categoryIds(){return this.checkedCategories.map((o,s)=>{var t;return o?(t=this.categories[s])==null?void 0:t.id:null}).filter(o=>o!==null)}},methods:{isNotEmpty:j,setup(){this.store&&(this.hasCategories||this.showCategories(),this.hasLoadedInitialProducts||this.showProducts())},async onView(o){await this.$router.push({name:"show-shop-product",params:{alias:this.store.alias,product_id:o.id}})},clearFilters(){this.checkedCategories=this.checkedCategories.map(()=>!1)},getSelectedQuantity(o){if(this.shoppingCart&&o){const s=this.shoppingCart.order_products.find(t=>t.product_id==o.id);if(s)return s.quantity}return null},async showProducts(){var o,s;try{this.isLoadingProducts=!0;let t={params:{store_id:this.store.id,association:"team member",category_ids:this.categoryIds,_relationships:"photo,variants"}};this.hasSearchTerm&&(t.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const d=await axios.get("/api/products",t);if(this.searchTerm===this.lastSearchTerm){const n=d.data;this.products=n.data,this.isLoadingProducts=!1,this.hasLoadedInitialProducts=!0}}catch(t){const d=((s=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:s.message)||(t==null?void 0:t.message)||"Something went wrong while fetching products";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(t),console.error("Failed to fetch products:",t)}finally{this.isLoadingProducts=!1}},async showCategories(){var o,s;try{this.isLoadingCategories=!0;let t={params:{per_page:100,store_id:this.store.id,_countable_relationships:["products"].join(",")}};const n=(await axios.get("/api/categories",t)).data;this.categories=n.data,this.checkedCategories=Array(this.categories.length).fill(!1)}catch(t){const d=((s=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:s.message)||(t==null?void 0:t.message)||"Something went wrong while fetching categories";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(t),console.error("Failed to fetch categories:",t)}finally{this.isLoadingCategories=!1}}},created(){this.setup()}},D={class:"max-w-5xl mx-auto md:pt-8 pb-40 px-4"},W={key:0,class:"pt-8 flex items-center justify-center"},G={key:0,class:"select-none grid grid-cols-1 md:grid-cols-4 gap-y-4 md:gap-8"},H={class:"col-span-1"},J={class:"w-full bg-gray-50 p-4 border border-gray-300 rounded-lg relative"},K=["for"],O={class:"flex items-center space-x-2 hover:scale-105 transition-all duration-300"},R=["id","onUpdate:modelValue","onChange"],X={class:"space-x-2"},Y={class:"text-sm text-gray-900"},Z={class:"text-sm text-gray-400"},$={key:0,class:"border-t border-gray-300 pt-4 mt-4"},ee={class:"col-span-3"},te={key:0,class:"flex justify-center items-center space-x-4"},se={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ae={class:"w-full max-h-60 aspect-square relative flex items-center justify-center bg-gray-100 rounded-lg overflow-hidden"},ie={class:"flex items-center space-x-2 flex-wrap gap-2"},oe={key:2,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},re=["onClick"],ne={key:0,class:"absolute top-1 right-1 z-10 flex items-center justify-center min-w-6 w-fit h-6 p-1 bg-red-500 text-xs font-bold text-white rounded-full"},le={class:"w-full max-h-60 aspect-square relative flex items-center justify-center bg-gray-100 rounded-lg overflow-hidden"},ce=["alt","src"],de={class:"text-gray-900 text-sm font-medium truncate"},he={class:"flex items-center space-x-2 flex-wrap gap-2"},me={key:0,class:"text-gray-900 text-sm font-semibold"},ge={key:3,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"};function ue(o,s,t,d,n,l){const S=g("Loader"),b=g("Button"),L=g("Input"),k=g("Image"),w=g("Skeleton"),C=g("Pill"),P=g("MyCartButton");return a(),i("div",D,[l.isLoadingStore?(a(),i("div",W,[p(S,null,{default:f(()=>[...s[2]||(s[2]=[r("span",{class:"text-sm ml-2"},"Loading store",-1)])]),_:1})])):(a(),i(_,{key:1},[l.hasCategories?(a(),i("div",G,[r("div",H,[r("div",J,[s[3]||(s[3]=r("h1",{class:"text-gray-900 font-medium mb-4"},"Categories",-1)),(a(!0),i(_,null,v(n.categories,(e,h)=>(a(),i("label",{key:h,for:e.id,class:"cursor-pointer"},[r("div",O,[z(r("input",{type:"checkbox",id:e.id,class:"cursor-pointer","onUpdate:modelValue":u=>n.checkedCategories[h]=u,onChange:u=>n.checkedCategories[h]=u.target.checked},null,40,R),[[q,n.checkedCategories[h]]]),r("div",X,[r("span",Y,c(e.name),1),r("span",Z,"("+c(e.products_count)+")",1)])])],8,K))),128)),l.categoryIds.length?(a(),i("div",$,[p(b,{size:"xs",type:"light",buttonClass:"w-full",action:l.clearFilters},{default:f(()=>[x(" Clear filters ("+c(l.categoryIds.length)+") ",1)]),_:1},8,["action"])])):m("",!0)])]),r("div",ee,[n.hasLoadedInitialProducts?(a(),i("div",te,[p(L,{type:"search",debounced:!0,class:"w-full mb-4",modelValue:n.searchTerm,"onUpdate:modelValue":s[0]||(s[0]=e=>n.searchTerm=e),skeleton:l.isLoadingStore,placeholder:"Search products",onInput:s[1]||(s[1]=e=>n.isLoadingProducts=!0)},null,8,["modelValue","skeleton"])])):m("",!0),n.isLoadingProducts?(a(),i("div",se,[(a(!0),i(_,null,v([...Array(8).keys()].map(e=>e+1),e=>(a(),i("div",{key:e.id,class:"relative flex flex-col space-y-2 p-2 cursor-pointer rounded-lg hover:scale-105 transition-all duration-300"},[r("div",ae,[p(k,{size:"40",class:"text-gray-300"})]),p(w,{width:"w-4/5",shine:!0}),r("div",ie,[p(w,{width:"w-3/5",height:"h-2",shine:!0})])]))),128))])):l.hasProducts?(a(),i("div",oe,[(a(!0),i(_,null,v(n.products,e=>{var h,u;return a(),i("div",{key:e.id,onClick:M(()=>l.onView(e),["stop"]),class:"relative flex flex-col space-y-2 p-2 cursor-pointer rounded-lg hover:scale-105 transition-all duration-300"},[l.getSelectedQuantity(e)?(a(),i("div",ne,[r("span",null,c(l.getSelectedQuantity(e)),1)])):m("",!0),r("div",le,[(h=(e??e.variant).photo)!=null&&h.path?(a(),i("img",{key:0,alt:(e??e.variant).name,class:"absolute w-full h-full object-cover",src:(u=(e??e.variant).photo)==null?void 0:u.path},null,8,ce)):(a(),y(k,{key:1,size:"40",class:"text-gray-300"}))]),r("h4",de,c(e.name),1),r("div",he,[(e.variant??e).is_free?(a(),y(C,{key:0,type:"success",size:"xs"},{default:f(()=>[...s[4]||(s[4]=[x("free",-1)])]),_:1})):(a(),i(_,{key:1},[(e.variant??e).on_sale?(a(),i("span",me,c((e.variant??e).unit_sale_price.amount_with_currency),1)):m("",!0),r("span",{class:E(["text-sm",{"text-gray-400 line-through":(e.variant??e).on_sale,"text-gray-900 font-semibold":!(e.variant??e).on_sale}])},c((e.variant??e).unit_regular_price.amount_with_currency),3)],64)),(e.variant??e).stock_quantity_type=="limited"&&((e.variant??e).has_stock&&(e.variant??e).stock_quantity<=5||!(e.variant??e).has_stock)?(a(),y(C,{key:2,type:(e.variant??e).has_stock?"success":"warning",size:"xs"},{default:f(()=>[x(c((e.variant??e).has_stock?`${(e.variant??e).stock_quantity} left`:"no stock"),1)]),_:2},1032,["type"])):m("",!0)])],8,re)}),128))])):(a(),i("p",ge," No products found "))])])):m("",!0),l.shoppingCart?(a(),y(P,{key:1})):m("",!0)],64))])}const Ee=Q(A,[["render",ue]]);export{Ee as default};
