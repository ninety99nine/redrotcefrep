import{P as V}from"./Pill-CuSw6nga.js";import{I as j}from"./Input-DBnU4wzW.js";import{L as z}from"./Loader-DZWJgCmt.js";import{B as q}from"./Button-B134edVj.js";import{S as F}from"./Skeleton-Dmr_VmHU.js";import{a as E}from"./stringUtils-Bvzw0-oW.js";import{M}from"./MyCartButton-Dr8_xu22.js";import{c as s,a as l,g as v,F as m,b as c,d as _,e as h,f as x,t as d,r as y,o as e,w,i as P,k as Q}from"./app-CGNgl8eN.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as W}from"./chevron-right-cOP9ZuS3.js";import{I as A}from"./image-D1UoBb86.js";import"./Popover-BZ2E_DR-.js";import"./Tooltip-BCHxPPLL.js";import"./Copy-Bp4ENaQe.js";import"./ShineEffect-D1V-RWKB.js";import"./createLucideIcon-BakIve7O.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-DblrTBks.js";import"./circle-check-Bkm_qb2i.js";import"./circle-alert-uARVagVJ.js";import"./x-DHw5U7EU.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Drawer-DpkWEHvn.js";import"./shopping-cart-BJpzLNT2.js";const D={inject:["formState","orderState","storeState","notificationState"],components:{Pill:V,Image:A,Input:j,Loader:z,Button:q,Skeleton:F,ChevronRight:W,MyCartButton:M},data(){return{products:[],category:null,searchTerm:null,lastSearchTerm:null,isLoadingProducts:!1,isLoadingCategory:!1,hasLoadedInitialProducts:!1}},watch:{store(o,r){!r&&o&&this.setup()},categoryId(){this.showCategory(),this.showProducts()},searchTerm(){this.showProducts()}},computed:{store(){return this.storeState.store},shoppingCart(){return this.orderState.shoppingCart},isLoadingStore(){return this.storeState.isLoadingStore},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},hasProducts(){return this.products.length>0},categoryId(){return this.$route.params.category_id},breadcrumbTrail(){const o=[];let r=this.category;for(;r&&r.parent_category;)o.unshift(r.parent_category),r=r.parent_category;return this.category&&o.push(this.category),o}},methods:{isNotEmpty:E,setup(){this.store&&(this.category||this.showCategory(),this.hasLoadedInitialProducts||this.showProducts())},navigateToShowShopCategory(o){this.$router.push({name:"show-shop-category",params:{alias:this.store.alias,category_id:o.id}})},async onView(o){await this.$router.push({name:"show-shop-product",params:{alias:this.store.alias,product_id:o.id}})},getSelectedQuantity(o){if(this.shoppingCart&&o){const r=this.shoppingCart.order_products.find(a=>a.product_id==o.id);if(r)return r.quantity}return null},async showCategory(){var o,r;try{this.isLoadingCategory=!0;let a={params:{store_id:this.store.id,_relationships:["subCategories","parentCategory.parentCategory.parentCategory"].join(",")}};const g=await axios.get(`/api/categories/${this.categoryId}`,a);this.category=g.data}catch(a){if(a.status!=404){const g=((r=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:r.message)||(a==null?void 0:a.message)||"Something went wrong while fetching category";this.notificationState.showWarningNotification(g),this.formState.setServerFormErrors(a)}console.error("Failed to fetch category:",a)}finally{this.isLoadingCategory=!1}},async showProducts(){var o,r;try{this.isLoadingProducts=!0;let a={params:{store_id:this.store.id,association:"team member",category_ids:[this.categoryId],_relationships:"photo,variants"}};this.hasSearchTerm&&(a.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const g=await axios.get("/api/products",a);if(this.searchTerm===this.lastSearchTerm){const i=g.data;this.products=i.data,this.isLoadingProducts=!1,this.hasLoadedInitialProducts=!0}}catch(a){const g=((r=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:r.message)||(a==null?void 0:a.message)||"Something went wrong while fetching products";this.notificationState.showWarningNotification(g),this.formState.setServerFormErrors(a),console.error("Failed to fetch products:",a)}finally{this.isLoadingProducts=!1}}},created(){this.setup()}},U={class:"max-w-4xl mx-auto pb-40"},G={key:0,class:"pt-8 flex items-center justify-center"},H={class:"select-none"},J={key:0,class:"flex items-center space-x-2 mt-4"},K={key:1,class:"flex items-center space-x-2 mt-4"},O={key:0,class:"text-lg font-semibold"},X=["onClick"],Y={class:"text-gray-900 text-sm"},Z={key:3,class:"text-sm mt-4"},$={key:4,class:"flex flex-wrap space-x-2 mt-4"},tt={key:5,class:"flex flex-wrap space-x-2 mt-4"},et=["onClick"],st={class:"text-gray-900 text-sm"},at={key:6,class:"flex justify-center items-center space-x-4 mt-4 mb-2"},rt={key:7,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ot={class:"w-full max-h-60 aspect-square relative flex items-center justify-center bg-gray-100 rounded-lg overflow-hidden"},it={class:"flex items-center space-x-2 flex-wrap gap-2"},nt={key:8,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ct=["onClick"],lt={key:0,class:"absolute top-1 right-1 z-10 flex items-center justify-center min-w-6 w-fit h-6 p-1 bg-red-500 text-xs font-bold text-white rounded-full"},ht={class:"w-full max-h-60 aspect-square relative flex items-center justify-center bg-gray-100 rounded-lg overflow-hidden"},dt=["alt","src"],gt={class:"text-gray-900 text-sm font-medium truncate"},mt={class:"flex items-center space-x-2 flex-wrap gap-2"},ut={key:0,class:"text-gray-900 text-sm font-semibold"},yt={key:9,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"};function pt(o,r,a,g,i,n){var C,L,T;const I=y("Loader"),p=y("Skeleton"),k=y("ChevronRight"),B=y("Input"),S=y("Image"),b=y("Pill"),N=y("MyCartButton");return e(),s("div",U,[n.isLoadingStore?(e(),s("div",G,[l(I,null,{default:v(()=>[...r[2]||(r[2]=[c("span",{class:"text-sm ml-2"},"Loading store",-1)])]),_:1})])):(e(),s(m,{key:1},[c("div",H,[i.isLoadingCategory?(e(),s("div",J,[l(p,{width:"w-20",shine:!0,class:"my-2"}),l(k,{size:"16",class:"text-gray-300 text-sm"}),l(p,{width:"w-20",shine:!0,class:"my-2"})])):n.breadcrumbTrail.length?(e(),s("div",K,[(e(!0),s(m,null,x(n.breadcrumbTrail,(t,u)=>{var f;return e(),s(m,{key:t.id},[u==n.breadcrumbTrail.length-1?(e(),s("h1",O,d((f=i.category)==null?void 0:f.name),1)):(e(),s("div",{key:1,onClick:w(_t=>n.navigateToShowShopCategory(t),["stop"]),class:"cursor-pointer group bg-gray-100 border border-gray-200 hover:bg-gray-200 py-1 px-4 rounded-lg"},[c("span",Y,d(t.name),1)],8,X)),u<n.breadcrumbTrail.length-1?(e(),_(k,{size:"16",key:"separator-"+u,class:"text-gray-500 text-sm"})):h("",!0)],64)}),128))])):h("",!0),i.isLoadingCategory?(e(),_(p,{key:2,width:"w-60",shine:!0,class:"mt-2"})):(C=i.category)!=null&&C.description?(e(),s("p",Z,d(i.category.description),1)):h("",!0),i.isLoadingCategory?(e(),s("div",$,[(e(),s(m,null,x(3,t=>l(p,{key:t,width:"w-20",height:"h-8",rounded:"rounded-md",shine:!0,class:"my-2"})),64))])):(T=(L=i.category)==null?void 0:L.sub_categories)!=null&&T.length?(e(),s("div",tt,[(e(!0),s(m,null,x(i.category.sub_categories,t=>(e(),s("div",{key:t.id,onClick:w(u=>n.navigateToShowShopCategory(t),["stop"]),class:"cursor-pointer group bg-gray-100 border border-gray-200 hover:bg-gray-200 py-1 px-4 rounded-lg"},[c("span",st,d(t.name),1)],8,et))),128))])):h("",!0),i.hasLoadedInitialProducts?(e(),s("div",at,[l(B,{type:"search",debounced:!0,class:"w-full mb-4",modelValue:i.searchTerm,"onUpdate:modelValue":r[0]||(r[0]=t=>i.searchTerm=t),skeleton:n.isLoadingStore,placeholder:"Search products",onInput:r[1]||(r[1]=t=>i.isLoadingProducts=!0)},null,8,["modelValue","skeleton"])])):h("",!0),i.isLoadingProducts?(e(),s("div",rt,[(e(!0),s(m,null,x([...Array(8).keys()].map(t=>t+1),t=>(e(),s("div",{key:t.id,class:"relative flex flex-col space-y-2 p-2 cursor-pointer rounded-lg hover:scale-105 transition-all duration-300"},[c("div",ot,[l(S,{size:"40",class:"text-gray-300"})]),l(p,{width:"w-4/5",shine:!0}),c("div",it,[l(p,{width:"w-3/5",height:"h-2",shine:!0})])]))),128))])):n.hasProducts?(e(),s("div",nt,[(e(!0),s(m,null,x(i.products,t=>{var u,f;return e(),s("div",{key:t.id,onClick:w(()=>n.onView(t),["stop"]),class:"relative flex flex-col space-y-2 p-2 cursor-pointer rounded-lg hover:scale-105 transition-all duration-300"},[n.getSelectedQuantity(t)?(e(),s("div",lt,[c("span",null,d(n.getSelectedQuantity(t)),1)])):h("",!0),c("div",ht,[(u=(t??t.variant).photo)!=null&&u.path?(e(),s("img",{key:0,alt:(t??t.variant).name,class:"absolute w-full h-full object-cover",src:(f=(t??t.variant).photo)==null?void 0:f.path},null,8,dt)):(e(),_(S,{key:1,size:"40",class:"text-gray-300"}))]),c("h4",gt,d(t.name),1),c("div",mt,[(t.variant??t).is_free?(e(),_(b,{key:0,type:"success",size:"xs"},{default:v(()=>[...r[3]||(r[3]=[P("free",-1)])]),_:1})):(e(),s(m,{key:1},[(t.variant??t).on_sale?(e(),s("span",ut,d((t.variant??t).unit_sale_price.amount_with_currency),1)):h("",!0),c("span",{class:Q(["text-sm",{"text-gray-400 line-through":(t.variant??t).on_sale,"text-gray-900 font-semibold":!(t.variant??t).on_sale}])},d((t.variant??t).unit_regular_price.amount_with_currency),3)],64)),(t.variant??t).stock_quantity_type=="limited"&&((t.variant??t).has_stock&&(t.variant??t).stock_quantity<=5||!(t.variant??t).has_stock)?(e(),_(b,{key:2,type:(t.variant??t).has_stock?"success":"warning",size:"xs"},{default:v(()=>[P(d((t.variant??t).has_stock?`${(t.variant??t).stock_quantity} left`:"no stock"),1)]),_:2},1032,["type"])):h("",!0)])],8,ct)}),128))])):(e(),s("p",yt," No products found "))]),n.shoppingCart?(e(),_(N,{key:0})):h("",!0)],64))])}const At=R(D,[["render",pt]]);export{At as default};
