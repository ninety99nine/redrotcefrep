import{P as D}from"./Pill-_ubzDuHk.js";import{A as I}from"./Alert-jIC638EV.js";import{I as N}from"./Input-QwDj8T87.js";import{M as j}from"./Modal-UBL0nJJO.js";import{B as z}from"./Button-Dy6BYOYD.js";import{S as V}from"./Skeleton-BfdDUyfM.js";import{V as F}from"./vue-draggable-next.esm-bundler-D8Jtphk6.js";import{c as B,a as E}from"./stringUtils-Bvzw0-oW.js";import{c as l,b as o,d as u,a as m,s as v,g as c,F as f,f as _,w as S,r as h,o as i,e as x,i as w,t as y}from"./app-CAsQYp3T.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as W}from"./move-CrqEeJEG.js";import{C as R}from"./circle-dollar-sign-DozsjPp6.js";import{T as U}from"./trash-2-Cze44q0v.js";import{P as G}from"./plus-BwaaZFcM.js";import"./Popover-DUH2qEVS.js";import"./Tooltip-Gwe3QXsJ.js";import"./createLucideIcon-Dd5tvPb0.js";import"./circle-check-Coc-yKcS.js";import"./info-BxOCgZi_.js";import"./Copy-B_MLEMQD.js";import"./ShineEffect-DjmscYxr.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-D7oBzLST.js";import"./circle-alert-BwdAp8OB.js";import"./x-ICmzimgK.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Loader-j3Xd9R0O.js";const O={inject:["formState","storeState","notificationState"],components:{CircleDollarSign:R,Pill:D,Alert:I,Input:N,Modal:j,Button:z,Skeleton:V,Move:W,draggable:F},data(){return{Plus:G,Trash2:U,pagination:null,searchTerm:null,paymentMethods:[],lastSearchTerm:null,storePaymentMethods:[],isLoadingPaymentMethods:!1,selectedPaymentMethodType:"all",deletableStorePaymentMethod:null,isDeletingStorePaymentMethod:!1,isLoadingStorePaymentMethods:!1,hasLoadedInitialPaymentMethods:!1,isChangingStorePaymentMethodArrangement:!1,paymentMethodTypes:["all","automated","manual"]}},watch:{store(n,t){!t&&n&&this.setup()},selectedPaymentMethodType(){this.showPaymentMethods()},searchTerm(){this.showPaymentMethods()}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},hasPaymentMethods(){return this.paymentMethods.length>0},hasStorePaymentMethods(){return this.storePaymentMethods.length>0},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)}},methods:{isNotEmpty:E,capitalize:B,setup(){this.store&&this.showStorePaymentMethods()},onShow(){this.hasLoadedInitialPaymentMethods=!1,this.lastSearchTerm=null,this.paymentMethods=[],this.searchTerm=null,this.showPaymentMethods()},showDeleteStorePaymentMethodModal(n){this.deletableStorePaymentMethod=n,this.$refs.deleteStorePaymentMethodModal.showModal()},async navigateToAddPaymentMethod(n){await this.$router.push({name:"add-payment-method",query:{store_id:this.store.id,payment_method_id:n.id}})},async navigateToEditPaymentMethod(n){await this.$router.push({name:"edit-payment-method",query:{store_id:this.store.id},params:{store_payment_method_id:n.id}})},async showPaymentMethods(){var n,t;try{this.isLoadingPaymentMethods=!0;let e={params:{per_page:100,store_id:this.store.id,association:"unassociated"}};this.selectedPaymentMethodType=="automated"?e.params.automated_verification="1":this.selectedPaymentMethodType=="manual"&&(e.params.automated_verification="0"),this.hasSearchTerm&&(e.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const r=await axios.get("/api/payment-methods",e);if(this.searchTerm===this.lastSearchTerm){const a=r.data;this.paymentMethods=a.data,this.isLoadingPaymentMethods=!1,this.hasLoadedInitialPaymentMethods=!0}}catch(e){const r=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong while fetching payment methods";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(e),console.error("Failed to fetch payment methods:",e)}finally{this.isLoadingPaymentMethods=!1}},async showStorePaymentMethods(){var n,t;try{this.isLoadingStorePaymentMethods=!0;let e={params:{per_page:100,store_id:this.store.id,association:"team member",_relationships:["logo","paymentMethod"].join(",")}};const r=await axios.get("/api/store-payment-methods",e);this.pagination=r.data,this.storePaymentMethods=this.pagination.data}catch(e){const r=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong while fetching store payment methods";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(e),console.error("Failed to fetch store payment methods:",e)}finally{this.isLoadingStorePaymentMethods=!1}},async changeStorePaymentMethodArrangement(){var n,t;try{if(this.isChangingStorePaymentMethodArrangement)return;const e=this.storePaymentMethods.map(a=>a.id);if(e.length==0)return;this.isChangingStorePaymentMethodArrangement=!0;const r={store_id:this.store.id,store_payment_method_ids:e};await axios.post("/api/store-payment-methods/arrangement",r),this.notificationState.showSuccessNotification("Arrangement changed")}catch(e){const r=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong while updating payment method arrangement";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(e),console.error("Failed to update payment method arrangement:",e)}finally{this.isChangingStorePaymentMethodArrangement=!1}},async deleteStorePaymentMethod(){var n,t;try{if(this.isDeletingStorePaymentMethod)return;this.isDeletingStorePaymentMethod=!0;const e={data:{store_id:this.store.id}};await axios.delete(`/api/store-payment-methods/${this.deletableStorePaymentMethod.id}`,e),this.showStorePaymentMethods(),this.$refs.deleteStorePaymentMethodModal.hideModal(),this.notificationState.showSuccessNotification("Payment method deleted")}catch(e){const r=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong while deleting payment method";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(e),console.error("Failed to delete payment method:",e),hideModal()}finally{this.isDeletingStorePaymentMethod=!1}}},created(){this.setup()}},H={class:"max-w-2xl mx-auto pt-32 pb-40"},J={class:"flex justify-end"},K={class:"flex justify-center space-x-1 py-2"},Q={key:0,class:"flex justify-center items-center space-x-4 my-2"},X={key:2,class:"space-y-2 mb-4"},Y={key:3,class:"space-y-2 mb-4"},Z=["onClick"],$={class:"w-8 h-8 rounded-full overflow-hidden flex items-center justify-center"},ee=["src"],te={class:"w-full flex items-center justify-between"},oe={class:"text-sm font-semibold"},se={class:"mr-1"},ae={class:"w-60 text-xs text-center leading-5 px-2 py-1 whitespace-normal"},ne={key:4,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"},ie={key:0,class:"space-y-3 mt-4"},re={class:"flex justify-between items-center"},de={class:"flex items-center space-x-2 font-bold"},le={class:"flex items-center space-x-4"},me=["onClick"],he={class:"flex justify-between items-center"},ce={class:"flex items-center space-x-2 font-bold"},pe={class:"w-8 h-8 rounded-full overflow-hidden flex items-center justify-center"},ge=["src"],ye={class:"text-sm"},ue={class:"flex items-center space-x-4"},fe={key:2,class:"flex flex-col items-center justify-center bg-linear-to-br from-indigo-50 to-purple-50 border border-gray-300 shadow-lg rounded-2xl py-16 px-8 space-y-6"},_e={class:"relative"},we={class:"bg-linear-to-br from-white-50 to-indigo-50 text-indigo-500 rounded-full p-2"},Me={class:"mb-8"},Se={class:"font-bold text-black"};function Pe(n,t,e,r,a,d){const M=h("Pill"),b=h("Input"),T=h("Alert"),p=h("Skeleton"),P=h("Modal"),k=h("Button"),L=h("Move"),C=h("draggable"),A=h("CircleDollarSign");return i(),l("div",H,[o("div",J,[m(P,{size:"md",onShow:d.onShow,triggerSize:"md",contentClass:"px-4",triggerType:"primary",leftTriggerIcon:a.Plus,scrollOnContent:!1,showApproveButton:!1,ref:"addPaymentMethodModal",header:"Add Payment Method",triggerLoading:d.isLoadingStore,triggerText:d.hasStorePaymentMethods?"Add Payment Method":null},v({_:2},[!d.isLoadingStore&&!a.isLoadingStorePaymentMethods?{name:"content",fn:c(()=>[o("div",K,[(i(!0),l(f,null,_(a.paymentMethodTypes,(s,g)=>(i(),u(M,{size:"md",key:g,action:()=>a.selectedPaymentMethodType=s,type:a.selectedPaymentMethodType==s?"primary":"light"},{default:c(()=>[w(y(d.capitalize(s)),1)]),_:2},1032,["action","type"]))),128))]),a.hasLoadedInitialPaymentMethods?(i(),l("div",Q,[m(b,{type:"search",class:"w-full",debounced:!0,modelValue:a.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=s=>a.searchTerm=s),skeleton:d.isLoadingStore,placeholder:"Search payment methods",onInput:t[1]||(t[1]=s=>a.isLoadingPaymentMethods=!0)},null,8,["modelValue","skeleton"])])):x("",!0),a.selectedPaymentMethodType!=="all"?(i(),u(T,{key:1,class:"mb-2",type:"primary",dismissable:!1,description:a.selectedPaymentMethodType==="automated"?"Showing payment methods that automatically verify":"Showing payment methods that require manual verification"},null,8,["description"])):x("",!0),a.isLoadingPaymentMethods?(i(),l("div",X,[(i(),l(f,null,_([1,2,3],(s,g)=>o("div",{key:g,class:"flex items-center space-x-2 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50 w-full"},[m(p,{width:"w-10",height:"h-10",rounded:"rounded-full",shine:!0,class:"flex-shrink-0"}),m(p,{width:"w-1/3",shine:!0})])),64))])):d.hasPaymentMethods?(i(),l("div",Y,[(i(!0),l(f,null,_(a.paymentMethods,(s,g)=>(i(),l("div",{key:g,onClick:()=>d.navigateToAddPaymentMethod(s),class:"flex items-center space-x-2 cursor-pointer p-3 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100"},[o("div",$,[o("img",{alt:"Payment Method Logo",class:"h-full object-contain",src:s.image_url},null,8,ee)]),o("div",te,[o("p",oe,y(s.name),1),m(M,{tooltipTriggerClass:"w-4 h-4 text-gray-400 hover:text-gray-500",type:s.automated_verification?"primary":"light",size:"xs"},{tooltipContent:c(()=>[o("p",ae,y(s.automated_verification?"Automatic payment verification; no manual action needed":"Requires manual verification after customer payment"),1)]),default:c(()=>[o("span",se,y(s.automated_verification?"automated":"manual"),1)]),_:2},1032,["type"])])],8,Z))),128))])):(i(),l("p",ne," No payment methods found "))]),key:"0"}:void 0]),1032,["onShow","leftTriggerIcon","triggerLoading","triggerText"])]),d.isLoadingStore||a.isLoadingStorePaymentMethods?(i(),l("div",ie,[(i(),l(f,null,_([1,2,3],(s,g)=>o("div",{key:g,class:"bg-white p-4 shadow-sm rounded-xl transition-all duration-300"},[o("div",re,[o("div",de,[m(p,{width:"w-8",height:"h-8",rounded:"rounded-full",shine:!0}),m(p,{width:"w-40",shine:!0})]),o("div",le,[m(p,{width:"w-16",shine:!0}),m(p,{width:"w-4",height:"h-4",rounded:"rounded-md",shine:!0}),m(p,{width:"w-4",height:"h-4",rounded:"rounded-md",shine:!0})])])])),64))])):d.hasStorePaymentMethods?(i(),u(C,{key:1,class:"space-y-3 mt-4",handle:".draggable-handle","ghost-class":"bg-yellow-50",modelValue:a.storePaymentMethods,"onUpdate:modelValue":t[3]||(t[3]=s=>a.storePaymentMethods=s),onChange:d.changeStorePaymentMethodArrangement},{default:c(()=>[(i(!0),l(f,null,_(a.storePaymentMethods,s=>(i(),l("div",{key:s.id,onClick:S(()=>d.navigateToEditPaymentMethod(s),["stop"]),class:"bg-white p-4 shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-300 hover:shadow-lg cursor-pointer"},[o("div",he,[o("div",ce,[o("div",pe,[o("img",{alt:"Payment Method Logo",class:"h-full object-contain",src:s.logo?s.logo.path:s.payment_method.image_url},null,8,ge)]),o("span",ye,y(s.custom_name),1)]),o("div",ue,[s.requires_verification?(i(),u(M,{key:0,type:"warning",size:"xs"},{default:c(()=>[...t[5]||(t[5]=[w("Requires verification",-1)])]),_:1})):(i(),u(M,{key:1,type:s.active?"success":"warning",size:"xs"},{default:c(()=>[w(y(s.active?"active":"inactive"),1)]),_:2},1032,["type"])),m(k,{size:"xs",type:"bareDanger",leftIcon:a.Trash2,action:()=>d.showDeleteStorePaymentMethodModal(s)},null,8,["leftIcon","action"]),m(L,{onClick:t[2]||(t[2]=S(()=>{},["stop"])),size:"16",class:"draggable-handle cursor-grab active:cursor-grabbing text-gray-500 hover:text-yellow-500"})])])],8,me))),128))]),_:1},8,["modelValue","onChange"])):(i(),l("div",fe,[o("div",_e,[o("div",we,[m(A,{size:"60"})]),t[6]||(t[6]=o("div",{class:"absolute inset-0 bg-indigo-300 opacity-20 rounded-full animate-ping"},null,-1))]),t[8]||(t[8]=o("div",{class:"text-center"},[o("h3",{class:"text-xl font-semibold text-gray-800"},"Get Started with Payments!"),o("span",{class:"text-sm text-gray-600 mt-2 block max-w-sm"}," Add a payment method to unlock seamless transactions and grow your business. ")],-1)),o("button",{size:"lg",type:"bare",onClick:t[4]||(t[4]=S(()=>n.$refs.addPaymentMethodModal.showModal(),["stop"])),class:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-medium py-3 px-6 rounded-lg hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 hover:scale-105 cursor-pointer"},[...t[7]||(t[7]=[o("span",null,"Add Payment Method Now",-1)])])])),m(P,{approveType:"danger",approveLeftIcon:a.Trash2,approveText:"Delete Payment Method",ref:"deleteStorePaymentMethodModal",approveAction:d.deleteStorePaymentMethod,triggerLoading:a.isDeletingStorePaymentMethod,approveLoading:a.isDeletingStorePaymentMethod},v({_:2},[a.deletableStorePaymentMethod?{name:"content",fn:c(()=>[t[11]||(t[11]=o("p",{class:"text-lg font-bold border-b border-gray-300 border-dashed pb-4 mb-4"},"Confirm Delete",-1)),o("p",Me,[t[9]||(t[9]=w("Are you sure you want to delete ",-1)),o("span",Se,y(a.deletableStorePaymentMethod.custom_name),1),t[10]||(t[10]=w("?",-1))])]),key:"0"}:void 0]),1032,["approveLeftIcon","approveAction","triggerLoading","approveLoading"])])}const Xe=q(O,[["render",Pe]]);export{Xe as default};
