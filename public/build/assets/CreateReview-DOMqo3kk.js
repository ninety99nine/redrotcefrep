import{c as n,a,b as o,g as c,d as F,e as f,F as g,f as _,t as L,h as k,r as l,o as m}from"./app-811fDb4C.js";import{I as R}from"./Input-Ch5FVRoG.js";import{B as E}from"./Button-0Fhg4Aii.js";import{L as B}from"./Loader-DjUD9LDC.js";import{S as V}from"./Skeleton-DGkj9lRL.js";import{i as T}from"./stringUtils-Bvzw0-oW.js";import{M as C}from"./Menu-DyG0-bNr.js";import{B as I}from"./BackdropLoader-CPXO7-36.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as v}from"./move-left-C1am2jSW.js";import{S as h}from"./star-B8QuMcLK.js";import"./Copy-XiSIbjW8.js";import"./ShineEffect-BW3gyXUb.js";import"./createLucideIcon-JVTSwxMK.js";import"./Popover-DfwFh9bM.js";import"./Tooltip-5EEAR2_1.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-fYK0zSuq.js";import"./circle-check-Ci8AvIUe.js";import"./circle-alert-DdTgr82K.js";import"./x-WVuudoOP.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./house-DJhrT9DT.js";import"./video-BJANt8NR.js";import"./Drawer-BuxdFOUN.js";import"./DesignCardManager-DHRqG4iK.js";import"./store-CDbe-uI4.js";import"./Pill-aGbs_XL2.js";import"./image-2C7dvKgM.js";import"./AddressInput-CNrrxVX9.js";import"./index-ChmBBGBv.js";import"./Modal-X3iEO6Sa.js";import"./GoogleMaps-RFPisK6o.js";import"./SelectCountry-CJD2sKOm.js";import"./Select-B89KxZtb.js";import"./trash-2-COAOku7K.js";import"./plus-BU4OPlaU.js";import"./StoreLogo-CCMzoP_5.js";import"./link-Ebq6HyPQ.js";import"./at-sign-Ckexr1RE.js";import"./chevron-up-DcmVslGD.js";import"./Datepicker-DpIs3Os1.js";import"./arrow-right-DWMOGIdg.js";import"./arrow-left-oizamhNw.js";import"./Alert-CoP-lZmZ.js";import"./info-BoI19BZ7.js";import"./Switch-DrPP6l9i.js";import"./DeliveryTimePicker-C8OfieOk.js";import"./circle-check-big-CC1FR4MG.js";import"./menu-DBFxDB1c.js";import"./user-CNOykAp6.js";const N={inject:["formState","reviewState","storeState","notificationState"],components:{Input:R,Button:E,Loader:B,Skeleton:V,BackdropLoader:I,Menu:C,Star:h,MoveLeft:v},data(){return{Star:h,MoveLeft:v,isSubmitting:!1,isLoadingUser:!1}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},reviewForm(){return this.reviewState.reviewForm}},watch:{store(s,e){!e&&s&&this.setup()}},methods:{isEmpty:T,async setup(){this.store&&this.reviewState.setReviewForm(null,!0)},navigateToShowShopReviews(){this.$router.push({name:"show-shop-reviews",query:{alias:this.store.alias}})},setRating(s){this.reviewForm.rating=s},async createReview(){var s,e;try{if(this.isSubmitting||(this.formState.hideFormErrors(),this.isEmpty(this.reviewForm.rating)&&this.formState.setFormError("rating","The rating is required"),(this.reviewForm.rating<1||this.reviewForm.rating>5)&&this.formState.setFormError("rating","Rating must be between 1 and 5"),this.formState.hasErrors))return;this.isSubmitting=!0;const r={...this.reviewForm,store_id:this.store.id},d=await k.post("/api/reviews",r);this.notificationState.showSuccessNotification("Review submitted! It will be visible after approval."),await this.navigateToShowShopReviews(),this.reviewState.reset()}catch(r){const d=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Something went wrong while submitting your review";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(r),console.error("Failed to create review:",r)}finally{this.isSubmitting=!1}}},created(){this.setup()},beforeRouteLeave(s,e,r){if(this.reviewState.reviewForm&&(this.reviewForm.rating||this.reviewForm.comment||this.reviewForm.name||this.reviewForm.mobile_number)&&!window.confirm("You have unsaved changes. Are you sure you want to leave?"))return r(!1);this.reviewState.reset(),r()}},U={class:"max-w-4xl mx-auto pt-8 pb-40"},j={key:0,class:"pt-8 flex items-center justify-center"},z={key:1,class:"select-none relative bg-white rounded-lg space-y-4 p-4"},A={class:"flex items-center space-x-4"},q={class:"grid grid-cols-1 md:grid-cols-2 gap-4 border border-gray-300 shadow rounded-lg p-4 space-y-4"},W={class:"border border-gray-300 shadow rounded-lg p-4 space-y-4"},Y={class:"flex space-x-1 mt-2"},D={key:0,class:"mt-1 text-sm text-red-600"},G={class:"flex justify-end"};function H(s,e,r,d,p,t){const S=l("Menu"),b=l("Loader"),y=l("BackdropLoader"),w=l("Button"),u=l("Input"),x=l("Star");return m(),n("div",null,[a(S,{menuClass:"max-w-4xl mx-auto"}),o("div",U,[t.isLoadingStore||p.isLoadingUser?(m(),n("div",j,[a(b,null,{default:c(()=>[...e[3]||(e[3]=[o("span",{class:"text-sm ml-2"},"Loading...",-1)])]),_:1})])):(m(),n("div",z,[p.isSubmitting?(m(),F(y,{key:0,showSpinningLoader:!1,class:"rounded-lg"})):f("",!0),o("div",A,[a(w,{size:"xs",type:"light",action:t.navigateToShowShopReviews,leftIcon:p.MoveLeft},{default:c(()=>[...e[4]||(e[4]=[o("span",null,"Reviews",-1)])]),_:1},8,["action","leftIcon"]),e[5]||(e[5]=o("h1",{class:"text-2xl font-semibold"},"Write A Review",-1))]),t.reviewForm?(m(),n(g,{key:1},[o("div",q,[a(u,{type:"text",label:"Name",placeholder:"Your name",modelValue:t.reviewForm.name,"onUpdate:modelValue":e[0]||(e[0]=i=>t.reviewForm.name=i),secondaryLabel:"(optional)",errorText:t.formState.getFormError("name")},null,8,["modelValue","errorText"]),a(u,{type:"text",label:"Mobile Number",placeholder:"+26772000001",secondaryLabel:"(optional)",modelValue:t.reviewForm.mobile_number,"onUpdate:modelValue":e[1]||(e[1]=i=>t.reviewForm.mobile_number=i),errorText:t.formState.getFormError("mobile_number")},null,8,["modelValue","errorText"])]),o("div",W,[o("div",null,[e[6]||(e[6]=o("label",{class:"text-sm leading-6 font-medium text-gray-900"},"Rating",-1)),o("div",Y,[(m(),n(g,null,_(5,i=>a(x,{size:32,key:i,class:"cursor-pointer",onClick:J=>t.setRating(i),fill:i<=t.reviewForm.rating?"gold":"none",stroke:i<=t.reviewForm.rating?"gold":"gray"},null,8,["onClick","fill","stroke"])),64))]),t.formState.getFormError("rating")?(m(),n("p",D,L(t.formState.getFormError("rating")),1)):f("",!0)]),a(u,{rows:"2",type:"textarea",label:"Comment",modelValue:t.reviewForm.comment,"onUpdate:modelValue":e[2]||(e[2]=i=>t.reviewForm.comment=i),placeholder:"Share your experience...",errorText:t.formState.getFormError("comment"),tooltipContent:"A short description of your feedback"},null,8,["modelValue","errorText"]),o("div",G,[a(w,{size:"sm",type:"primary",leftIcon:p.Star,action:t.createReview,loading:p.isSubmitting},{default:c(()=>[...e[7]||(e[7]=[o("span",null,"Send Review",-1)])]),_:1},8,["leftIcon","action","loading"])])])],64)):f("",!0)]))])])}const Ge=M(N,[["render",H]]);export{Ge as default};
