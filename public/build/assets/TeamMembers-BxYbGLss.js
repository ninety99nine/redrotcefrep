import{p as q,q as D,c as m,b as r,a as p,g as l,h as T,r as h,o as n,F as f,f as y,k as S,w,e as b,t as u,i as k,d as L}from"./app-BFRszLDY.js";import{i as E}from"./index-DhTHOtvJ.js";import{P as F}from"./Pill-Tc8R0SoQ.js";import{I as V}from"./Input-D2CpQCT5.js";import{M as U}from"./Modal-Cn5tyxTP.js";import{L as B}from"./Loader-CVwI2N_w.js";import{B as j}from"./Button-DCQzWhi0.js";import{P as z}from"./Popover-7t3v7uU0.js";import{D as O}from"./Dropdown-CpdLLFNy.js";import{T as W}from"./Table-DFBc6y7n.js";import{a as Y}from"./stringUtils-Bvzw0-oW.js";import{N as Z}from"./NoDataPlaceholder-BkgEmswc.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as C}from"./plus-B7cTGDAB.js";import{M as G}from"./move-Dd7XxmJu.js";import{T as J}from"./trash-2-CG5LzenE.js";import"./Tooltip-BCcWuuCA.js";import"./Copy-BnPm0WTY.js";import"./ShineEffect-jVKnL5S-.js";import"./createLucideIcon-CSc6mW6X.js";import"./Skeleton-Cb_5uZP7.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-DHHZfB71.js";import"./circle-check--aSqogot.js";import"./circle-alert-C2w03bbG.js";import"./x-t57Ey7ol.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Select-DX-XgYP0.js";import"./Paginator-jjvKspqj.js";import"./Drawer-Z-XvPFMU.js";import"./SelectCountry-xtLhVYyF.js";import"./Datepicker-223716MX.js";import"./chevron-up-C_VBavIw.js";import"./Switch-Cs_wN3SM.js";import"./vue-draggable-next.esm-bundler-CYsXuEiO.js";import"./rotate-ccw-r2YeGhJw.js";const K={inject:["formState","storeState","notificationState"],components:{Move:G,Plus:C,Pill:F,Input:V,Modal:U,Loader:B,Button:j,Popover:z,Dropdown:O,Table:W,NoDataPlaceholder:Z},data(){return{Plus:C,Trash2:J,teamMembers:[],perPage:"15",checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,latestRequestId:0,filterExpressions:[],sortingExpressions:[],removableTeamMember:null,cancelTokenSource:null,isRemovingTeamMemberIds:[],isLoadingTeamMembers:!1,columns:this.prepareColumns(),bulkSelectionOptions:[{label:"Remove",action:this.showRemoveTeamMembersModal}]}},watch:{store(o,e){!e&&o&&this.showTeamMembers()},selectAll(o){this.checkedRows=this.teamMembers.reduce((e,t)=>(e[t.id]=o,e),{})}},computed:{store(){return this.storeState.store},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},isRemovingTeamMembers(){return this.isRemovingTeamMemberIds.length>0},totalCheckedRows(){return Object.values(this.checkedRows).filter(o=>o).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0}},methods:{isNotEmpty:Y,formattedDatetime:D,formattedRelativeDate:q,prepareColumns(){const o=["Name","Email","Role","Created Date"],e=["Name","Email","Role","Created Date"];return o.map(t=>({name:t,active:e.includes(t),priority:e.includes(t)}))},showRemoveTeamMembersModal(){this.$refs.actionDropdown.hideDropdown(),this.$refs.removeTeamMembersModal.showModal()},showRemoveConfirmationModal(o){this.removableTeamMember=o,this.$refs.removeTeamMemberModal.showModal()},isRemovingTeamMember(o){return o==null?!1:this.isRemovingTeamMemberIds.findIndex(e=>e==o.id)!=-1},onView(o){this.$router.push({name:"edit-team-member",params:{user_id:o.id},query:{store_id:this.store.id,searchTerm:this.searchTerm,filterExpressions:this.filterExpressions.join("|"),sortingExpressions:this.sortingExpressions.join("|")}})},onAddTeamMember(){this.$router.push({name:"add-team-member",query:{store_id:this.store.id}})},paginate(o){this.showTeamMembers(o)},search(o){this.searchTerm=o,this.showTeamMembers()},updatedColumns(o){this.columns=o},updatedFilters(o){const e=o.map(t=>t.expression);E(this.filterExpressions,e)||(this.filterExpressions=e,this.showTeamMembers())},updatedSorting(o){const e=o.map(t=>t.expression);E(this.sortingExpressions,e)||(this.sortingExpressions=e,this.showTeamMembers())},updatedPerPage(o){this.perPage=o,this.showTeamMembers()},async showTeamMembers(o=1){var t,d;const e=++this.latestRequestId;try{this.isLoadingTeamMembers=!0,this.cancelTokenSource&&this.cancelTokenSource.cancel("Request superseded by a newer one"),this.cancelTokenSource=T.CancelToken.source();let s={params:{page:o,per_page:this.perPage,store_id:this.store.id,_relationships:["roles"].join(",")},cancelToken:this.cancelTokenSource.token};this.hasSearchTerm&&(s.params.search=this.searchTerm),this.hasFilterExpressions&&(s.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(s.params._sort=this.sortingExpressions.join("|"));const i=await T.get("/api/team-members",s);if(e!==this.latestRequestId)return;this.pagination=i.data,this.teamMembers=this.pagination.data,this.checkedRows=this.teamMembers.reduce((v,x)=>(v[x.id]=!1,v),{})}catch(s){if(T.isCancel(s)||e!==this.latestRequestId)return;const i=((d=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:d.message)||(s==null?void 0:s.message)||"Something went wrong while fetching team members";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(s),console.error("Failed to fetch team members:",s)}finally{if(e!==this.latestRequestId)return;this.isLoadingTeamMembers=!1,this.cancelTokenSource=null}},async removeTeamMembers(){var o,e;try{const t=this.teamMembers.filter(s=>this.checkedRows[s.id]).map(s=>s.id).filter(s=>!this.isRemovingTeamMemberIds.includes(s));if(t.length===0)return;this.isRemovingTeamMemberIds.push(...t);const d={data:{store_id:this.store.id,user_ids:t}};await T.delete("/api/team-members",d),this.storeState.silentUpdate(),this.notificationState.showSuccessNotification(t.length==1?"Team member removed":"Team members removed"),this.teamMembers=this.teamMembers.filter(s=>!t.includes(s.id)),this.teamMembers.length==0&&this.showTeamMembers(),this.isRemovingTeamMemberIds=this.isRemovingTeamMemberIds.filter(s=>!t.includes(s)),t.forEach(s=>{this.checkedRows[s]!==void 0&&(this.checkedRows[s]=!1)}),this.selectAll=!1}catch(t){const d=((e=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Something went wrong while removing team members";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(t),console.error("Failed to remove team members:",t)}finally{this.$refs.removeTeamMembersModal.hideModal()}},async removeTeamMember(){var o,e;try{if(this.isRemovingTeamMemberIds.includes(this.removableTeamMember.id))return;this.isRemovingTeamMemberIds.push(this.removableTeamMember.id);const t={data:{store_id:this.store.id}};await T.delete(`/api/team-members/${this.removableTeamMember.id}`,t),this.storeState.silentUpdate(),this.notificationState.showSuccessNotification("Team member removed"),this.teamMembers=this.teamMembers.filter(d=>d.id!=this.removableTeamMember.id),this.teamMembers.length==0&&this.showTeamMembers()}catch(t){const d=((e=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Something went wrong while removing team member";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(t),console.error("Failed to remove team member:",t)}finally{this.isRemovingTeamMemberIds.splice(this.isRemovingTeamMemberIds.findIndex(t=>t==this.removableTeamMember.id),1),this.$refs.removeTeamMemberModal.hideModal()}}},created(){this.isLoadingTeamMembers=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.store&&this.showTeamMembers()}},Q={class:"pt-24 px-8 relative select-none"},X={class:"relative bg-white/80 p-4 rounded-md mb-60"},$={class:"flex items-center space-x-2"},ee={scope:"col",class:"whitespace-nowrap align-center px-4 py-4"},se={key:0,scope:"col",class:"whitespace-nowrap align-center pr-4 py-4"},te=["onClick"],oe={key:0,class:"whitespace-nowrap align-center pr-4 py-4 text-sm"},re={key:1,class:"whitespace-nowrap align-center pr-4 py-4 text-sm"},ie={key:2,class:"align-center pr-4 py-4 text-sm"},ae={key:3,class:"whitespace-nowrap align-center pr-4 py-4 text-sm"},ne={class:"flex space-x-1 items-center"},me={key:2,class:"align-center pr-4 py-4"},le={class:"flex items-center space-x-4"},de=["onClick"],pe=["onClick"],ce={class:"flex justify-between items-end p-10 bg-blue-50 border-t border-blue-200"},he={class:"flex space-x-2 items-center p-4 text-xs bg-red-50 rounded-lg mb-8"},ue={class:"text-red-500"},be={key:0,class:"mb-8"},ge={class:"font-bold text-black"};function fe(o,e,t,d,s,i){const v=h("Button"),x=h("Dropdown"),R=h("Input"),P=h("Pill"),I=h("Popover"),A=h("Loader"),N=h("Table"),_=h("Modal");return n(),m("div",Q,[e[14]||(e[14]=r("img",{src:"/images/clouds.png",class:"absolute bottom-0"},null,-1)),r("div",X,[e[8]||(e[8]=r("h1",{class:"text-lg font-semibold mb-4"},"Team Members",-1)),p(N,{onSearch:i.search,columns:s.columns,perPage:s.perPage,onPaginate:i.paginate,resource:"team-members",onRefresh:i.showTeamMembers,searchTerm:s.searchTerm,pagination:s.pagination,isLoading:s.isLoadingTeamMembers,onUpdatedColumns:i.updatedColumns,onUpdatedFilters:i.updatedFilters,onUpdatedSorting:i.updatedSorting,onUpdatedPerPage:i.updatedPerPage,filterExpressions:s.filterExpressions,sortingExpressions:s.sortingExpressions,searchPlaceholder:"Search by team member name"},{afterRefreshButton:l(()=>[r("div",$,[p(v,{size:"xs",type:"primary",leftIcon:s.Plus,action:i.onAddTeamMember},{default:l(()=>[...e[2]||(e[2]=[r("span",null,"Add Team Member",-1)])]),_:1},8,["leftIcon","action"])])]),belowToolbar:l(()=>[r("div",{class:S([{hidden:i.totalCheckedRows==0},"bg-gray-50 border border-gray-200 flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[e[3]||(e[3]=r("span",{class:"text-sm"},"Actions: ",-1)),p(x,{ref:"actionDropdown",dropdownClasses:"w-72",options:s.bulkSelectionOptions},{triggerText:l(()=>[r("span",null,"Select Action ("+u(`${i.totalCheckedRows} selected`)+")",1)]),_:1},8,["options"])],2)]),head:l(()=>[r("tr",null,[r("th",ee,[p(R,{type:"checkbox",modelValue:s.selectAll,"onUpdate:modelValue":e[0]||(e[0]=a=>s.selectAll=a)},null,8,["modelValue"])]),(n(!0),m(f,null,y(s.columns,(a,c)=>(n(),m(f,{key:c},[a.active?(n(),m("th",se,u(a.name),1)):b("",!0)],64))),128)),e[4]||(e[4]=r("th",{scope:"col",class:"whitespace-nowrap align-center pr-4 py-4"},null,-1))])]),body:l(()=>[(n(!0),m(f,null,y(s.teamMembers,a=>(n(),m("tr",{key:a.id,onClick:w(c=>i.onView(a),["stop"]),class:S([s.checkedRows[a.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer border-b border-blue-100"])},[(n(!0),m(f,null,y(s.columns,(c,M)=>(n(),m(f,{key:M},[M==0?(n(),m("td",{key:0,onClick:e[1]||(e[1]=w(()=>{},["stop"])),class:"whitespace-nowrap align-center px-4 py-4"},[p(R,{type:"checkbox",modelValue:s.checkedRows[a.id],"onUpdate:modelValue":g=>s.checkedRows[a.id]=g},null,8,["modelValue","onUpdate:modelValue"])])):b("",!0),c.active?(n(),m(f,{key:1},[c.name=="Name"?(n(),m("td",oe,[r("span",null,u(a.name),1)])):c.name=="Email"?(n(),m("td",re,[r("span",null,u(a.email),1)])):c.name=="Role"?(n(),m("td",ie,[p(P,{type:"light",size:"xs"},{default:l(()=>{var g;return[k(u(((g=a.roles[0])==null?void 0:g.name)||"None"),1)]}),_:2},1024)])):c.name=="Created Date"?(n(),m("td",ae,[r("div",ne,[r("span",null,u(i.formattedDatetime(a.created_at)),1),p(I,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:i.formattedRelativeDate(a.created_at)},null,8,["content"])])])):b("",!0)],64)):b("",!0),M==s.columns.length-1?(n(),m("td",me,[r("div",le,[i.isRemovingTeamMember(a)?b("",!0):(n(),m("span",{key:0,onClick:w(g=>i.onView(a),["stop","prevent"]),class:"text-sm font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,de)),i.isRemovingTeamMember(a)?(n(),L(A,{key:1,type:"danger"},{default:l(()=>[...e[5]||(e[5]=[r("span",{class:"text-xs ml-2"},"Removing...",-1)])]),_:1})):(n(),m("span",{key:2,onClick:w(g=>i.showRemoveConfirmationModal(a),["stop","prevent"]),class:"text-sm font-medium text-red-600 dark:text-red-500 hover:underline"},"Remove",8,pe))])])):b("",!0)],64))),128))],10,te))),128))]),noResults:l(()=>[r("div",ce,[e[7]||(e[7]=r("div",null,[r("h1",{class:"text-2xl font-bold mb-4"}," Ready to Build Your Team? "),r("p",{class:"text-sm text-gray-500"}," Your team members will appear here once you add them. ")],-1)),r("div",null,[p(v,{size:"lg",type:"primary",leftIcon:s.Plus,action:i.onAddTeamMember},{default:l(()=>[...e[6]||(e[6]=[r("span",null,"Add Team Member",-1)])]),_:1},8,["leftIcon","action"])])])]),_:1},8,["onSearch","columns","perPage","onPaginate","onRefresh","searchTerm","pagination","isLoading","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","filterExpressions","sortingExpressions"])]),p(_,{approveType:"danger",ref:"removeTeamMembersModal",leftApproveIcon:s.Trash2,approveAction:i.removeTeamMembers,approveLoading:i.isRemovingTeamMembers,approveText:i.totalCheckedRows==1?"Remove Team Member":"Remove Team Members"},{content:l(()=>[e[10]||(e[10]=r("p",{class:"text-lg font-bold border-b border-gray-300 border-dashed pb-4 mb-4"},"Remove Team Members",-1)),r("div",he,[e[9]||(e[9]=r("svg",{class:"w-6 h-6 text-red-500 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})],-1)),r("span",ue,"Are you sure you want to remove "+u(i.totalCheckedRows>1?`these ${i.totalCheckedRows} team members`:"this team member")+"?",1)])]),_:1},8,["leftApproveIcon","approveAction","approveLoading","approveText"]),p(_,{approveType:"danger",ref:"removeTeamMemberModal",leftApproveIcon:s.Trash2,approveText:"Remove Team Member",approveAction:i.removeTeamMember,approveLoading:i.isRemovingTeamMember(s.removableTeamMember)},{content:l(()=>[e[13]||(e[13]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Confirm Remove",-1)),s.removableTeamMember?(n(),m("p",be,[e[11]||(e[11]=k("Are you sure you want to remove ",-1)),r("span",ge,u(s.removableTeamMember.name),1),e[12]||(e[12]=k("?",-1))])):b("",!0)]),_:1},8,["leftApproveIcon","approveAction","approveLoading"])])}const es=H(K,[["render",fe]]);export{es as default};
