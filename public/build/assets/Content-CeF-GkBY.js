import{h as M,c as d,d as p,a as c,r as m,o,e as h,b as r,t as l,F as b,f as k,k as I,w as D,g as x,i as v,p as q,q as A,s as Q,u as V,G as Z,ah as H}from"./app-811fDb4C.js";import{I as N,r as K}from"./Input-Ch5FVRoG.js";import{S as z}from"./Select-B89KxZtb.js";import{S as T}from"./Skeleton-DGkj9lRL.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as J}from"./Popover-DfwFh9bM.js";import{P as U}from"./Pill-aGbs_XL2.js";import{B as F}from"./Button-0Fhg4Aii.js";import{I as j}from"./image-2C7dvKgM.js";import{M as X}from"./move-right-DTc9G3AK.js";import{a as Y,O as $}from"./OrderPaymentStatusSelect-DdvWJtlK.js";import{M as B}from"./Modal-X3iEO6Sa.js";import{i as R,c as ee}from"./stringUtils-Bvzw0-oW.js";import{L as te}from"./Loader-DjUD9LDC.js";import{U as re}from"./user-round-B621P_aE.js";import{T as E}from"./trash-2-COAOku7K.js";import{A as se}from"./arrow-down-to-line-Qulef3ep.js";import{A as W}from"./Alert-CoP-lZmZ.js";import{G as oe}from"./GoogleMaps-RFPisK6o.js";import{C as ne}from"./CollectionStatus-Do8BI4Oy.js";import{c as ie}from"./createLucideIcon-JVTSwxMK.js";import{E as G}from"./external-link-Dvd2ainH.js";import{A as ae}from"./arrow-right-DWMOGIdg.js";import{B as de}from"./banknote-BZwDJVsw.js";import{C as le}from"./circle-dollar-sign-Bbz0-xrV.js";import{L as ce}from"./link-2-BbYSfYFs.js";import{P as me}from"./plus-BU4OPlaU.js";import"./Copy-XiSIbjW8.js";import"./ShineEffect-BW3gyXUb.js";import"./Tooltip-5EEAR2_1.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-fYK0zSuq.js";import"./circle-check-Ci8AvIUe.js";import"./circle-alert-DdTgr82K.js";import"./x-WVuudoOP.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./info-BoI19BZ7.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ie("user-round-check",[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]),he={inject:["formState","orderState","storeState","notificationState"],components:{Input:N,Select:z,Skeleton:T},data(){return{teamMembers:[],isLoadingTeamMembers:!1}},watch:{isLoadingOrder(i){!i&&this.hasOrder&&this.showTeamMembers()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},orderForm(){return this.orderState.orderForm},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},teamMemberOptions(){let i=[{label:"Unassigned",value:null}];return this.teamMembers.forEach(t=>{i.push({label:t.name,value:t.id})}),i}},methods:{async showTeamMembers(){var i,t;try{this.isLoadingTeamMembers=!0;let s={params:{store_id:this.store.id}};const a=await M.get("/api/users",s);this.pagination=a.data,this.teamMembers=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching team members";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch team members:",s)}finally{this.isLoadingTeamMembers=!1}},async updateOrder(i,t){var s,a;try{if(i={...i,store_id:this.store.id},await M.put(`/api/orders/${this.order.id}`,i),t=="team member")if(this.orderForm.assigned_to_user_id){const n=this.teamMembers.find(e=>e.id===this.orderForm.assigned_to_user_id);this.notificationState.showSuccessNotification(`Order assigned to ${n.first_name}`)}else this.notificationState.showSuccessNotification("No team member unassigned");else t=="internal note"&&(this.orderForm.internal_note?this.notificationState.showSuccessNotification("Internal note updated"):this.notificationState.showSuccessNotification("Internal note removed"),this.orderState.order.internal_note=this.orderForm.internal_note)}catch(n){const e=((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(n),console.error("Failed to update order changes:",n)}}}},ge={class:"bg-white rounded-lg p-4 mb-4"},fe={key:1,class:"space-y-4"};function pe(i,t,s,a,n,e){const g=m("Skeleton"),u=m("Select"),_=m("Input");return o(),d("div",ge,[e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:0,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),d("div",fe,[c(u,{search:!0,label:"Assigned To",options:e.teamMemberOptions,modelValue:e.orderForm.assigned_to_user_id,"onUpdate:modelValue":t[0]||(t[0]=f=>e.orderForm.assigned_to_user_id=f),skeleton:e.isLoadingOrder||!e.hasOrder||n.isLoadingTeamMembers,onChange:t[1]||(t[1]=f=>e.updateOrder({assigned_to_user_id:f},"team member"))},null,8,["options","modelValue","skeleton"]),c(_,{rows:"2",type:"textarea",label:"Internal Note",modelValue:e.orderForm.internal_note,"onUpdate:modelValue":t[2]||(t[2]=f=>e.orderForm.internal_note=f),description:"Visible to team members",errorText:e.formState.getFormError("internal_note"),onBlur:t[3]||(t[3]=f=>e.updateOrder({internal_note:f},"internal note")),tooltipContent:"Internal information about this order only visible to you and other team members"},null,8,["modelValue","errorText"])]))])}const _e=C(he,[["render",pe]]),ye={inject:["orderState","storeState"],components:{Skeleton:T},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder},hasTaxTotal(){return this.isLoadingOrder?!1:this.order.vat_amount.amount>0},hasFeeTotal(){return this.isLoadingOrder?!1:this.order.fee_total.amount>0},hasDiscountTotal(){return this.isLoadingOrder?!1:this.order.discount_total.amount>0},orderFees(){return this.isLoadingOrder?[]:this.order.order_fees},orderDiscounts(){return this.isLoadingOrder?[]:this.order.order_discounts}},methods:{removeDecimalTrailingZeros:K}},be={class:"bg-blue-50 border border-blue-400 rounded-lg p-4"},we={key:0,class:"flex items-center justify-between text-sm border-b border-dashed border-gray-300 pb-2 mb-2"},xe={key:1},Se={key:1,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},ve={key:1},Oe={key:3},ke={key:2,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Ce={class:"flex items-center justify-between text-sm mb-1"},Pe={key:1,class:"w-full"},Te={key:3},Le={key:1,class:"text-xs text-gray-400"},Ie={key:3,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Fe={key:1},De={key:3},je={class:"flex items-center justify-between text-base pt-2"},Me={key:1,class:"font-bold"};function Ne(i,t,s,a,n,e){const g=m("Skeleton");return o(),d("div",be,[e.isLoadingOrder||!e.hasOrder||e.hasTaxTotal||e.hasDiscountTotal||e.hasFeeTotal?(o(),d("div",we,[t[0]||(t[0]=r("span",null,"Subtotal",-1)),e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",xe,l(e.order.subtotal.amount_with_currency),1))])):h("",!0),e.isLoadingOrder||!e.hasOrder||e.hasDiscountTotal?(o(),d("div",Se,[(o(!0),d(b,null,k(e.isLoadingOrder||!e.hasOrder?[1]:e.orderDiscounts,(u,_)=>(o(),d("div",{key:_,class:"flex items-center justify-between text-sm text-gray-500"},[e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",ve,l(u.name),1)),e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:2,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Oe,l(u.amount.amount_with_currency),1))]))),128))])):h("",!0),e.isLoadingOrder||!e.hasOrder||e.hasTaxTotal?(o(),d("div",ke,[r("div",Ce,[e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:0,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("div",Pe,"Tax ("+l(e.removeDecimalTrailingZeros(e.order.vat_rate))+"% "+l(e.order.vat_method)+")",1)),e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",Te,l(e.order.vat_amount.amount_with_currency),1))]),e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:0,width:"w-1/3",color:"bg-blue-200",shine:!0})):e.order.vat_amount.amount>0?(o(),d("p",Le,"Tax calculated on the discounted subtotal of "+l(e.order.subtotal_after_discount.amount_with_currency),1)):h("",!0)])):h("",!0),e.isLoadingOrder||!e.hasOrder||e.hasFeeTotal?(o(),d("div",Ie,[(o(!0),d(b,null,k(e.isLoadingOrder||!e.hasOrder?[1]:e.orderFees,(u,_)=>(o(),d("div",{key:_,class:"flex items-center justify-between text-sm text-gray-500"},[e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Fe,l(u.name),1)),e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",De,l(u.amount.amount_with_currency),1))]))),128))])):h("",!0),r("div",je,[t[1]||(t[1]=r("div",{class:"w-full font-bold"},"Grand Total",-1)),e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",Me,l(e.order.grand_total.amount_with_currency),1))])])}const Ee=C(ye,[["render",Ne]]),Ae={inject:["orderState","storeState"],components:{Image:j,Pill:U,Button:F},props:{orderProduct:{type:Object}},data(){return{MoveRight:X,expanded:!1}},computed:{store(){return this.storeState.store},hasDetectedChanges(){return this.orderProduct.detected_changes.length>0},totalDetectedChanges(){return this.orderProduct.detected_changes.length},hasPhoto(){return this.photo!=null},photo(){return this.orderProduct.photo},canShowProduct(){return this.orderProduct.product_id!=null}},methods:{toggleExpansion(){this.expanded=!this.expanded},navigateToProduct(){console.log(this.orderProduct),this.$router.push({name:"edit-product",params:{product_id:this.orderProduct.product_id},query:{store_id:this.store.id}})}}},Ue={class:"w-full flex items-center space-x-4"},Ve=["src"],ze={class:"w-full flex items-center justify-between"},Be={class:"font-semibold text-sm whitespace-nowrap"},Re={class:"text-sm font-semibold"},We={class:"text-xs text-gray-500"},Ge={class:"flex items-center space-x-2 mr-4"},qe={class:"flex items-center space-x-2"},Qe={class:"text-sm"},Ze={key:0,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},He={key:1,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},Ke={key:0,class:"text-sm p-4 pb-8"},Je={class:"flex items-end justify-between mb-4 ml-4"},Xe={class:"w-full overflow-x-auto rounded-lg border border-gray-300 mb-4"},Ye={class:"w-full text-sm text-left rtl:text-right text-gray-500"},$e={class:"whitespace-nowrap align-top text-left p-2 pl-4"},et={class:"whitespace-nowrap align-top text-center py-2"},tt={class:"whitespace-nowrap align-top text-center py-2"},rt={class:"whitespace-nowrap align-top text-center py-2"},st={class:"whitespace-nowrap align-top text-center py-2"},ot={class:"whitespace-nowrap align-top text-right p-2 pr-4"},nt={class:"w-full overflow-x-auto rounded-lg border border-gray-300 mb-4"},it={class:"w-full text-sm text-left rtl:text-right text-gray-500"},at={class:"whitespace-nowrap align-top text-left p-2 pl-4"},dt={class:"whitespace-nowrap align-top text-center p-2"},lt={class:"whitespace-nowrap align-top text-center p-2"},ct={class:"w-full overflow-x-auto rounded-lg border mb-4"},mt={class:"w-full text-sm text-left rtl:text-right text-gray-500"},ut={key:0,class:"whitespace-nowrap align-top text-left p-2 pl-4"},ht={key:1,class:"whitespace-nowrap align-top text-center p-2"},gt={class:"space-y-2"},ft={class:"text-xs"};function pt(i,t,s,a,n,e){const g=m("Image"),u=m("Pill"),_=m("Button");return o(),d("div",{class:I([{"shadow-md":n.expanded},"select-none rounded-lg overflow-hidden border border-gray-300"])},[r("div",{onClick:t[1]||(t[1]=(...f)=>e.toggleExpansion&&e.toggleExpansion(...f)),class:I([{"shadow-sm border-b border-gray-300":n.expanded},"flex justify-between items-center cursor-pointer p-2 bg-gray-50 hover:bg-gray-100"])},[r("div",Ue,[r("div",{class:I(["flex items-center justify-center w-10 h-10 rounded-lg",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),d("img",{key:0,class:"w-full max-h-full object-contain rounded-lg flex-shrink-0",src:e.photo.path},null,8,Ve)):(o(),p(g,{key:1,size:"20",class:"text-gray-400 flex-shrink-0"}))],2),r("div",ze,[r("div",null,[r("div",{onClick:t[0]||(t[0]=D((...f)=>e.navigateToProduct&&e.navigateToProduct(...f),["stop"])),class:"flex items-center space-x-2 hover:text-blue-500 hover:underline"},[r("span",Be,l(s.orderProduct.quantity)+" x",1),r("span",Re,l(s.orderProduct.name),1)]),r("div",We,l(s.orderProduct.unit_price.amount_with_currency)+" each",1)]),r("div",Ge,[e.hasDetectedChanges?(o(),p(u,{key:0,type:"warning",size:"xs",showDot:!1},{default:x(()=>[v(l(`${e.totalDetectedChanges} ${e.totalDetectedChanges==1?"change":"changes"} found`),1)]),_:1})):h("",!0),s.orderProduct.on_sale?(o(),p(u,{key:1,type:"success",size:"xs",showDot:!1},{default:x(()=>[...t[2]||(t[2]=[v("on sale",-1)])]),_:1})):h("",!0),s.orderProduct.is_free?(o(),p(u,{key:2,type:"success",size:"xs",showDot:!1},{default:x(()=>[...t[3]||(t[3]=[v("free",-1)])]),_:1})):h("",!0)])])]),r("div",qe,[r("span",Qe,l(s.orderProduct.grand_total.amount_with_currency),1),n.expanded?(o(),d("svg",Ze,[...t[4]||(t[4]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"},null,-1)])])):(o(),d("svg",He,[...t[5]||(t[5]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"},null,-1)])]))])],2),n.expanded?(o(),d("div",Ke,[r("div",Je,[t[7]||(t[7]=r("h1",{class:"text-sm text-gray-500 font-semibold"},"Pricing",-1)),e.canShowProduct?(o(),p(_,{key:0,size:"xs",type:"light",rightIcon:n.MoveRight,action:e.navigateToProduct},{default:x(()=>[...t[6]||(t[6]=[r("span",null,"Show Product",-1)])]),_:1},8,["rightIcon","action"])):h("",!0)]),r("div",Xe,[r("table",Ye,[t[8]||(t[8]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"Regular Price")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Sale Price")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Quantity")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Subtotal")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Discount Total")]),r("th",{class:"whitespace-nowrap align-top text-right p-2 pr-4"},[r("span",null,"Grand Total")])])],-1)),r("tbody",null,[r("tr",null,[r("td",$e,[r("span",null,l(s.orderProduct.unit_regular_price.amount_with_currency),1)]),r("td",et,[r("span",null,l(s.orderProduct.unit_sale_price.amount_with_currency),1)]),r("td",tt,[r("span",null,l(s.orderProduct.quantity),1)]),r("td",rt,[r("span",null,l(s.orderProduct.subtotal.amount_with_currency),1)]),r("td",st,[r("span",null,l(s.orderProduct.sale_discount_total.amount_with_currency),1)]),r("td",ot,[r("span",null,l(s.orderProduct.grand_total.amount_with_currency),1)])])])])]),s.orderProduct.unit_weight>0?(o(),d(b,{key:0},[t[10]||(t[10]=r("h1",{class:"text-sm text-gray-500 font-semibold mb-4 ml-4"},"Weight",-1)),r("div",nt,[r("table",it,[t[9]||(t[9]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"Unit Weight")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Quantity")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Total Weight")])])],-1)),r("tbody",null,[r("tr",null,[r("td",at,[r("span",null,l(s.orderProduct.unit_weight),1)]),r("td",dt,[r("span",null,l(s.orderProduct.quantity),1)]),r("td",lt,[r("span",null,l(s.orderProduct.unit_weight),1)])])])])])],64)):h("",!0),s.orderProduct.sku||s.orderProduct.barcode?(o(),d(b,{key:1},[t[12]||(t[12]=r("h1",{class:"text-base text-gray-500 font-semibold mb-4 ml-4"},"Identification",-1)),r("div",ct,[r("table",mt,[t[11]||(t[11]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"SKU")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Barcode")])])],-1)),r("tbody",null,[r("tr",null,[s.orderProduct.sku?(o(),d("td",ut,[r("span",null,l(s.orderProduct.sku),1)])):h("",!0),s.orderProduct.barcode?(o(),d("td",ht,[r("span",null,l(s.orderProduct.barcode),1)])):h("",!0)])])])])],64)):h("",!0),e.hasDetectedChanges?(o(),d(b,{key:2},[t[13]||(t[13]=r("h1",{class:"text-base text-gray-500 font-semibold mb-4 ml-4"},"Changes",-1)),r("div",gt,[(o(!0),d(b,null,k(s.orderProduct.detected_changes,(f,S)=>(o(),d("div",{key:S,class:"flex space-x-2 p-2 border-l-8 border-yellow-300 bg-gray-50"},[r("p",ft,l(f.message),1)]))),128))])],64)):h("",!0)])):h("",!0)],2)}const _t=C(Ae,[["render",pt]]),yt={inject:["storeState","orderState"],components:{Image:j,Skeleton:T,OrderProduct:_t},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},orderProducts(){return this.order.order_products}}},bt={key:0,class:"space-y-2"},wt={class:"flex items-center justify-center w-10 h-10 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},xt={class:"w-full flex justify-between"},St={class:"flex items-center space-x-2"};function vt(i,t,s,a,n,e){const g=m("Image"),u=m("Skeleton"),_=m("OrderProduct");return e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",bt,[(o(),d(b,null,k([1,2],(f,S)=>r("div",{key:S,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50"},[r("div",wt,[c(g,{size:"20",class:"text-gray-400"})]),r("div",xt,[c(u,{width:"w-1/3",shine:!0}),r("div",St,[c(u,{width:"w-16",shine:!0}),c(u,{width:"w-4",shine:!0})])])])),64))])):(o(!0),d(b,{key:1},k(e.orderProducts,(f,S)=>(o(),p(_,{key:S,orderProduct:f},null,8,["orderProduct"]))),128))}const Ot=C(yt,[["render",vt]]),kt={inject:["formState","orderState","storeState","notificationState"],components:{Popover:J,Skeleton:T,OrderTotals:Ee,OrderProducts:Ot,OrderStatusSelect:Y},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderId(){return this.$route.params.order_id},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder}},methods:{formattedDatetime:A,formattedRelativeDate:q,async updateOrder(i){var t,s;try{i={...i,store_id:this.store.id},await axios.put(`/api/orders/${this.orderId}`,i),this.notificationState.showSuccessNotification(`Order ${this.orderForm.status}`),this.orderState.order.status=this.orderForm.status}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}}},Ct={class:"bg-white overflow-hidden rounded-lg space-y-4 p-4 mb-4"},Pt={class:"flex justify-between items-center"},Tt={class:"text-gray-700 font-semibold mb-4"},Lt={class:"flex space-x-4"},It={key:0,class:"flex items-center justify-end space-x-1"},Ft={class:"text-gray-500 text-xs"};function Dt(i,t,s,a,n,e){const g=m("Popover"),u=m("Skeleton"),_=m("OrderStatusSelect"),f=m("OrderProducts"),S=m("OrderTotals");return o(),d("div",Ct,[r("div",Pt,[r("h1",Tt,[t[1]||(t[1]=v("Items ",-1)),!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d(b,{key:0},[v("("+l(e.order.total_uncancelled_product_quantities)+")",1)],64)):h("",!0)]),r("div",Lt,[!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d("div",It,[r("span",Ft,l(e.formattedDatetime(e.order.created_at)),1),c(g,{content:`Created ${e.formattedRelativeDate(e.order.created_at)}`},null,8,["content"])])):h("",!0),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(u,{key:1,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),p(_,{key:2,class:"w-48",showLabel:!1,onChange:t[0]||(t[0]=P=>e.updateOrder({status:P}))}))])]),c(f),c(S)])}const jt=C(kt,[["render",Dt]]),Mt={components:{UserRound:re,Pill:U,Loader:te,Button:F},props:{index:{type:Number},orderComment:{type:Object},onViewPhoto:{type:Function},deleteOrderComment:{type:Function},isDeletingOrderCommentIds:{type:Array}},data(){return{Trash2:E,expanded:!1}},computed:{user(){return this.orderComment.user},hasPhotos(){return this.photos.length>0},photos(){return this.orderComment.photos},isDeletingOrderComment(){return this.isDeletingOrderCommentIds.findIndex(i=>i==this.orderComment.id)!=-1}},methods:{formattedDatetime:A}},Nt={class:"bg-gray-100 p-2 rounded-lg leading-0"},Et={key:0,class:"font-bold text-sm"},At={class:"text-sm"},Ut={key:1,class:"flex flex-wrap space-x-2 space-y-2 my-2"},Vt=["src","onClick"],zt={class:"flex justify-between"},Bt={class:"text-gray-400 text-xs"};function Rt(i,t,s,a,n,e){const g=m("Loader"),u=m("Button");return o(),d("div",Nt,[e.user?(o(),d("p",Et,l(e.user.name),1)):h("",!0),r("p",At,l(s.orderComment.comment),1),e.hasPhotos?(o(),d("div",Ut,[(o(!0),d(b,null,k(e.photos,_=>(o(),d("img",{key:_.id,src:_.path,onClick:()=>s.onViewPhoto(_),class:"max-h-20 object-contain rounded-lg flex-shrink-0 hover:scale-105 transition-all cursor-pointer"},null,8,Vt))),128))])):h("",!0),r("div",zt,[r("p",Bt,l(e.formattedDatetime(s.orderComment.created_at)),1),e.user?(o(),d(b,{key:0},[e.isDeletingOrderComment?(o(),p(g,{key:0,type:"danger"})):(o(),p(u,{key:1,size:"xs",leftIconSize:"14",leftIcon:n.Trash2,type:"bareDanger",action:()=>s.deleteOrderComment(s.orderComment)},null,8,["leftIcon","action"]))],64)):h("",!0)])])}const Wt=C(Mt,[["render",Rt]]),Gt={inject:["authState","formState","storeState","orderState","notificationState"],components:{Image:j,Modal:B,Input:N,Button:F,Skeleton:T,OrderComment:Wt},data(){return{Trash2:E,ArrowDownToLine:se,form:{photos:[],comment:""},pagination:null,orderComments:[],isUploading:!1,orderCommentPhoto:null,createdOrderComment:null,isCreatingOrderComment:!1,isLoadingOrderComments:!1,isDeletingOrderCommentIds:[],isDeletingOrderCommentPhotoIds:[],isDownloadingOrderCommentPhotoIds:[],isDownloadingOrderCommentPhoto:!1}},watch:{store(i,t){!t&&i&&this.showOrderComments()},isUploading(i){i==!1&&this.orderCommentCreationCompleted()}},computed:{store(){return this.storeState.store},orderId(){return this.$route.params.order_id},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasOrderComments(){return this.orderComments.length>0}},methods:{isEmpty:R,reset(){this.form.photos=[],this.form.comment=""},async showOrderComments(){var i,t;try{this.isLoadingOrderComments=!0;let s={params:{order_id:this.orderId,store_id:this.store.id,_relationships:["photos","user"].join(",")}};const a=await axios.get("/api/order-comments",s);this.pagination=a.data,this.orderComments=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching order comments";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch order comments:",s)}finally{this.isLoadingOrderComments=!1}},onEnterCreateOrderComment(i){i.preventDefault(),this.createOrderComment()},async createOrderComment(){var i,t;try{if(this.isCreatingOrderComment||this.isUploading||(this.formState.hideFormErrors(),this.isEmpty(this.form.comment)&&this.formState.setFormError("comment","The comment is required"),this.formState.hasErrors))return;this.isCreatingOrderComment=!0;const s={order_id:this.orderId,store_id:this.store.id,comment:this.form.comment},a=await axios.post("/api/order-comments",s);this.createdOrderComment=a.data.order_comment,this.form.photos.length?this.uploadImages():this.orderCommentCreationCompleted()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while creating order comment";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to create order comment:",s),this.isCreatingOrderComment=!1}},orderCommentCreationCompleted(){this.orderComments.push({user:this.authState.user,...this.createdOrderComment,photos:this.form.photos.map(function(i){return{id:Q(),temporary:!0,path:i.path}})}),this.notificationState.showSuccessNotification("Comment created!"),this.isCreatingOrderComment=!1,this.showOrderComments(),this.reset()},async uploadImages(i=null){let t=[];for(let s=0;s<this.form.photos.length;s++){const a=this.form.photos[s];(a.uploaded===null||a.uploaded===!1)&&a.uploading==!1&&(i==null||i==s)&&t.push(this.uploadSingleImage(a,s))}return this.isUploading=!0,Promise.allSettled(t).then(s=>{let a=s.filter(n=>n.status==="rejected").length;a>0&&this.notificationState.showWarningNotification(`⚠️ ${a} image(s) failed to upload. Try again or change the image.`),this.isUploading=!1})},async uploadSingleImage(i,t,s=0,a=null){var n,e,g;try{if(s>2)return console.log(`❌ Image ${t+1} permanently failed after 3 attempts.`),i.uploaded=!1,i.uploading=!1,i.error_message=((e=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Upload failed",Promise.reject("Failed after 3 attempts");let u=new FormData;u.append("file",i.file_ref),u.append("store_id",this.store.id),u.append("mediable_type","order comment"),u.append("mediable_id",this.createdOrderComment.id),u.append("upload_folder_name","order_comment_photo"),i.uploading=!0,i.error_message=null;const _={headers:{"Content-Type":"multipart/form-data"}},f=await axios.post("/api/media-files",u,_);return i.uploaded=!0,i.uploading=!1,console.log(`✅ Image ${t+1} uploaded successfully.`),f}catch(u){return console.error(`⚠️ Image ${t+1} upload attempt ${s+1} failed.`,u),u.code==="ECONNABORTED"||((g=u.response)==null?void 0:g.status)===504?void 0:this.uploadSingleImage(i,t,s+1,u)}},onViewPhoto(i){this.orderCommentPhoto=i,this.$refs.showPhotoModal.showModal()},async downloadOrderCommentPhoto(){try{if(this.isDownloadingOrderCommentPhotoIds.includes(this.orderCommentPhoto.id))return;this.isDownloadingOrderCommentPhotoIds.push(this.orderCommentPhoto.id);let i={responseType:"blob",params:{store_id:this.store.id}};const s=(await axios.get(`/api/media-files/${this.orderCommentPhoto.id}/download`,i)).data,a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=this.orderCommentPhoto.name,n.click(),URL.revokeObjectURL(a)}catch(i){console.error("Error downloading the store QR code image:",i)}finally{this.isDownloadingOrderCommentPhotoIds.splice(this.isDownloadingOrderCommentPhotoIds.findIndex(i=>i==this.orderCommentPhoto.id),1)}},async deleteOrderCommentPhoto(){var i,t;try{if(this.isDeletingOrderCommentPhotoIds.includes(this.orderCommentPhoto.id))return;this.isDeletingOrderCommentPhotoIds.push(this.orderCommentPhoto.id);const s={data:{store_id:this.store.id}};await axios.delete(`/api/media-files/${this.orderCommentPhoto.id}`,s),this.orderComments=this.orderComments.map(a=>({...a,photos:a.photos.filter(n=>n.id!==this.orderCommentPhoto.id)})),this.notificationState.showSuccessNotification("Photo deleted"),this.$refs.showPhotoModal.hideModal()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while deleting comment photo";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to delete comment photo:",s)}finally{this.isDeletingOrderCommentPhotoIds.splice(this.isDeletingOrderCommentPhotoIds.findIndex(s=>s==this.orderCommentPhoto.id),1)}},async deleteOrderComment(i){var t,s;try{if(this.isDeletingOrderCommentIds.includes(i.id))return;this.isDeletingOrderCommentIds.push(i.id);const a={data:{store_id:this.store.id}};await axios.delete(`/api/order-comments/${i.id}`,a),this.notificationState.showSuccessNotification("Comment deleted"),this.orderComments=this.orderComments.filter(n=>n.id!=i.id)}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while deleting order comment";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to delete order comment:",a)}finally{this.isDeletingOrderCommentIds.splice(this.isDeletingOrderCommentIds.findIndex(a=>a==i.id),1)}}},created(){this.store&&this.showOrderComments()}},qt={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},Qt={class:"flex justify-between items-center space-x-4"},Zt={key:0,class:"w-full flex space-x-2"},Ht=["onClick"],Kt={key:0,class:"space-y-2"},Jt={class:"space-y-2 p-2 px-4 bg-gray-50"},Xt={class:"flex justify-between items-center space-x-8"},Yt={class:"flex items-center space-x-2 whitespace-nowrap"},$t={class:"flex justify-end items-end space-x-2"},er={class:"flex items-center justify-center w-10 h-10 rounded-lg border border-dashed border-gray-200"},tr={class:"flex justify-center"},rr=["src"],sr={key:0,class:"flex justify-end space-x-2 mt-4"};function or(i,t,s,a,n,e){const g=m("Input"),u=m("Image"),_=m("Button"),f=m("Skeleton"),S=m("OrderComment"),P=m("Modal");return o(),d(b,null,[r("div",qt,[t[8]||(t[8]=r("h1",{class:"text-gray-700 font-semibold mb-4"},"Comments",-1)),r("div",Qt,[!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d("div",Zt,[r("div",{onClick:t[6]||(t[6]=D(w=>i.$refs.comment.focusInput(),["stop"])),class:"w-full border border-gray-300 p-2 rounded-lg"},[c(g,{type:"file",maxFiles:5,class:"w-full",wrapperClass:{},modelValue:n.form.photos,"onUpdate:modelValue":t[3]||(t[3]=w=>n.form.photos=w),onRetryUploads:t[4]||(t[4]=w=>e.uploadImages()),onRetryUpload:t[5]||(t[5]=(w,O)=>e.uploadImages(O))},{fileTrigger:x(w=>[r("div",{class:"w-full flex space-x-2",onClick:t[2]||(t[2]=D(O=>i.$refs.comment.focusInput(),["stop"]))},[c(g,{rows:"1",onClick:t[0]||(t[0]=D(()=>{},["stop"])),ref:"comment",class:"w-full",type:"textarea",wrapperClass:{},modelValue:n.form.comment,"onUpdate:modelValue":t[1]||(t[1]=O=>n.form.comment=O),placeholder:"Say something",onOnEnter:e.onEnterCreateOrderComment,errorText:e.formState.getFormError("comment")},null,8,["modelValue","onOnEnter","errorText"]),r("div",{onClick:D(w.handleClick,["stop"]),class:"z-10 w-10 h-10 flex flex-shrink-0 items-center justify-center bg-gray-50 border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer"},[c(u,{size:"20",class:I([{"text-gray-400":!w.filesLeftToUpload}])},null,8,["class"])],8,Ht)])]),_:1},8,["modelValue"])]),c(_,{size:"sm",type:"primary",buttonClass:"flex-shrink-0",action:e.createOrderComment,disabled:n.isCreatingOrderComment||n.isUploading},{default:x(()=>[...t[7]||(t[7]=[r("span",null,"Post",-1)])]),_:1},8,["action","disabled"])])):h("",!0)]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",Kt,[(o(),d(b,null,k([1,2],(w,O)=>r("div",{key:O,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",Jt,[r("div",Xt,[c(f,{width:"w-1/3",shine:!0}),r("div",Yt,[c(f,{width:"w-20",shine:!0}),c(f,{width:"w-10",shine:!0}),c(f,{width:"w-10",shine:!0})])]),r("div",$t,[c(f,{width:"w-10",shine:!0}),r("div",er,[c(u,{size:"16",class:"text-gray-400 flex-shrink-0"})])])])])),64))])):(o(),d(b,{key:1},[e.hasOrderComments?(o(!0),d(b,{key:0},k(n.orderComments,(w,O)=>(o(),p(S,{index:O,key:w.id,onViewPhoto:e.onViewPhoto,orderComment:w,deleteOrderComment:e.deleteOrderComment,isDeletingOrderCommentIds:n.isDeletingOrderCommentIds},null,8,["index","onViewPhoto","orderComment","deleteOrderComment","isDeletingOrderCommentIds"]))),128)):h("",!0)],64))]),c(P,{showFooter:!1,ref:"showPhotoModal",scrollOnContent:!1},V({_:2},[n.orderCommentPhoto?{name:"content",fn:x(()=>[t[11]||(t[11]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Image Preview",-1)),r("div",tr,[r("img",{src:n.orderCommentPhoto.path},null,8,rr)]),n.orderCommentPhoto.hasOwnProperty("temporary")?h("",!0):(o(),d("div",sr,[c(_,{size:"sm",type:"primary",leftIcon:n.ArrowDownToLine,action:e.downloadOrderCommentPhoto,loading:this.isDownloadingOrderCommentPhotoIds.findIndex(w=>w==this.orderCommentPhoto.id)!=-1},{default:x(()=>[...t[9]||(t[9]=[r("span",null,"Download",-1)])]),_:1},8,["leftIcon","action","loading"]),c(_,{size:"sm",type:"danger",leftIcon:n.Trash2,action:e.deleteOrderCommentPhoto,loading:this.isDeletingOrderCommentPhotoIds.findIndex(w=>w==this.orderCommentPhoto.id)!=-1},{default:x(()=>[...t[10]||(t[10]=[r("span",null,"Delete",-1)])]),_:1},8,["leftIcon","action","loading"])]))]),key:"0"}:void 0]),1536)],64)}const nr=C(Gt,[["render",or]]),ir={inject:["formState","storeState","orderState","notificationState"],components:{UserRoundCheck:ue,Alert:W,Input:N,Select:z,Button:F,Skeleton:T,GoogleMaps:oe,CollectionStatus:ne},data(){return{ArrowRight:ae,couriers:[],ExternalLink:G,courierOptions:[],isLoadingCouriers:!1}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},customer(){return this.order.customer},deliveryMethod(){return this.order.delivery_method},deliveryAddress(){return this.order.delivery_address},selectedCourierLink(){if(!this.orderForm.courier_id||!this.couriers.length)return null;const i=this.couriers.find(n=>n.id===this.orderForm.courier_id);if(!i)return null;const t=this.orderForm.tracking_number,s=i.tracking_page;if(!t)return s;const a=s.includes("?")?"&":"?";return i.name=="DHL Express"?`${s}${a}tracking-id=${encodeURIComponent(t)}`:s},googleMapsUrl(){return!this.isLoadingOrder&&this.deliveryAddress.latitude&&this.deliveryAddress.longitude?`https://www.google.com/maps?q=${this.deliveryAddress.latitude},${this.deliveryAddress.longitude}`:null}},methods:{formattedDate:H,formattedShortWeekday:Z,openGoogleMapsLink(){window.open(this.googleMapsUrl,"_blank")},navigateToCustomer(){this.$router.push({name:"edit-customer",params:{customer_id:this.customer.id},query:{store_id:this.store.id}})},async showCouriers(){var i,t;try{if(this.couriers.length)return;this.isLoadingCouriers=!0;let s={params:{per_page:100}};const a=await M.get("/api/couriers",s);this.couriers=a.data.data,this.courierOptions=this.couriers.map(n=>({label:ee(n.name),value:n.id})),this.courierOptions.unshift({label:"None",value:null})}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching stores";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch stores:",s)}finally{this.isLoadingCouriers=!1}},async updateOrder(i,t){var s,a;try{if(i={...i,store_id:this.store.id},await M.put(`/api/orders/${this.order.id}`,i),t=="courier"){if(this.orderForm.courier_id){const n=this.courierOptions.find(e=>e.value===this.orderForm.courier_id);this.notificationState.showSuccessNotification(`Courier updated to ${n.label}`)}else this.notificationState.showSuccessNotification("Courier removed");this.orderState.order.courier_id=this.orderForm.courier_id}else t=="tracking number"?(this.orderForm.tracking_number?this.notificationState.showSuccessNotification(`Tracking number updated to ${this.orderForm.tracking_number}`):this.notificationState.showSuccessNotification("Tracking number removed"),this.orderState.order.tracking_number=this.orderForm.tracking_number):t=="remark"&&(this.orderForm.remark?this.notificationState.showSuccessNotification("Remark updated"):this.notificationState.showSuccessNotification("Remark removed"),this.orderState.order.remark=this.orderForm.remark)}catch(n){const e=((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(n),console.error("Failed to update order changes:",n)}}},created(){this.showCouriers()}},ar={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},dr={class:"flex justify-between items-center mb-4"},lr={key:0,class:"space-y-2"},cr={class:"space-y-2 p-2 px-4 bg-gray-50"},mr={class:"flex justify-between items-center space-x-8"},ur={class:"flex items-center space-x-2 whitespace-nowrap"},hr={class:"grid grid-cols-2 gap-4"},gr={class:"col-span-1"},fr={class:"col-span-1"},pr={key:0,class:"col-span-2 text-sm"},_r=["href"],yr={class:"col-span-2"},br={key:0,class:"bg-gray-50 p-4 border border-gray-200 rounded-lg space-y-2 text-sm"},wr={key:0,class:"grid grid-cols-3 items-center"},xr={class:"col-span-2 flex items-center space-x-2"},Sr={key:1,class:"grid grid-cols-3"},vr={class:"col-span-2"},Or=["href"],kr={key:2,class:"grid grid-cols-3"},Cr={class:"col-span-2"},Pr=["href"],Tr={key:3,class:"grid grid-cols-3"},Lr={class:"col-span-2"},Ir={key:4,class:"grid grid-cols-3"},Fr={class:"col-span-2"},Dr=["href"],jr={key:5,class:"grid grid-cols-3"},Mr={class:"space-x-2"},Nr={class:"list-disc text-xs space-y-2 border-t border-blue-300 border-dashed pt-2 mt-2 pl-2"},Er={key:0},Ar={class:"font-bold"},Ur={class:"font-bold"},Vr={key:1},zr={class:"font-bold"},Br={class:"font-bold"},Rr={key:2},Wr={class:"font-bold"},Gr={class:"font-bold"},qr={class:"rounded-lg overflow-hidden"},Qr={key:0,class:"flex justify-end mt-4"};function Zr(i,t,s,a,n,e){const g=m("Skeleton"),u=m("CollectionStatus"),_=m("Select"),f=m("Input"),S=m("UserRoundCheck"),P=m("Button"),w=m("Alert"),O=m("GoogleMaps");return o(),d("div",ar,[r("div",dr,[t[7]||(t[7]=r("h1",{class:"text-gray-700 font-semibold"},"Fulfillment",-1)),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:0,width:"w-20",shine:!0})):(o(),p(u,{key:1}))]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",lr,[(o(),d(b,null,k([1,2],(y,L)=>r("div",{key:L,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",cr,[r("div",mr,[c(g,{width:"w-1/3",shine:!0}),r("div",ur,[c(g,{width:"w-20",shine:!0}),c(g,{width:"w-10",shine:!0}),c(g,{width:"w-10",shine:!0})])])])])),64))])):(o(),d(b,{key:1},[r("div",hr,[r("div",gr,[c(_,{search:!0,label:"Courier",options:n.courierOptions,modelValue:e.orderForm.courier_id,"onUpdate:modelValue":t[0]||(t[0]=y=>e.orderForm.courier_id=y),errorText:e.formState.getFormError("courier_id"),onChange:t[1]||(t[1]=y=>e.updateOrder({courier_id:y},"courier"))},null,8,["options","modelValue","errorText"])]),r("div",fr,[c(f,{type:"text",label:"Tracking Number",modelValue:e.orderForm.tracking_number,"onUpdate:modelValue":t[2]||(t[2]=y=>e.orderForm.tracking_number=y),errorText:e.formState.getFormError("tracking_number"),onBlur:t[3]||(t[3]=y=>e.updateOrder({tracking_number:y},"tracking number"))},null,8,["modelValue","errorText"])]),e.selectedCourierLink?(o(),d("div",pr,[t[8]||(t[8]=r("span",null,"Tracking Page: ",-1)),r("a",{href:e.selectedCourierLink,target:"_blank",class:"text-blue-500 hover:underline"},l(e.selectedCourierLink),9,_r)])):h("",!0),r("div",yr,[c(f,{rows:"2",label:"Remark",type:"textarea",placeholder:"Optional",modelValue:e.orderForm.remark,"onUpdate:modelValue":t[4]||(t[4]=y=>e.orderForm.remark=y),description:"Visible to customer",errorText:e.formState.getFormError("remark"),onBlur:t[5]||(t[5]=y=>e.updateOrder({remark:y},"remark")),tooltipContent:"Use the Remark field to add a note that will be visible to the customer, such as special instructions, order details, or personalized messages."},null,8,["modelValue","errorText"])])]),e.order.customer_name||e.order.customer_email||e.order.customer_mobile_number||e.deliveryMethod||e.deliveryAddress||e.order.delivery_date?(o(),d("div",br,[e.order.customer_name?(o(),d("div",wr,[t[10]||(t[10]=r("span",null,"Name",-1)),r("div",xr,[e.customer?(o(),p(S,{key:0,size:"16"})):h("",!0),r("span",{class:I({"text-blue-500 hover:underline cursor-pointer":e.customer}),onClick:t[6]||(t[6]=()=>e.customer?e.navigateToCustomer():null)},l(e.order.customer_name),3),c(P,{size:"xs",type:"light",class:"hidden lg:block",rightIcon:n.ArrowRight,action:e.navigateToCustomer},{default:x(()=>[...t[9]||(t[9]=[r("span",null,"Show Profile",-1)])]),_:1},8,["rightIcon","action"])])])):h("",!0),e.order.customer_email?(o(),d("div",Sr,[t[11]||(t[11]=r("span",null,"Email",-1)),r("span",vr,[r("a",{href:`mailto:${e.order.customer_email}`,target:"_blank",class:"text-blue-500 hover:underline"},l(e.order.customer_email),9,Or)])])):h("",!0),e.order.customer_mobile_number?(o(),d("div",kr,[t[12]||(t[12]=r("span",null,"Mobile",-1)),r("span",Cr,[r("a",{href:`tel:${e.order.customer_mobile_number.international}`,target:"_blank",class:"text-blue-500 hover:underline"},l(e.order.customer_mobile_number.international),9,Pr)])])):h("",!0),e.deliveryMethod?(o(),d("div",Tr,[t[13]||(t[13]=r("span",null,"Delivery",-1)),r("span",Lr,l(e.deliveryMethod.name),1)])):h("",!0),e.deliveryAddress?(o(),d("div",Ir,[t[14]||(t[14]=r("span",null,"Address",-1)),r("span",Fr,[r("a",{href:e.googleMapsUrl,target:"_blank",class:"text-blue-500 hover:underline"},l(e.deliveryAddress.complete_address),9,Dr)])])):h("",!0),e.order.delivery_date?(o(),d("div",jr,[t[15]||(t[15]=r("span",null,"Schedule",-1)),r("div",Mr,[r("span",null,l(e.formattedDate(e.order.delivery_date))+" ("+l(e.formattedShortWeekday(e.order.delivery_date))+")",1),r("span",null,l(e.order.delivery_timeslot),1)])])):h("",!0),e.customer&&(e.customer.name&&e.order.customer_name&&e.customer.name!=e.order.customer_name||e.customer.email&&e.order.customer_email&&e.customer.email!=e.order.customer_email||e.customer.mobile_number&&e.order.customer_mobile_number&&e.customer.mobile_number.international!=e.order.customer_mobile_number.international)?(o(),p(w,{key:6,type:"primary",dismissable:!0,title:"Profile changes"},{description:x(()=>[r("ul",Nr,[e.customer.name&&e.order.customer_name&&e.customer.name!=e.order.customer_name?(o(),d("li",Er,[t[16]||(t[16]=v("Order name (",-1)),r("span",Ar,l(e.order.customer_name),1),t[17]||(t[17]=v(") is different from customer profile name (",-1)),r("span",Ur,l(e.customer.name),1),t[18]||(t[18]=v(").",-1))])):h("",!0),e.customer.email&&e.order.customer_email&&e.customer.email!=e.order.customer_email?(o(),d("li",Vr,[t[19]||(t[19]=v("Order email (",-1)),r("span",zr,l(e.order.customer_email),1),t[20]||(t[20]=v(") is different from customer profile email (",-1)),r("span",Br,l(e.customer.email),1),t[21]||(t[21]=v(").",-1))])):h("",!0),e.customer.mobile_number&&e.order.customer_mobile_number&&e.customer.mobile_number.international!=e.order.customer_mobile_number.international?(o(),d("li",Rr,[t[22]||(t[22]=v("Order mobile number (",-1)),r("span",Wr,l(e.order.customer_mobile_number.international),1),t[23]||(t[23]=v(") is different from customer profile mobile number (",-1)),r("span",Gr,l(e.customer.mobile_number.international),1),t[24]||(t[24]=v(").",-1))])):h("",!0)])]),_:1})):h("",!0)])):h("",!0),e.deliveryAddress?(o(),d(b,{key:1},[r("div",qr,[c(O,{height:"350px",gmpDraggable:!1,latitude:e.deliveryAddress.latitude,longitude:e.deliveryAddress.longitude},null,8,["latitude","longitude"])]),e.googleMapsUrl?(o(),d("div",Qr,[c(P,{size:"xs",type:"light",buttonClass:"h-full",rightIcon:n.ExternalLink,action:e.openGoogleMapsLink},{default:x(()=>[...t[25]||(t[25]=[r("span",null,"Google Maps",-1)])]),_:1},8,["rightIcon","action"])])):h("",!0)],64)):h("",!0)],64))])}const Hr=C(ir,[["render",Zr]]),Kr={components:{Image:j,Pill:U,Button:F,Banknote:de},props:{index:{type:Number},transaction:{type:Object},onDeleteTransaction:{type:Function}},data(){return{Trash2:E,expanded:!1}},computed:{hasPhoto(){return this.photo!=null},photo(){return this.transaction.photo}},methods:{formattedDatetime:A}},Jr={class:"rounded-lg overflow-hidden border border-gray-300"},Xr={class:"space-y-2 p-2 px-4 bg-gray-50 hover:bg-gray-100"},Yr={class:"flex justify-between items-center space-x-8"},$r={class:"flex items-center space-x-2"},es={class:"font-semibold text-sm"},ts={class:"flex items-center space-x-2 whitespace-nowrap"},rs={class:"text-gray-500 text-xs mr-4"},ss={class:"text-sm"},os=["src"];function ns(i,t,s,a,n,e){const g=m("Banknote"),u=m("Pill"),_=m("Image"),f=m("Button");return o(),d("div",Jr,[r("div",Xr,[r("div",Yr,[r("div",$r,[c(g,{size:"20",class:"text-gray-400 flex-shrink-0"}),r("p",es,l(s.transaction.store_payment_method?s.transaction.store_payment_method.custom_name:s.transaction.description),1)]),r("div",ts,[r("span",rs,l(e.formattedDatetime(s.transaction.created_at)),1),c(u,{type:"success",size:"xs",showDot:!1},{default:x(()=>[v(l(s.transaction.payment_status),1)]),_:1}),r("span",ss,l(s.transaction.amount.amount_with_currency),1),r("div",{class:I(["flex items-center justify-center w-10 h-10 hover:bg-white rounded-lg cursor-pointer",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),d("img",{key:0,class:"w-full max-h-10 object-contain rounded-lg flex-shrink-0",src:e.photo.path},null,8,os)):(o(),p(_,{key:1,size:"16",class:"text-gray-400 flex-shrink-0"}))],2),c(f,{size:"xs",leftIconSize:"14",leftIcon:n.Trash2,type:"bareDanger",action:()=>s.onDeleteTransaction(s.transaction)},null,8,["leftIcon","action"])])])])])}const is=C(Kr,[["render",ns]]),as={inject:["formState","storeState","orderState","notificationState"],components:{Image:j,Alert:W,Input:N,Modal:B,Button:F,Skeleton:T,OrderTransaction:is,OrderPaymentStatusSelect:$},data(){return{Plus:me,Link2:ce,Trash2:E,ExternalLink:G,CircleDollarSign:le,form:{photo:[],amount:"0.00",description:""},pagination:null,transactions:[],isLoadingTransactions:!1,deletableTransaction:null,isCreatingTransaction:!1,isDeletingTransactionId:null}},watch:{store(){this.setup()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderId(){return this.$route.params.order_id},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasTransactions(){return this.transactions.length>0}},methods:{isEmpty:R,setup(){this.store&&this.showTransactions()},reset(){this.form.photo=[],this.form.amount="0.00",this.form.description=""},async copyPaymentLink(){try{await navigator.clipboard.writeText("the payment link"),this.notificationState.showSuccessNotification("Payment link copied!")}catch(i){console.error("Failed to copy:",i),this.notificationState.showWarningNotification("Payment link failed to copy")}},async showTransactions(){var i,t;try{this.isLoadingTransactions=!0;let s={params:{order_id:this.orderId,store_id:this.store.id,_relationships:["photo","storePaymentMethod"].join(",")}};const a=await axios.get("/api/transactions",s);this.pagination=a.data,this.transactions=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching transactions";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch transactions:",s)}finally{this.isLoadingTransactions=!1}},async createTransaction(){var i,t;try{if(this.isCreatingTransaction||(this.formState.hideFormErrors(),this.isEmpty(this.form.description)&&this.formState.setFormError("description","Enter payment name"),this.formState.hasErrors))return;this.isCreatingTransaction=!0;let s=new FormData;s.append("return",1),s.append("owner_type","order"),s.append("owner_id",this.orderId),s.append("store_id",this.store.id),s.append("amount",this.form.amount),s.append("currency",this.store.currency),s.append("description",this.form.description),this.form.photo.length&&s.append("photo",this.form.photo[0].file_ref);const a={headers:{"Content-Type":"multipart/form-data"}},n=await axios.post("/api/transactions",s,a);this.notificationState.showSuccessNotification("Payment created!"),this.$refs.addPaymentModal.hideModal(),this.showTransactions(),this.reset()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while creating payment";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to create payment:",s)}finally{this.isCreatingTransaction=!1}},onDeleteTransaction(i){this.deletableTransaction=i,this.$refs.deletePaymentModal.showModal()},async deleteTransaction(){var i,t;try{this.isDeletingTransactionId=this.deletableTransaction.id;const s=this.transactions.findIndex(n=>n.id==this.deletableTransaction.id),a={data:{store_id:this.store.id}};await axios.delete(`/api/transactions/${this.deletableTransaction.id}`,a),this.notificationState.showSuccessNotification("Payment deleted"),this.$refs.deletePaymentModal.hideModal(),this.transactions.splice(s,1)}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while deleting transaction";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to delete transaction:",s)}finally{this.isDeletingTransactionId=null}},async updateOrder(i){var t,s;try{i={...i,store_id:this.store.id},await axios.put(`/api/orders/${this.orderId}`,i),this.notificationState.showSuccessNotification(`Order ${this.orderForm.payment_status}`),this.orderState.order.payment_status=this.orderForm.payment_status}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}},created(){this.setup()}},ds={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},ls={class:"flex justify-between items-center mb-4"},cs={class:"flex items-center space-x-2"},ms={class:"flex justify-between items-center space-x-4"},us={class:"space-y-4 mb-8"},hs={key:0,class:"space-y-2"},gs={class:"space-y-2 p-2 px-4 bg-gray-50"},fs={class:"flex justify-between items-center space-x-8"},ps={class:"flex items-center space-x-2 whitespace-nowrap"},_s={class:"flex justify-end items-end space-x-2"},ys={class:"flex items-center justify-center w-10 h-10 rounded-lg border border-dashed border-gray-200"},bs={class:"bg-blue-50 border border-blue-400 rounded-lg p-4 space-y-4"},ws={class:"flex justify-between text-sm font-bold"},xs={key:0,class:"flex justify-between text-sm font-bold"},Ss={class:"text-red-500"},vs={class:"p-4 text-sm bg-gray-100 rounded-lg"},Os={class:"space-x-2"},ks={class:"space-x-2"};function Cs(i,t,s,a,n,e){const g=m("Button"),u=m("Input"),_=m("Modal"),f=m("Skeleton"),S=m("OrderPaymentStatusSelect"),P=m("Image"),w=m("OrderTransaction"),O=m("Alert");return o(),d("div",ds,[r("div",ls,[r("div",cs,[t[4]||(t[4]=r("h1",{class:"text-gray-700 font-semibold"},"Payments",-1)),c(g,{size:"xs",type:"bare",leftIcon:n.ExternalLink},null,8,["leftIcon"])]),r("div",ms,[c(g,{size:"xs",type:"bare",leftIcon:n.Link2,action:e.copyPaymentLink},{default:x(()=>[...t[5]||(t[5]=[r("span",null,"Copy Payment Link",-1)])]),_:1},8,["leftIcon","action"]),!e.isLoadingStore&&!e.isLoadingOrder?(o(),p(_,{key:0,triggerSize:"xs",triggerType:"light",approveType:"primary",ref:"addPaymentModal",leftApproveIcon:n.Plus,leftTriggerIcon:n.Plus,scrollOnContent:!1,leftTriggerIconSize:"14",triggerText:"Add Payment",approveText:"Add Payment",approveAction:e.createTransaction,approveLoading:n.isCreatingTransaction},{content:x(()=>[t[6]||(t[6]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Add Payment",-1)),r("div",us,[c(u,{type:"text",label:"Payment Name",modelValue:n.form.description,"onUpdate:modelValue":t[0]||(t[0]=y=>n.form.description=y),placeholder:"Bank Transfer",errorText:e.formState.getFormError("description")},null,8,["modelValue","errorText"]),c(u,{type:"money",modelValue:n.form.amount,"onUpdate:modelValue":t[1]||(t[1]=y=>n.form.amount=y),label:"Payment Amount",currency:e.store.currency.code,errorText:e.formState.getFormError("amount")},null,8,["modelValue","currency","errorText"]),c(u,{type:"file",maxFiles:1,modelValue:n.form.photo,"onUpdate:modelValue":t[2]||(t[2]=y=>n.form.photo=y),label:"Proof Of Payment",imagePreviewGridCols:1,singleFileUploadMessage:"proof of payment attached"},null,8,["modelValue"])])]),_:1},8,["leftApproveIcon","leftTriggerIcon","approveAction","approveLoading"])):h("",!0),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(f,{key:1,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),p(S,{key:2,class:"w-48",showLabel:!1,onChange:t[3]||(t[3]=y=>e.updateOrder({payment_status:y}))}))])]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",hs,[(o(),d(b,null,k([1,2],(y,L)=>r("div",{key:L,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",gs,[r("div",fs,[c(f,{width:"w-1/3",shine:!0}),r("div",ps,[c(f,{width:"w-20",shine:!0}),c(f,{width:"w-10",shine:!0}),c(f,{width:"w-10",shine:!0})])]),r("div",_s,[c(g,{size:"xs",skeleton:!0,leftIconSize:"14",leftIcon:n.Trash2,type:"outlineDanger"},null,8,["leftIcon"]),r("div",ys,[c(P,{size:"16",class:"text-gray-400 flex-shrink-0"})])])])])),64))])):(o(),d(b,{key:1},[e.hasTransactions?(o(),d(b,{key:0},[(o(!0),d(b,null,k(n.transactions,(y,L)=>(o(),p(w,{key:L,index:L,transaction:y,onDeleteTransaction:e.onDeleteTransaction},null,8,["index","transaction","onDeleteTransaction"]))),128)),r("div",bs,[r("div",ws,[t[7]||(t[7]=r("span",null,"Amount Paid",-1)),r("span",null,l(e.order.paid_total.amount_with_currency),1)]),e.order.outstanding_total.amount>0?(o(),d("div",xs,[t[8]||(t[8]=r("span",null,"Amount Due",-1)),r("span",Ss,l(e.order.outstanding_total.amount_with_currency),1)])):h("",!0)])],64)):(o(),p(O,{key:1,type:"light",dismissable:!1,icon:n.CircleDollarSign,title:"No transctions yet"},null,8,["icon"])),c(_,{approveText:"Delete",approveType:"danger",ref:"deletePaymentModal",scrollOnContent:!1,leftApproveIcon:n.Trash2,approveAction:e.deleteTransaction,approveLoading:n.deletableTransaction&&n.isDeletingTransactionId==n.deletableTransaction.id},V({_:2},[n.deletableTransaction?{name:"content",fn:x(()=>[t[11]||(t[11]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Confirm Delete",-1)),t[12]||(t[12]=r("p",{class:"mb-8"},"Are you sure you want to permanently delete this payment?",-1)),r("div",vs,[r("div",Os,[t[9]||(t[9]=r("span",{class:"font-bold"},"Name:",-1)),r("span",null,l(n.deletableTransaction.description),1)]),r("div",ks,[t[10]||(t[10]=r("span",{class:"font-bold"},"Amount:",-1)),r("span",null,l(n.deletableTransaction.amount.amount_with_currency),1)])])]),key:"0"}:void 0]),1032,["leftApproveIcon","approveAction","approveLoading"])],64))])}const Ps=C(as,[["render",Cs]]),Ts={inject:["orderState","storeState"],components:{TeamMember:_e,OrderItems:jt,OrderComments:nr,OrderFulfilment:Hr,OrderTransactions:Ps},computed:{store(){return this.storeState.store},order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder}}},Ls={class:"grid grid-cols-12 gap-8 mb-4"},Is={class:"col-span-8"},Fs={class:"col-span-4"};function Ds(i,t,s,a,n,e){const g=m("OrderItems"),u=m("OrderTransactions"),_=m("OrderFulfilment"),f=m("TeamMember"),S=m("OrderComments");return o(),d("div",Ls,[r("div",Is,[c(g),c(u),c(_)]),r("div",Fs,[c(f),c(S)])])}const _o=C(Ts,[["render",Ds]]);export{_o as default};
