import{B as b}from"./Button-C-mSVtjr.js";import{L}from"./Loader-DC71jh3F.js";import{P as I}from"./Popover-CErryWiK.js";import{c as d,a as h,b as i,g as p,T as R,e as r,d as y,k as g,t as l,y as w,q as F,r as m,o}from"./app-CfcRgAtV.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as _}from"./move-right-bBtbHlKC.js";import{R as x}from"./refresh-ccw-BfzP-qh6.js";import{C as z}from"./circle-check-DJt4jgY5.js";import{C as B}from"./circle-alert-DtAPlORr.js";import{C as P}from"./credit-card-BXDIVYYH.js";import{C as D}from"./clock-1Z9DaZjJ.js";import"./ShineEffect-DuM8M3bS.js";import"./createLucideIcon-6Wi-O4Lc.js";const N={inject:["formState","storeState","notificationState"],components:{Button:b,Loader:L,Popover:I,Clock:D,CreditCard:P,CircleAlert:B,CircleCheck:z,RefreshCcw:x,MoveRight:_},data(){return{MoveRight:_,CreditCard:P,RefreshCcw:x,isPastDate:w,formattedDatetime:F,transaction:null,isVerifyingPayment:!1,isLoadingTransaction:!1,isRenewTransactionPaymentLink:!1,countdown:5,countdownInterval:null}},watch:{store(){this.setup()},isPaid(e){e&&!this.isLoadingTransaction&&!this.isVerifyingPayment&&this.startCountdown()}},computed:{store(){return this.storeState.store},order(){var e;return(e=this.transaction)==null?void 0:e.owner},isPaid(){var e;return((e=this.transaction)==null?void 0:e.payment_status)==="paid"},isFailedPayment(){var e;return((e=this.transaction)==null?void 0:e.payment_status)==="failed payment"},isPendingPayment(){var e;return((e=this.transaction)==null?void 0:e.payment_status)==="pending payment"},dpoPaymentUrl(){var e,n;return(n=(e=this.transaction)==null?void 0:e.metadata)==null?void 0:n.dpo_payment_url},dpoPaymentLinkHasExpired(){var e,n;return w((n=(e=this.transaction)==null?void 0:e.metadata)==null?void 0:n.dpo_payment_url_expires_at)}},methods:{async setup(){var e;await this.showTransaction(),((e=this.transaction)==null?void 0:e.payment_status)!=="paid"&&this.verifyDomainPayment()},async navigateToShowShopOrder(){await this.$router.push({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}})},async showTransaction(){var e,n;try{this.isLoadingTransaction=!0;const t=this.$route.query.transaction_id;let c={params:{store_id:this.store.id,_relationships:["owner"].join(",")}};const s=await axios.get(`/api/transactions/${t}`,c);this.transaction=s.data}catch(t){const c=((n=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while fetching transaction";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to fetch transaction:",t)}finally{this.isLoadingTransaction=!1}},makePayment(){this.isRenewTransactionPaymentLink||(this.dpoPaymentLinkHasExpired?this.renewTransactionPaymentLink():(this.isRenewTransactionPaymentLink=!0,window.location.assign(this.dpoPaymentUrl)))},async renewTransactionPaymentLink(){var e,n;try{this.isRenewTransactionPaymentLink=!0;let t={store_id:this.store.id};const s=(await axios.post(`/api/transactions/${this.transaction.id}/renew`,t)).data;window.location.href=s.metadata.dpo_payment_url}catch(t){const c=((n=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while renewing payment link";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to renew payment link:",t)}finally{this.isRenewTransactionPaymentLink=!1}},async verifyDomainPayment(){var e,n;try{this.isVerifyingPayment=!0;const t=this.$route.query.transaction_id;let c={store_id:this.store.id};const s=await axios.post(`/api/orders/verify-payment/${t}`,c);this.notificationState.showSuccessNotification("Order payment verified!"),this.transaction=s.data}catch(t){const c=((n=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while verifying order payment";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to verify order payment:",t)}finally{this.isVerifyingPayment=!1}},startCountdown(){this.countdownInterval&&clearInterval(this.countdownInterval),this.countdown=5,this.countdownInterval=setInterval(()=>{this.countdown-=1,this.countdown<=0&&(clearInterval(this.countdownInterval),this.navigateToShowShopOrder())},1e3)}},created(){this.store&&this.setup()},beforeDestroy(){this.countdownInterval&&clearInterval(this.countdownInterval)}},E={class:"min-h-screen bg-linear-to-br from-gray-50 to-gray-100 flex flex-col items-center justify-center space-y-4 py-12 px-4 sm:px-6 lg:px-8"},O={key:0,class:"w-full max-w-md p-2 bg-white rounded-lg text-sm text-gray-600 text-center"},j={class:"w-full max-w-md bg-white rounded-2xl shadow-lg p-6 sm:p-8 transition-all duration-300 ease-in-out transform hover:shadow-xl"},M={key:0,class:"flex flex-col items-center justify-center space-y-4"},q={class:"flex items-center space-x-3 text-2xl font-bold text-gray-800"},A={key:1,class:"space-y-6"},W={class:"flex items-center space-x-3"},H={class:"text-3xl font-bold text-gray-800"},U={key:0,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},G={class:"text-sm font-semibold text-red-600"},J={key:0,class:"text-xs text-red-500"},K={class:"p-4 bg-gray-50 border border-gray-200 rounded-lg"},Q={class:"text-gray-600 text-sm"},X={class:"font-semibold"},Y={key:1,class:"space-y-4"},Z={key:2,class:"space-y-4"},$={class:"space-y-2 text-sm text-gray-500"},tt={class:"flex items-center space-x-2"},et={class:"flex items-center space-x-2"};function st(e,n,t,c,s,a){const v=m("CreditCard"),k=m("Loader"),C=m("CircleCheck"),S=m("Clock"),T=m("CircleAlert"),f=m("Button"),u=m("Popover");return o(),d("div",E,[h(R,{name:"fade-1"},{default:p(()=>[a.isPaid?(o(),d("p",O," Redirecting to show order in "+l(s.countdown)+" second"+l(s.countdown!==1?"s":"")+"... ",1)):r("",!0)]),_:1}),i("div",j,[s.isLoadingTransaction||s.isVerifyingPayment?(o(),d("div",M,[i("h1",q,[h(v,{size:"28",class:"text-indigo-600"}),n[0]||(n[0]=i("span",null,"Verifying Order Payment",-1))]),n[1]||(n[1]=i("p",{class:"text-sm text-gray-500 text-center max-w-xs"},"Please wait while we verify your payment.",-1)),h(k,{class:"w-12 h-12 text-indigo-600 animate-pulse"})])):r("",!0),!s.isLoadingTransaction&&!s.isVerifyingPayment&&s.transaction?(o(),d("div",A,[i("div",W,[a.isPaid?(o(),y(C,{key:0,size:"32",class:"text-green-500"})):r("",!0),a.isPendingPayment?(o(),y(S,{key:1,size:"32",class:"text-yellow-500"})):r("",!0),a.isFailedPayment?(o(),y(T,{key:2,size:"32",class:"text-red-500"})):r("",!0),i("h1",{class:g(["text-2xl font-bold capitalize",a.isPaid?"text-green-600":a.isFailedPayment?"text-red-600":"text-yellow-600"])},l(s.transaction.payment_status),3)]),i("p",{class:g(["text-base",a.isPaid?"text-green-600":a.isFailedPayment?"text-red-600":"text-yellow-600"])},l(s.transaction.description),3),i("h2",H,l(s.transaction.amount.amount_with_currency),1),a.isFailedPayment?(o(),d("div",U,[i("p",G,l(s.transaction.failure_type??"Failure Reason"),1),s.transaction.failure_reason?(o(),d("p",J,l(s.transaction.failure_reason),1)):r("",!0)])):r("",!0),i("div",K,[i("span",Q,[i("span",X,l(a.order.summary),1)])]),!s.isVerifyingPayment&&(a.isPendingPayment||a.isFailedPayment)?(o(),d("div",Y,[a.isPendingPayment?(o(),y(f,{key:0,size:"lg",type:"primary",buttonClass:"w-full",action:a.makePayment,leftIcon:s.CreditCard,loading:s.isRenewTransactionPaymentLink},{default:p(()=>[...n[2]||(n[2]=[i("span",{class:"ml-2"},"Make Payment",-1)])]),_:1},8,["action","leftIcon","loading"])):r("",!0),a.isFailedPayment?(o(),y(f,{key:1,size:"lg",type:"primary",buttonClass:"w-full",action:a.makePayment,leftIcon:s.RefreshCcw,loading:s.isRenewTransactionPaymentLink},{default:p(()=>[...n[3]||(n[3]=[i("span",{class:"ml-2"},"Retry Payment",-1)])]),_:1},8,["action","leftIcon","loading"])):r("",!0)])):r("",!0),a.isPaid?(o(),d("div",Z,[i("div",$,[i("div",tt,[i("span",null,l(s.formattedDatetime(s.transaction.created_at)),1),h(u,{content:"This is the transaction date",placement:"top"})]),i("div",et,[i("span",null,l(s.transaction.id),1),h(u,{content:"This is the transaction ID",placement:"top"})])])])):r("",!0),a.store?(o(),y(f,{key:3,size:"lg",buttonClass:"w-full",rightIcon:s.MoveRight,action:a.navigateToShowShopOrder,type:a.isPaid?"primary":"light"},{default:p(()=>[...n[4]||(n[4]=[i("span",{class:"mr-2"},"View Order",-1)])]),_:1},8,["rightIcon","action","type"])):r("",!0)])):r("",!0)])])}const ut=V(N,[["render",st]]);export{ut as default};
