import{B as S}from"./Button-DQZsVgv2.js";import{L}from"./Loader-Cx-EKtVY.js";import{P as T}from"./Popover-B8o2G8jc.js";import{c as l,b as i,e as r,a as p,r as d,d as y,j as f,t as m,F as _,g as u,av as P,m as F,o}from"./app-NqhLBX5U.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as D}from"./circle-check-CR2oW9jw.js";import{C as z}from"./circle-alert-CK7NUARt.js";import{C as x}from"./credit-card-De1ER7Oj.js";import{C as V}from"./clock-DtlUlfBX.js";import{R as I}from"./refresh-ccw-D0BER8Gi.js";import{M as B}from"./move-right-NZYDzv3Z.js";import"./ShineEffect-D1afC5Ah.js";import"./createLucideIcon-DnmJ9UE3.js";const N={inject:["formState","storeState","notificationState"],components:{Button:S,Loader:L,Popover:T,Clock:V,CreditCard:x,CircleAlert:z,CircleCheck:D},data(){return{MoveRight:B,CreditCard:x,RefreshCcw:I,isPastDate:P,formattedDatetime:F,transaction:null,isVerifyingPayment:!1,isLoadingTransaction:!1,isRenewTransactionPaymentLink:!1}},watch:{store:{handler:async function(e){e&&(await this.showTransaction(),this.verifyDomainPayment())}}},computed:{store(){return this.storeState.store},domain(){var e;return(e=this.transaction)==null?void 0:e.owner},isPaid(){var e;return((e=this.transaction)==null?void 0:e.payment_status)==="paid"},isFailedPayment(){var e;return((e=this.transaction)==null?void 0:e.payment_status)==="failed payment"},isPendingPayment(){var e;return((e=this.transaction)==null?void 0:e.payment_status)==="pending payment"},dpoPaymentUrl(){var e,n;return(n=(e=this.transaction)==null?void 0:e.metadata)==null?void 0:n.dpo_payment_url},dpoPaymentLinkHasExpired(){var e,n;return P((n=(e=this.transaction)==null?void 0:e.metadata)==null?void 0:n.dpo_payment_url_expires_at)}},methods:{navigateToDomains(){this.$router.push({name:"show-domains",query:{store_id:this.store.id}})},async showTransaction(){var e,n;try{this.isLoadingTransaction=!0;const t=this.$route.query.transaction_id;let c={params:{store_id:this.store.id,_relationships:["owner"].join(",")}};const a=await axios.get(`/api/transactions/${t}`,c);this.transaction=a.data}catch(t){const c=((n=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while fetching transaction";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to fetch transaction:",t)}finally{this.isLoadingTransaction=!1}},makePayment(){this.isRenewTransactionPaymentLink||(this.dpoPaymentLinkHasExpired?this.renewTransactionPaymentLink():(this.isRenewTransactionPaymentLink=!0,window.location.assign(this.dpoPaymentUrl)))},async renewTransactionPaymentLink(){var e,n;try{this.isRenewTransactionPaymentLink=!0;let t={store_id:this.store.id};const a=(await axios.post(`/api/transactions/${this.transaction.id}/renew`,t)).data;window.location.href=a.metadata.dpo_payment_url}catch(t){const c=((n=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while renewing payment link";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to renew payment link:",t)}finally{this.isRenewTransactionPaymentLink=!1}},async verifyDomainPayment(){var e,n;try{this.isVerifyingPayment=!0;const t=this.$route.query.transaction_id;let c={store_id:this.store.id};const a=await axios.post(`/api/domains/verify-payment/${t}`,c);this.notificationState.showSuccessNotification("Domain payment verified!"),this.transaction=a.data}catch(t){const c=((n=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while verifying domain payment";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to verify domain payment:",t)}finally{this.isVerifyingPayment=!1}}}},E={class:"min-h-screen relative"},j={class:"z-10 pt-32 px-20 relative"},M={key:0,class:"flex flex-col items-center"},q={class:"flex justify-center items-center space-x-2 text-xl text-gray-700 font-semibold mb-4"},A={key:1,class:"flex flex-col items-center justify-center space-y-4 mb-8"},W={class:"flex items-center space-x-2 mb-2"},H={key:0,class:"text-red-600 p-4 bg-red-50 border border-red-300 rounded-lg mb-4"},U={class:"text-sm font-semibold mb-2"},O={key:0,class:"text-xs"},G={class:"bg-gray-50 border p-4 rounded-lg mb-4"},J={class:"text-gray-600"},K={class:"font-bold"},Q={class:"flex items-center space-x-2 text-xs mb-2"},X={class:"text-gray-400"},Y={class:"flex items-center space-x-2 text-xs"},Z={class:"text-gray-400"};function $(e,n,t,c,a,s){const w=d("CreditCard"),k=d("Loader"),C=d("CircleCheck"),b=d("Clock"),v=d("CircleAlert"),h=d("Button"),g=d("Popover");return o(),l("div",E,[i("div",j,[a.isLoadingTransaction||a.isVerifyingPayment?(o(),l("div",M,[i("h1",q,[p(w,{size:"24"}),n[0]||(n[0]=i("span",null,"Verifying Domain Payment",-1))]),n[1]||(n[1]=i("p",{class:"w-96 text-sm text-gray-600 text-center mb-8"},"One moment, we are verifying your domain purchase payment",-1)),p(k,{class:"mb-8"})])):r("",!0),a.transaction?(o(),l("div",A,[i("div",{class:f([{"animated-border-green":s.isPaid},{"animated-border-red":s.isFailedPayment},{"animated-border-cyan":s.isPendingPayment},"w-96 bg-white py-4 px-4 shadow-sm rounded-xl"])},[i("div",W,[s.isPaid?(o(),y(C,{key:0,size:"28",class:"text-green-600"})):r("",!0),s.isPendingPayment?(o(),y(b,{key:1,size:"28",class:"text-yellow-600"})):r("",!0),s.isFailedPayment?(o(),y(v,{key:2,size:"28",class:"text-red-600"})):r("",!0),i("h1",{class:f([{"text-green-600":s.isPaid},{"text-red-600":s.isFailedPayment},{"text-yellow-600":s.isPendingPayment},"capitalize text-xl font-bold"])},m(a.transaction.payment_status),3)]),i("h2",{class:f([{"text-green-600":s.isPaid},{"text-red-600":s.isFailedPayment},{"text-yellow-600":s.isPendingPayment},"text-sm mb-4"])},m(a.transaction.description),3),i("h2",{class:f([{"text-green-600":s.isPaid},{"text-red-600":s.isFailedPayment},{"text-yellow-600":s.isPendingPayment},"text-3xl text-gray-700 font-bold space-x-1 mb-4"])},[i("span",null,m(a.transaction.amount.amount_with_currency),1)],2),s.isFailedPayment?(o(),l("div",H,[i("p",U,m(a.transaction.failure_type??"Failure Reason"),1),a.transaction.failure_reason?(o(),l("p",O,m(a.transaction.failure_reason),1)):r("",!0)])):r("",!0),i("div",G,[i("span",J,[i("span",K,m(s.domain.name),1)])]),a.isVerifyingPayment?r("",!0):(o(),l(_,{key:1},[s.isPendingPayment?(o(),y(h,{key:0,size:"sm",type:"primary",action:s.makePayment,leftIcon:a.CreditCard,buttonClass:"w-full mb-4",loading:a.isRenewTransactionPaymentLink},{default:u(()=>n[2]||(n[2]=[i("span",null,"Make Payment",-1)])),_:1,__:[2]},8,["action","leftIcon","loading"])):r("",!0),s.isFailedPayment?(o(),y(h,{key:1,size:"sm",type:"primary",action:s.makePayment,leftIcon:a.RefreshCcw,buttonClass:"w-full mb-4",loading:a.isRenewTransactionPaymentLink},{default:u(()=>n[3]||(n[3]=[i("span",null,"Retry Payment",-1)])),_:1,__:[3]},8,["action","leftIcon","loading"])):r("",!0),s.isPaid?(o(),l(_,{key:2},[i("div",Q,[i("span",X,m(a.formattedDatetime(a.transaction.created_at)),1),p(g,{content:"This is the transaction date",placement:"top"})]),i("div",Y,[i("span",Z,m(a.transaction.id),1),p(g,{content:"This is the transaction ID",placement:"top"})])],64)):r("",!0)],64))],2),s.store?(o(),y(h,{key:0,size:"md",buttonClass:"w-96",rightIconSize:"28",rightIcon:a.MoveRight,action:s.navigateToDomains,type:s.isPaid?"primary":"light"},{default:u(()=>n[4]||(n[4]=[i("span",{class:"mr-2"},"View Domains",-1)])),_:1,__:[4]},8,["rightIcon","action","type"])):r("",!0)])):r("",!0)]),n[5]||(n[5]=i("img",{src:"/images/clouds.png",class:"absolute top-32"},null,-1))])}const pt=R(N,[["render",$]]);export{pt as default};
