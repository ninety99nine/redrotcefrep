import{d as v}from"./debounce-DdECE0Qm.js";import{S as y}from"./Skeleton-BmfWv9Ad.js";import{D}from"./Datepicker-ZV66TTkQ.js";import{S as c}from"./ShineEffect-Bjy7l8nq.js";import{at as g,c as M,d as m,g as p,r as a,o as h,b as n,a as f,D as w}from"./app-C3gvvzwr.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as F}from"./Select-DpnAowrL.js";const b={inject:["formState","storeState","deliveryMethodState","notificationState"],components:{Skeleton:y,Datepicker:D,ShineEffect:c},props:{modelValue:{type:String},deliveryMethod:{type:Object},showAllDates:{type:Boolean,default:!1}},emits:["update:modelValue","isLoading","change","scheduleOptions"],data(){return{minDate:null,maxDate:null,isLoading:!1,disabledDates:[],apiRequestCounter:0,disabledWeekDays:[],debounceInstance:null,localModelValue:this.modelValue}},watch:{modelValue(e){this.localModelValue=e},localModelValue(e){this.$emit("update:modelValue",e)},...["schedule_type","daily_order_limit","same_day_delivery","set_daily_order_limit","time_slot_interval_unit","auto_generate_time_slots","time_slot_interval_value","latest_delivery_time_value","earliest_delivery_time_unit","earliest_delivery_time_value","require_minimum_notice_for_orders","restrict_maximum_notice_for_orders"].reduce((e,i)=>(e[`deliveryMethodForm.${i}`]=function(){this.debouncedShowDeliveryMethodScheduleOptions()},e),{}),"deliveryMethodForm.operational_hours":{handler(){this.debouncedShowDeliveryMethodScheduleOptions()},deep:!0}},computed:{key(){return this.minDate+this.maxDate+this.showAllDates+this.disabledDates.length+this.disabledWeekDays.length},store(){return this.storeState.store},deliveryMethodForm(){return this.deliveryMethodState.deliveryMethodForm}},methods:{formattedDate:g,setIsLoading(e){this.isLoading=e,this.$emit("isLoading",e)},parseForm(){return{store_id:this.store.id,schedule_type:this.deliveryMethod?this.deliveryMethod.schedule_type:this.deliveryMethodForm.schedule_type,daily_order_limit:this.deliveryMethod?this.deliveryMethod.daily_order_limit:this.deliveryMethodForm.daily_order_limit,same_day_delivery:this.deliveryMethod?this.deliveryMethod.same_day_delivery:this.deliveryMethodForm.same_day_delivery,operational_hours:this.deliveryMethod?this.deliveryMethod.operational_hours:this.deliveryMethodForm.operational_hours,set_daily_order_limit:this.deliveryMethod?this.deliveryMethod.set_daily_order_limit:this.deliveryMethodForm.set_daily_order_limit,time_slot_interval_unit:this.deliveryMethod?this.deliveryMethod.time_slot_interval_unit:this.deliveryMethodForm.time_slot_interval_unit,auto_generate_time_slots:this.deliveryMethod?this.deliveryMethod.auto_generate_time_slots:this.deliveryMethodForm.auto_generate_time_slots,time_slot_interval_value:this.deliveryMethod?this.deliveryMethod.time_slot_interval_value:this.deliveryMethodForm.time_slot_interval_value,latest_delivery_time_value:this.deliveryMethod?this.deliveryMethod.latest_delivery_time_value:this.deliveryMethodForm.latest_delivery_time_value,earliest_delivery_time_unit:this.deliveryMethod?this.deliveryMethod.earliest_delivery_time_unit:this.deliveryMethodForm.earliest_delivery_time_unit,earliest_delivery_time_value:this.deliveryMethod?this.deliveryMethod.earliest_delivery_time_value:this.deliveryMethodForm.earliest_delivery_time_value,require_minimum_notice_for_orders:this.deliveryMethod?this.deliveryMethod.require_minimum_notice_for_orders:this.deliveryMethodForm.require_minimum_notice_for_orders,restrict_maximum_notice_for_orders:this.deliveryMethod?this.deliveryMethod.restrict_maximum_notice_for_orders:this.deliveryMethodForm.restrict_maximum_notice_for_orders}},async showDeliveryMethodScheduleOptions(){var e,i;try{const t=this.parseForm(),r=++this.apiRequestCounter,o=await axios.post("/api/delivery-methods/schedule-options",t);if(r!==this.apiRequestCounter)return;const s=o.data;this.minDate=this.formattedDate(s.min_date),this.disabledWeekDays=s.days_of_week_disabled,this.disabledDates=s.dates_disabled.map(l=>this.formattedDate(l)),this.maxDate=s.max_date?this.formattedDate(s.max_date):null,this.$emit("scheduleOptions",s)}catch(t){const r=((i=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:i.message)||(t==null?void 0:t.message)||"Something went wrong while fetching schedule options";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(t),console.error("Failed to fetch schedule options:",t)}finally{this.setIsLoading(!1)}},debouncedShowDeliveryMethodScheduleOptions(){this.debounceInstance&&this.debounceInstance.cancel(),this.setIsLoading(!0),this.debounceInstance=v(()=>{this.showDeliveryMethodScheduleOptions()},1e3),this.debounceInstance()}},created(){this.setIsLoading(!0),this.showDeliveryMethodScheduleOptions()}},k={class:"flex items-center space-x-2"};function x(e,i,t,r,o,s){const l=a("Skeleton"),d=a("ShineEffect"),u=a("Datepicker");return h(),M("div",null,[o.isLoading?(h(),m(d,{key:0},{default:p(()=>[n("div",k,[i[2]||(i[2]=n("svg",{class:"w-4 h-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})],-1)),f(l,{width:"w-1/2"})])]),_:1})):(h(),m(u,{key:s.key,enableTimePicker:!1,modelValue:o.localModelValue,"onUpdate:modelValue":i[0]||(i[0]=_=>o.localModelValue=_),placeholder:"Select delivery date",minDate:t.showAllDates?null:o.minDate,maxDate:t.showAllDates?null:o.maxDate,onChange:i[1]||(i[1]=_=>e.$emit("change",_)),disabledDates:t.showAllDates?[]:o.disabledDates,disabledWeekDays:t.showAllDates?[]:o.disabledWeekDays},null,8,["modelValue","minDate","maxDate","disabledDates","disabledWeekDays"]))])}const j=S(b,[["render",x]]),V={inject:["formState","storeState","deliveryMethodState","notificationState"],components:{Select:F,Skeleton:y,ShineEffect:c},props:{modelValue:{type:String},form:{type:Object},deliveryMethod:{type:Object},deliveryDate:{type:String},showAllDates:{type:Boolean,default:!1},showAllTimeslots:{type:Boolean,default:!1},autoSelectFirstTimeslot:{type:Boolean,value:!0}},emits:["update:modelValue","isLoading","change","scheduleOptions"],data(){return{isLoading:!1,apiRequestCounter:0,debounceInstance:null,availableTimeSlotOptions:[],localModelValue:this.modelValue}},watch:{modelValue(e){this.localModelValue=e},localModelValue(e){this.$emit("update:modelValue",e),this.$emit("change",e)},deliveryDate(e){e&&this.debouncedShowDeliveryMethodScheduleOptions()}},computed:{store(){return this.storeState.store},deliveryMethodForm(){return this.deliveryMethodState.deliveryMethodForm}},methods:{setIsLoading(e){this.isLoading=e,this.$emit("isLoading",e)},parseForm(){return{store_id:this.store.id,show_all_dates:this.showAllDates,show_all_timeslots:this.showAllTimeslots,delivery_date:w(this.deliveryDate).format("YYYY-MM-DD"),schedule_type:this.deliveryMethod?this.deliveryMethod.schedule_type:this.deliveryMethodForm.schedule_type,daily_order_limit:this.deliveryMethod?this.deliveryMethod.daily_order_limit:this.deliveryMethodForm.daily_order_limit,same_day_delivery:this.deliveryMethod?this.deliveryMethod.same_day_delivery:this.deliveryMethodForm.same_day_delivery,operational_hours:this.deliveryMethod?this.deliveryMethod.operational_hours:this.deliveryMethodForm.operational_hours,set_daily_order_limit:this.deliveryMethod?this.deliveryMethod.set_daily_order_limit:this.deliveryMethodForm.set_daily_order_limit,time_slot_interval_unit:this.deliveryMethod?this.deliveryMethod.time_slot_interval_unit:this.deliveryMethodForm.time_slot_interval_unit,auto_generate_time_slots:this.deliveryMethod?this.deliveryMethod.auto_generate_time_slots:this.deliveryMethodForm.auto_generate_time_slots,time_slot_interval_value:this.deliveryMethod?this.deliveryMethod.time_slot_interval_value:this.deliveryMethodForm.time_slot_interval_value,latest_delivery_time_value:this.deliveryMethod?this.deliveryMethod.latest_delivery_time_value:this.deliveryMethodForm.latest_delivery_time_value,earliest_delivery_time_unit:this.deliveryMethod?this.deliveryMethod.earliest_delivery_time_unit:this.deliveryMethodForm.earliest_delivery_time_unit,earliest_delivery_time_value:this.deliveryMethod?this.deliveryMethod.earliest_delivery_time_value:this.deliveryMethodForm.earliest_delivery_time_value,require_minimum_notice_for_orders:this.deliveryMethod?this.deliveryMethod.require_minimum_notice_for_orders:this.deliveryMethodForm.require_minimum_notice_for_orders,restrict_maximum_notice_for_orders:this.deliveryMethod?this.deliveryMethod.restrict_maximum_notice_for_orders:this.deliveryMethodForm.restrict_maximum_notice_for_orders}},async showDeliveryMethodScheduleOptions(){var e,i;try{const t=this.parseForm(),r=++this.apiRequestCounter,o=await axios.post("/api/delivery-methods/schedule-options",t);if(r!==this.apiRequestCounter)return;const s=o.data,l=s.available_time_slots;this.autoSelectFirstTimeslot&&l.length&&!l.includes(this.localModelValue)&&(this.localModelValue=l[0]),this.availableTimeSlotOptions=l.map(function(d){return{label:d,value:d}}),this.$emit("scheduleOptions",s)}catch(t){const r=((i=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:i.message)||(t==null?void 0:t.message)||"Something went wrong while fetching schedule options";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(t),console.error("Failed to fetch schedule options:",t)}finally{this.setIsLoading(!1)}},debouncedShowDeliveryMethodScheduleOptions(){this.debounceInstance&&this.debounceInstance.cancel(),this.setIsLoading(!0),this.availableTimeSlotOptions=[],this.debounceInstance=v(()=>{this.showDeliveryMethodScheduleOptions()},1e3),this.debounceInstance()}},created(){this.setIsLoading(!0),this.showDeliveryMethodScheduleOptions()}},O={class:"flex items-center space-x-2"};function I(e,i,t,r,o,s){const l=a("Skeleton"),d=a("ShineEffect"),u=a("Select");return h(),M("div",null,[o.isLoading?(h(),m(d,{key:0},{default:p(()=>[n("div",O,[i[1]||(i[1]=n("svg",{class:"w-4 h-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1)),f(l,{width:"w-1/2"})])]),_:1})):(h(),m(u,{key:1,class:"w-full",search:!1,modelValue:o.localModelValue,"onUpdate:modelValue":i[0]||(i[0]=_=>o.localModelValue=_),noResultsText:"No timeslots found",placeholder:"Select delivery time",options:o.availableTimeSlotOptions},null,8,["modelValue","options"]))])}const E=S(V,[["render",I]]);export{E as D,j as a};
