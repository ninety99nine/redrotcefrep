import{Q as T}from"./browser-BluySq_y.js";import{a as N,C as W}from"./Copy-DtqSf0U1.js";import{B as U}from"./Button-CMAESCwz.js";import{S as z}from"./Skeleton-KK-V-B9B.js";import{V as B}from"./vue-slide-up-down-BJtNgx5R.js";import{S as E}from"./StoreLogo-TTC2UFqy.js";import{a as Q}from"./stringUtils-Bvzw0-oW.js";import{W as j}from"./WhatsappIcon-D7iocXyI.js";import{W as A}from"./WhatsappMessage-CGV7D_4n.js";import{c as n,b as t,d as u,e as _,t as y,a as d,r as l,i as x,F as w,g as m,f as D,o as r,n as v,w as P}from"./app-CaCDZNvD.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as V,a as F}from"./chevron-up-CHJq7Wo_.js";import{R as G}from"./receipt-text-CBqaHEwE.js";import{A as H}from"./arrow-left-CgKkGxGf.js";import"./ShineEffect-9Bzjo95p.js";import"./createLucideIcon-hJfW1V63.js";import"./Loader-C6t2-ZQM.js";import"./plus-BsLTh-Ke.js";const J={inject:["formState","storeState","orderState","notificationState"],components:{Copy:N,Button:U,Skeleton:z,VueSlideUpDown:B,ReceiptText:G,ChevronUp:F,ChevronDown:V,StoreLogo:E,WhatsappIcon:j,WhatsappMessage:A},data(){return{CopyIcon:W,ArrowLeft:H,qrCode:null,clicked:!1,accordions:[{label:"Open in external browser",expanded:!1},{label:"Send order details manually",expanded:!1},{label:"Scan QR code to open this page on your mobile",expanded:!1}]}},watch:{order(o,e){!e&&o&&this.setup()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},paymentMethod(){return this.$route.query.payment_method??null},orderUrl(){return`${window.location.origin+this.$router.resolve({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}}).href}`},currentPageUrl(){return window.location.origin+this.$router.resolve({name:"show-shop-confirming-payment",params:{alias:this.store.alias,order_id:this.order.id}}).href},whatsappMessage(){if(this.order){let o="";o+=`*Order #${this.order.number}*
`;for(let i=0;i<this.order.order_products.length;i++){const s=this.order.order_products[i];o+=`
*${s.quantity}x* ${s.name} ${s.grand_total.amount_with_currency}`}o+=`

*Grand Total: ${this.order.grand_total.amount_with_currency}* (Qty: ${this.order.total_uncancelled_product_quantities})
`;const e=this.isNotEmpty(this.order.customer_name),a=this.isNotEmpty(this.order.customer_email),p=this.isNotEmpty(this.order.customer_mobile_number);return e&&(o+=`
Name: ${this.order.customer_name}`),p&&(o+=`
Mobile: ${this.order.customer_mobile_number.international}`),a&&(o+=`
Email: ${this.order.customer_email}`),(e||p||a)&&(o+=`
`),this.paymentMethod!=null&&(o+=`
Payment : ${this.paymentMethod} (Confirm Payment)
`),this.order.delivery_method!=null&&(o+=`
Delivery: ${this.order.delivery_method.name}`),this.order.paymentMethod!=null&&(o+=`
Address: ${this.order.delivery_address.complete_address}`),o+=`

See invoice ${this.orderUrl}`,o}return null}},methods:{isNotEmpty:Q,setup(){this.store&&this.order&&(this.generateQRCode(),["paid","waiting confirmation"].includes(this.order.payment_status)||this.updateOrder())},toggleAccordian(o){for(let e=0;e<this.accordions.length;e++)e==o?this.accordions[e].expanded=!this.accordions[e].expanded:this.accordions[e].expanded=!1},async generateQRCode(){try{this.qrCode=await T.toDataURL(this.currentPageUrl,{margin:2,width:150,color:{dark:"#000000",light:"#ffffff"}})}catch(o){console.error("Failed to generate QR code:",o)}},async navigateToShowShopOrder(){await this.$router.push({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}})},async navigateToStorefront(){await this.$router.push({name:"show-storefront",params:{alias:this.store.alias}})},sendUsingWhatsapp(){const o=this.store.whatsapp_mobile_number?`phone=${this.store.whatsapp_mobile_number.international.replace("+","")}&`:"";window.open(`https://wa.me/?${o}text=${encodeURIComponent(this.whatsappMessage)}`,"_blank"),this.clicked=!0},async updateOrder(){var o,e;try{const a="waiting confirmation",p={payment_status:a,store_id:this.store.id};await axios.put(`/api/orders/${this.order.id}`,p),this.orderState.order.payment_status=a}catch(a){const p=((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(p),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}},created(){this.setup()}},K={class:"select-none max-w-xl mx-auto pt-16"},X={class:"w-full bg-white border border-gray-100 shadow-sm rounded-xl mb-4"},Y={class:"p-4 flex items-center space-x-4"},Z={class:"w-full flex justify-between space-x-4"},$={class:"w-full"},ee={key:1,class:"text-gray-700 font-semibold text-sm"},te={key:3,class:"text-gray-500 text-sm"},se={key:1,class:"text-right text-gray-400 text-xs"},oe={class:"w-full bg-gray-50 border border-gray-100 shadow rounded-xl p-10"},re={class:"w-16 h-16 mx-auto flex items-center justify-center bg-green-100 text-green-500 rounded-full mb-4"},ae={class:"flex justify-center space-x-2 mb-4"},ne={key:0},ie=["onClick"],de={class:"text-sm text-gray-700"},le={key:1,class:"p-4 space-y-2"},ce={key:0,class:"flex items-center justify-between"},me={class:"text-gray-700 font-semibold text-xs"},pe={class:"flex items-center justify-end"},he=["src"],ue={key:1,class:"flex justify-center"},ge={class:"flex items-center space-x-1"};function fe(o,e,a,p,i,s){const C=l("StoreLogo"),b=l("Skeleton"),k=l("ReceiptText"),g=l("Button"),L=l("ChevronUp"),I=l("ChevronDown"),S=l("Copy"),M=l("WhatsappMessage"),O=l("vue-slide-up-down"),R=l("WhatsappIcon");return r(),n("div",K,[t("div",X,[t("div",Y,[s.store&&s.store.logo?(r(),u(C,{key:0,size:"w-10 h-10",showButton:!1})):_("",!0),t("div",Z,[t("div",$,[s.isLoadingStore||s.isLoadingOrder?(r(),u(b,{key:0,width:"w-40",height:"h-2",shine:!0})):(r(),n("p",ee,y(s.order.customer_name),1)),s.isLoadingStore||s.isLoadingOrder?(r(),u(b,{key:2,width:"w-2/3",height:"h-2",shine:!0})):(r(),n("p",te,y(s.order.summary),1))]),s.isLoadingStore||s.isLoadingOrder?(r(),u(b,{key:0,width:"w-2/3",height:"h-2",shine:!0})):(r(),n("p",se,"Order #"+y(s.order.number),1))])])]),t("div",oe,[t("div",re,[d(k,{size:"24"})]),e[10]||(e[10]=t("p",{class:"text-xl font-semibold text-center mb-2"},"Confirming Payment",-1)),e[11]||(e[11]=t("p",{class:"text-sm text-gray-500 text-center mb-8"},[x(" Our team will confirm your payment and process your order. "),t("br"),x(" Send us a message to stay in touch. ")],-1)),i.clicked?(r(),n(w,{key:0},[t("div",ae,[d(g,{size:"md",type:"light",leftIcon:i.ArrowLeft,action:s.navigateToStorefront},{default:m(()=>e[0]||(e[0]=[t("span",{class:"text-xs"},"Back to shop",-1)])),_:1,__:[0]},8,["leftIcon","action"]),d(g,{size:"md",type:"success",action:s.navigateToShowShopOrder},{default:m(()=>e[1]||(e[1]=[t("span",{class:"text-xs"},"Go to invoice",-1)])),_:1,__:[1]},8,["action"])]),!s.isLoadingStore&&!s.isLoadingOrder?(r(),n("div",ne,[e[8]||(e[8]=t("p",{class:"text-sm text-red-500 text-center mt-8 mb-4"},"WhatsApp is not opening?",-1)),(r(!0),n(w,null,D(i.accordions,(f,c)=>(r(),n("div",{key:c,onClick:P(()=>s.toggleAccordian(c),["stop"]),class:v(["border border-gray-300",{"rounded-t-lg":c==0},{"rounded-b-lg":c==i.accordions.length-1}])},[t("div",{class:v(["flex items-center justify-between bg-gray-50 hover:bg-gray-100 p-2 cursor-pointer",{shadow:f.expanded},{"rounded-t-lg":c==0},{"rounded-b-lg":c==i.accordions.length-1&&!f.expanded}])},[t("p",de,y(f.label),1),f.expanded?(r(),u(L,{key:0,size:"16"})):(r(),u(I,{key:1,size:"16"}))],2),d(O,{active:f.expanded},{default:m(()=>[c==0?(r(),n(w,{key:0},[e[2]||(e[2]=t("p",{class:"text-xs text-gray-500 p-4 mb-4"},[x(" Look for the option called "),t("span",{class:"font-bold"},'"Open in external browser"')],-1)),e[3]||(e[3]=t("img",{src:"/images/open_in_external_browser.png",class:"max-w-80 rounded-lg overflow-hidden m-4 mx-auto"},null,-1))],64)):c==1?(r(),n("div",le,[e[6]||(e[6]=t("p",{class:"text-xs text-gray-500 mb-4"},[x(" Copy order details below and send to our "),t("span",{class:"font-bold"},"Whatsapp number")],-1)),s.store.whatsapp_mobile_number?(r(),n("div",ce,[t("span",me,y(s.store.whatsapp_mobile_number.international),1),d(S,{showText:!1,text:s.store.whatsapp_mobile_number.international},{trigger:m(h=>[d(g,{size:"xs",type:"light",leftIconSize:"14",leftIcon:i.CopyIcon,action:()=>h.loading?h.copyToClipboardNotReady():h.copyToClipboard()},{default:m(()=>e[4]||(e[4]=[t("span",{class:"text-xs ml-1"},"copy our whatsapp number",-1)])),_:2,__:[4]},1032,["leftIcon","action"])]),_:1},8,["text"])])):_("",!0),s.whatsappMessage?(r(),n(w,{key:1},[t("div",pe,[d(S,{showText:!1,text:s.whatsappMessage},{trigger:m(h=>[d(g,{size:"xs",type:"light",leftIconSize:"14",leftIcon:i.CopyIcon,action:()=>h.loading?h.copyToClipboardNotReady():h.copyToClipboard()},{default:m(()=>e[5]||(e[5]=[t("span",{class:"text-xs ml-1"},"copy order details",-1)])),_:2,__:[5]},1032,["leftIcon","action"])]),_:1},8,["text"])]),d(M,{message:s.whatsappMessage},null,8,["message"])],64)):_("",!0)])):c==2?(r(),n(w,{key:2},[e[7]||(e[7]=t("p",{class:"text-xs text-gray-500 p-4 mb-4"},[x(" Use your mobile camera to scan this "),t("span",{class:"font-bold"},"QR Code")],-1)),t("img",{src:i.qrCode,alt:"QR Code",class:"my-4 mx-auto border border-gray-300 rounded-lg shadow max-w-60"},null,8,he)],64)):_("",!0)]),_:2},1032,["active"])],10,ie))),128))])):_("",!0)],64)):(r(),n("div",ue,[d(g,{size:"xs",type:"success",action:s.sendUsingWhatsapp},{default:m(()=>[t("div",ge,[d(R,{color:"#ffffff",class:"mx-2"}),e[9]||(e[9]=t("span",{class:"text-xs"},"Send using Whatsapp",-1))])]),_:1},8,["action"])]))])])}const ze=q(J,[["render",fe]]);export{ze as default};
