import{Q as U}from"./browser-CdP7bVHs.js";import{a as W,C as N}from"./Copy-B_MLEMQD.js";import{B as z}from"./Button-Dy6BYOYD.js";import{S as R}from"./Skeleton-BfdDUyfM.js";import{V as B}from"./vue-slide-up-down-DvCHtOEz.js";import{S as Q}from"./StoreLogo-DJAU6e07.js";import{a as j}from"./stringUtils-Bvzw0-oW.js";import{W as E}from"./WhatsappIcon-CawMyV9I.js";import{W as P}from"./WhatsappMessage-D3B3cYb7.js";import{c as n,b as s,d as g,e as y,t as _,a as d,i as x,F as w,g as p,f as A,r as l,o as r,n as S,w as D}from"./app-CAsQYp3T.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as V,a as F}from"./chevron-up-GoZo737D.js";import{H}from"./hand-coins-gthh3cYb.js";import{A as G}from"./arrow-left-Cy1iBNmi.js";import"./ShineEffect-DjmscYxr.js";import"./createLucideIcon-Dd5tvPb0.js";import"./Loader-j3Xd9R0O.js";import"./plus-BwaaZFcM.js";const Y={inject:["storeState","orderState"],components:{Copy:W,HandCoins:H,Button:z,Skeleton:R,VueSlideUpDown:B,ChevronUp:F,ChevronDown:V,StoreLogo:Q,WhatsappIcon:E,WhatsappMessage:P},data(){return{CopyIcon:N,ArrowLeft:G,qrCode:null,clicked:!1,accordions:[{label:"Open in external browser",expanded:!1},{label:"Send order details manually",expanded:!1},{label:"Scan QR code to open this page on your mobile",expanded:!1}]}},watch:{order(o,e){!e&&o&&this.setup()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},paymentMethod(){return this.$route.query.payment_method??null},orderUrl(){return`${window.location.origin+this.$router.resolve({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}}).href}`},currentPageUrl(){return window.location.origin+this.$router.resolve({name:"show-shop-pending-payment",params:{alias:this.store.alias,order_id:this.order.id}}).href},whatsappMessage(){if(this.order){let o="";o+=`*Order #${this.order.number}*
`;for(let i=0;i<this.order.order_products.length;i++){const t=this.order.order_products[i];o+=`
*${t.quantity}x* ${t.name} ${t.grand_total.amount_with_currency}`}o+=`

*Grand Total: ${this.order.grand_total.amount_with_currency}* (Qty: ${this.order.total_uncancelled_product_quantities})
`;const e=this.isNotEmpty(this.order.customer_name),a=this.isNotEmpty(this.order.customer_email),m=this.isNotEmpty(this.order.customer_mobile_number);return e&&(o+=`
Name: ${this.order.customer_name}`),m&&(o+=`
Mobile: ${this.order.customer_mobile_number.international}`),a&&(o+=`
Email: ${this.order.customer_email}`),(e||m||a)&&(o+=`
`),this.paymentMethod!=null&&(o+=`
Payment : ${this.paymentMethod} (Unpaid)
`),this.order.delivery_method!=null&&(o+=`
Delivery: ${this.order.delivery_method.name}`),this.order.paymentMethod!=null&&(o+=`
Address: ${this.order.delivery_address.complete_address}`),o+=`

See invoice ${this.orderUrl}`,o}return null}},methods:{isNotEmpty:j,setup(){this.store&&this.order&&(this.generateQRCode(),["paid","unpaid"].includes(this.order.payment_status)||this.updateOrder())},toggleAccordian(o){for(let e=0;e<this.accordions.length;e++)e==o?this.accordions[e].expanded=!this.accordions[e].expanded:this.accordions[e].expanded=!1},async generateQRCode(){try{this.qrCode=await U.toDataURL(this.currentPageUrl,{margin:2,width:150,color:{dark:"#000000",light:"#ffffff"}})}catch(o){console.error("Failed to generate QR code:",o)}},async navigateToShowShopOrder(){await this.$router.push({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}})},async navigateToStorefront(){await this.$router.push({name:"show-storefront",params:{alias:this.store.alias}})},sendUsingWhatsapp(){const o=this.store.whatsapp_mobile_number?`phone=${this.store.whatsapp_mobile_number.international.replace("+","")}&`:"";window.open(`https://wa.me/?${o}text=${encodeURIComponent(this.whatsappMessage)}`,"_blank"),this.clicked=!0},async updateOrder(){var o,e;try{const a="unpaid",m={payment_status:a,store_id:this.store.id};await axios.put(`/api/orders/${this.order.id}`,m),this.orderState.order.payment_status=a}catch(a){const m=((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(m),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}},created(){this.setup()}},J={class:"select-none max-w-xl mx-auto pt-16"},K={class:"p-4 flex items-center space-x-4"},X={class:"w-full flex justify-between space-x-4"},Z={class:"w-full"},$={key:1,class:"text-gray-700 font-semibold text-sm"},ee={key:3,class:"text-gray-500 text-sm"},te={key:1,class:"text-right text-gray-400 text-xs"},se={class:"w-full bg-gray-50 border border-gray-100 shadow rounded-xl p-10"},oe={class:"w-16 h-16 mx-auto flex items-center justify-center bg-green-100 text-green-500 rounded-full mb-4"},re={class:"flex justify-center space-x-2 mb-4"},ae={key:0},ne=["onClick"],ie={class:"text-sm text-gray-700"},de={key:1,class:"p-4 space-y-2"},le={key:0,class:"flex items-center justify-between"},ce={class:"text-gray-700 font-semibold text-xs"},pe={class:"flex items-center justify-end"},me=["src"],he={key:1,class:"flex justify-center"},ue={class:"flex items-center space-x-1"};function ge(o,e,a,m,i,t){const C=l("StoreLogo"),b=l("Skeleton"),k=l("HandCoins"),f=l("Button"),L=l("ChevronUp"),O=l("ChevronDown"),v=l("Copy"),I=l("WhatsappMessage"),M=l("vue-slide-up-down"),T=l("WhatsappIcon");return r(),n("div",J,[s("div",{onClick:e[0]||(e[0]=(...h)=>t.navigateToShowShopOrder&&t.navigateToShowShopOrder(...h)),class:"w-full bg-white border border-gray-100 shadow-sm rounded-xl cursor-pointer hover:bg-gray-50 hover:scale-105 active:opacity-80 active:scale-100 transition-all duration-300 mb-4"},[s("div",K,[t.store&&t.store.logo?(r(),g(C,{key:0,size:"w-10 h-10",showButton:!1})):y("",!0),s("div",X,[s("div",Z,[t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:0,width:"w-40",height:"h-2",shine:!0})):(r(),n("p",$,_(t.order.customer_name),1)),t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:2,width:"w-2/3",height:"h-2",shine:!0})):(r(),n("p",ee,_(t.order.summary),1))]),t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:0,width:"w-2/3",height:"h-2",shine:!0})):(r(),n("p",te,"Order #"+_(t.order.number),1))])])]),s("div",se,[s("div",oe,[d(k,{size:"24"})]),e[11]||(e[11]=s("p",{class:"text-xl font-semibold text-center mb-2"},"Pending Payment",-1)),e[12]||(e[12]=s("p",{class:"text-sm text-gray-500 text-center mb-8"},[x(" Your payment is pending, let us know how we can help. "),s("br"),x(" Send us a message to stay in touch. ")],-1)),i.clicked?(r(),n(w,{key:0},[s("div",re,[d(f,{size:"md",type:"light",leftIcon:i.ArrowLeft,action:t.navigateToStorefront},{default:p(()=>[...e[1]||(e[1]=[s("span",{class:"text-xs"},"Back to shop",-1)])]),_:1},8,["leftIcon","action"]),d(f,{size:"md",type:"success",action:t.navigateToShowShopOrder},{default:p(()=>[...e[2]||(e[2]=[s("span",{class:"text-xs"},"Go to invoice",-1)])]),_:1},8,["action"])]),!t.isLoadingStore&&!t.isLoadingOrder?(r(),n("div",ae,[e[9]||(e[9]=s("p",{class:"text-sm text-red-500 text-center mt-8 mb-4"},"WhatsApp is not opening?",-1)),(r(!0),n(w,null,A(i.accordions,(h,c)=>(r(),n("div",{key:c,onClick:D(()=>t.toggleAccordian(c),["stop"]),class:S(["border border-gray-300",{"rounded-t-lg":c==0},{"rounded-b-lg":c==i.accordions.length-1}])},[s("div",{class:S(["flex items-center justify-between bg-gray-50 hover:bg-gray-100 p-2 cursor-pointer",{shadow:h.expanded},{"rounded-t-lg":c==0},{"rounded-b-lg":c==i.accordions.length-1&&!h.expanded}])},[s("p",ie,_(h.label),1),h.expanded?(r(),g(L,{key:0,size:"16"})):(r(),g(O,{key:1,size:"16"}))],2),d(M,{active:h.expanded},{default:p(()=>[c==0?(r(),n(w,{key:0},[e[3]||(e[3]=s("p",{class:"text-xs text-gray-500 p-4 mb-4"},[x(" Look for the option called "),s("span",{class:"font-bold"},'"Open in external browser"')],-1)),e[4]||(e[4]=s("img",{src:"/images/open_in_external_browser.png",class:"max-w-80 rounded-lg overflow-hidden m-4 mx-auto"},null,-1))],64)):c==1?(r(),n("div",de,[e[7]||(e[7]=s("p",{class:"text-xs text-gray-500 mb-4"},[x(" Copy order details below and send to our "),s("span",{class:"font-bold"},"Whatsapp number")],-1)),t.store.whatsapp_mobile_number?(r(),n("div",le,[s("span",ce,_(t.store.whatsapp_mobile_number.international),1),d(v,{showText:!1,text:t.store.whatsapp_mobile_number.international},{trigger:p(u=>[d(f,{size:"xs",type:"light",leftIconSize:"14",leftIcon:i.CopyIcon,action:()=>u.loading?u.copyToClipboardNotReady():u.copyToClipboard()},{default:p(()=>[...e[5]||(e[5]=[s("span",{class:"text-xs ml-1"},"copy our whatsapp number",-1)])]),_:1},8,["leftIcon","action"])]),_:1},8,["text"])])):y("",!0),t.whatsappMessage?(r(),n(w,{key:1},[s("div",pe,[d(v,{showText:!1,text:t.whatsappMessage},{trigger:p(u=>[d(f,{size:"xs",type:"light",leftIconSize:"14",leftIcon:i.CopyIcon,action:()=>u.loading?u.copyToClipboardNotReady():u.copyToClipboard()},{default:p(()=>[...e[6]||(e[6]=[s("span",{class:"text-xs ml-1"},"copy order details",-1)])]),_:1},8,["leftIcon","action"])]),_:1},8,["text"])]),d(I,{message:t.whatsappMessage},null,8,["message"])],64)):y("",!0)])):c==2?(r(),n(w,{key:2},[e[8]||(e[8]=s("p",{class:"text-xs text-gray-500 p-4 mb-4"},[x(" Use your mobile camera to scan this "),s("span",{class:"font-bold"},"QR Code")],-1)),s("img",{src:i.qrCode,alt:"QR Code",class:"my-4 mx-auto border border-gray-300 shadow max-w-60"},null,8,me)],64)):y("",!0)]),_:2},1032,["active"])],10,ne))),128))])):y("",!0)],64)):(r(),n("div",he,[d(f,{size:"xs",type:"success",action:t.sendUsingWhatsapp},{default:p(()=>[s("div",ue,[d(T,{color:"#ffffff",class:"mx-2"}),e[10]||(e[10]=s("span",{class:"text-xs"},"Send using Whatsapp",-1))])]),_:1},8,["action"])]))])])}const ze=q(Y,[["render",ge]]);export{ze as default};
