import{c as d,b as r,a as n,r as c,t as m,F as k,g as h,w as _,e as x,h as g,o as u}from"./app-C9fKn4Wu.js";import{L as S}from"./Logo-Jvt7Q30m.js";import{A as b}from"./Alert-XyQlk9Xa.js";import{I as E}from"./Input-BpvCbPzt.js";import{B as v}from"./Button-B6uWpkNJ.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as F}from"./createLucideIcon-aSWH95Ml.js";import"./Popover-DkgXtOm4.js";import"./info-DcMYHvks.js";import"./Copy-MnYDw6Fb.js";import"./ShineEffect-CamUJCMA.js";import"./Skeleton-D3J4oatQ.js";import"./Loader-7AMjb3nm.js";/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=F("log-in",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),V={name:"SetupAccount",components:{Logo:S,Alert:b,Input:E,Button:v},inject:["authState","formState","notificationState"],data(){return{LogIn:I,form:{email:"",token:"",password:"",confirm_password:""},loading:!1,tokenError:null,currentYear:new Date().getFullYear()}},methods:{goHome(){this.$router.push({name:"login"})},async validateToken(){var l,t;try{await g.post("/api/auth/validate-token",{email:this.form.email,token:this.form.token}),this.tokenError=null}catch(o){const i=((t=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"Invalid or expired token.";this.tokenError=i,this.notificationState.showWarningNotification(i)}},async submit(){var l,t;if(!this.loading&&(this.formState.hideFormErrors(),this.form.email.trim()===""&&this.formState.setFormError("email","Email is required"),this.form.password.trim()===""&&this.formState.setFormError("password","Password is required"),this.form.confirm_password.trim()===""&&this.formState.setFormError("confirm_password","Confirm password"),this.form.password!==this.form.confirm_password&&this.formState.setFormError("confirm_password","Passwords do not match"),!this.formState.hasErrors)){this.loading=!0;try{const i=(await g.post("/api/auth/setup-password",this.form)).data.token;this.authState.setTokenOnRequest(i),this.authState.setTokenOnLocalStorage(i),this.$router.push({name:"show-stores"}),this.notificationState.showSuccessNotification("Password set successfully!")}catch(o){const i=((t=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"Something went wrong while setting your password";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(o),console.error("Failed to set password:",o)}finally{this.loading=!1}}}},async mounted(){this.form.email=this.$route.query.email||"",this.form.token=this.$route.query.token||"",this.form.email&&this.form.token?await this.validateToken():(this.tokenError="Invalid or missing email/token.",this.notificationState.showWarningNotification("Invalid or missing email/token."))}},L={class:"min-h-screen grid grid-cols-1 lg:grid-cols-2 transition-opacity opacity-100 duration-750 lg:grow starting:opacity-0"},P={class:"flex items-center justify-center p-6 bg-gradient-to-b from-blue-100 to-white-100"},A={class:"w-full max-w-md"},C={class:"bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6"},B={class:"text-2xl font-semibold leading-none tracking-tight mb-4"},N={class:"text-sm text-gray-500 mb-4"},q={key:0,class:"text-red-500 text-sm mb-3"},j={class:"ml-1"},U={class:"text-sm text-center text-gray-500"};function Y(l,t,o,i,e,s){const w=c("Logo"),y=c("Alert"),f=c("Button"),p=c("Input");return u(),d("div",L,[r("div",P,[r("div",A,[n(w,{height:"h-20 mx-auto mb-4"}),r("div",C,[r("h1",B,m(e.tokenError?e.tokenError.includes("expired")?"Setup Link Expired":"Setup Link Invalid":"Set Up Your Account"),1),r("h1",N,m(e.tokenError?e.tokenError.includes("expired")?"The link to set up your account has expired. Contact your administrator to assist.":"The link to set up your account is invalid. Contact your administrator to assist.":"Please set your password to activate your account."),1),e.tokenError?(u(),d(k,{key:0},[n(y,{title:e.tokenError,type:"danger",dismissable:!1,class:"mb-8"},null,8,["title"]),n(f,{type:"primary",size:"lg",action:s.goHome,buttonClass:"w-full"},{default:h(()=>t[4]||(t[4]=[r("span",null,"Go Home",-1)])),_:1,__:[4]},8,["action"])],64)):(u(),d("form",{key:1,onSubmit:t[3]||(t[3]=_((...a)=>s.submit&&s.submit(...a),["prevent"])),class:"space-y-4"},[n(p,{disabled:"",type:"email",label:"Email",modelValue:e.form.email,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.email=a),errorText:s.formState.getFormError("email")},null,8,["modelValue","errorText"]),n(p,{type:"password",label:"Password",modelValue:e.form.password,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.password=a),errorText:s.formState.getFormError("password")},null,8,["modelValue","errorText"]),n(p,{type:"password",label:"Confirm Password",modelValue:e.form.confirm_password,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.confirm_password=a),errorText:s.formState.getFormError("confirm_password")},null,8,["modelValue","errorText"]),s.formState.generalErrorText?(u(),d("div",q,m(s.formState.generalErrorText),1)):x("",!0),n(f,{size:"md",type:"primary",class:"w-full",action:s.submit,leftIcon:e.LogIn,disabled:e.loading},{default:h(()=>[r("span",j,m(e.loading?"Setting Password...":"Set Password"),1)]),_:1},8,["action","leftIcon","disabled"])],32))]),r("p",U,"Â© "+m(e.currentYear)+" Perfect Order. All rights reserved.",1)])]),t[5]||(t[5]=r("div",{class:"hidden lg:block"},[r("img",{src:"/images/lady-with-laptop.jpg",class:"w-full h-full object-cover",alt:"Lady holding boxes"})],-1))])}const $=T(V,[["render",Y]]);export{$ as default};
