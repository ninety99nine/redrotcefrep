import{h as M,c as d,d as p,a as c,r as m,o,e as g,b as r,t as l,F as b,f as k,k as T,w as D,g as x,i as O,p as q,q as A,s as Q,u as V,G as Z,ah as H}from"./app-Ckd9AbVO.js";import{I as N,r as K}from"./Input-DTpSf4CK.js";import{S as z}from"./Select-LIksYHJW.js";import{S as L}from"./Skeleton-C7IaP8B7.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as J}from"./Popover-DNosUJul.js";import{P as U}from"./Pill-CDvn4AWu.js";import{B as F}from"./Button-B96ByjTu.js";import{I as j}from"./image-DYIofzhQ.js";import{M as X}from"./move-right-Dd4hStSZ.js";import{a as Y,O as $}from"./OrderPaymentStatusSelect-C-hWu5IO.js";import{M as B}from"./Modal-CT3wZrtx.js";import{i as R,c as ee}from"./stringUtils-Bvzw0-oW.js";import{L as te}from"./Loader-BbLMPbbw.js";import{U as re}from"./user-round-DzOn5SBg.js";import{T as E}from"./trash-2-D32cBtOq.js";import{A as se}from"./arrow-down-to-line-C2SkONpS.js";import{A as W}from"./Alert-BMOwR5tH.js";import{G as oe}from"./GoogleMaps-DmISjMnD.js";import{C as ne}from"./CollectionStatus-CB_B4rFo.js";import{c as ie}from"./createLucideIcon-DrbACf-e.js";import{E as G}from"./external-link-Ct16ZcqW.js";import{A as ae}from"./arrow-right-DtQcap7T.js";import{B as de}from"./banknote-BgcJe0ux.js";import{C as le}from"./circle-dollar-sign-B2ZdLWjN.js";import{L as ce}from"./link-2-Bi1d2eeP.js";import{P as me}from"./plus-B2WqJXut.js";import"./Copy-DAJZKgwH.js";import"./ShineEffect-CdpjiGQa.js";import"./Tooltip-DGqAsbhw.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-BnkvBi13.js";import"./circle-check-CWZ-rRxZ.js";import"./circle-alert-gjxEm3KP.js";import"./x-C10GWcGQ.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./info-aeyZRSQR.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ie("user-round-check",[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]),he={inject:["formState","orderState","storeState","notificationState"],components:{Input:N,Select:z,Skeleton:L},data(){return{teamMembers:[],isLoadingTeamMembers:!1}},watch:{isLoadingOrder(i){!i&&this.hasOrder&&this.showTeamMembers()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},orderForm(){return this.orderState.orderForm},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},teamMemberOptions(){let i=[{label:"Unassigned",value:null}];return this.teamMembers.forEach(t=>{i.push({label:t.name,value:t.id})}),i}},methods:{async showTeamMembers(){var i,t;try{this.isLoadingTeamMembers=!0;let s={params:{store_id:this.store.id}};const a=await M.get("/api/users",s);this.pagination=a.data,this.teamMembers=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching team members";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch team members:",s)}finally{this.isLoadingTeamMembers=!1}},async updateOrder(i,t){var s,a;try{if(i={...i,store_id:this.store.id},await M.put(`/api/orders/${this.order.id}`,i),t=="team member")if(this.orderForm.assigned_to_user_id){const n=this.teamMembers.find(e=>e.id===this.orderForm.assigned_to_user_id);this.notificationState.showSuccessNotification(`Order assigned to ${n.first_name}`)}else this.notificationState.showSuccessNotification("No team member unassigned");else t=="internal note"&&(this.orderForm.internal_note?this.notificationState.showSuccessNotification("Internal note updated"):this.notificationState.showSuccessNotification("Internal note removed"),this.orderState.order.internal_note=this.orderForm.internal_note)}catch(n){const e=((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(n),console.error("Failed to update order changes:",n)}}}},ge={class:"bg-white rounded-lg p-4 mb-4"},fe={key:1,class:"space-y-4"};function pe(i,t,s,a,n,e){const h=m("Skeleton"),u=m("Select"),_=m("Input");return o(),d("div",ge,[e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),d("div",fe,[c(u,{search:!0,label:"Assigned To",options:e.teamMemberOptions,modelValue:e.orderForm.assigned_to_user_id,"onUpdate:modelValue":t[0]||(t[0]=f=>e.orderForm.assigned_to_user_id=f),skeleton:e.isLoadingOrder||!e.hasOrder||n.isLoadingTeamMembers,onChange:t[1]||(t[1]=f=>e.updateOrder({assigned_to_user_id:f},"team member"))},null,8,["options","modelValue","skeleton"]),c(_,{rows:"2",type:"textarea",label:"Internal Note",modelValue:e.orderForm.internal_note,"onUpdate:modelValue":t[2]||(t[2]=f=>e.orderForm.internal_note=f),description:"Visible to team members",errorText:e.formState.getFormError("internal_note"),onBlur:t[3]||(t[3]=f=>e.updateOrder({internal_note:f},"internal note")),tooltipContent:"Internal information about this order only visible to you and other team members"},null,8,["modelValue","errorText"])]))])}const _e=C(he,[["render",pe]]),ye={inject:["orderState","storeState"],components:{Skeleton:L},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder},hasTaxTotal(){return this.isLoadingOrder?!1:this.order.vat_amount.amount>0},hasFeeTotal(){return this.isLoadingOrder?!1:this.order.fee_total.amount>0},deliveryFee(){return this.isLoadingOrder?this.order.delivery_fee.amount:null},hasDeliveryName(){return this.isLoadingOrder?!1:this.order.delivery_name!=null},hasDiscountTotal(){return this.isLoadingOrder?!1:this.order.discount_total.amount>0},orderFees(){return this.isLoadingOrder?[]:this.order.order_fees},orderDiscounts(){return this.isLoadingOrder?[]:this.order.order_discounts},hasAdjustmentTotal(){return this.isLoadingOrder?!1:this.order.adjustment_total.amount!=0},adjustmentTotalPositive(){return this.isLoadingOrder?!1:this.order.adjustment_total.amount>0}},methods:{removeDecimalTrailingZeros:K}},be={class:"bg-blue-50 border border-blue-400 rounded-lg p-4"},we={key:0,class:"flex items-center justify-between text-sm border-b border-dashed border-gray-300 pb-2 mb-2"},xe={key:1},Se={key:1,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Oe={key:1},ve={key:3},ke={key:2,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Ce={class:"flex items-center justify-between text-sm mb-1"},Pe={key:1,class:"w-full"},Te={key:3},Le={key:1,class:"text-xs text-gray-400"},Ie={key:3,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Fe={key:1},De={key:3},je={key:4,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Me={class:"flex items-center justify-between text-sm text-gray-500"},Ne={key:1},Ee={key:3},Ae={key:5,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},Ue={class:"flex items-center justify-between text-sm text-gray-500"},Ve={key:1},ze={class:"flex items-center justify-between text-base pt-2"},Be={key:1,class:"font-bold"};function Re(i,t,s,a,n,e){const h=m("Skeleton");return o(),d("div",be,[e.isLoadingOrder||!e.hasOrder||e.hasTaxTotal||e.hasDiscountTotal||e.hasFeeTotal||e.hasDeliveryName?(o(),d("div",we,[t[0]||(t[0]=r("span",null,"Subtotal",-1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",xe,l(e.order.subtotal.amount_with_currency),1))])):g("",!0),e.isLoadingOrder||!e.hasOrder||e.hasDiscountTotal?(o(),d("div",Se,[(o(!0),d(b,null,k(e.isLoadingOrder||!e.hasOrder?[1]:e.orderDiscounts,(u,_)=>(o(),d("div",{key:_,class:"flex items-center justify-between text-sm text-gray-500"},[e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",Oe,l(u.name),1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:2,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",ve,l(u.amount.amount_with_currency),1))]))),128))])):g("",!0),e.isLoadingOrder||!e.hasOrder||e.hasTaxTotal?(o(),d("div",ke,[r("div",Ce,[e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("div",Pe,"Tax ("+l(e.removeDecimalTrailingZeros(e.order.vat_rate))+"% "+l(e.order.vat_method)+")",1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",Te,l(e.order.vat_amount.amount_with_currency),1))]),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-1/3",color:"bg-blue-200",shine:!0})):e.order.vat_amount.amount>0?(o(),d("p",Le,"Tax calculated on the discounted subtotal of "+l(e.order.subtotal_after_discount.amount_with_currency),1)):g("",!0)])):g("",!0),e.isLoadingOrder||!e.hasOrder||e.hasFeeTotal?(o(),d("div",Ie,[(o(!0),d(b,null,k(e.isLoadingOrder||!e.hasOrder?[1]:e.orderFees,(u,_)=>(o(),d("div",{key:_,class:"flex items-center justify-between text-sm text-gray-500"},[e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Fe,l(u.name),1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",De,l(u.amount.amount_with_currency),1))]))),128))])):g("",!0),e.isLoadingOrder||!e.hasOrder||e.hasDeliveryName?(o(),d("div",je,[r("div",Me,[e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Ne,l(e.order.delivery_name),1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",Ee,l(e.order.delivery_fee.amount_with_currency),1))])])):g("",!0),e.isLoadingOrder||!e.hasOrder||e.hasAdjustmentTotal?(o(),d("div",Ae,[r("div",Ue,[e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Ve,"Adjustment")),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",{key:3,class:T([e.adjustmentTotalPositive?"text-green-500":"text-red-500"])},l(e.adjustmentTotalPositive?"+":"-")+" "+l(`${e.order.adjustment_total.amount_with_currency}`.replace("-","")),3))])])):g("",!0),r("div",ze,[t[1]||(t[1]=r("div",{class:"w-full font-bold"},"Grand Total",-1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",Be,l(e.order.grand_total.amount_with_currency),1))])])}const We=C(ye,[["render",Re]]),Ge={inject:["orderState","storeState"],components:{Image:j,Pill:U,Button:F},props:{orderProduct:{type:Object}},data(){return{MoveRight:X,expanded:!1}},computed:{store(){return this.storeState.store},hasDetectedChanges(){return this.orderProduct.detected_changes.length>0},totalDetectedChanges(){return this.orderProduct.detected_changes.length},hasPhoto(){return this.photo!=null},photo(){return this.orderProduct.photo},canShowProduct(){return this.orderProduct.product_id!=null}},methods:{toggleExpansion(){this.expanded=!this.expanded},navigateToProduct(){console.log(this.orderProduct),this.$router.push({name:"edit-product",params:{product_id:this.orderProduct.product_id},query:{store_id:this.store.id}})}}},qe={class:"w-full flex items-center space-x-4"},Qe=["src"],Ze={class:"w-full flex items-center justify-between"},He={class:"font-semibold text-sm whitespace-nowrap"},Ke={class:"text-sm font-semibold"},Je={class:"text-xs text-gray-500"},Xe={class:"flex items-center space-x-2 mr-4"},Ye={class:"flex items-center space-x-2"},$e={class:"text-sm"},et={key:0,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},tt={key:1,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},rt={key:0,class:"text-sm p-4 pb-8"},st={class:"flex items-end justify-between mb-4 ml-4"},ot={class:"w-full overflow-x-auto rounded-lg border border-gray-300 mb-4"},nt={class:"w-full text-sm text-left rtl:text-right text-gray-500"},it={class:"whitespace-nowrap align-top text-left p-2 pl-4"},at={class:"whitespace-nowrap align-top text-center py-2"},dt={class:"whitespace-nowrap align-top text-center py-2"},lt={class:"whitespace-nowrap align-top text-center py-2"},ct={class:"whitespace-nowrap align-top text-center py-2"},mt={class:"whitespace-nowrap align-top text-right p-2 pr-4"},ut={class:"w-full overflow-x-auto rounded-lg border border-gray-300 mb-4"},ht={class:"w-full text-sm text-left rtl:text-right text-gray-500"},gt={class:"whitespace-nowrap align-top text-left p-2 pl-4"},ft={class:"whitespace-nowrap align-top text-center p-2"},pt={class:"whitespace-nowrap align-top text-center p-2"},_t={class:"w-full overflow-x-auto rounded-lg border mb-4"},yt={class:"w-full text-sm text-left rtl:text-right text-gray-500"},bt={key:0,class:"whitespace-nowrap align-top text-left p-2 pl-4"},wt={key:1,class:"whitespace-nowrap align-top text-center p-2"},xt={class:"space-y-2"},St={class:"text-xs"};function Ot(i,t,s,a,n,e){const h=m("Image"),u=m("Pill"),_=m("Button");return o(),d("div",{class:T([{"shadow-md":n.expanded},"select-none rounded-lg overflow-hidden border border-gray-300"])},[r("div",{onClick:t[1]||(t[1]=(...f)=>e.toggleExpansion&&e.toggleExpansion(...f)),class:T([{"shadow-sm border-b border-gray-300":n.expanded},"flex justify-between items-center cursor-pointer p-2 bg-gray-50 hover:bg-gray-100"])},[r("div",qe,[r("div",{class:T(["flex items-center justify-center w-10 h-10 rounded-lg",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),d("img",{key:0,class:"w-full max-h-full object-contain rounded-lg flex-shrink-0",src:e.photo.path},null,8,Qe)):(o(),p(h,{key:1,size:"20",class:"text-gray-400 flex-shrink-0"}))],2),r("div",Ze,[r("div",null,[r("div",{onClick:t[0]||(t[0]=D((...f)=>e.navigateToProduct&&e.navigateToProduct(...f),["stop"])),class:"flex items-center space-x-2 hover:text-blue-500 hover:underline"},[r("span",He,l(s.orderProduct.quantity)+" x",1),r("span",Ke,l(s.orderProduct.name),1)]),r("div",Je,l(s.orderProduct.unit_price.amount_with_currency)+" each",1)]),r("div",Xe,[e.hasDetectedChanges?(o(),p(u,{key:0,type:"warning",size:"xs",showDot:!1},{default:x(()=>[O(l(`${e.totalDetectedChanges} ${e.totalDetectedChanges==1?"change":"changes"} found`),1)]),_:1})):g("",!0),s.orderProduct.on_sale?(o(),p(u,{key:1,type:"success",size:"xs",showDot:!1},{default:x(()=>[...t[2]||(t[2]=[O("on sale",-1)])]),_:1})):g("",!0),s.orderProduct.is_free?(o(),p(u,{key:2,type:"success",size:"xs",showDot:!1},{default:x(()=>[...t[3]||(t[3]=[O("free",-1)])]),_:1})):g("",!0)])])]),r("div",Ye,[r("span",$e,l(s.orderProduct.grand_total.amount_with_currency),1),n.expanded?(o(),d("svg",et,[...t[4]||(t[4]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"},null,-1)])])):(o(),d("svg",tt,[...t[5]||(t[5]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"},null,-1)])]))])],2),n.expanded?(o(),d("div",rt,[r("div",st,[t[7]||(t[7]=r("h1",{class:"text-sm text-gray-500 font-semibold"},"Pricing",-1)),e.canShowProduct?(o(),p(_,{key:0,size:"xs",type:"light",rightIcon:n.MoveRight,action:e.navigateToProduct},{default:x(()=>[...t[6]||(t[6]=[r("span",null,"Show Product",-1)])]),_:1},8,["rightIcon","action"])):g("",!0)]),r("div",ot,[r("table",nt,[t[8]||(t[8]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"Regular Price")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Sale Price")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Quantity")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Subtotal")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Discount Total")]),r("th",{class:"whitespace-nowrap align-top text-right p-2 pr-4"},[r("span",null,"Grand Total")])])],-1)),r("tbody",null,[r("tr",null,[r("td",it,[r("span",null,l(s.orderProduct.unit_regular_price.amount_with_currency),1)]),r("td",at,[r("span",null,l(s.orderProduct.unit_sale_price.amount_with_currency),1)]),r("td",dt,[r("span",null,l(s.orderProduct.quantity),1)]),r("td",lt,[r("span",null,l(s.orderProduct.subtotal.amount_with_currency),1)]),r("td",ct,[r("span",null,l(s.orderProduct.sale_discount_total.amount_with_currency),1)]),r("td",mt,[r("span",null,l(s.orderProduct.grand_total.amount_with_currency),1)])])])])]),s.orderProduct.unit_weight>0?(o(),d(b,{key:0},[t[10]||(t[10]=r("h1",{class:"text-sm text-gray-500 font-semibold mb-4 ml-4"},"Weight",-1)),r("div",ut,[r("table",ht,[t[9]||(t[9]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"Unit Weight")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Quantity")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Total Weight")])])],-1)),r("tbody",null,[r("tr",null,[r("td",gt,[r("span",null,l(s.orderProduct.unit_weight),1)]),r("td",ft,[r("span",null,l(s.orderProduct.quantity),1)]),r("td",pt,[r("span",null,l(s.orderProduct.unit_weight),1)])])])])])],64)):g("",!0),s.orderProduct.sku||s.orderProduct.barcode?(o(),d(b,{key:1},[t[12]||(t[12]=r("h1",{class:"text-base text-gray-500 font-semibold mb-4 ml-4"},"Identification",-1)),r("div",_t,[r("table",yt,[t[11]||(t[11]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"SKU")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Barcode")])])],-1)),r("tbody",null,[r("tr",null,[s.orderProduct.sku?(o(),d("td",bt,[r("span",null,l(s.orderProduct.sku),1)])):g("",!0),s.orderProduct.barcode?(o(),d("td",wt,[r("span",null,l(s.orderProduct.barcode),1)])):g("",!0)])])])])],64)):g("",!0),e.hasDetectedChanges?(o(),d(b,{key:2},[t[13]||(t[13]=r("h1",{class:"text-base text-gray-500 font-semibold mb-4 ml-4"},"Changes",-1)),r("div",xt,[(o(!0),d(b,null,k(s.orderProduct.detected_changes,(f,S)=>(o(),d("div",{key:S,class:"flex space-x-2 p-2 border-l-8 border-yellow-300 bg-gray-50"},[r("p",St,l(f.message),1)]))),128))])],64)):g("",!0)])):g("",!0)],2)}const vt=C(Ge,[["render",Ot]]),kt={inject:["storeState","orderState"],components:{Image:j,Skeleton:L,OrderProduct:vt},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},orderProducts(){return this.order.order_products}}},Ct={key:0,class:"space-y-2"},Pt={class:"flex items-center justify-center w-10 h-10 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},Tt={class:"w-full flex justify-between"},Lt={class:"flex items-center space-x-2"};function It(i,t,s,a,n,e){const h=m("Image"),u=m("Skeleton"),_=m("OrderProduct");return e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",Ct,[(o(),d(b,null,k([1,2],(f,S)=>r("div",{key:S,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50"},[r("div",Pt,[c(h,{size:"20",class:"text-gray-400"})]),r("div",Tt,[c(u,{width:"w-1/3",shine:!0}),r("div",Lt,[c(u,{width:"w-16",shine:!0}),c(u,{width:"w-4",shine:!0})])])])),64))])):(o(!0),d(b,{key:1},k(e.orderProducts,(f,S)=>(o(),p(_,{key:S,orderProduct:f},null,8,["orderProduct"]))),128))}const Ft=C(kt,[["render",It]]),Dt={inject:["formState","orderState","storeState","notificationState"],components:{Popover:J,Skeleton:L,OrderTotals:We,OrderProducts:Ft,OrderStatusSelect:Y},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderId(){return this.$route.params.order_id},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder}},methods:{formattedDatetime:A,formattedRelativeDate:q,async updateOrder(i){var t,s;try{i={...i,store_id:this.store.id},await axios.put(`/api/orders/${this.orderId}`,i),this.notificationState.showSuccessNotification(`Order ${this.orderForm.status}`),this.orderState.order.status=this.orderForm.status}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}}},jt={class:"bg-white overflow-hidden rounded-lg space-y-4 p-4 mb-4"},Mt={class:"flex justify-between items-center"},Nt={class:"text-gray-700 font-semibold mb-4"},Et={class:"flex space-x-4"},At={key:0,class:"flex items-center justify-end space-x-1"},Ut={class:"text-gray-500 text-xs"};function Vt(i,t,s,a,n,e){const h=m("Popover"),u=m("Skeleton"),_=m("OrderStatusSelect"),f=m("OrderProducts"),S=m("OrderTotals");return o(),d("div",jt,[r("div",Mt,[r("h1",Nt,[t[1]||(t[1]=O("Items ",-1)),!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d(b,{key:0},[O("("+l(e.order.total_uncancelled_product_quantities)+")",1)],64)):g("",!0)]),r("div",Et,[!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d("div",At,[r("span",Ut,l(e.formattedDatetime(e.order.created_at)),1),c(h,{content:`Created ${e.formattedRelativeDate(e.order.created_at)}`},null,8,["content"])])):g("",!0),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(u,{key:1,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),p(_,{key:2,class:"w-48",showLabel:!1,onChange:t[0]||(t[0]=P=>e.updateOrder({status:P}))}))])]),c(f),c(S)])}const zt=C(Dt,[["render",Vt]]),Bt={components:{UserRound:re,Pill:U,Loader:te,Button:F},props:{index:{type:Number},orderComment:{type:Object},onViewPhoto:{type:Function},deleteOrderComment:{type:Function},isDeletingOrderCommentIds:{type:Array}},data(){return{Trash2:E,expanded:!1}},computed:{user(){return this.orderComment.user},hasPhotos(){return this.photos.length>0},photos(){return this.orderComment.photos},isDeletingOrderComment(){return this.isDeletingOrderCommentIds.findIndex(i=>i==this.orderComment.id)!=-1}},methods:{formattedDatetime:A}},Rt={class:"bg-gray-100 p-2 rounded-lg leading-0"},Wt={key:0,class:"font-bold text-sm"},Gt={class:"text-sm"},qt={key:1,class:"flex flex-wrap space-x-2 space-y-2 my-2"},Qt=["src","onClick"],Zt={class:"flex justify-between"},Ht={class:"text-gray-400 text-xs"};function Kt(i,t,s,a,n,e){const h=m("Loader"),u=m("Button");return o(),d("div",Rt,[e.user?(o(),d("p",Wt,l(e.user.name),1)):g("",!0),r("p",Gt,l(s.orderComment.comment),1),e.hasPhotos?(o(),d("div",qt,[(o(!0),d(b,null,k(e.photos,_=>(o(),d("img",{key:_.id,src:_.path,onClick:()=>s.onViewPhoto(_),class:"max-h-20 object-contain rounded-lg flex-shrink-0 hover:scale-105 transition-all cursor-pointer"},null,8,Qt))),128))])):g("",!0),r("div",Zt,[r("p",Ht,l(e.formattedDatetime(s.orderComment.created_at)),1),e.user?(o(),d(b,{key:0},[e.isDeletingOrderComment?(o(),p(h,{key:0,type:"danger"})):(o(),p(u,{key:1,size:"xs",leftIconSize:"14",leftIcon:n.Trash2,type:"bareDanger",action:()=>s.deleteOrderComment(s.orderComment)},null,8,["leftIcon","action"]))],64)):g("",!0)])])}const Jt=C(Bt,[["render",Kt]]),Xt={inject:["authState","formState","storeState","orderState","notificationState"],components:{Image:j,Modal:B,Input:N,Button:F,Skeleton:L,OrderComment:Jt},data(){return{Trash2:E,ArrowDownToLine:se,form:{photos:[],comment:""},pagination:null,orderComments:[],isUploading:!1,orderCommentPhoto:null,createdOrderComment:null,isCreatingOrderComment:!1,isLoadingOrderComments:!1,isDeletingOrderCommentIds:[],isDeletingOrderCommentPhotoIds:[],isDownloadingOrderCommentPhotoIds:[],isDownloadingOrderCommentPhoto:!1}},watch:{store(i,t){!t&&i&&this.showOrderComments()},isUploading(i){i==!1&&this.orderCommentCreationCompleted()}},computed:{store(){return this.storeState.store},orderId(){return this.$route.params.order_id},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasOrderComments(){return this.orderComments.length>0}},methods:{isEmpty:R,reset(){this.form.photos=[],this.form.comment=""},async showOrderComments(){var i,t;try{this.isLoadingOrderComments=!0;let s={params:{order_id:this.orderId,store_id:this.store.id,_relationships:["photos","user"].join(",")}};const a=await axios.get("/api/order-comments",s);this.pagination=a.data,this.orderComments=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching order comments";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch order comments:",s)}finally{this.isLoadingOrderComments=!1}},onEnterCreateOrderComment(i){i.preventDefault(),this.createOrderComment()},async createOrderComment(){var i,t;try{if(this.isCreatingOrderComment||this.isUploading||(this.formState.hideFormErrors(),this.isEmpty(this.form.comment)&&this.formState.setFormError("comment","The comment is required"),this.formState.hasErrors))return;this.isCreatingOrderComment=!0;const s={order_id:this.orderId,store_id:this.store.id,comment:this.form.comment},a=await axios.post("/api/order-comments",s);this.createdOrderComment=a.data.order_comment,this.form.photos.length?this.uploadImages():this.orderCommentCreationCompleted()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while creating order comment";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to create order comment:",s),this.isCreatingOrderComment=!1}},orderCommentCreationCompleted(){this.orderComments.push({user:this.authState.user,...this.createdOrderComment,photos:this.form.photos.map(function(i){return{id:Q(),temporary:!0,path:i.path}})}),this.notificationState.showSuccessNotification("Comment created!"),this.isCreatingOrderComment=!1,this.showOrderComments(),this.reset()},async uploadImages(i=null){let t=[];for(let s=0;s<this.form.photos.length;s++){const a=this.form.photos[s];(a.uploaded===null||a.uploaded===!1)&&a.uploading==!1&&(i==null||i==s)&&t.push(this.uploadSingleImage(a,s))}return this.isUploading=!0,Promise.allSettled(t).then(s=>{let a=s.filter(n=>n.status==="rejected").length;a>0&&this.notificationState.showWarningNotification(`⚠️ ${a} image(s) failed to upload. Try again or change the image.`),this.isUploading=!1})},async uploadSingleImage(i,t,s=0,a=null){var n,e,h;try{if(s>2)return console.log(`❌ Image ${t+1} permanently failed after 3 attempts.`),i.uploaded=!1,i.uploading=!1,i.error_message=((e=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Upload failed",Promise.reject("Failed after 3 attempts");let u=new FormData;u.append("file",i.file_ref),u.append("store_id",this.store.id),u.append("mediable_type","order comment"),u.append("mediable_id",this.createdOrderComment.id),u.append("upload_folder_name","order_comment_photo"),i.uploading=!0,i.error_message=null;const _={headers:{"Content-Type":"multipart/form-data"}},f=await axios.post("/api/media-files",u,_);return i.uploaded=!0,i.uploading=!1,console.log(`✅ Image ${t+1} uploaded successfully.`),f}catch(u){return console.error(`⚠️ Image ${t+1} upload attempt ${s+1} failed.`,u),u.code==="ECONNABORTED"||((h=u.response)==null?void 0:h.status)===504?void 0:this.uploadSingleImage(i,t,s+1,u)}},onViewPhoto(i){this.orderCommentPhoto=i,this.$refs.showPhotoModal.showModal()},async downloadOrderCommentPhoto(){try{if(this.isDownloadingOrderCommentPhotoIds.includes(this.orderCommentPhoto.id))return;this.isDownloadingOrderCommentPhotoIds.push(this.orderCommentPhoto.id);let i={responseType:"blob",params:{store_id:this.store.id}};const s=(await axios.get(`/api/media-files/${this.orderCommentPhoto.id}/download`,i)).data,a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=this.orderCommentPhoto.name,n.click(),URL.revokeObjectURL(a)}catch(i){console.error("Error downloading the store QR code image:",i)}finally{this.isDownloadingOrderCommentPhotoIds.splice(this.isDownloadingOrderCommentPhotoIds.findIndex(i=>i==this.orderCommentPhoto.id),1)}},async deleteOrderCommentPhoto(){var i,t;try{if(this.isDeletingOrderCommentPhotoIds.includes(this.orderCommentPhoto.id))return;this.isDeletingOrderCommentPhotoIds.push(this.orderCommentPhoto.id);const s={data:{store_id:this.store.id}};await axios.delete(`/api/media-files/${this.orderCommentPhoto.id}`,s),this.orderComments=this.orderComments.map(a=>({...a,photos:a.photos.filter(n=>n.id!==this.orderCommentPhoto.id)})),this.notificationState.showSuccessNotification("Photo deleted"),this.$refs.showPhotoModal.hideModal()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while deleting comment photo";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to delete comment photo:",s)}finally{this.isDeletingOrderCommentPhotoIds.splice(this.isDeletingOrderCommentPhotoIds.findIndex(s=>s==this.orderCommentPhoto.id),1)}},async deleteOrderComment(i){var t,s;try{if(this.isDeletingOrderCommentIds.includes(i.id))return;this.isDeletingOrderCommentIds.push(i.id);const a={data:{store_id:this.store.id}};await axios.delete(`/api/order-comments/${i.id}`,a),this.notificationState.showSuccessNotification("Comment deleted"),this.orderComments=this.orderComments.filter(n=>n.id!=i.id)}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while deleting order comment";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to delete order comment:",a)}finally{this.isDeletingOrderCommentIds.splice(this.isDeletingOrderCommentIds.findIndex(a=>a==i.id),1)}}},created(){this.store&&this.showOrderComments()}},Yt={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},$t={class:"flex justify-between items-center space-x-4"},er={key:0,class:"w-full flex space-x-2"},tr=["onClick"],rr={key:0,class:"space-y-2"},sr={class:"space-y-2 p-2 px-4 bg-gray-50"},or={class:"flex justify-between items-center space-x-8"},nr={class:"flex items-center space-x-2 whitespace-nowrap"},ir={class:"flex justify-end items-end space-x-2"},ar={class:"flex items-center justify-center w-10 h-10 rounded-lg border border-dashed border-gray-200"},dr={class:"flex justify-center"},lr=["src"],cr={key:0,class:"flex justify-end space-x-2 mt-4"};function mr(i,t,s,a,n,e){const h=m("Input"),u=m("Image"),_=m("Button"),f=m("Skeleton"),S=m("OrderComment"),P=m("Modal");return o(),d(b,null,[r("div",Yt,[t[8]||(t[8]=r("h1",{class:"text-gray-700 font-semibold mb-4"},"Comments",-1)),r("div",$t,[!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d("div",er,[r("div",{onClick:t[6]||(t[6]=D(w=>i.$refs.comment.focusInput(),["stop"])),class:"w-full border border-gray-300 p-2 rounded-lg"},[c(h,{type:"file",maxFiles:5,class:"w-full",wrapperClass:{},modelValue:n.form.photos,"onUpdate:modelValue":t[3]||(t[3]=w=>n.form.photos=w),onRetryUploads:t[4]||(t[4]=w=>e.uploadImages()),onRetryUpload:t[5]||(t[5]=(w,v)=>e.uploadImages(v))},{fileTrigger:x(w=>[r("div",{class:"w-full flex space-x-2",onClick:t[2]||(t[2]=D(v=>i.$refs.comment.focusInput(),["stop"]))},[c(h,{rows:"1",onClick:t[0]||(t[0]=D(()=>{},["stop"])),ref:"comment",class:"w-full",type:"textarea",wrapperClass:{},modelValue:n.form.comment,"onUpdate:modelValue":t[1]||(t[1]=v=>n.form.comment=v),placeholder:"Say something",onOnEnter:e.onEnterCreateOrderComment,errorText:e.formState.getFormError("comment")},null,8,["modelValue","onOnEnter","errorText"]),r("div",{onClick:D(w.handleClick,["stop"]),class:"z-10 w-10 h-10 flex flex-shrink-0 items-center justify-center bg-gray-50 border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer"},[c(u,{size:"20",class:T([{"text-gray-400":!w.filesLeftToUpload}])},null,8,["class"])],8,tr)])]),_:1},8,["modelValue"])]),c(_,{size:"sm",type:"primary",buttonClass:"flex-shrink-0",action:e.createOrderComment,disabled:n.isCreatingOrderComment||n.isUploading},{default:x(()=>[...t[7]||(t[7]=[r("span",null,"Post",-1)])]),_:1},8,["action","disabled"])])):g("",!0)]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",rr,[(o(),d(b,null,k([1,2],(w,v)=>r("div",{key:v,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",sr,[r("div",or,[c(f,{width:"w-1/3",shine:!0}),r("div",nr,[c(f,{width:"w-20",shine:!0}),c(f,{width:"w-10",shine:!0}),c(f,{width:"w-10",shine:!0})])]),r("div",ir,[c(f,{width:"w-10",shine:!0}),r("div",ar,[c(u,{size:"16",class:"text-gray-400 flex-shrink-0"})])])])])),64))])):(o(),d(b,{key:1},[e.hasOrderComments?(o(!0),d(b,{key:0},k(n.orderComments,(w,v)=>(o(),p(S,{index:v,key:w.id,onViewPhoto:e.onViewPhoto,orderComment:w,deleteOrderComment:e.deleteOrderComment,isDeletingOrderCommentIds:n.isDeletingOrderCommentIds},null,8,["index","onViewPhoto","orderComment","deleteOrderComment","isDeletingOrderCommentIds"]))),128)):g("",!0)],64))]),c(P,{showFooter:!1,ref:"showPhotoModal",scrollOnContent:!1},V({_:2},[n.orderCommentPhoto?{name:"content",fn:x(()=>[t[11]||(t[11]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Image Preview",-1)),r("div",dr,[r("img",{src:n.orderCommentPhoto.path},null,8,lr)]),n.orderCommentPhoto.hasOwnProperty("temporary")?g("",!0):(o(),d("div",cr,[c(_,{size:"sm",type:"primary",leftIcon:n.ArrowDownToLine,action:e.downloadOrderCommentPhoto,loading:this.isDownloadingOrderCommentPhotoIds.findIndex(w=>w==this.orderCommentPhoto.id)!=-1},{default:x(()=>[...t[9]||(t[9]=[r("span",null,"Download",-1)])]),_:1},8,["leftIcon","action","loading"]),c(_,{size:"sm",type:"danger",leftIcon:n.Trash2,action:e.deleteOrderCommentPhoto,loading:this.isDeletingOrderCommentPhotoIds.findIndex(w=>w==this.orderCommentPhoto.id)!=-1},{default:x(()=>[...t[10]||(t[10]=[r("span",null,"Delete",-1)])]),_:1},8,["leftIcon","action","loading"])]))]),key:"0"}:void 0]),1536)],64)}const ur=C(Xt,[["render",mr]]),hr={inject:["formState","storeState","orderState","notificationState"],components:{UserRoundCheck:ue,Alert:W,Input:N,Select:z,Button:F,Skeleton:L,GoogleMaps:oe,CollectionStatus:ne},data(){return{ArrowRight:ae,couriers:[],ExternalLink:G,courierOptions:[],isLoadingCouriers:!1}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},customer(){return this.order.customer},deliveryMethod(){return this.order.delivery_method},deliveryAddress(){return this.order.delivery_address},selectedCourierLink(){if(!this.orderForm.courier_id||!this.couriers.length)return null;const i=this.couriers.find(n=>n.id===this.orderForm.courier_id);if(!i)return null;const t=this.orderForm.tracking_number,s=i.tracking_page;if(!t)return s;const a=s.includes("?")?"&":"?";return i.name=="DHL Express"?`${s}${a}tracking-id=${encodeURIComponent(t)}`:s},googleMapsUrl(){return!this.isLoadingOrder&&this.deliveryAddress.latitude&&this.deliveryAddress.longitude?`https://www.google.com/maps?q=${this.deliveryAddress.latitude},${this.deliveryAddress.longitude}`:null}},methods:{formattedDate:H,formattedShortWeekday:Z,openGoogleMapsLink(){window.open(this.googleMapsUrl,"_blank")},navigateToCustomer(){this.$router.push({name:"edit-customer",params:{customer_id:this.customer.id},query:{store_id:this.store.id}})},async showCouriers(){var i,t;try{if(this.couriers.length)return;this.isLoadingCouriers=!0;let s={params:{per_page:100}};const a=await M.get("/api/couriers",s);this.couriers=a.data.data,this.courierOptions=this.couriers.map(n=>({label:ee(n.name),value:n.id})),this.courierOptions.unshift({label:"None",value:null})}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching stores";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch stores:",s)}finally{this.isLoadingCouriers=!1}},async updateOrder(i,t){var s,a;try{if(i={...i,store_id:this.store.id},await M.put(`/api/orders/${this.order.id}`,i),t=="courier"){if(this.orderForm.courier_id){const n=this.courierOptions.find(e=>e.value===this.orderForm.courier_id);this.notificationState.showSuccessNotification(`Courier updated to ${n.label}`)}else this.notificationState.showSuccessNotification("Courier removed");this.orderState.order.courier_id=this.orderForm.courier_id}else t=="tracking number"?(this.orderForm.tracking_number?this.notificationState.showSuccessNotification(`Tracking number updated to ${this.orderForm.tracking_number}`):this.notificationState.showSuccessNotification("Tracking number removed"),this.orderState.order.tracking_number=this.orderForm.tracking_number):t=="remark"&&(this.orderForm.remark?this.notificationState.showSuccessNotification("Remark updated"):this.notificationState.showSuccessNotification("Remark removed"),this.orderState.order.remark=this.orderForm.remark)}catch(n){const e=((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(n),console.error("Failed to update order changes:",n)}}},created(){this.showCouriers()}},gr={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},fr={class:"flex justify-between items-center mb-4"},pr={key:0,class:"space-y-2"},_r={class:"space-y-2 p-2 px-4 bg-gray-50"},yr={class:"flex justify-between items-center space-x-8"},br={class:"flex items-center space-x-2 whitespace-nowrap"},wr={class:"grid grid-cols-2 gap-4"},xr={class:"col-span-1"},Sr={class:"col-span-1"},Or={key:0,class:"col-span-2 text-sm"},vr=["href"],kr={class:"col-span-2"},Cr={key:0,class:"bg-gray-50 p-4 border border-gray-200 rounded-lg space-y-2 text-sm"},Pr={key:0,class:"grid grid-cols-3 items-center"},Tr={class:"col-span-2 flex items-center space-x-2"},Lr={key:1,class:"grid grid-cols-3"},Ir={class:"col-span-2"},Fr=["href"],Dr={key:2,class:"grid grid-cols-3"},jr={class:"col-span-2"},Mr=["href"],Nr={key:3,class:"grid grid-cols-3"},Er={class:"col-span-2"},Ar={key:4,class:"grid grid-cols-3"},Ur={class:"col-span-2"},Vr=["href"],zr={key:5,class:"grid grid-cols-3"},Br={class:"space-x-2"},Rr={class:"list-disc text-xs space-y-2 border-t border-blue-300 border-dashed pt-2 mt-2 pl-2"},Wr={key:0},Gr={class:"font-bold"},qr={class:"font-bold"},Qr={key:1},Zr={class:"font-bold"},Hr={class:"font-bold"},Kr={key:2},Jr={class:"font-bold"},Xr={class:"font-bold"},Yr={class:"rounded-lg overflow-hidden"},$r={key:0,class:"flex justify-end mt-4"};function es(i,t,s,a,n,e){const h=m("Skeleton"),u=m("CollectionStatus"),_=m("Select"),f=m("Input"),S=m("UserRoundCheck"),P=m("Button"),w=m("Alert"),v=m("GoogleMaps");return o(),d("div",gr,[r("div",fr,[t[7]||(t[7]=r("h1",{class:"text-gray-700 font-semibold"},"Fulfillment",-1)),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-20",shine:!0})):(o(),p(u,{key:1}))]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",pr,[(o(),d(b,null,k([1,2],(y,I)=>r("div",{key:I,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",_r,[r("div",yr,[c(h,{width:"w-1/3",shine:!0}),r("div",br,[c(h,{width:"w-20",shine:!0}),c(h,{width:"w-10",shine:!0}),c(h,{width:"w-10",shine:!0})])])])])),64))])):(o(),d(b,{key:1},[r("div",wr,[r("div",xr,[c(_,{search:!0,label:"Courier",options:n.courierOptions,modelValue:e.orderForm.courier_id,"onUpdate:modelValue":t[0]||(t[0]=y=>e.orderForm.courier_id=y),errorText:e.formState.getFormError("courier_id"),onChange:t[1]||(t[1]=y=>e.updateOrder({courier_id:y},"courier"))},null,8,["options","modelValue","errorText"])]),r("div",Sr,[c(f,{type:"text",label:"Tracking Number",modelValue:e.orderForm.tracking_number,"onUpdate:modelValue":t[2]||(t[2]=y=>e.orderForm.tracking_number=y),errorText:e.formState.getFormError("tracking_number"),onBlur:t[3]||(t[3]=y=>e.updateOrder({tracking_number:y},"tracking number"))},null,8,["modelValue","errorText"])]),e.selectedCourierLink?(o(),d("div",Or,[t[8]||(t[8]=r("span",null,"Tracking Page: ",-1)),r("a",{href:e.selectedCourierLink,target:"_blank",class:"text-blue-500 hover:underline"},l(e.selectedCourierLink),9,vr)])):g("",!0),r("div",kr,[c(f,{rows:"2",label:"Remark",type:"textarea",placeholder:"Optional",modelValue:e.orderForm.remark,"onUpdate:modelValue":t[4]||(t[4]=y=>e.orderForm.remark=y),description:"Visible to customer",errorText:e.formState.getFormError("remark"),onBlur:t[5]||(t[5]=y=>e.updateOrder({remark:y},"remark")),tooltipContent:"Use the Remark field to add a note that will be visible to the customer, such as special instructions, order details, or personalized messages."},null,8,["modelValue","errorText"])])]),e.order.customer_name||e.order.customer_email||e.order.customer_mobile_number||e.deliveryMethod||e.deliveryAddress||e.order.delivery_date?(o(),d("div",Cr,[e.order.customer_name?(o(),d("div",Pr,[t[10]||(t[10]=r("span",null,"Name",-1)),r("div",Tr,[e.customer?(o(),p(S,{key:0,size:"16"})):g("",!0),r("span",{class:T({"text-blue-500 hover:underline cursor-pointer":e.customer}),onClick:t[6]||(t[6]=()=>e.customer?e.navigateToCustomer():null)},l(e.order.customer_name),3),c(P,{size:"xs",type:"light",class:"hidden lg:block",rightIcon:n.ArrowRight,action:e.navigateToCustomer},{default:x(()=>[...t[9]||(t[9]=[r("span",null,"Show Profile",-1)])]),_:1},8,["rightIcon","action"])])])):g("",!0),e.order.customer_email?(o(),d("div",Lr,[t[11]||(t[11]=r("span",null,"Email",-1)),r("span",Ir,[r("a",{href:`mailto:${e.order.customer_email}`,target:"_blank",class:"text-blue-500 hover:underline"},l(e.order.customer_email),9,Fr)])])):g("",!0),e.order.customer_mobile_number?(o(),d("div",Dr,[t[12]||(t[12]=r("span",null,"Mobile",-1)),r("span",jr,[r("a",{href:`tel:${e.order.customer_mobile_number.international}`,target:"_blank",class:"text-blue-500 hover:underline"},l(e.order.customer_mobile_number.international),9,Mr)])])):g("",!0),e.deliveryMethod?(o(),d("div",Nr,[t[13]||(t[13]=r("span",null,"Delivery",-1)),r("span",Er,l(e.deliveryMethod.name),1)])):g("",!0),e.deliveryAddress?(o(),d("div",Ar,[t[14]||(t[14]=r("span",null,"Address",-1)),r("span",Ur,[r("a",{href:e.googleMapsUrl,target:"_blank",class:"text-blue-500 hover:underline"},l(e.deliveryAddress.complete_address),9,Vr)])])):g("",!0),e.order.delivery_date?(o(),d("div",zr,[t[15]||(t[15]=r("span",null,"Schedule",-1)),r("div",Br,[r("span",null,l(e.formattedDate(e.order.delivery_date))+" ("+l(e.formattedShortWeekday(e.order.delivery_date))+")",1),r("span",null,l(e.order.delivery_timeslot),1)])])):g("",!0),e.customer&&(e.customer.name&&e.order.customer_name&&e.customer.name!=e.order.customer_name||e.customer.email&&e.order.customer_email&&e.customer.email!=e.order.customer_email||e.customer.mobile_number&&e.order.customer_mobile_number&&e.customer.mobile_number.international!=e.order.customer_mobile_number.international)?(o(),p(w,{key:6,type:"primary",dismissable:!0,title:"Profile changes"},{description:x(()=>[r("ul",Rr,[e.customer.name&&e.order.customer_name&&e.customer.name!=e.order.customer_name?(o(),d("li",Wr,[t[16]||(t[16]=O("Order name (",-1)),r("span",Gr,l(e.order.customer_name),1),t[17]||(t[17]=O(") is different from customer profile name (",-1)),r("span",qr,l(e.customer.name),1),t[18]||(t[18]=O(").",-1))])):g("",!0),e.customer.email&&e.order.customer_email&&e.customer.email!=e.order.customer_email?(o(),d("li",Qr,[t[19]||(t[19]=O("Order email (",-1)),r("span",Zr,l(e.order.customer_email),1),t[20]||(t[20]=O(") is different from customer profile email (",-1)),r("span",Hr,l(e.customer.email),1),t[21]||(t[21]=O(").",-1))])):g("",!0),e.customer.mobile_number&&e.order.customer_mobile_number&&e.customer.mobile_number.international!=e.order.customer_mobile_number.international?(o(),d("li",Kr,[t[22]||(t[22]=O("Order mobile number (",-1)),r("span",Jr,l(e.order.customer_mobile_number.international),1),t[23]||(t[23]=O(") is different from customer profile mobile number (",-1)),r("span",Xr,l(e.customer.mobile_number.international),1),t[24]||(t[24]=O(").",-1))])):g("",!0)])]),_:1})):g("",!0)])):g("",!0),e.deliveryAddress?(o(),d(b,{key:1},[r("div",Yr,[c(v,{height:"350px",gmpDraggable:!1,latitude:e.deliveryAddress.latitude,longitude:e.deliveryAddress.longitude},null,8,["latitude","longitude"])]),e.googleMapsUrl?(o(),d("div",$r,[c(P,{size:"xs",type:"light",buttonClass:"h-full",rightIcon:n.ExternalLink,action:e.openGoogleMapsLink},{default:x(()=>[...t[25]||(t[25]=[r("span",null,"Google Maps",-1)])]),_:1},8,["rightIcon","action"])])):g("",!0)],64)):g("",!0)],64))])}const ts=C(hr,[["render",es]]),rs={components:{Image:j,Pill:U,Button:F,Banknote:de},props:{index:{type:Number},transaction:{type:Object},onDeleteTransaction:{type:Function}},data(){return{Trash2:E,expanded:!1}},computed:{hasPhoto(){return this.photo!=null},photo(){return this.transaction.photo}},methods:{formattedDatetime:A}},ss={class:"rounded-lg overflow-hidden border border-gray-300"},os={class:"space-y-2 p-2 px-4 bg-gray-50 hover:bg-gray-100"},ns={class:"flex justify-between items-center space-x-8"},is={class:"flex items-center space-x-2"},as={class:"font-semibold text-sm"},ds={class:"flex items-center space-x-2 whitespace-nowrap"},ls={class:"text-gray-500 text-xs mr-4"},cs={class:"text-sm"},ms=["src"];function us(i,t,s,a,n,e){const h=m("Banknote"),u=m("Pill"),_=m("Image"),f=m("Button");return o(),d("div",ss,[r("div",os,[r("div",ns,[r("div",is,[c(h,{size:"20",class:"text-gray-400 flex-shrink-0"}),r("p",as,l(s.transaction.store_payment_method?s.transaction.store_payment_method.custom_name:s.transaction.description),1)]),r("div",ds,[r("span",ls,l(e.formattedDatetime(s.transaction.created_at)),1),c(u,{type:s.transaction.payment_status=="paid"?"success":"warning",size:"xs",showDot:!1},{default:x(()=>[O(l(s.transaction.payment_status),1)]),_:1},8,["type"]),r("span",cs,l(s.transaction.amount.amount_with_currency),1),r("div",{class:T(["flex items-center justify-center w-10 h-10 hover:bg-white rounded-lg cursor-pointer",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),d("img",{key:0,class:"w-full max-h-10 object-contain rounded-lg flex-shrink-0",src:e.photo.path},null,8,ms)):(o(),p(_,{key:1,size:"16",class:"text-gray-400 flex-shrink-0"}))],2),c(f,{size:"xs",leftIconSize:"14",leftIcon:n.Trash2,type:"bareDanger",action:()=>s.onDeleteTransaction(s.transaction)},null,8,["leftIcon","action"])])])])])}const hs=C(rs,[["render",us]]),gs={inject:["formState","storeState","orderState","notificationState"],components:{Image:j,Alert:W,Input:N,Modal:B,Button:F,Skeleton:L,OrderTransaction:hs,OrderPaymentStatusSelect:$},data(){return{Plus:me,Link2:ce,Trash2:E,ExternalLink:G,CircleDollarSign:le,form:{photo:[],amount:"0.00",description:""},pagination:null,transactions:[],isLoadingTransactions:!1,deletableTransaction:null,isCreatingTransaction:!1,isDeletingTransactionId:null}},watch:{store(){this.setup()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderId(){return this.$route.params.order_id},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasTransactions(){return this.transactions.length>0}},methods:{isEmpty:R,setup(){this.store&&this.showTransactions()},reset(){this.form.photo=[],this.form.amount="0.00",this.form.description=""},async copyPaymentLink(){try{await navigator.clipboard.writeText("the payment link"),this.notificationState.showSuccessNotification("Payment link copied!")}catch(i){console.error("Failed to copy:",i),this.notificationState.showWarningNotification("Payment link failed to copy")}},async showTransactions(){var i,t;try{this.isLoadingTransactions=!0;let s={params:{order_id:this.orderId,store_id:this.store.id,_relationships:["photo","storePaymentMethod"].join(",")}};const a=await axios.get("/api/transactions",s);this.pagination=a.data,this.transactions=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching transactions";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch transactions:",s)}finally{this.isLoadingTransactions=!1}},async createTransaction(){var i,t;try{if(this.isCreatingTransaction||(this.formState.hideFormErrors(),this.isEmpty(this.form.description)&&this.formState.setFormError("description","Enter payment name"),this.formState.hasErrors))return;this.isCreatingTransaction=!0;let s=new FormData;s.append("return",1),s.append("owner_type","order"),s.append("owner_id",this.orderId),s.append("store_id",this.store.id),s.append("amount",this.form.amount),s.append("currency",this.store.currency),s.append("description",this.form.description),this.form.photo.length&&s.append("photo",this.form.photo[0].file_ref);const a={headers:{"Content-Type":"multipart/form-data"}},n=await axios.post("/api/transactions",s,a);this.notificationState.showSuccessNotification("Payment created!"),this.$refs.addPaymentModal.hideModal(),this.showTransactions(),this.reset()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while creating payment";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to create payment:",s)}finally{this.isCreatingTransaction=!1}},onDeleteTransaction(i){this.deletableTransaction=i,this.$refs.deletePaymentModal.showModal()},async deleteTransaction(){var i,t;try{this.isDeletingTransactionId=this.deletableTransaction.id;const s=this.transactions.findIndex(n=>n.id==this.deletableTransaction.id),a={data:{store_id:this.store.id}};await axios.delete(`/api/transactions/${this.deletableTransaction.id}`,a),this.notificationState.showSuccessNotification("Payment deleted"),this.$refs.deletePaymentModal.hideModal(),this.transactions.splice(s,1)}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while deleting transaction";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to delete transaction:",s)}finally{this.isDeletingTransactionId=null}},async updateOrder(i){var t,s;try{i={...i,store_id:this.store.id},await axios.put(`/api/orders/${this.orderId}`,i),this.notificationState.showSuccessNotification(`Order ${this.orderForm.payment_status}`),this.orderState.order.payment_status=this.orderForm.payment_status}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}},created(){this.setup()}},fs={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},ps={class:"flex justify-between items-center mb-4"},_s={class:"flex items-center space-x-2"},ys={class:"flex justify-between items-center space-x-4"},bs={class:"space-y-4 mb-8"},ws={key:0,class:"space-y-2"},xs={class:"space-y-2 p-2 px-4 bg-gray-50"},Ss={class:"flex justify-between items-center space-x-8"},Os={class:"flex items-center space-x-2 whitespace-nowrap"},vs={class:"flex justify-end items-end space-x-2"},ks={class:"flex items-center justify-center w-10 h-10 rounded-lg border border-dashed border-gray-200"},Cs={class:"bg-blue-50 border border-blue-400 rounded-lg p-4 space-y-4"},Ps={class:"flex justify-between text-sm font-bold"},Ts={key:0,class:"flex justify-between text-sm font-bold"},Ls={class:"text-red-500"},Is={class:"p-4 text-sm bg-gray-100 rounded-lg"},Fs={class:"space-x-2"},Ds={class:"space-x-2"};function js(i,t,s,a,n,e){const h=m("Button"),u=m("Input"),_=m("Modal"),f=m("Skeleton"),S=m("OrderPaymentStatusSelect"),P=m("Image"),w=m("OrderTransaction"),v=m("Alert");return o(),d("div",fs,[r("div",ps,[r("div",_s,[t[4]||(t[4]=r("h1",{class:"text-gray-700 font-semibold"},"Payments",-1)),c(h,{size:"xs",type:"bare",leftIcon:n.ExternalLink},null,8,["leftIcon"])]),r("div",ys,[c(h,{size:"xs",type:"bare",leftIcon:n.Link2,action:e.copyPaymentLink},{default:x(()=>[...t[5]||(t[5]=[r("span",null,"Copy Payment Link",-1)])]),_:1},8,["leftIcon","action"]),!e.isLoadingStore&&!e.isLoadingOrder?(o(),p(_,{key:0,triggerSize:"xs",triggerType:"light",approveType:"primary",ref:"addPaymentModal",leftApproveIcon:n.Plus,leftTriggerIcon:n.Plus,scrollOnContent:!1,leftTriggerIconSize:"14",triggerText:"Add Payment",approveText:"Add Payment",approveAction:e.createTransaction,approveLoading:n.isCreatingTransaction},{content:x(()=>[t[6]||(t[6]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Add Payment",-1)),r("div",bs,[c(u,{type:"text",label:"Payment Name",modelValue:n.form.description,"onUpdate:modelValue":t[0]||(t[0]=y=>n.form.description=y),placeholder:"Bank Transfer",errorText:e.formState.getFormError("description")},null,8,["modelValue","errorText"]),c(u,{type:"money",modelValue:n.form.amount,"onUpdate:modelValue":t[1]||(t[1]=y=>n.form.amount=y),label:"Payment Amount",currency:e.store.currency.code,errorText:e.formState.getFormError("amount")},null,8,["modelValue","currency","errorText"]),c(u,{type:"file",maxFiles:1,modelValue:n.form.photo,"onUpdate:modelValue":t[2]||(t[2]=y=>n.form.photo=y),label:"Proof Of Payment",imagePreviewGridCols:1,singleFileUploadMessage:"proof of payment attached"},null,8,["modelValue"])])]),_:1},8,["leftApproveIcon","leftTriggerIcon","approveAction","approveLoading"])):g("",!0),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(f,{key:1,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),p(S,{key:2,class:"w-48",showLabel:!1,onChange:t[3]||(t[3]=y=>e.updateOrder({payment_status:y}))}))])]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",ws,[(o(),d(b,null,k([1,2],(y,I)=>r("div",{key:I,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",xs,[r("div",Ss,[c(f,{width:"w-1/3",shine:!0}),r("div",Os,[c(f,{width:"w-20",shine:!0}),c(f,{width:"w-10",shine:!0}),c(f,{width:"w-10",shine:!0})])]),r("div",vs,[c(h,{size:"xs",skeleton:!0,leftIconSize:"14",leftIcon:n.Trash2,type:"outlineDanger"},null,8,["leftIcon"]),r("div",ks,[c(P,{size:"16",class:"text-gray-400 flex-shrink-0"})])])])])),64))])):(o(),d(b,{key:1},[e.hasTransactions?(o(),d(b,{key:0},[(o(!0),d(b,null,k(n.transactions,(y,I)=>(o(),p(w,{key:I,index:I,transaction:y,onDeleteTransaction:e.onDeleteTransaction},null,8,["index","transaction","onDeleteTransaction"]))),128)),r("div",Cs,[r("div",Ps,[t[7]||(t[7]=r("span",null,"Amount Paid",-1)),r("span",null,l(e.order.paid_total.amount_with_currency),1)]),e.order.outstanding_total.amount>0?(o(),d("div",Ts,[t[8]||(t[8]=r("span",null,"Amount Due",-1)),r("span",Ls,l(e.order.outstanding_total.amount_with_currency),1)])):g("",!0)])],64)):(o(),p(v,{key:1,type:"light",dismissable:!1,icon:n.CircleDollarSign,title:"No transctions yet"},null,8,["icon"])),c(_,{approveText:"Delete",approveType:"danger",ref:"deletePaymentModal",scrollOnContent:!1,leftApproveIcon:n.Trash2,approveAction:e.deleteTransaction,approveLoading:n.deletableTransaction&&n.isDeletingTransactionId==n.deletableTransaction.id},V({_:2},[n.deletableTransaction?{name:"content",fn:x(()=>[t[11]||(t[11]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Confirm Delete",-1)),t[12]||(t[12]=r("p",{class:"mb-8"},"Are you sure you want to permanently delete this payment?",-1)),r("div",Is,[r("div",Fs,[t[9]||(t[9]=r("span",{class:"font-bold"},"Name:",-1)),r("span",null,l(n.deletableTransaction.description),1)]),r("div",Ds,[t[10]||(t[10]=r("span",{class:"font-bold"},"Amount:",-1)),r("span",null,l(n.deletableTransaction.amount.amount_with_currency),1)])])]),key:"0"}:void 0]),1032,["leftApproveIcon","approveAction","approveLoading"])],64))])}const Ms=C(gs,[["render",js]]),Ns={inject:["orderState","storeState"],components:{TeamMember:_e,OrderItems:zt,OrderComments:ur,OrderFulfilment:ts,OrderTransactions:Ms},computed:{store(){return this.storeState.store},order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder}}},Es={class:"grid grid-cols-12 gap-8 mb-4"},As={class:"col-span-8"},Us={class:"col-span-4"};function Vs(i,t,s,a,n,e){const h=m("OrderItems"),u=m("OrderTransactions"),_=m("OrderFulfilment"),f=m("TeamMember"),S=m("OrderComments");return o(),d("div",Es,[r("div",As,[c(h),c(u),c(_)]),r("div",Us,[c(f),c(S)])])}const vo=C(Ns,[["render",Vs]]);export{vo as default};
