import{c as n,b as s,d as g,e as y,t as _,a as d,i as x,F as w,g as m,f as U,z as W,r as l,o as r,k as S,w as z}from"./app-CGNgl8eN.js";import{Q as N}from"./browser-8RhrTJnM.js";import{a as R,C as B}from"./Copy-Bp4ENaQe.js";import{B as j}from"./Button-B134edVj.js";import{S as Q}from"./Skeleton-Dmr_VmHU.js";import{V as A}from"./vue-slide-up-down-Ce1Dvygw.js";import{S as E}from"./StoreLogo-Ch_dhXf0.js";import{a as P}from"./stringUtils-Bvzw0-oW.js";import{W as D}from"./WhatsappIcon-BjEWAXBU.js";import{W as q}from"./WhatsappMessage-wT0c5M7E.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as V}from"./chevron-down-wPajd1_B.js";import{C as F}from"./chevron-up-DDBk_8YV.js";import{H as G}from"./hand-coins-CHoQQphQ.js";import{A as Y}from"./arrow-left-CJqkyR7k.js";import"./ShineEffect-D1V-RWKB.js";import"./createLucideIcon-BakIve7O.js";import"./Loader-DZWJgCmt.js";import"./plus-B1hMjDDg.js";import"./trash-2-Bff_GbSw.js";const J={inject:["storeState","orderState"],components:{Copy:R,HandCoins:G,Button:j,Skeleton:Q,VueSlideUpDown:A,ChevronUp:F,ChevronDown:V,StoreLogo:E,WhatsappIcon:D,WhatsappMessage:q},data(){return{CopyIcon:B,ArrowLeft:Y,qrCode:null,clicked:!1,now:W().format("HH:mm"),accordions:[{label:"Open in external browser",expanded:!1},{label:"Send order details manually",expanded:!1},{label:"Scan QR code to open this page on your mobile",expanded:!1}]}},watch:{order(o,e){!e&&o&&this.setup()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},paymentMethod(){return this.$route.query.payment_method??null},orderUrl(){return`${window.location.origin+this.$router.resolve({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}}).href}`},currentPageUrl(){return window.location.origin+this.$router.resolve({name:"show-shop-pending-payment",params:{alias:this.store.alias,order_id:this.order.id}}).href},whatsappMessage(){if(this.order){let o="";o+=`*Order #${this.order.number}*
`;for(let i=0;i<this.order.order_products.length;i++){const t=this.order.order_products[i];o+=`
*${t.quantity}x* ${t.name} ${t.grand_total.amount_with_currency}`}o+=`

*Grand Total: ${this.order.grand_total.amount_with_currency}* (Qty: ${this.order.total_uncancelled_product_quantities})
`;const e=this.isNotEmpty(this.order.customer_name),a=this.isNotEmpty(this.order.customer_email),p=this.isNotEmpty(this.order.customer_mobile_number);return e&&(o+=`
Name: ${this.order.customer_name}`),p&&(o+=`
Mobile: ${this.order.customer_mobile_number.international}`),a&&(o+=`
Email: ${this.order.customer_email}`),(e||p||a)&&(o+=`
`),this.paymentMethod!=null&&(o+=`
Payment : ${this.paymentMethod} (Unpaid)
`),this.order.delivery_method!=null&&(o+=`
Delivery: ${this.order.delivery_method.name}`),this.order.paymentMethod!=null&&(o+=`
Address: ${this.order.delivery_address.complete_address}`),o+=`

See invoice ${this.orderUrl}`,o}return null}},methods:{isNotEmpty:P,setup(){this.store&&this.order&&(this.generateQRCode(),["paid","unpaid"].includes(this.order.payment_status)||this.updateOrder())},toggleAccordian(o){for(let e=0;e<this.accordions.length;e++)e==o?this.accordions[e].expanded=!this.accordions[e].expanded:this.accordions[e].expanded=!1},async generateQRCode(){try{this.qrCode=await N.toDataURL(this.currentPageUrl,{margin:2,width:150,color:{dark:"#000000",light:"#ffffff"}})}catch(o){console.error("Failed to generate QR code:",o)}},async navigateToShowShopOrder(){await this.$router.push({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}})},async navigateToStorefront(){await this.$router.push({name:"show-storefront",params:{alias:this.store.alias}})},sendUsingWhatsapp(){const o=this.store.whatsapp_mobile_number?`phone=${this.store.whatsapp_mobile_number.international.replace("+","")}&`:"";window.open(`https://wa.me/?${o}text=${encodeURIComponent(this.whatsappMessage)}`,"_blank"),this.clicked=!0},async updateOrder(){var o,e;try{const a="unpaid",p={payment_status:a,store_id:this.store.id};await axios.put(`/api/orders/${this.order.id}`,p),this.orderState.order.payment_status=a}catch(a){const p=((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(p),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}},created(){this.setup()}},K={class:"select-none max-w-xl mx-auto pt-16"},X={class:"p-4 flex items-center space-x-4"},Z={class:"w-full flex justify-between space-x-4"},$={class:"w-full"},ee={key:1,class:"text-gray-700 font-semibold text-sm"},te={key:3,class:"text-gray-500 text-sm"},se={key:1,class:"text-right text-gray-400 text-xs"},oe={class:"w-full bg-gray-50 border border-gray-100 shadow rounded-xl p-10"},re={class:"w-16 h-16 mx-auto flex items-center justify-center bg-green-100 text-green-500 rounded-full mb-4"},ae={class:"flex justify-center space-x-2 mb-4"},ne={key:0},ie=["onClick"],de={class:"text-sm text-gray-700"},le={key:1,class:"p-4 space-y-2"},ce={key:0,class:"flex items-center justify-between"},me={class:"text-gray-700 font-semibold text-xs"},pe={class:"flex items-center justify-end"},he=["src"],ue={key:1,class:"flex justify-center"},ge={class:"flex items-center space-x-1"};function fe(o,e,a,p,i,t){const C=l("StoreLogo"),b=l("Skeleton"),k=l("HandCoins"),f=l("Button"),L=l("ChevronUp"),O=l("ChevronDown"),v=l("Copy"),M=l("WhatsappMessage"),I=l("vue-slide-up-down"),T=l("WhatsappIcon");return r(),n("div",K,[s("div",{onClick:e[0]||(e[0]=(...h)=>t.navigateToShowShopOrder&&t.navigateToShowShopOrder(...h)),class:"w-full bg-white border border-gray-100 shadow-sm rounded-xl cursor-pointer hover:bg-gray-50 hover:scale-105 active:opacity-80 active:scale-100 transition-all duration-300 mb-4"},[s("div",X,[t.store&&t.store.logo?(r(),g(C,{key:0,size:"w-10 h-10",showButton:!1})):y("",!0),s("div",Z,[s("div",$,[t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:0,width:"w-40",height:"h-2",class:"mb-2",shine:!0})):(r(),n("p",ee,_(t.order.customer_name),1)),t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:2,width:"w-2/3",height:"h-2",shine:!0})):(r(),n("p",te,_(t.order.summary),1))]),t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:0,width:"w-2/3",height:"h-2",shine:!0})):(r(),n("p",se,"Order #"+_(t.order.number),1))])])]),s("div",oe,[s("div",re,[d(k,{size:"24"})]),e[11]||(e[11]=s("p",{class:"text-xl font-semibold text-center mb-2"},"Pending Payment",-1)),e[12]||(e[12]=s("p",{class:"text-sm text-gray-500 text-center mb-8"},[x(" Your order has been received but is pending payment. "),s("br"),x(" Send us a message to make your payment now. ")],-1)),i.clicked?(r(),n(w,{key:0},[s("div",ae,[d(f,{size:"md",type:"light",leftIcon:i.ArrowLeft,action:t.navigateToStorefront},{default:m(()=>[...e[1]||(e[1]=[s("span",{class:"text-xs"},"Back to shop",-1)])]),_:1},8,["leftIcon","action"]),d(f,{size:"md",type:"success",action:t.navigateToShowShopOrder},{default:m(()=>[...e[2]||(e[2]=[s("span",{class:"text-xs"},"Go to invoice",-1)])]),_:1},8,["action"])]),!t.isLoadingStore&&!t.isLoadingOrder?(r(),n("div",ne,[e[9]||(e[9]=s("p",{class:"text-sm text-red-500 text-center mt-8 mb-4"},"WhatsApp is not opening?",-1)),(r(!0),n(w,null,U(i.accordions,(h,c)=>(r(),n("div",{key:c,onClick:z(()=>t.toggleAccordian(c),["stop"]),class:S(["border border-gray-300",{"rounded-t-lg":c==0},{"rounded-b-lg":c==i.accordions.length-1}])},[s("div",{class:S(["flex items-center justify-between bg-gray-50 hover:bg-gray-100 p-2 cursor-pointer",{shadow:h.expanded},{"rounded-t-lg":c==0},{"rounded-b-lg":c==i.accordions.length-1&&!h.expanded}])},[s("p",de,_(h.label),1),h.expanded?(r(),g(L,{key:0,size:"16"})):(r(),g(O,{key:1,size:"16"}))],2),d(I,{active:h.expanded},{default:m(()=>[c==0?(r(),n(w,{key:0},[e[3]||(e[3]=s("p",{class:"text-xs text-gray-500 p-4 mb-4"},[x(" Look for the option called "),s("span",{class:"font-bold"},'"Open in external browser"')],-1)),e[4]||(e[4]=s("img",{src:"/images/open_in_external_browser.png",class:"max-w-80 rounded-lg overflow-hidden m-4 mx-auto"},null,-1))],64)):c==1?(r(),n("div",le,[e[7]||(e[7]=s("p",{class:"text-xs text-gray-500 mb-4"},[x(" Copy order details below and send to our "),s("span",{class:"font-bold"},"Whatsapp number")],-1)),t.store.whatsapp_mobile_number?(r(),n("div",ce,[s("span",me,_(t.store.whatsapp_mobile_number.international),1),d(v,{showText:!1,text:t.store.whatsapp_mobile_number.international},{trigger:m(u=>[d(f,{size:"xs",type:"light",leftIconSize:"14",leftIcon:i.CopyIcon,action:()=>u.loading?u.copyToClipboardNotReady():u.copyToClipboard()},{default:m(()=>[...e[5]||(e[5]=[s("span",{class:"text-xs ml-1"},"copy our whatsapp number",-1)])]),_:1},8,["leftIcon","action"])]),_:1},8,["text"])])):y("",!0),t.whatsappMessage?(r(),n(w,{key:1},[s("div",pe,[d(v,{showText:!1,text:t.whatsappMessage},{trigger:m(u=>[d(f,{size:"xs",type:"light",leftIconSize:"14",leftIcon:i.CopyIcon,action:()=>u.loading?u.copyToClipboardNotReady():u.copyToClipboard()},{default:m(()=>[...e[6]||(e[6]=[s("span",{class:"text-xs ml-1"},"copy order details",-1)])]),_:1},8,["leftIcon","action"])]),_:1},8,["text"])]),d(M,{class:"h-60",animate:!1,loopAnimation:!1,messages:[{sender:"You",text:t.whatsappMessage,timestamp:i.now,isOwnMessage:!0}]},null,8,["messages"])],64)):y("",!0)])):c==2?(r(),n(w,{key:2},[e[8]||(e[8]=s("p",{class:"text-xs text-gray-500 p-4 mb-4"},[x(" Use your mobile camera to scan this "),s("span",{class:"font-bold"},"QR Code")],-1)),s("img",{src:i.qrCode,alt:"QR Code",class:"my-4 mx-auto border border-gray-300 shadow max-w-60"},null,8,he)],64)):y("",!0)]),_:2},1032,["active"])],10,ie))),128))])):y("",!0)],64)):(r(),n("div",ue,[d(f,{size:"xs",type:"success",action:t.sendUsingWhatsapp},{default:m(()=>[s("div",ge,[d(T,{color:"#ffffff",class:"mx-2"}),e[10]||(e[10]=s("span",{class:"text-xs"},"Send using Whatsapp",-1))])]),_:1},8,["action"])]))])])}const je=H(J,[["render",fe]]);export{je as default};
