import{c as n,a,b as o,g as c,d as x,e as f,F as g,f as F,t as L,h as k,r as l,o as m}from"./app-GlJHzU_x.js";import{I as R}from"./Input-nrLqMDkp.js";import{B as E}from"./Button-C5PjVjk3.js";import{L as B}from"./Loader-BQyLZa88.js";import{S as V}from"./Skeleton-CCmfEA-R.js";import{i as T}from"./stringUtils-Bvzw0-oW.js";import{M as C}from"./Menu-BqaNxyQd.js";import{B as I}from"./BackdropLoader-BCy7BoLZ.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as v}from"./move-left-CB0J3wAv.js";import{S as h}from"./star-BFjHhTn6.js";import"./Copy-By71uU1S.js";import"./ShineEffect-B9_RJRQO.js";import"./createLucideIcon-BHEQ_wZh.js";import"./Popover-CDw03pE7.js";import"./Tooltip-C-cjSIU7.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-Bc4GdQ8O.js";import"./circle-check-D0AZ00dD.js";import"./circle-alert-DHQrfF2Y.js";import"./x-D9LU4_3P.js";import"./parsePhoneNumber-DR0S47Bc.js";import"./house-B9Fh3W88.js";import"./shopping-cart-U7uiFUog.js";import"./Drawer-BcGSzIoz.js";import"./DesignCardManager-CO4n6g9c.js";import"./store-Cc2vbcNJ.js";import"./Pill-jpvJKogt.js";import"./image-BMFpvjep.js";import"./AddressInput-CUYYTYLa.js";import"./isEqual-Ci7WdrA7.js";import"./Modal-CB5khyw0.js";import"./GoogleMaps-rpsfcOLp.js";import"./SelectCountry-kcBKhfkF.js";import"./Select-K0z1EWjn.js";import"./trash-2-1C5JYDaS.js";import"./plus-xs22FjRq.js";import"./StoreLogo-Z37m6ez-.js";import"./link-BGnFydDh.js";import"./video-CanxtEGY.js";import"./at-sign-DWyt0W_r.js";import"./Countdown-DsbsTlnP.js";import"./chevron-up-G2Q5S2Sv.js";import"./Datepicker-gJdSEtaR.js";import"./arrow-right-CX0piUxv.js";import"./arrow-left-C7oTTeLH.js";import"./Alert-B7ALCCvV.js";import"./info-C4TdMLfP.js";import"./Switch-CrsvtGnj.js";import"./DeliveryTimePicker-BJONwytM.js";import"./debounce-5Hi1IPUI.js";import"./circle-check-big-CGHqM8wJ.js";import"./menu-EYd-BMal.js";import"./user-B2mhmT2y.js";const N={inject:["formState","reviewState","storeState","notificationState"],components:{Input:R,Button:E,Loader:B,Skeleton:V,BackdropLoader:I,Menu:C,Star:h,MoveLeft:v},data(){return{Star:h,MoveLeft:v,isSubmitting:!1,isLoadingUser:!1}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},reviewForm(){return this.reviewState.reviewForm}},watch:{store(s,e){!e&&s&&this.setup()}},methods:{isEmpty:T,async setup(){this.store&&this.reviewState.setReviewForm(null,!0)},navigateToShowShopReviews(){this.$router.push({name:"show-shop-reviews",query:{alias:this.store.alias}})},setRating(s){this.reviewForm.rating=s},async createReview(){var s,e;try{if(this.isSubmitting||(this.formState.hideFormErrors(),this.isEmpty(this.reviewForm.rating)&&this.formState.setFormError("rating","The rating is required"),(this.reviewForm.rating<1||this.reviewForm.rating>5)&&this.formState.setFormError("rating","Rating must be between 1 and 5"),this.formState.hasErrors))return;this.isSubmitting=!0;const r={...this.reviewForm,store_id:this.store.id},d=await k.post("/api/reviews",r);this.notificationState.showSuccessNotification("Review submitted! It will be visible after approval."),await this.navigateToShowShopReviews(),this.reviewState.reset()}catch(r){const d=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Something went wrong while submitting your review";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(r),console.error("Failed to create review:",r)}finally{this.isSubmitting=!1}}},created(){this.setup()},beforeRouteLeave(s,e,r){if(this.reviewState.reviewForm&&(this.reviewForm.rating||this.reviewForm.comment||this.reviewForm.name||this.reviewForm.mobile_number)&&!window.confirm("You have unsaved changes. Are you sure you want to leave?"))return r(!1);this.reviewState.reset(),r()}},U={class:"max-w-4xl mx-auto pt-8 pb-40"},j={key:0,class:"pt-8 flex items-center justify-center"},z={key:1,class:"select-none relative bg-white rounded-lg space-y-4 p-4"},A={class:"flex items-center space-x-4"},q={class:"grid grid-cols-1 md:grid-cols-2 gap-4 border border-gray-300 shadow rounded-lg p-4 space-y-4"},W={class:"border border-gray-300 shadow rounded-lg p-4 space-y-4"},Y={class:"flex space-x-1 mt-2"},D={key:0,class:"mt-1 text-sm text-red-600"},G={class:"flex justify-end"};function H(s,e,r,d,p,t){const S=l("Menu"),b=l("Loader"),_=l("BackdropLoader"),w=l("Button"),u=l("Input"),y=l("Star");return m(),n("div",null,[a(S,{menuClass:"max-w-4xl mx-auto"}),o("div",U,[t.isLoadingStore||p.isLoadingUser?(m(),n("div",j,[a(b,null,{default:c(()=>e[3]||(e[3]=[o("span",{class:"text-sm ml-2"},"Loading...",-1)])),_:1,__:[3]})])):(m(),n("div",z,[p.isSubmitting?(m(),x(_,{key:0,showSpinningLoader:!1,class:"rounded-lg"})):f("",!0),o("div",A,[a(w,{size:"xs",type:"light",action:t.navigateToShowShopReviews,leftIcon:p.MoveLeft},{default:c(()=>e[4]||(e[4]=[o("span",null,"Reviews",-1)])),_:1,__:[4]},8,["action","leftIcon"]),e[5]||(e[5]=o("h1",{class:"text-2xl font-semibold"},"Write A Review",-1))]),t.reviewForm?(m(),n(g,{key:1},[o("div",q,[a(u,{type:"text",label:"Name",placeholder:"Your name",modelValue:t.reviewForm.name,"onUpdate:modelValue":e[0]||(e[0]=i=>t.reviewForm.name=i),secondaryLabel:"(optional)",errorText:t.formState.getFormError("name")},null,8,["modelValue","errorText"]),a(u,{type:"text",label:"Mobile Number",placeholder:"+26772000001",secondaryLabel:"(optional)",modelValue:t.reviewForm.mobile_number,"onUpdate:modelValue":e[1]||(e[1]=i=>t.reviewForm.mobile_number=i),errorText:t.formState.getFormError("mobile_number")},null,8,["modelValue","errorText"])]),o("div",W,[o("div",null,[e[6]||(e[6]=o("label",{class:"text-sm leading-6 font-medium text-gray-900"},"Rating",-1)),o("div",Y,[(m(),n(g,null,F(5,i=>a(y,{size:32,key:i,class:"cursor-pointer",onClick:J=>t.setRating(i),fill:i<=t.reviewForm.rating?"gold":"none",stroke:i<=t.reviewForm.rating?"gold":"gray"},null,8,["onClick","fill","stroke"])),64))]),t.formState.getFormError("rating")?(m(),n("p",D,L(t.formState.getFormError("rating")),1)):f("",!0)]),a(u,{rows:"2",type:"textarea",label:"Comment",modelValue:t.reviewForm.comment,"onUpdate:modelValue":e[2]||(e[2]=i=>t.reviewForm.comment=i),placeholder:"Share your experience...",errorText:t.formState.getFormError("comment"),tooltipContent:"A short description of your feedback"},null,8,["modelValue","errorText"]),o("div",G,[a(w,{size:"sm",type:"primary",leftIcon:p.Star,action:t.createReview,loading:p.isSubmitting},{default:c(()=>e[7]||(e[7]=[o("span",null,"Send Review",-1)])),_:1,__:[7]},8,["leftIcon","action","loading"])])])],64)):f("",!0)]))])])}const Ke=M(N,[["render",H]]);export{Ke as default};
