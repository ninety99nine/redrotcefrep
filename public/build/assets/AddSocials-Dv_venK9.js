import{i as E}from"./index-DhTHOtvJ.js";import{I as V}from"./Input-D2CpQCT5.js";import{c as d,b as i,a as c,F as p,f as C,e as w,i as A,t as m,k as L,g as _,T as I,H as h,r as g,o as n,d as P}from"./app-BFRszLDY.js";import{B as z}from"./Button-DCQzWhi0.js";import{S as F}from"./Switch-Cs_wN3SM.js";import{a as M,i as U}from"./stringUtils-Bvzw0-oW.js";import{S as N}from"./Skeleton-Cb_5uZP7.js";import{S as T}from"./StoreLogo-N-Oy-vlD.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{A as j}from"./at-sign-BJyIMTId.js";import{I as R}from"./info-BmAppJiG.js";import{M as H}from"./move-right-3MfWaVLf.js";import"./Copy-BnPm0WTY.js";import"./ShineEffect-jVKnL5S-.js";import"./createLucideIcon-CSc6mW6X.js";import"./Popover-7t3v7uU0.js";import"./Tooltip-BCcWuuCA.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-DHHZfB71.js";import"./circle-check--aSqogot.js";import"./circle-alert-C2w03bbG.js";import"./x-t57Ey7ol.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Loader-CVwI2N_w.js";import"./plus-B7cTGDAB.js";const W={inject:["formState","storeState","notificationState"],components:{Info:R,Input:V,AtSign:j,Button:z,Switch:F,Skeleton:N,StoreLogo:T},data(){return{MoveRight:H,designCards:[],designCardPlatforms:[],isLoadingDesignCards:!1,designCardConfigurations:[],originalDesignCardPlatforms:[],isUpdatingDesignCardPlatforms:!1,isLoadingDesignCardConfigurations:!1}},computed:{store(){return this.storeState.store},hasActiveDesignCardPlatforms(){return this.designCardPlatforms.some(t=>t.active)},totalActiveDesignCardPlatforms(){return this.designCardPlatforms.filter(t=>t.active).length},designCardPlatformsHaveChanged(){var t=h(this.designCardPlatforms),e=h(this.originalDesignCardPlatforms);return!E(t,e)},designCardPlatformValidationErrors(){return this.designCardPlatforms.filter(t=>t.active).map(t=>{const e=new RegExp("^(https?:\\/\\/)?([a-zA-Z0-9-]+\\.)?[a-zA-Z0-9-]+\\.[a-zA-Z]{2,6}(:[0-9]{1,5})?(\\/[^\\s]*)?$");let s="";return this.isEmpty(t.link)?s=`The ${t.name} link is required`:e.test(t.link.trim())||(s=`The ${t.name} link is incorrect`),s?{name:t.name,message:s}:null}).filter(t=>t!==null)},hasDesignCardPlatformValidationErrors(){return this.designCardPlatformValidationErrors.length>0},socialsConfiguration(){return this.designCardConfigurations.find(t=>t.type==="socials")||null},socialsDesignCard(){return this.designCards.find(t=>t.placement==="menu"&&t.type==="socials")||null}},methods:{isEmpty:U,isNotEmpty:M,hasMatchingPlatformValidationError(t){return this.designCardPlatformValidationErrors.some(e=>e.name===t)},getMatchingPlatformValidationError(t){const e=this.designCardPlatformValidationErrors.find(s=>s.name===t);return e?e.message:null},getMatchingPlatformIcon(t){return{name:t,icon:`/images/social-media-icons/${t.toLowerCase()}.png`}},async setup(){await this.showDesignCardConfigurations(),await this.showDesignCards(),this.initializeDesignCardPlatforms()},async showDesignCards(){var t,e;try{this.isLoadingDesignCards=!0;let s={params:{per_page:100,store_id:this.store.id}};const o=await axios.get("/api/design-cards",s);this.designCards=o.data.data}catch(s){const o=((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Something went wrong while fetching design cards";this.notificationState.showWarningNotification(o),this.formState.setServerFormErrors(s),console.error("Failed to fetch design cards:",s)}finally{this.isLoadingDesignCards=!1}},async showDesignCardConfigurations(){var t,e;try{this.isLoadingDesignCardConfigurations=!0;let s={params:{store_id:this.store.id}};const o=await axios.get("/api/design-cards/configurations",s);this.designCardConfigurations=o.data}catch(s){const o=((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Something went wrong while fetching design card options";this.notificationState.showWarningNotification(o),this.formState.setServerFormErrors(s),console.error("Failed to fetch design card options:",s)}finally{this.isLoadingDesignCardConfigurations=!1}},initializeDesignCardPlatforms(){if(!this.socialsConfiguration){this.designCardPlatforms=[];return}this.designCardPlatforms=h(this.socialsConfiguration.metadata.platforms.map(t=>{var s,o;const e=((o=(s=this.socialsDesignCard)==null?void 0:s.metadata.platforms.find(l=>l.name.toLowerCase()===t.name.toLowerCase()))==null?void 0:o.link)||"";return{link:e,name:t.name,active:this.isNotEmpty(e)}})),this.originalDesignCardPlatforms=h(this.designCardPlatforms)},async createOrUpdateDesignCard(){var t,e;try{if(!this.socialsConfiguration)throw new Error("Socials configuration not found");this.isUpdatingDesignCardPlatforms=!0;const s=this.designCardPlatforms.filter(a=>this.isNotEmpty(a.link)).map(a=>({name:a.name,link:a.link})),o=this.designCards.length>0?Math.max(...this.designCards.map(a=>a.position||0))+1:1;let l={visible:!0,placement:"menu",store_id:this.store.id,type:this.socialsConfiguration.type,metadata:{...this.socialsConfiguration.metadata,platforms:s}};this.socialsDesignCard?await axios.put(`/api/design-cards/${this.socialsDesignCard.id}`,l):(l.arrangement="last",await axios.post("/api/design-cards",l)),this.notificationState.showSuccessNotification("Social media links updated"),this.originalDesignCardPlatforms=h(this.designCardPlatforms),this.navigateToAddAdvancedFeatures()}catch(s){const o=((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Something went wrong while updating social media links";this.notificationState.showWarningNotification(o),this.formState.setServerFormErrors(s),console.error("Failed to update social media links:",s)}finally{this.isUpdatingDesignCardPlatforms=!1}},navigateToAddAdvancedFeatures(){this.$router.push({name:"advanced-features",params:{store_id:this.store.id}})}},beforeRouteLeave(t,e,s){if((this.isUpdatingDesignCardPlatforms||this.designCardPlatformsHaveChanged)&&!window.confirm("You have unsaved changes. Are you sure you want to leave?"))return s(!1);s()},created(){this.setup()}},Y={class:"min-h-screen flex flex-col items-center pb-40"},Z={class:"w-full max-w-lg"},q={class:"w-full max-w-lg"},O={class:"mb-4"},G={key:0,class:"space-y-2"},J={class:"w-full flex items-center space-x-2"},K={key:1,class:"space-y-3 mb-4"},Q={class:"flex justify-between items-center"},X={class:"flex items-center space-x-2 font-bold"},$={class:"w-8 h-8 rounded-full overflow-hidden flex items-center justify-center"},ss=["src"],ts={class:"text-sm"},es={key:0,class:"w-full mt-4"},as={key:0,class:"flex space-x-1 text-xs text-yellow-600 font-semibold bg-yellow-100 border border-yellow-300 p-3 rounded-lg shadow-md mt-2"},is={key:0,class:"list-disc text-xs text-yellow-600 bg-yellow-100 border border-yellow-300 py-3 px-4 rounded-lg shadow-md mb-4"},os={class:"space-y-1"},ns={key:1,class:"text-blue-600 bg-blue-100 border border-blue-300 p-3 rounded-lg shadow-md mb-4"},rs={class:"flex items-center space-x-2"},ds={key:0,class:"text-sm font-semibold"},ls={class:"font-bold"},cs={class:"flex justify-end"};function ms(t,e,s,o,l,a){const x=g("StoreLogo"),v=g("Skeleton"),b=g("Switch"),D=g("Input"),S=g("Info"),k=g("AtSign"),y=g("Button");return n(),d("div",Y,[i("div",Z,[c(x,{showButton:!1,class:"flex justify-center mb-4"}),e[0]||(e[0]=i("h2",{class:"text-2xl font-semibold text-center mb-2"},"Connect Your Socials",-1)),e[1]||(e[1]=i("p",{class:"text-gray-500 text-center mb-6"},"Make it easy for customers to find and follow you",-1))]),i("div",q,[i("div",O,[l.isLoadingDesignCardConfigurations?(n(),d("div",G,[(n(),d(p,null,C([1,2,3],(r,f)=>i("div",{key:f,class:"border border-gray-300 shadow-sm rounded-lg p-4 bg-gray-50"},[i("div",J,[c(v,{width:"w-8",shine:!0}),c(v,{width:"w-40",shine:!0})])])),64))])):(n(),d("div",K,[(n(!0),d(p,null,C(l.designCardPlatforms,(r,f)=>(n(),d("div",{key:f,class:"bg-white p-4 shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-300 hover:shadow-lg cursor-pointer"},[i("div",Q,[i("div",X,[i("div",$,[i("img",{alt:"Social Media Logo",class:"h-full object-contain",src:a.getMatchingPlatformIcon(r.name).icon.toLowerCase()},null,8,ss)]),i("span",ts,m(r.name),1)]),c(b,{size:"md",modelValue:r.active,"onUpdate:modelValue":u=>r.active=u},null,8,["modelValue","onUpdate:modelValue"])]),r.active?(n(),d("div",es,[c(D,{placeholder:"https://",modelValue:r.link,"onUpdate:modelValue":u=>r.link=u,label:`${r.name} link`,errorText:a.formState.getFormError("designCardPlatforms"+f+"Link")},null,8,["modelValue","onUpdate:modelValue","label","errorText"]),a.hasMatchingPlatformValidationError(r.name)?(n(),d("p",as,[c(S,{size:"14",class:"shrink-0"}),i("span",null,m(a.getMatchingPlatformValidationError(r.name)),1)])):w("",!0)])):w("",!0)]))),128))]))]),a.hasDesignCardPlatformValidationErrors?(n(),d("div",is,[e[2]||(e[2]=i("p",{class:"text-lg font-semibold mb-2"},"Resolve these to continue",-1)),i("ul",os,[(n(!0),d(p,null,C(a.designCardPlatformValidationErrors,(r,f)=>(n(),d("li",{key:f},m(r.message),1))),128))])])):(n(),d("div",ns,[i("div",rs,[c(k,{size:"28",class:"shrink-0"}),i("div",null,[a.hasActiveDesignCardPlatforms?(n(),d("p",ds,[A(m(a.store.name)+" supports ",1),i("span",ls,m(a.totalActiveDesignCardPlatforms)+" "+m(a.totalActiveDesignCardPlatforms==1?"social platform":"social platforms"),1)])):w("",!0),i("p",{class:L([a.hasActiveDesignCardPlatforms?"text-xs":"text-sm font-semibold"])},"You can always "+m(a.hasActiveDesignCardPlatforms?"add more":"add")+" social links later! ðŸ˜Š",3)])])])),i("div",cs,[c(I,{name:"fade-1",mode:"out-in"},{default:_(()=>[a.designCardPlatformsHaveChanged||a.hasActiveDesignCardPlatforms?(n(),P(y,{key:0,size:"md",type:"primary",buttonClass:"w-full",action:a.createOrUpdateDesignCard,loading:l.isUpdatingDesignCardPlatforms,disabled:l.isUpdatingDesignCardPlatforms||a.hasDesignCardPlatformValidationErrors},{default:_(()=>[...e[3]||(e[3]=[i("span",null,"Continue",-1)])]),_:1},8,["action","loading","disabled"])):(n(),P(y,{key:1,size:"md",type:"light",buttonClass:"w-40",rightIconSize:"24",rightIcon:l.MoveRight,action:a.navigateToAddAdvancedFeatures},{default:_(()=>[...e[4]||(e[4]=[i("span",null,"Skip",-1)])]),_:1},8,["rightIcon","action"]))]),_:1})])])])}const Ns=B(W,[["render",ms]]);export{Ns as default};
