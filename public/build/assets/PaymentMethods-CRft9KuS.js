import{P as D}from"./Pill-CfzFjwDX.js";import{A as I}from"./Alert-DgNvZObK.js";import{I as N}from"./Input-CI0gKfpk.js";import{M as j}from"./Modal-B0SwX18I.js";import{B as z}from"./Button-CMAESCwz.js";import{S as V}from"./Skeleton-KK-V-B9B.js";import{V as E}from"./vue-draggable-next.esm-bundler-DDZvFHTU.js";import{c as F,a as B}from"./stringUtils-Bvzw0-oW.js";import{c as m,b as o,d as w,a as r,q as v,g as p,r as h,F as u,f,w as S,o as i,e as x,i as _,t as y}from"./app-CaCDZNvD.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as W}from"./move-6uIJOqKA.js";import{C as U}from"./circle-dollar-sign-C58-Ars8.js";import{T as G}from"./trash-2-B_yhlISY.js";import{P as O}from"./plus-BsLTh-Ke.js";import"./Popover-1WlbTYZh.js";import"./x-Do1GLDRA.js";import"./createLucideIcon-hJfW1V63.js";import"./circle-check-CFrnoQ4d.js";import"./info-BAalSlfL.js";import"./Copy-DtqSf0U1.js";import"./ShineEffect-9Bzjo95p.js";import"./refresh-ccw-C1cdGvMt.js";import"./circle-alert-ChEGa5ss.js";import"./parsePhoneNumber-DR0S47Bc.js";import"./Loader-C6t2-ZQM.js";const R={inject:["formState","storeState","notificationState"],components:{CircleDollarSign:U,Pill:D,Alert:I,Input:N,Modal:j,Button:z,Skeleton:V,Move:W,draggable:E},data(){return{Plus:O,Trash2:G,pagination:null,searchTerm:null,paymentMethods:[],lastSearchTerm:null,storePaymentMethods:[],isLoadingPaymentMethods:!1,selectedPaymentMethodType:"all",deletableStorePaymentMethod:null,isDeletingStorePaymentMethod:!1,isLoadingStorePaymentMethods:!1,hasLoadedInitialPaymentMethods:!1,isChangingStorePaymentMethodArrangement:!1,paymentMethodTypes:["all","automated","manual"]}},watch:{store(n,t){!t&&n&&this.setup()},selectedPaymentMethodType(){this.showPaymentMethods()},searchTerm(){this.showPaymentMethods()}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},hasPaymentMethods(){return this.paymentMethods.length>0},hasStorePaymentMethods(){return this.storePaymentMethods.length>0},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)}},methods:{isNotEmpty:B,capitalize:F,setup(){this.store&&this.showStorePaymentMethods()},onShow(){this.hasLoadedInitialPaymentMethods=!1,this.lastSearchTerm=null,this.paymentMethods=[],this.searchTerm=null,this.showPaymentMethods()},showDeleteStorePaymentMethodModal(n){this.deletableStorePaymentMethod=n,this.$refs.deleteStorePaymentMethodModal.showModal()},async navigateToAddPaymentMethod(n){await this.$router.push({name:"add-payment-method",query:{store_id:this.store.id,payment_method_id:n.id}})},async navigateToEditPaymentMethod(n){await this.$router.push({name:"edit-payment-method",query:{store_id:this.store.id},params:{store_payment_method_id:n.id}})},async showPaymentMethods(){var n,t;try{this.isLoadingPaymentMethods=!0;let e={params:{per_page:100,store_id:this.store.id,association:"unassociated"}};this.selectedPaymentMethodType=="automated"?e.params.automated_verification="1":this.selectedPaymentMethodType=="manual"&&(e.params.automated_verification="0"),this.hasSearchTerm&&(e.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const d=await axios.get("/api/payment-methods",e);if(this.searchTerm===this.lastSearchTerm){const s=d.data;this.paymentMethods=s.data,this.isLoadingPaymentMethods=!1,this.hasLoadedInitialPaymentMethods=!0}}catch(e){const d=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong while fetching payment methods";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(e),console.error("Failed to fetch payment methods:",e)}finally{this.isLoadingPaymentMethods=!1}},async showStorePaymentMethods(){var n,t;try{this.isLoadingStorePaymentMethods=!0;let e={params:{per_page:100,store_id:this.store.id,association:"team member",_relationships:["logo","paymentMethod"].join(",")}};const d=await axios.get("/api/store-payment-methods",e);this.pagination=d.data,this.storePaymentMethods=this.pagination.data}catch(e){const d=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong while fetching store payment methods";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(e),console.error("Failed to fetch store payment methods:",e)}finally{this.isLoadingStorePaymentMethods=!1}},async changeStorePaymentMethodArrangement(){var n,t;try{if(this.isChangingStorePaymentMethodArrangement)return;const e=this.storePaymentMethods.map(s=>s.id);if(e.length==0)return;this.isChangingStorePaymentMethodArrangement=!0;const d={store_id:this.store.id,store_payment_method_ids:e};await axios.post("/api/store-payment-methods/arrangement",d),this.notificationState.showSuccessNotification("Arrangement changed")}catch(e){const d=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong while updating payment method arrangement";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(e),console.error("Failed to update payment method arrangement:",e)}finally{this.isChangingStorePaymentMethodArrangement=!1}},async deleteStorePaymentMethod(){var n,t;try{if(this.isDeletingStorePaymentMethod)return;this.isDeletingStorePaymentMethod=!0;const e={data:{store_id:this.store.id}};await axios.delete(`/api/store-payment-methods/${this.deletableStorePaymentMethod.id}`,e),this.showStorePaymentMethods(),this.$refs.deleteStorePaymentMethodModal.hideModal(),this.notificationState.showSuccessNotification("Payment method deleted")}catch(e){const d=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong while deleting payment method";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(e),console.error("Failed to delete payment method:",e),hideModal()}finally{this.isDeletingStorePaymentMethod=!1}}},created(){this.setup()}},H={class:"max-w-2xl mx-auto pt-32 pb-40"},J={class:"flex justify-end"},K={class:"flex justify-center space-x-1 py-2"},Q={key:0,class:"flex justify-center items-center space-x-4 my-2"},X={key:2,class:"space-y-2 mb-4"},Y={key:3,class:"space-y-2 mb-4"},Z=["onClick"],$={class:"w-8 h-8 rounded-full overflow-hidden flex items-center justify-center"},ee=["src"],te={class:"w-full flex items-center justify-between"},oe={class:"text-sm font-semibold"},se={class:"mr-1"},ae={class:"w-60 text-xs text-center leading-5 px-2 py-1 whitespace-normal"},ne={key:4,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"},ie={key:0,class:"space-y-3 mt-4"},re={class:"flex justify-between items-center"},de={class:"flex items-center space-x-2 font-bold"},le={class:"flex items-center space-x-4"},me=["onClick"],he={class:"flex justify-between items-center"},ce={class:"flex items-center space-x-2 font-bold"},ge={class:"w-8 h-8 rounded-full overflow-hidden flex items-center justify-center"},pe=["src"],ye={class:"text-sm"},ue={class:"flex items-center space-x-4"},fe={key:2,class:"flex flex-col items-center justify-center bg-gradient-to-br from-indigo-50 to-purple-50 border border-gray-300 shadow-lg rounded-2xl py-16 px-8 space-y-6"},_e={class:"relative"},Me={class:"bg-gradient-to-br from-white-50 to-indigo-50 text-indigo-500 rounded-full p-2"},we={class:"mb-8"},Se={class:"font-bold text-black"};function Pe(n,t,e,d,s,l){const M=h("Pill"),b=h("Input"),T=h("Alert"),c=h("Skeleton"),P=h("Modal"),k=h("Button"),L=h("Move"),C=h("draggable"),A=h("CircleDollarSign");return i(),m("div",H,[o("div",J,[r(P,{size:"md",onShow:l.onShow,triggerSize:"md",contentClass:"px-4",triggerType:"primary",leftTriggerIcon:s.Plus,scrollOnContent:!1,showApproveButton:!1,ref:"addPaymentMethodModal",header:"Add Payment Method",triggerLoading:l.isLoadingStore,triggerText:l.hasStorePaymentMethods?"Add Payment Method":null},v({_:2},[!l.isLoadingStore&&!s.isLoadingStorePaymentMethods?{name:"content",fn:p(()=>[o("div",K,[(i(!0),m(u,null,f(s.paymentMethodTypes,(a,g)=>(i(),w(M,{size:"md",key:g,action:()=>s.selectedPaymentMethodType=a,type:s.selectedPaymentMethodType==a?"primary":"light"},{default:p(()=>[_(y(l.capitalize(a)),1)]),_:2},1032,["action","type"]))),128))]),s.hasLoadedInitialPaymentMethods?(i(),m("div",Q,[r(b,{type:"search",class:"w-full",debounced:!0,modelValue:s.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=a=>s.searchTerm=a),skeleton:l.isLoadingStore,placeholder:"Search payment methods",onInput:t[1]||(t[1]=a=>s.isLoadingPaymentMethods=!0)},null,8,["modelValue","skeleton"])])):x("",!0),s.selectedPaymentMethodType!=="all"?(i(),w(T,{key:1,class:"mb-2",type:"primary",dismissable:!1,description:s.selectedPaymentMethodType==="automated"?"Showing payment methods that automatically verify":"Showing payment methods that require manual verification"},null,8,["description"])):x("",!0),s.isLoadingPaymentMethods?(i(),m("div",X,[(i(),m(u,null,f([1,2,3],(a,g)=>o("div",{key:g,class:"flex items-center space-x-2 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50 w-full"},[r(c,{width:"w-10",height:"h-10",rounded:"rounded-full",shine:!0,class:"flex-shrink-0"}),r(c,{width:"w-1/3",shine:!0})])),64))])):l.hasPaymentMethods?(i(),m("div",Y,[(i(!0),m(u,null,f(s.paymentMethods,(a,g)=>(i(),m("div",{key:g,onClick:()=>l.navigateToAddPaymentMethod(a),class:"flex items-center space-x-2 cursor-pointer p-3 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100"},[o("div",$,[o("img",{alt:"Payment Method Logo",class:"h-full object-contain",src:a.image_url},null,8,ee)]),o("div",te,[o("p",oe,y(a.name),1),r(M,{tooltipTriggerClass:"w-4 h-4 text-gray-400 hover:text-gray-500",type:a.automated_verification?"primary":"light",size:"xs"},{tooltipContent:p(()=>[o("p",ae,y(a.automated_verification?"Automatic payment verification; no manual action needed":"Requires manual verification after customer payment"),1)]),default:p(()=>[o("span",se,y(a.automated_verification?"automated":"manual"),1)]),_:2},1032,["type"])])],8,Z))),128))])):(i(),m("p",ne," No payment methods found "))]),key:"0"}:void 0]),1032,["onShow","leftTriggerIcon","triggerLoading","triggerText"])]),l.isLoadingStore||s.isLoadingStorePaymentMethods?(i(),m("div",ie,[(i(),m(u,null,f([1,2,3],(a,g)=>o("div",{key:g,class:"bg-white p-4 shadow-sm rounded-xl transition-all duration-300"},[o("div",re,[o("div",de,[r(c,{width:"w-8",height:"h-8",rounded:"rounded-full",shine:!0}),r(c,{width:"w-40",shine:!0})]),o("div",le,[r(c,{width:"w-16",shine:!0}),r(c,{width:"w-4",height:"h-4",rounded:"rounded-md",shine:!0}),r(c,{width:"w-4",height:"h-4",rounded:"rounded-md",shine:!0})])])])),64))])):l.hasStorePaymentMethods?(i(),w(C,{key:1,class:"space-y-3 mt-4",handle:".draggable-handle","ghost-class":"bg-yellow-50",modelValue:s.storePaymentMethods,"onUpdate:modelValue":t[3]||(t[3]=a=>s.storePaymentMethods=a),onChange:l.changeStorePaymentMethodArrangement},{default:p(()=>[(i(!0),m(u,null,f(s.storePaymentMethods,a=>(i(),m("div",{key:a.id,onClick:S(()=>l.navigateToEditPaymentMethod(a),["stop"]),class:"bg-white p-4 shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-300 hover:shadow-lg cursor-pointer"},[o("div",he,[o("div",ce,[o("div",ge,[o("img",{alt:"Payment Method Logo",class:"h-full object-contain",src:a.logo?a.logo.path:a.payment_method.image_url},null,8,pe)]),o("span",ye,y(a.custom_name),1)]),o("div",ue,[r(M,{type:a.active?"success":"warning",size:"xs"},{default:p(()=>[_(y(a.active?"active":"inactive"),1)]),_:2},1032,["type"]),r(k,{size:"xs",type:"bareDanger",leftIcon:s.Trash2,action:()=>l.showDeleteStorePaymentMethodModal(a)},null,8,["leftIcon","action"]),r(L,{onClick:t[2]||(t[2]=S(()=>{},["stop"])),size:"16",class:"draggable-handle cursor-grab active:cursor-grabbing text-gray-500 hover:text-yellow-500"})])])],8,me))),128))]),_:1},8,["modelValue","onChange"])):(i(),m("div",fe,[o("div",_e,[o("div",Me,[r(A,{size:"60"})]),t[5]||(t[5]=o("div",{class:"absolute inset-0 bg-indigo-300 opacity-20 rounded-full animate-ping"},null,-1))]),t[7]||(t[7]=o("div",{class:"text-center"},[o("h3",{class:"text-xl font-semibold text-gray-800"},"Get Started with Payments!"),o("span",{class:"text-sm text-gray-600 mt-2 block max-w-sm"}," Add a payment method to unlock seamless transactions and grow your business. ")],-1)),o("button",{size:"lg",type:"bare",onClick:t[4]||(t[4]=S(()=>n.$refs.addPaymentMethodModal.showModal(),["stop"])),class:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-medium py-3 px-6 rounded-lg hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 hover:scale-105 cursor-pointer"},t[6]||(t[6]=[o("span",null,"Add Payment Method Now",-1)]))])),r(P,{approveType:"danger",approveLeftIcon:s.Trash2,approveText:"Delete Payment Method",ref:"deleteStorePaymentMethodModal",approveAction:l.deleteStorePaymentMethod,triggerLoading:s.isDeletingStorePaymentMethod,approveLoading:s.isDeletingStorePaymentMethod},v({_:2},[s.deletableStorePaymentMethod?{name:"content",fn:p(()=>[t[10]||(t[10]=o("p",{class:"text-lg font-bold border-b border-gray-300 border-dashed pb-4 mb-4"},"Confirm Delete",-1)),o("p",we,[t[8]||(t[8]=_("Are you sure you want to delete ")),o("span",Se,y(s.deletableStorePaymentMethod.custom_name),1),t[9]||(t[9]=_("?"))])]),key:"0"}:void 0]),1032,["approveLeftIcon","approveAction","triggerLoading","approveLoading"])])}const Ke=q(R,[["render",Pe]]);export{Ke as default};
