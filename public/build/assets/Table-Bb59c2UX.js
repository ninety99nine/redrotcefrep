import{P as j}from"./Pill-CDGvVlRG.js";import{X as oe,I as H}from"./Input-ChopJmt9.js";import{S as G}from"./Select-oImkjFwu.js";import{B as T}from"./Button-DwrvLHoq.js";import{L as N}from"./Loader-DjOVE8lE.js";import{S as J,c as n,u as I,b as i,e as h,w as b,a as u,r as c,n as q,o as r,d as f,g as k,i as M,t as F,x as P,F as U,f as L,T as le}from"./app-BS747Cvj.js";import{P as se}from"./Paginator-BKz7MJWa.js";import{i as K}from"./isEqual-D4F7LSaO.js";import{c as E}from"./cloneDeep-DTO5MgNn.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as re}from"./SelectCountry-DCiHCdqE.js";import{D as ne}from"./Datepicker-DaxBmykV.js";import{C as ie,a as ae}from"./chevron-up-BbuZ3xfe.js";import{c as B}from"./createLucideIcon-48nG323g.js";import{S as ue}from"./Switch-C7NpZjIx.js";import{V as Q}from"./vue-draggable-next.esm-bundler-D5YB87j-.js";import{M as Z}from"./move-CbjHNjVC.js";import{R as ce}from"./rotate-ccw-DNPxJp3z.js";/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=B("arrow-down-wide-narrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=B("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=B("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=B("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=B("logs",[["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M3 12h1",key:"lp3yf2"}],["path",{d:"M3 18h1",key:"1eiwyy"}],["path",{d:"M3 6h1",key:"rgxa97"}],["path",{d:"M8 12h1",key:"1con00"}],["path",{d:"M8 18h1",key:"13wk12"}],["path",{d:"M8 6h1",key:"tn6mkg"}]]),de={components:{X:oe,Button:T},props:{position:{type:String,default:"right",validator:t=>["left","right"].includes(t)},trigger:{type:[String,null],default:null},header:{type:[String,null],default:null},content:{type:[String,null],default:null},showFooter:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!0},declineText:{type:String,default:"Cancel"},declineType:{type:String,default:"light"},declineSize:{type:String,default:"sm"},declineAction:{type:[Function,null],default:null},showApproveButton:{type:Boolean,default:!0},approveText:{type:String,default:"Confirm"},approveSize:{type:String,default:"sm"},approveType:{type:String,default:"primary"},approveAction:{type:[Function,null],default:null},scrollOnContent:{type:Boolean,default:!0},dismissable:{type:Boolean,default:!0},maxWidth:{type:String,default:"max-w-xs"},onShow:{type:[Function,null],default:null},onHide:{type:[Function,null],default:null}},data(){return{uniqueId:J("drawer")}},computed:{positionClass(){return this.position==="right"?"end-0 translate-x-full hs-overlay-open:translate-x-0":"start-0 -translate-x-full hs-overlay-open:translate-x-0"}},mounted(){setTimeout(()=>{window.HSOverlay&&window.HSOverlay.autoInit()},500)},methods:{showDrawer(){const t=document.querySelector(`#${this.uniqueId}`);t&&(window.HSOverlay.open(t),this.onShow&&this.onShow())},hideDrawer(){const t=document.querySelector(`#${this.uniqueId}`);t&&(window.HSOverlay.close(t),this.onHide&&this.onHide())}}},he=["id"],pe={class:"relative flex flex-col h-full"},me={key:0,class:"flex justify-between items-center py-3 px-4 border-b border-gray-200 dark:border-neutral-700"},ge={key:0,class:"font-bold text-gray-700 dark:text-white"},fe={class:"text-sm text-gray-700 dark:text-neutral-400"},ye={key:0,class:"flex justify-end items-center gap-x-2 py-3 px-4 border-t border-gray-200 dark:border-neutral-700"};function ve(t,e,o,g,s,l){const d=c("Button"),p=c("X");return r(),n("div",null,[I(t.$slots,"trigger",{showDrawer:l.showDrawer},()=>[o.trigger?(r(),f(d,{key:0,size:"sm",type:"primary",action:l.showDrawer},{default:k(()=>[M(F(o.trigger),1)]),_:1},8,["action"])):h("",!0)]),i("div",{id:s.uniqueId,class:q([o.maxWidth,"hs-overlay hidden fixed inset-y-0 z-50 w-full bg-white shadow-lg border-r border-gray-200 transition-transform duration-300 ease-in-out dark:bg-neutral-800 dark:border-neutral-700",l.positionClass,{"[--overlay-backdrop:static]":!o.dismissable}])},[i("div",pe,[i("button",{type:"button","aria-label":"Close",onClick:e[0]||(e[0]=b((...y)=>l.hideDrawer&&l.hideDrawer(...y),["prevent","stop"])),class:"absolute top-2 right-6 size-8 inline-flex justify-center items-center gap-x-2 rounded-full border border-transparent bg-gray-100 text-gray-700 hover:bg-gray-200 focus:outline-hidden focus:bg-gray-200 dark:bg-neutral-700 dark:hover:bg-neutral-600 dark:text-neutral-400 dark:focus:bg-neutral-600"},[e[1]||(e[1]=i("span",{class:"sr-only"},"Close",-1)),u(p,{size:"20"})]),o.header||t.$slots.header?(r(),n("div",me,[I(t.$slots,"header",{hideDrawer:l.hideDrawer},()=>[o.header?(r(),n("h3",ge,F(o.header),1)):h("",!0)])])):h("",!0),o.content||t.$slots.content?(r(),n("div",{key:1,class:q(["flex-1 overflow-y-auto",{"p-4":o.content},{"max-h-80":o.scrollOnContent}])},[I(t.$slots,"content",{hideDrawer:l.hideDrawer},()=>[i("p",fe,F(o.content),1)])],2)):h("",!0),I(t.$slots,"footer",{hideDrawer:l.hideDrawer},()=>[o.showFooter&&(o.showCancelButton||o.showApproveButton)?(r(),n("div",ye,[o.showCancelButton?(r(),f(d,{key:0,size:o.declineSize,type:o.declineType,action:o.declineAction?()=>o.declineAction(l.hideDrawer):l.hideDrawer},{default:k(()=>[M(F(o.declineText),1)]),_:1},8,["size","type","action"])):h("",!0),o.showApproveButton?(r(),f(d,{key:1,size:o.approveSize,type:o.approveType,action:o.approveAction?()=>o.approveAction(l.hideDrawer):l.hideDrawer},{default:k(()=>[M(F(o.approveText),1)]),_:1},8,["size","type","action"])):h("",!0)])):h("",!0)])])],10,he)])}const Y=z(de,[["render",ve]]),we={inject:["notificationState"],components:{Pill:j,Input:H,Button:T,Drawer:Y,Datepicker:ne,Loader:N,Select:G,SelectCountry:re,Funnel:W,ChevronUp:ae,ChevronDown:ie},props:{filterExpressions:{type:Array,default:()=>[]},resource:{type:String}},emits:["updatedFilters"],data(){return{Funnel:W,ArrowUp:ee,ArrowDown:$,showMore:!1,localFilters:null,filterDrawer:null,originalFilters:null,isLoadingFilters:!1,lastEmittedFilters:null}},watch:{localFilters:{handler(t){this.createFilterExpressions()},deep:!0}},computed:{hasFilterExpressions(){return this.filterExpressions.length>0},totalActiveFilters(){return this.localFilters==null?0:this.localFilters.filter(t=>t.options.some(e=>e.active)).length},hasPriorityFilters(){return this.localFilters==null?!1:this.localFilters.filter(t=>t.priority).length>0},hasNonPriorityFilters(){return this.localFilters==null?!1:this.localFilters.filter(t=>!t.priority).length>0}},methods:{countActiveOptions(t){return t.options.filter(e=>e.active).length},createFilterExpressions(){let t=[];for(let e=0;e<this.localFilters.length;e++){const o=this.localFilters[e];if(o.options.some(s=>s.active))if(o.type==="checkboxes"){const l=o.options.filter(y=>y.active).map(y=>y.value),d=`${o.label} = ${l.join(", ")}`,p=`${o.target}:in:${l.join(",")}`;t.push({label:d,expression:p,filterIndex:e})}else for(let s=0;s<o.options.length;s++){const l=o.options[s];if(l.active){let p=null,y=null,V=l.value,C=l.value2,v=l.operator;if(["bt","bt_ex"].includes(v)){if(!V||!C)continue;p=`${o.label} between ${l.value} - ${l.value2} ${v=="bt"?"(including)":"(excluding)"}`,y=`${o.target}:${v}:${V}:${C}`}else if(["in","not_in"].includes(v)){if(!V&&!C)continue;const D=(C?C.split(",").map(S=>S.trim()):[V]).join(",");p=`${o.label} ${v==="in"?"in":"not in"} ${D}`,y=`${o.target}:${v}:${D}`}else p=`${o.label} ${v??"="} ${l.value}`,y=`${o.target}:${v??"="}:${V}`;t.push({label:p,expression:y,filterIndex:e,optionIndex:s})}}}this.filtersHaveChanged(t,this.lastEmittedFilters)&&(this.$emit("updatedFilters",t),this.lastEmittedFilters=E(t))},applyFilterExpressions(){this.filterExpressions.forEach(t=>{const e=t.split(":"),o=e[0],g=e[1],s=e[2],l=e[3]??null,d=this.localFilters.find(p=>p.target===o);d&&d.options.forEach(p=>{p.value===g&&(p.active=!0,d.type==="date"&&s&&P(s).isValid()?(p.value=P(s).format("DD MMM YYYY"),l&&P(l).isValid()&&(p.value2=P(l).format("DD MMM YYYY"))):["in","not_in"].includes(g)?(p.value=s.split(",")[0],p.value2=s):(p.value=s,p.value2=l))})})},filtersHaveChanged(t,e){var o=E(t),g=E(e);return!K(o,g)},openFilterDrawer(){this.localFilters==null&&this.getFilters(),this.filterDrawer.showDrawer()},closeFilterDrawer(){this.filterDrawer.hideDrawer()},toggleFilterVisibility(t){this.localFilters[t].active||this.localFilters.forEach((e,o)=>{this.localFilters[o].active=!1}),this.localFilters[t].active=!this.localFilters[t].active},showMoreOrLess(){this.showMore=!this.showMore},removeAppliedFilter(t){t.hasOwnProperty("filterIndex")&&t.hasOwnProperty("optionIndex")?this.localFilters[t.filterIndex].options[t.optionIndex].active=!1:this.localFilters[t.filterIndex].options.forEach(e=>{e.active=!1})},clearFilters(){this.localFilters=E(this.originalFilters)},async getFilters(){var t,e;try{if(this.isLoadingFilters)return;this.isLoadingFilters=!0;const o={params:{type:this.resource}},g=await axios.get("/api/filters",o);this.localFilters=g.data.map(s=>({...s,active:!1,options:s.options.map(l=>{let d={...l,active:!1};return s.type==="money"?(d.value="0.00",d.value2="0.00"):s.type==="date"?(d.value=P().subtract(7,"day").format("YYYY-MM-DD"),d.value2=P().add(7,"day").format("YYYY-MM-DD")):(["text","number","uuid"].includes(s.type)||s.target==="country"||s.type==="select")&&(d.value="",d.value2=""),d})})),this.originalFilters=E(this.localFilters),this.applyFilterExpressions()}catch(o){const g=((e=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Something went wrong while fetching the filter options";this.notificationState.showWarningNotification(g),console.error("Failed to fetch filter options:",o)}finally{this.isLoadingFilters=!1}}},mounted(){this.filterDrawer=this.$refs.filterDrawer,this.hasFilterExpressions&&this.getFilters()}},be={class:"flex items-center space-x-2 bg-gray-100 border-b border-gray-300 shadow-sm p-4"},xe={key:0,class:"flex justify-center my-8"},Se={key:1,class:"divide-y mb-4"},_e={key:0},ke=["onClick"],De={class:"flex items-center space-x-2"},Fe={key:0,class:"text-sm p-4"},Ve={key:0,class:"my-4"},Ce={key:0,class:"space-y-4"},Ee={key:1,class:"space-y-4"},Ae={key:2,class:"space-y-4"},Ie={key:3,class:"space-y-4"},Ue={key:4,class:"space-y-4"},Me={key:5,class:"space-y-4"},Le={key:6,class:"space-y-4"},Oe={key:2,class:"flex flex-col items-center px-4 space-y-8 mb-60"};function Pe(t,e,o,g,s,l){const d=c("Button"),p=c("Funnel"),y=c("Loader"),V=c("Pill"),C=c("ChevronUp"),v=c("ChevronDown"),x=c("Input"),D=c("Datepicker"),S=c("SelectCountry"),_=c("Select"),A=c("Drawer");return r(),n("div",null,[u(d,{size:"xs",type:"bare",leftIcon:s.Funnel,action:l.openFilterDrawer},null,8,["leftIcon","action"]),u(A,{placement:"right",ref:"filterDrawer",showFooter:!1,scrollOnContent:!1},{content:k(()=>[i("div",be,[u(p,{size:"20"}),e[14]||(e[14]=i("h2",null,"Filters",-1))]),e[16]||(e[16]=i("p",{class:"p-4 text-sm bg-indigo-100"}," Find exactly what you need by applying filters to your data ",-1)),s.isLoadingFilters?(r(),n("div",xe,[u(y)])):(r(),n("div",Se,[(r(!0),n(U,null,L(s.localFilters,(w,O)=>(r(),n(U,{key:O},[s.showMore||w.priority?(r(),n("div",_e,[i("div",{onClick:a=>l.toggleFilterVisibility(O),class:"text-sm p-4 bg-gray-50 hover:bg-gray-100 cursor-pointer flex items-center justify-between"},[i("span",null,F(w.label),1),i("div",De,[l.countActiveOptions(w)?(r(),f(V,{key:0,type:"primary",size:"xs",class:"flex-shrink-0"},{default:k(()=>[M(F(l.countActiveOptions(w)),1)]),_:2},1024)):h("",!0),w.active?(r(),f(C,{key:1,size:"16"})):(r(),f(v,{key:2,size:"16"}))])],8,ke),w.active?(r(),n("div",Fe,[(r(!0),n(U,null,L(w.options,(a,te)=>(r(),n("div",{key:te},[u(x,{onClick:e[0]||(e[0]=b(()=>{},["stop"])),type:"checkbox",modelValue:a.active,"onUpdate:modelValue":m=>a.active=m,inputLabel:a.label},null,8,["modelValue","onUpdate:modelValue","inputLabel"]),a.active?(r(),n("div",Ve,[w.type==="date"?(r(),n("div",Ce,[u(D,{onClick:e[1]||(e[1]=b(()=>{},["stop"])),modelValue:a.value,"onUpdate:modelValue":m=>a.value=m},null,8,["modelValue","onUpdate:modelValue"]),["bt","bt_ex"].includes(a.operator)?(r(),f(D,{key:0,onClick:e[2]||(e[2]=b(()=>{},["stop"])),modelValue:a.value2,"onUpdate:modelValue":m=>a.value2=m},null,8,["modelValue","onUpdate:modelValue"])):h("",!0)])):w.type==="money"?(r(),n("div",Ee,[u(x,{type:"money",onClick:e[3]||(e[3]=b(()=>{},["stop"])),modelValue:a.value,"onUpdate:modelValue":m=>a.value=m},null,8,["modelValue","onUpdate:modelValue"]),["bt","bt_ex"].includes(a.operator)?(r(),f(x,{key:0,type:"money",onClick:e[4]||(e[4]=b(()=>{},["stop"])),modelValue:a.value2,"onUpdate:modelValue":m=>a.value2=m},null,8,["modelValue","onUpdate:modelValue"])):h("",!0)])):w.target==="country"?(r(),n("div",Ae,[u(S,{onClick:e[5]||(e[5]=b(()=>{},["stop"])),modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,placeholder:"Select country"},null,8,["modelValue","onUpdate:modelValue"]),["in","not_in"].includes(a.operator)?(r(),f(x,{key:0,type:"text",onClick:e[6]||(e[6]=b(()=>{},["stop"])),modelValue:a.value2,"onUpdate:modelValue":m=>a.value2=m,placeholder:"Enter comma-separated country codes"},null,8,["modelValue","onUpdate:modelValue"])):h("",!0)])):w.type==="text"?(r(),n("div",Ie,[u(x,{type:"text",onClick:e[7]||(e[7]=b(()=>{},["stop"])),modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,placeholder:"Enter value"},null,8,["modelValue","onUpdate:modelValue"])])):w.type==="number"?(r(),n("div",Ue,[u(x,{type:"number",onClick:e[8]||(e[8]=b(()=>{},["stop"])),modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,placeholder:"Enter number"},null,8,["modelValue","onUpdate:modelValue"]),["bt","bt_ex"].includes(a.operator)?(r(),f(x,{key:0,type:"number",onClick:e[9]||(e[9]=b(()=>{},["stop"])),modelValue:a.value2,"onUpdate:modelValue":m=>a.value2=m,placeholder:"Enter number"},null,8,["modelValue","onUpdate:modelValue"])):h("",!0)])):w.type==="uuid"?(r(),n("div",Me,[u(x,{type:"text",onClick:e[10]||(e[10]=b(()=>{},["stop"])),modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,placeholder:"Enter UUID"},null,8,["modelValue","onUpdate:modelValue"]),["in","not_in"].includes(a.operator)?(r(),f(x,{key:0,type:"text",onClick:e[11]||(e[11]=b(()=>{},["stop"])),modelValue:a.value2,"onUpdate:modelValue":m=>a.value2=m,placeholder:"Enter comma-separated UUIDs"},null,8,["modelValue","onUpdate:modelValue"])):h("",!0)])):w.type==="select"?(r(),n("div",Le,[u(_,{onClick:e[12]||(e[12]=b(()=>{},["stop"])),modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,options:w.options,placeholder:"Select value"},null,8,["modelValue","onUpdate:modelValue","options"]),["in","not_in"].includes(a.operator)?(r(),f(x,{key:0,type:"text",onClick:e[13]||(e[13]=b(()=>{},["stop"])),modelValue:a.value2,"onUpdate:modelValue":m=>a.value2=m,placeholder:"Enter comma-separated values"},null,8,["modelValue","onUpdate:modelValue"])):h("",!0)])):h("",!0)])):h("",!0)]))),128))])):h("",!0)])):h("",!0)],64))),128))])),s.isLoadingFilters?h("",!0):(r(),n("div",Oe,[l.hasPriorityFilters&&l.hasNonPriorityFilters?(r(),f(d,{key:0,size:"xs",type:"outline",action:l.showMoreOrLess,leftIcon:s.showMore?s.ArrowUp:s.ArrowDown},{default:k(()=>[i("span",null,F(s.showMore?"show less options":"show more options"),1)]),_:1},8,["action","leftIcon"])):h("",!0),l.totalActiveFilters?(r(),f(d,{key:1,size:"sm",type:"light",buttonClass:"w-full",action:l.clearFilters},{default:k(()=>e[15]||(e[15]=[i("span",null,"Clear Filters",-1)])),_:1,__:[15]},8,["action"])):h("",!0)]))]),_:1},512)])}const Te=z(we,[["render",Pe]]),ze={inject:["formState"],components:{Move:Z,Logs:X,draggable:Q,Input:H,Pill:j,Button:T,Drawer:Y,Switch:ue},props:{columns:{type:Array,default:()=>[]}},emits:["updatedColumns"],data(){return{Logs:X,showMore:!1,columnsDrawer:null,showEverything:!1,localColumns:E(this.columns),originalColumns:E(this.columns)}},watch:{localColumns:{handler(t){this.showEverything!=this.isShowingEverything&&(this.showEverything=this.isShowingEverything),this.$emit("updatedColumns",t)},deep:!0},showEverything(t){t?this.localColumns.map(e=>e.active=!0):this.isShowingEverything&&this.localColumns.map(e=>e.active=e.priority)}},computed:{isShowingEverything(){return this.localColumns.filter(t=>t.active==!0).length==this.localColumns.length}},methods:{openColumnsDrawer(){this.columnsDrawer.showDrawer()},closeColumnsDrawer(){this.columnsDrawer.hideDrawer()},resetColumns(){this.localColumns=E(this.originalColumns)}},mounted(){this.columnsDrawer=this.$refs.columnsDrawer}},Be={class:"flex items-center space-x-2 bg-gray-100 border-b border-gray-300 shadow-sm p-4"},je={class:"p-4 border-b shadow-sm"},He={class:"divide-y mb-4"},Ne={class:"px-4 mb-60"};function Ye(t,e,o,g,s,l){const d=c("Button"),p=c("Logs"),y=c("Switch"),V=c("Input"),C=c("Move"),v=c("draggable"),x=c("Drawer");return r(),n("div",null,[u(d,{size:"xs",type:"bare",leftIcon:s.Logs,action:l.openColumnsDrawer},null,8,["leftIcon","action"]),u(x,{placement:"right",ref:"columnsDrawer",showFooter:!1,scrollOnContent:!1},{content:k(()=>[i("div",Be,[u(p,{size:"20"}),e[4]||(e[4]=i("h2",null,"Columns",-1))]),e[6]||(e[6]=i("p",{class:"p-4 text-sm bg-indigo-100"}," Show, hide and move your data they way you want to see it ",-1)),i("div",je,[u(y,{size:"sm",modelValue:s.showEverything,"onUpdate:modelValue":e[0]||(e[0]=D=>s.showEverything=D),suffixText:"Show Everything"},null,8,["modelValue"])]),i("div",He,[u(v,{class:"divide-y mb-4",modelValue:s.localColumns,"onUpdate:modelValue":e[3]||(e[3]=D=>s.localColumns=D),handle:".draggable-handle","ghost-class":"bg-yellow-50"},{default:k(()=>[(r(!0),n(U,null,L(s.localColumns,(D,S)=>(r(),n("div",{key:S,class:"flex items-center justify-between p-4"},[u(V,{onClick:e[1]||(e[1]=b(()=>{},["stop"])),type:"checkbox",modelValue:D.active,"onUpdate:modelValue":_=>D.active=_,inputLabel:D.name},null,8,["modelValue","onUpdate:modelValue","inputLabel"]),u(C,{onClick:e[2]||(e[2]=b(()=>{},["stop"])),size:"16",class:"draggable-handle cursor-grab active:cursor-grabbing text-gray-500 hover:text-yellow-500"})]))),128))]),_:1},8,["modelValue"])]),i("div",Ne,[u(d,{size:"sm",type:"light",buttonClass:"w-full",action:l.resetColumns},{default:k(()=>e[5]||(e[5]=[i("span",null,"Reset Columns",-1)])),_:1,__:[5]},8,["action"])])]),_:1},512)])}const qe=z(ze,[["render",Ye]]),Re={inject:["notificationState"],components:{Move:Z,draggable:Q,Pill:j,Input:H,Button:T,Drawer:Y,Loader:N,ArrowDownWideNarrow:R},props:{sortingExpressions:{type:Array,default:()=>[]},resource:{type:String}},emits:["updatedSorting"],data(){return{ArrowUp:ee,ArrowDown:$,showMore:!1,sortDrawer:null,localSorting:null,ArrowDownWideNarrow:R,originalSorting:null,isLoadingSorting:!1,lastEmittedSorting:null}},watch:{localSorting:{handler(t){this.createSortingExpressions()},deep:!0}},computed:{hasSortingExpressions(){return this.sortingExpressions.length>0},totalActiveSortOptions(){return this.localSorting==null?0:this.localSorting.filter(t=>t.options.some(e=>e.active)).length},hasPrioritySortOptions(){return this.localSorting==null?!1:this.localSorting.filter(t=>t.priority).length>0},hasNonPrioritySortOptions(){return this.localSorting==null?!1:this.localSorting.filter(t=>!t.priority).length>0}},methods:{toggleSortOption(t,e){this.localSorting[t].options.forEach((o,g)=>{g!==e&&(o.active=!1)})},countActiveOptions(t){return t.options.filter(e=>e.active).length},createSortingExpressions(){let t=[];for(let e=0;e<this.localSorting.length;e++){const o=this.localSorting[e];if(o.options.some(s=>s.active)){const l=o.options.filter(y=>y.active)[0],d=`${o.label} (${l.label})`,p=`${o.target}:${l.value}`;t.push({label:d,sortIndex:e,expression:p})}}this.sortingHasChanged(t,this.lastEmittedSorting)&&(this.$emit("updatedSorting",t),this.lastEmittedSorting=E(t))},applySortingExpressions(){this.sortingExpressions.forEach(t=>{const e=t.split(":"),o=e[0],g=e[1],s=this.localSorting.find(l=>l.target===o);s&&s.options.forEach(l=>{l.value==g&&(l.active=!0)})})},sortingHasChanged(t,e){var o=E(t),g=E(e);return!K(o,g)},openSortDrawer(){this.localSorting==null&&this.getSorting(),this.sortDrawer.showDrawer()},closeSortDrawer(){this.sortDrawer.hideDrawer()},toggleSortingVisibility(t){this.localSorting[t].active||this.localSorting.forEach((e,o)=>{this.localSorting[o].active=!1}),this.localSorting[t].active=!this.localSorting[t].active},showMoreOrLess(){this.showMore=!this.showMore},removeAppliedSort(t){this.localSorting[t.sortIndex].options.forEach(e=>{e.active=!1})},clearSorting(){this.localSorting=E(this.originalSorting)},async getSorting(){var t,e;try{if(this.isLoadingSorting)return;this.isLoadingSorting=!0;const o={params:{type:this.resource}},g=await axios.get("/api/sorting",o);this.localSorting=g.data.map(s=>({...s,active:!1,options:s.options.map(l=>({...l,active:!1}))})),this.originalSorting=E(this.localSorting),this.applySortingExpressions()}catch(o){const g=((e=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Something went wrong while fetching the sorting options";this.notificationState.showWarningNotification(g),console.error("Failed to fetch sorting options:",o)}finally{this.isLoadingSorting=!1}}},mounted(){this.sortDrawer=this.$refs.sortDrawer,this.hasSortingExpressions&&this.getSorting()}},We={class:"flex items-center space-x-2 bg-gray-100 border-b border-gray-300 shadow-sm p-4"},Xe={key:0,class:"flex justify-center my-8"},Ge={key:0},Je=["onClick"],Ke={class:"flex items-center space-x-2"},Qe={key:2,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},Ze={key:3,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},$e={key:0,class:"text-sm p-4"},et={key:2,class:"flex flex-col items-center px-4 space-y-8 mb-60"};function tt(t,e,o,g,s,l){const d=c("Button"),p=c("ArrowDownWideNarrow"),y=c("Loader"),V=c("Pill"),C=c("Move"),v=c("Input"),x=c("draggable"),D=c("Drawer");return r(),n("div",null,[u(d,{size:"xs",type:"bare",action:l.openSortDrawer,leftIcon:s.ArrowDownWideNarrow},null,8,["action","leftIcon"]),u(D,{ref:"sortDrawer",placement:"right",showFooter:!1,scrollOnContent:!1},{content:k(()=>[i("div",We,[u(p,{size:"20"}),e[2]||(e[2]=i("h2",null,"Sorting",-1))]),e[6]||(e[6]=i("p",{class:"p-4 text-sm bg-indigo-100"}," When using two or more sorting options, you can rearrange their order to prioritize which criteria are applied first. ",-1)),s.isLoadingSorting?(r(),n("div",Xe,[u(y)])):(r(),f(x,{key:1,modelValue:s.localSorting,"onUpdate:modelValue":e[1]||(e[1]=S=>s.localSorting=S),class:"divide-y mb-4",handle:".draggable-handle","ghost-class":"bg-yellow-50"},{default:k(()=>[(r(!0),n(U,null,L(s.localSorting,(S,_)=>(r(),n(U,{key:_},[s.showMore||S.priority?(r(),n("div",Ge,[i("div",{onClick:A=>l.toggleSortingVisibility(_),class:"text-sm p-4 bg-gray-50 hover:bg-gray-100 cursor-pointer flex items-center justify-between"},[i("span",null,F(S.label),1),i("div",Ke,[l.countActiveOptions(S)?(r(),f(V,{key:0,type:"primary",size:"xs",class:"flex-shrink-0"},{default:k(()=>[M(F(l.countActiveOptions(S)),1)]),_:2},1024)):h("",!0),l.countActiveOptions(S)?(r(),f(C,{key:1,onClick:e[0]||(e[0]=b(()=>{},["stop"])),size:"16",class:"draggable-handle cursor-grab active:cursor-grabbing text-gray-500 hover:text-yellow-500"})):h("",!0),S.active?(r(),n("svg",Qe,e[3]||(e[3]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"},null,-1)]))):(r(),n("svg",Ze,e[4]||(e[4]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"},null,-1)])))])],8,Je),S.active?(r(),n("div",$e,[(r(!0),n(U,null,L(S.options,(A,w)=>(r(),n("div",{key:w},[u(v,{type:"checkbox",modelValue:A.active,"onUpdate:modelValue":O=>A.active=O,inputLabel:A.label,onClick:b(()=>l.toggleSortOption(_,w),["stop"])},null,8,["modelValue","onUpdate:modelValue","inputLabel","onClick"])]))),128))])):h("",!0)])):h("",!0)],64))),128))]),_:1},8,["modelValue"])),s.isLoadingSorting?h("",!0):(r(),n("div",et,[l.hasPrioritySortOptions&&l.hasNonPrioritySortOptions?(r(),f(d,{key:0,size:"xs",type:"outline",action:l.showMoreOrLess,leftIcon:s.showMore?s.ArrowUp:s.ArrowDown},{default:k(()=>[i("span",null,F(s.showMore?"show less options":"show more options"),1)]),_:1},8,["action","leftIcon"])):h("",!0),l.totalActiveSortOptions?(r(),f(d,{key:1,size:"sm",type:"light",buttonClass:"w-full",action:l.clearSorting},{default:k(()=>e[5]||(e[5]=[i("span",null,"Clear Sorting",-1)])),_:1,__:[5]},8,["action"])):h("",!0)]))]),_:1},512)])}const ot=z(Re,[["render",tt]]),lt={components:{Pill:j,Button:T,Input:H,Select:G,Paginator:se,Loader:N,FilterDrawer:Te,ColumnsDrawer:qe,SortingDrawer:ot},props:{isLoading:{type:Boolean,default:!1},searchTerm:{type:String,default:null},searchPlaceholder:{type:String,default:null},pagination:{type:Object},perPage:{type:String,default:"15"},resource:{type:String},columns:{type:Array,default:()=>[]},filterExpressions:{type:Array,default:()=>[]},sortingExpressions:{type:Array,default:()=>[]}},emits:["search","refresh","paginate","updatedColumns","updatedFilters","updatedSorting","updatedPerPage"],data(){return{RotateCcw:ce,modal:null,filters:[],sorting:[],filterDrawer:null,isSearching:!1,sortingDrawer:null,totalTableHeaders:0,localPerPage:this.perPage,localIsLoading:this.isLoading,localSearchTerm:this.searchTerm,uniqueModalId:J("modal")}},watch:{isLoading(t){this.localIsLoading=t,this.isSearching=t&&this.hasSearchTerm},localSearchTerm(t){this.$emit("search",t)},localPerPage(t){this.$emit("updatedPerPage",t)},pagination(t){t&&this.$nextTick(()=>{this.filterDrawer=this.$refs.filterDrawer,this.sortingDrawer=this.$refs.sortingDrawer})},columns:{handler(){this.$nextTick(()=>{this.totalTableHeaders=this.$refs.tablehead.querySelectorAll("th").length})},deep:!0}},computed:{hasSearchTerm(){return this.localSearchTerm!=null&&this.localSearchTerm.trim()!=""},hasFilters(){return this.filters.length>0},hasSorting(){return this.sorting.length>0},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},perPageOptions(){return["15","50","100","200"].map(t=>({label:`${t} per page`,value:t}))}},methods:{refresh(){this.localIsLoading||this.$emit("refresh")},paginate(t){this.$emit("paginate",t)},updatedColumns(t){this.$emit("updatedColumns",t)},updatedFilters(t){this.filters=t,this.$emit("updatedFilters",t)},updatedSorting(t){this.sorting=t,this.$emit("updatedSorting",t)},removeAppliedFilter(t){this.filterDrawer.removeAppliedFilter(t)},removeAppliedSort(t){this.sortingDrawer.removeAppliedSort(t)},onInputSearchTerm(t){t.target.value.length?this.isSearching=!0:this.isSearching=!1,this.localIsLoading=!0}},mounted(){this.totalTableHeaders=this.$refs.tablehead.querySelectorAll("th").length}},st={class:"flex justify-between items-center space-x-4 mb-4"},rt={key:0,class:"flex justify-center items-center space-x-4"},nt={key:0},it={key:1},at={key:0,class:"flex flex-col items-center mb-4"},ut={class:"flex items-center space-x-2"},ct={key:1,class:"flex flex-col items-center mb-4"},dt={class:"flex items-center space-x-2"},ht={key:2,class:"flex flex-wrap gap-2 mb-4"},pt={class:"relative w-full overflow-x-auto border border-blue-200 rounded-lg"},mt={key:0,class:"absolute top-0 bottom-0 left-0 right-0 bg-white/50 flex justify-center items-center"},gt={class:"w-full text-left rtl:text-right"},ft={class:"text-sm bg-blue-50",ref:"tablehead"},yt={key:0},vt={key:2},wt={key:2,class:"text-sm text-gray-700 text-center py-16 bg-blue-50 border-t border-blue-200"},bt={key:0,class:"flex items-center justify-center space-x-2"},xt={class:"text-sm text-gray-500"},St={key:1},_t={key:0,class:"flex justify-between items-center mt-4"},kt={class:"text-sm font-normal text-gray-500 dark:text-gray-400"},Dt={class:"font-semibold text-gray-900 dark:text-white"},Ft={class:"font-semibold text-gray-900 dark:text-white"},Vt={class:"flex items-center space-x-4"};function Ct(t,e,o,g,s,l){const d=c("Input"),p=c("FilterDrawer"),y=c("SortingDrawer"),V=c("ColumnsDrawer"),C=c("Button"),v=c("Loader"),x=c("Pill"),D=c("Select"),S=c("Paginator");return r(),n("div",null,[I(t.$slots,"header"),i("div",st,[u(d,{type:"search",class:"w-full",debounced:!0,modelValue:s.localSearchTerm,"onUpdate:modelValue":e[0]||(e[0]=_=>s.localSearchTerm=_),onInput:l.onInputSearchTerm,placeholder:o.searchPlaceholder},null,8,["modelValue","onInput","placeholder"]),o.pagination?(r(),n("div",rt,[u(p,{ref:"filterDrawer",resource:o.resource,filterExpressions:o.filterExpressions,onUpdatedFilters:l.updatedFilters},null,8,["resource","filterExpressions","onUpdatedFilters"]),u(y,{ref:"sortingDrawer",resource:o.resource,sortingExpressions:o.sortingExpressions,onUpdatedSorting:l.updatedSorting},null,8,["resource","sortingExpressions","onUpdatedSorting"]),u(V,{ref:"columnsDrawer",columns:o.columns,onUpdatedColumns:l.updatedColumns},null,8,["columns","onUpdatedColumns"]),t.$slots.beforeRefreshButton?(r(),n("div",nt,[I(t.$slots,"beforeRefreshButton")])):h("",!0),u(C,{action:l.refresh,type:"bare",size:"xs",leftIcon:s.RotateCcw},null,8,["action","leftIcon"]),t.$slots.afterRefreshButton?(r(),n("div",it,[I(t.$slots,"afterRefreshButton")])):h("",!0)])):h("",!0)]),u(le,{name:"fade-1",mode:"out-in"},{default:k(()=>[l.hasFilterExpressions&&!l.hasFilters?(r(),n("div",at,[i("div",ut,[u(v),e[2]||(e[2]=i("span",{class:"text-sm text-gray-500"},"Preparing filters",-1))])])):l.hasSortingExpressions&&!l.hasSorting?(r(),n("div",ct,[i("div",dt,[u(v),e[3]||(e[3]=i("span",{class:"text-sm text-gray-500"},"Preparing sorting",-1))])])):l.hasFilters||l.hasSorting?(r(),n("div",ht,[(r(!0),n(U,null,L(s.filters,(_,A)=>(r(),f(x,{key:A,type:"primary",size:"xs",closableAction:()=>l.removeAppliedFilter(_)},{default:k(()=>[M(F(_.label),1)]),_:2},1032,["closableAction"]))),128)),(r(!0),n(U,null,L(s.sorting,(_,A)=>(r(),f(x,{key:A,type:"success",size:"xs",closableAction:()=>l.removeAppliedSort(_)},{default:k(()=>[M(F(_.label),1)]),_:2},1032,["closableAction"]))),128))])):h("",!0)]),_:1}),I(t.$slots,"belowToolbar"),i("div",pt,[o.pagination&&o.pagination.meta.total>0&&(s.localIsLoading||s.isSearching)?(r(),n("div",mt,[u(v)])):h("",!0),i("table",gt,[i("thead",ft,[I(t.$slots,"head")],512),!o.pagination&&s.localIsLoading&&s.totalTableHeaders>0?(r(),n("tbody",yt,[(r(),n(U,null,L([1,2,3],(_,A)=>i("tr",{key:A,class:"animate-pulse"},[(r(!0),n(U,null,L(s.totalTableHeaders,(w,O)=>(r(),n("td",{key:O},e[4]||(e[4]=[i("div",{class:"h-2 bg-blue-200 rounded-full mx-4 my-4"},null,-1)])))),128))])),64))])):t.$slots.tbody?I(t.$slots,"tbody",{key:1}):(r(),n("tbody",vt,[I(t.$slots,"body")]))]),t.$slots.noResults&&!s.localIsLoading&&o.pagination&&o.pagination.meta.total==0&&!l.hasSearchTerm?I(t.$slots,"noResults",{key:1}):o.pagination&&o.pagination.meta.total==0?(r(),n("div",wt,[s.localIsLoading||s.isSearching?(r(),n("div",bt,[u(v),i("span",xt,F(s.isSearching?"Searching":"Loading"),1)])):(r(),n("span",St,"No results found"))])):h("",!0)]),o.pagination&&o.pagination.meta.total>0?(r(),n("div",_t,[i("span",kt,[e[5]||(e[5]=M("Showing ")),i("span",Dt,F(o.pagination.meta.from)+"-"+F(o.pagination.meta.to),1),e[6]||(e[6]=M(" of ")),i("span",Ft,F(o.pagination.meta.total),1)]),i("div",Vt,[u(D,{class:"w-40",search:!1,modelValue:s.localPerPage,"onUpdate:modelValue":e[1]||(e[1]=_=>s.localPerPage=_),options:l.perPageOptions},null,8,["modelValue","options"]),o.pagination?(r(),f(S,{key:0,pagination:o.pagination,onPaginate:l.paginate},null,8,["pagination","onPaginate"])):h("",!0)])])):h("",!0)])}const Xt=z(lt,[["render",Ct]]);export{Xt as T};
