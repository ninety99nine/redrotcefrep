import{P as R}from"./Pill-DEVX10W2.js";import{A as H}from"./Alert-LkkaFZeO.js";import{I}from"./Input-DQaGChU5.js";import{M as N}from"./Modal-C-GRW1OC.js";import{c as b,b as i,e as h,a as l,g as p,F as V,d as g,t as u,k as P,i as c,H as C,r as n,o as d}from"./app-CzVSkBab.js";import{B as U}from"./Button-DUZYr7K5.js";import{L as q}from"./Loader-Bgtn0B02.js";import{S as O}from"./Select-B8ZGKCOx.js";import{P as j}from"./Popover-BGU_kWIn.js";import{i as D}from"./stringUtils-Bvzw0-oW.js";import{S as W}from"./Skeleton-l29zb6aX.js";import{B as z}from"./BackdropLoader-CK4TPjhE.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as Y}from"./move-left-AZNGtGHt.js";import{T as G}from"./trash-2-n_1HHVAw.js";import"./Tooltip-nJZxzEfJ.js";import"./createLucideIcon-WossyTSX.js";import"./circle-check-taEu8iWA.js";import"./info-BfeIira8.js";import"./Copy-BUwnGB5M.js";import"./ShineEffect-CBOqjs08.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-BBBhZ936.js";import"./circle-alert-CJwodHer.js";import"./x-1vCauBqQ.js";import"./parsePhoneNumber-xMTQFMCS.js";const K={inject:["formState","storeState","teamMemberState","changeHistoryState","notificationState"],components:{Pill:R,Alert:H,Input:I,Modal:N,Button:U,Loader:q,Select:O,Popover:j,Skeleton:W,BackdropLoader:z},data(){return{Trash2:G,MoveLeft:Y,roles:[]}},watch:{store(s,e){!e&&s&&this.setup()},"$route.params.team_member_id"(s){s&&(this.setup(),this.setActionButtons())}},computed:{store(){return this.storeState.store},teamMember(){return this.teamMemberState.teamMember},hasTeamMember(){return this.teamMemberState.hasTeamMember},teamMemberId(){return this.$route.params.team_member_id},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingTeamMember(){return this.teamMemberState.isLoadingTeamMember},isEditing(){return this.$route.name==="edit-team-member"},isAdding(){return this.$route.name==="add-team-member"},teamMemberForm(){return this.teamMemberState.teamMemberForm},isSubmitting(){return this.changeHistoryState.actionButtons.length==0?!1:this.changeHistoryState.actionButtons[1].loading},isRemovingTeamMember(){return this.teamMemberState.isRemovingTeamMember},hasRoles(){return this.roles.length>0},roleOptions(){return this.roles.map(s=>({value:s.id,label:s.name}))}},methods:{isEmpty:D,goBack(){this.navigateToTeamMembers()},async setup(){this.teamMemberForm==null&&this.teamMemberState.setTeamMemberForm(null,this.isAdding),this.store&&(this.showRoles(),this.isEditing&&await this.showTeamMember())},async navigateToTeamMembers(){await this.$router.replace({name:"show-team-members",query:{store_id:this.store.id,searchTerm:this.$route.query.searchTerm,filterExpressions:this.$route.query.filterExpressions,sortingExpressions:this.$route.query.sortingExpressions}})},async showTeamMember(){var s,e,t;try{this.teamMemberState.isLoadingTeamMember=!0;let r={params:{store_id:this.store.id,_relationships:["user","role"].join(",")}};const a=(await axios.get(`/api/team-members/${this.teamMemberId}`,r)).data;this.teamMemberState.setTeamMember(a),this.teamMemberState.setTeamMemberForm(a)}catch(r){const o=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Something went wrong while fetching team member";this.notificationState.showWarningNotification(o),this.formState.setServerFormErrors(r),console.error("Failed to fetch team member:",r),((t=r.response)==null?void 0:t.status)===404&&await this.navigateToTeamMembers()}finally{this.teamMemberState.isLoadingTeamMember=!1}},async addTeamMember(){var s,e;try{if(this.teamMemberState.isAddingTeamMember||this.teamMemberState.isUploading||(this.formState.hideFormErrors(),this.isEmpty(this.teamMemberForm.email)&&this.formState.setFormError("email","The email is required"),this.isEmpty(this.teamMemberForm.role_id)&&this.formState.setFormError("role_id","The role is required"),this.formState.hasErrors))return;this.teamMemberState.isAddingTeamMember=!0,this.changeHistoryState.actionButtons[1].loading=!0;const t={...this.getPayload(),store_id:this.store.id},o=(await axios.post("/api/team-members",t)).data.team_member;this.teamMemberForm.id=o.id,this.storeState.silentUpdate(),this.notificationState.showSuccessNotification("Invitation sent"),this.teamMemberState.saveOriginalState("Original team member"),await this.navigateToTeamMembers(o)}catch(t){const r=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Something went wrong while adding team member";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(t),console.error("Failed to add team member:",t)}finally{this.teamMemberState.isAddingTeamMember=!1,this.changeHistoryState.actionButtons[1].loading=!1}},async updateTeamMember(){var s,e;try{if(this.teamMemberState.isUpdatingTeamMember||(this.formState.hideFormErrors(),this.isEmpty(this.teamMemberForm.email)&&this.formState.setFormError("email","The email is required"),this.isEmpty(this.teamMemberForm.role_id)&&this.formState.setFormError("role_id","The role is required"),this.formState.hasErrors))return;this.teamMemberState.isUpdatingTeamMember=!0,this.changeHistoryState.actionButtons[1].loading=!0;const t={...this.getPayload(),store_id:this.store.id};await axios.put(`/api/team-members/${this.teamMemberForm.id}`,t),this.storeState.silentUpdate(),this.notificationState.showSuccessNotification("Team member updated"),this.teamMemberState.saveOriginalState("Original team member")}catch(t){const r=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Something went wrong while updating team member";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(t),console.error("Failed to update team member:",t)}finally{this.teamMemberState.isUpdatingTeamMember=!1,this.changeHistoryState.actionButtons[1].loading=!1}},async removeTeamMember(s){var e,t;try{if(this.teamMemberState.isRemovingTeamMember)return;this.teamMemberState.isRemovingTeamMember=!0;const r={data:{store_id:this.store.id}};await axios.delete(`/api/team-members/${this.teamMember.id}`,r),this.storeState.silentUpdate(),this.notificationState.showSuccessNotification("Team member removed"),s(),await new Promise(o=>setTimeout(o,500)),await this.navigateToTeamMembers()}catch(r){const o=((t=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while removing team member";this.notificationState.showWarningNotification(o),this.formState.setServerFormErrors(r),console.error("Failed to remove team member:",r),s()}finally{this.teamMemberState.isRemovingTeamMember=!1}},async showRoles(){var s,e;try{this.isLoadingRoles=!0;let t={params:{per_page:100,store_id:this.store.id}};const r=await axios.get("/api/roles",t);this.pagination=r.data,this.roles=this.pagination.data}catch(t){const r=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Something went wrong while fetching roles";this.notificationState.showWarningNotification(r),this.formState.setServerFormErrors(t),console.error("Failed to fetch roles:",t)}finally{this.isLoadingRoles=!1}},getPayload(){return C(this.teamMemberForm)},setActionButtons(){(this.isAdding||this.isEditing)&&(this.changeHistoryState.removeButtons(),this.changeHistoryState.addDiscardButton(),this.changeHistoryState.addActionButton(this.isEditing?"Save Changes":"Add Team Member",this.isEditing?this.updateTeamMember:this.addTeamMember,"primary",null))},setTeamMemberForm(s){this.teamMemberState.teamMemberForm=s}},beforeRouteLeave(s,e,t){if(this.changeHistoryState.hasChangeHistory&&!window.confirm("You have unsaved changes. Are you sure you want to leave?"))return t(!1);t()},unmounted(){this.teamMemberState.reset()},created(){this.setup(),this.setActionButtons();const s=["undo","redo","jumpToHistory","resetHistoryToCurrent","resetHistoryToOriginal"];for(let e=0;e<s.length;e++){let t=s[e];this.changeHistoryState.listeners[t]=this.setTeamMemberForm}}},Q={class:"pt-24 px-4"},X={class:"grid grid-cols-12 gap-4 mb-4"},Z={class:"col-span-8 col-start-3"},$={class:"select-none bg-white rounded-lg p-4 mb-4"},ee={class:"flex items-center space-x-4"},te={key:0,class:"flex items-center space-x-2"},ae={class:"flex items-center space-x-1"},re={class:"text-lg text-gray-700 font-semibold"},se={class:"relative mb-8"},ie={class:"bg-white rounded-lg space-y-4 p-4"},oe={class:"space-y-2"},me={class:"font-bold text-black"},ne={class:"flex justify-end"},de={class:"mb-8"},le={class:"font-bold text-black"};function he(s,e,t,r,o,a){var S,T,y,v,w,_;const F=n("Button"),f=n("Skeleton"),x=n("Popover"),E=n("Pill"),L=n("BackdropLoader"),M=n("Input"),B=n("Select"),k=n("Alert"),A=n("Modal");return d(),b("div",Q,[i("div",X,[i("div",Z,[i("div",$,[i("div",ee,[l(F,{size:"xs",type:"light",action:a.goBack,leftIcon:o.MoveLeft},{default:p(()=>[...e[6]||(e[6]=[i("span",null,"Back",-1)])]),_:1},8,["action","leftIcon"]),a.isLoadingStore||a.isLoadingTeamMember||a.isEditing&&!a.hasTeamMember?(d(),b("div",te,[l(f,{width:"w-40"}),l(f,{width:"w-4"})])):(d(),b(V,{key:1},[i("div",ae,[i("h1",re,u(a.isAdding?"Add Team Member":(S=a.teamMemberForm)==null?void 0:S.first_name),1),l(x,{content:"Team members are users assigned to manage your store with specific roles.",placement:"top"})]),(T=a.teamMember)!=null&&T.creator?(d(),g(E,{key:0,type:"success",size:"xs",class:"ml-1"},{default:p(()=>[...e[7]||(e[7]=[c("creator",-1)])]),_:1})):h("",!0)],64))])]),i("div",se,[a.isLoadingTeamMember||a.isSubmitting?(d(),g(L,{key:0,showSpinningLoader:!1,class:"rounded-lg"})):h("",!0),i("div",ie,[l(M,{type:"text",label:"First Name",placeholder:"John",secondaryLabel:"(optional)",modelValue:a.teamMemberForm.first_name,"onUpdate:modelValue":e[0]||(e[0]=m=>a.teamMemberForm.first_name=m),errorText:a.formState.getFormError("first_name"),onInput:e[1]||(e[1]=m=>a.teamMemberState.saveStateDebounced("First name changed"))},null,8,["modelValue","errorText"]),l(M,{type:"email",label:"Email",placeholder:"john@store.com",modelValue:a.teamMemberForm.email,"onUpdate:modelValue":e[2]||(e[2]=m=>a.teamMemberForm.email=m),disabled:(y=a.teamMember)==null?void 0:y.creator,errorText:a.formState.getFormError("email"),tooltipContent:"The email address of the team member",onInput:e[3]||(e[3]=m=>a.teamMemberState.saveStateDebounced("Email changed"))},null,8,["modelValue","disabled","errorText"]),(v=a.teamMember)!=null&&v.creator?h("",!0):(d(),g(B,{key:0,label:"Role",class:"w-full",search:!1,options:a.roleOptions,modelValue:a.teamMemberForm.role_id,"onUpdate:modelValue":e[4]||(e[4]=m=>a.teamMemberForm.role_id=m),errorText:a.formState.getFormError("role_id"),tooltipContent:"Select the role for this team member",onChange:e[5]||(e[5]=m=>a.teamMemberState.saveStateDebounced("Role changed"))},null,8,["options","modelValue","errorText"])),(w=a.teamMember)!=null&&w.creator?(d(),g(k,{key:1,type:"primary",showIcon:!1,dismissable:!1,description:"The creator's role cannot be changed, and the creator cannot be removed from the store."})):h("",!0)])]),a.teamMember&&!a.teamMember.creator?(d(),b("div",{key:0,class:P(["flex items-center justify-between space-x-4 overflow-hidden rounded-lg p-4 border mb-20",a.isLoadingTeamMember?"border-gray-300 bg-gray-50":"border-red-300 bg-red-50"])},[i("div",oe,[i("p",null,[e[8]||(e[8]=c("Remove ",-1)),i("span",me,u((_=a.teamMemberForm)==null?void 0:_.first_name),1),e[9]||(e[9]=c("?",-1))]),e[10]||(e[10]=i("p",{class:"text-sm"},"Once this team member is removed, they will lose access to the store.",-1))]),i("div",ne,[l(A,{triggerType:"danger",approveType:"danger",approveLeftIcon:o.Trash2,triggerText:"Remove Team Member",approveText:"Remove Team Member",approveAction:a.removeTeamMember,triggerLoading:a.isRemovingTeamMember,approveLoading:a.isRemovingTeamMember},{content:p(()=>{var m;return[e[13]||(e[13]=i("p",{class:"text-lg font-bold border-b border-gray-300 border-dashed pb-4 mb-4"},"Confirm Remove",-1)),i("p",de,[e[11]||(e[11]=c("Are you sure you want to permanently remove ",-1)),i("span",le,u((m=a.teamMemberForm)==null?void 0:m.first_name),1),e[12]||(e[12]=c("?",-1))])]}),_:1},8,["approveLeftIcon","approveAction","triggerLoading","approveLoading"])])],2)):h("",!0)])])])}const Ce=J(K,[["render",he]]);export{Ce as default};
