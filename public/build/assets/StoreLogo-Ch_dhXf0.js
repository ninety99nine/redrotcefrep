import{B as w}from"./Button-B134edVj.js";import{c as r,b as n,e as d,F as b,a as P,d as c,k as u,g as m,r as f,o as s,t as k}from"./app-CGNgl8eN.js";import{_ as v}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as U}from"./createLucideIcon-BakIve7O.js";import{P as y}from"./plus-B1hMjDDg.js";import{T as x}from"./trash-2-Bff_GbSw.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=U("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),B={inject:["formState","storeState","notificationState"],components:{Plus:y,RefreshCw:S,Button:w},props:{size:{type:String,default:"w-20 h-20"},store:{type:[Object,null],default:null},showButton:{type:Boolean,default:!0},uploading:{type:Boolean,default:!1},editable:{type:Boolean,default:!0}},emits:["selectedFile"],data(){return{Plus:y,Trash2:x,RefreshCw:S,filePath:null,localDeleting:!1,localUploading:!1}},watch:{localStore(){this.setPath()},"localStore.logo"(t){this.filePath=t==null?void 0:t.path}},computed:{stateStore(){return this.storeState.store},isUploadingAny(){return this.uploading||this.localUploading},localStore(){return this.store?this.store:this.stateStore}},methods:{setPath(){var t;(t=this.localStore)!=null&&t.logo&&(this.filePath=this.localStore.logo.path)},triggerFileUpload(){this.$refs.fileInput.click()},handleFileUpload(t){const o=t.target.files[0];o&&(this.filePath=URL.createObjectURL(o),this.$emit("selectedFile",this.$refs.fileInput.files[0]),this.localStore&&this.uploadStoreLogo())},async uploadStoreLogo(){var t,o;try{if(this.isUploadingAny||this.$refs.fileInput.files.length==0)return;let e=new FormData;e.append("return",1),e.append("mediable_type","store"),e.append("store_id",this.localStore.id),e.append("mediable_id",this.localStore.id),e.append("upload_folder_name","store_logo"),e.append("file",this.$refs.fileInput.files[0]);const a={headers:{"Content-Type":"multipart/form-data"}};this.localUploading=!0;const i=await axios.post("/api/media-files",e,a);this.notificationState.showSuccessNotification("Store logo updated!"),this.storeState.store&&this.localStore.id==this.storeState.store.id&&(this.storeState.store.logo=i.data.media_file,this.filePath=i.data.media_file.path)}catch(e){const a=((o=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:o.message)||(e==null?void 0:e.message)||"Something went wrong while uploading store logo";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(e),console.error("Failed to upload store logo:",e)}finally{this.localUploading=!1,this.$refs.fileInput.value=""}},async deleteStoreLogo(){var t,o;try{this.localDeleting=!0;const e={data:{store_id:this.localStore.id}};await axios.delete(`/api/media-files/${this.localStore.logo.id}`,e),this.storeState.store&&this.localStore.id==this.storeState.store.id&&(this.storeState.store.logo=null,this.filePath=null)}catch(e){const a=((o=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:o.message)||(e==null?void 0:e.message)||"Something went wrong while deleting store logo";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(e),console.error("Failed to delete store logo:",e)}finally{this.localDeleting=!1}}},created(){this.setPath()}},F={key:0,class:"absolute inset-0 text-white bg-blue-500/80 bg-opacity-50 flex items-center justify-center rounded-full transition-opacity"},C={key:1,class:"absolute inset-0 text-white bg-black/80 bg-opacity-50 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 transition-opacity"},L=["src"],I={class:"flex items-center space-x-1"};function j(t,o,e,a,i,l){const h=f("RefreshCw"),_=f("Plus"),g=f("Button");return s(),r("div",{class:u(["select-none",{"flex flex-col items-center space-y-2":e.showButton}])},[n("div",{onClick:o[0]||(o[0]=p=>e.editable&&!l.isUploadingAny?l.triggerFileUpload():null),class:u([e.size,{"cursor-pointer active:scale-95 transition-all relative group":e.editable},"bg-gray-200 rounded-full flex items-center justify-center"])},[e.editable?(s(),r(b,{key:0},[l.isUploadingAny?(s(),r("div",F,[P(h,{size:"16",class:"animate-spin"})])):(s(),r("div",C,[i.filePath?(s(),c(h,{key:0,size:"16"})):(s(),c(_,{key:1,size:"16"}))]))],64)):d("",!0),n("img",{src:i.filePath?i.filePath:"/images/logo-black-transparent.png",alt:"Store Logo",class:"w-full h-full rounded-full"},null,8,L)],2),n("input",{type:"file",class:"hidden",ref:"fileInput",onChange:o[1]||(o[1]=(...p)=>l.handleFileUpload&&l.handleFileUpload(...p)),accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),n("div",I,[e.showButton?(s(),c(g,{key:0,size:"xs",type:"light",action:l.triggerFileUpload,leftIcon:i.filePath?i.RefreshCw:i.Plus,disabled:l.isUploadingAny||i.localDeleting},{default:m(()=>[n("span",null,k(i.filePath?"Change":"Add store logo"),1)]),_:1},8,["action","leftIcon","disabled"])):d("",!0),e.showButton&&i.filePath&&!l.isUploadingAny?(s(),c(g,{key:1,size:"xs",type:"danger",loading:i.localDeleting,action:l.deleteStoreLogo},{default:m(()=>[...o[2]||(o[2]=[n("span",null,"Remove",-1)])]),_:1},8,["loading","action"])):d("",!0)])],2)}const E=v(B,[["render",j]]);export{S as R,E as S};
