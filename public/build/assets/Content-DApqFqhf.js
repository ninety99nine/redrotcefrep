import{c as n,a as i,b as o,d as f,g as x,r as c,o as s,F as v,f as k,e as _,h as T,t as p,k as O,i as F,D as H,G as B,T as W,w as q,l as Y}from"./app-9D_Cw4s4.js";import{B as D}from"./Button-enl4NEGy.js";import{S as P}from"./Skeleton-ChnWfFmK.js";import{I as C,b as U}from"./Input-CaqG3UNa.js";import{S as A}from"./Select-DmaDYR2i.js";import{S as E}from"./Switch-B-8TeSQT.js";import{R as I}from"./enums-DDsOf2xw.js";import{c as M,a as j}from"./stringUtils-Bvzw0-oW.js";import{_ as b}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as N}from"./trash-2-BO5hz549.js";import{P as V}from"./plus-BPwoMIzT.js";import{O as G,a as Q}from"./OrderPaymentStatusSelect-BF_ucUK4.js";import{M as R}from"./Modal-BQzBOKi-.js";import{R as J}from"./refresh-ccw-sY-Ia2Cp.js";import{T as K}from"./tag-BPG64gUD.js";import{P as Z}from"./Pill-BFJX92pa.js";import{A as X}from"./arrow-left-D4fa9TJE.js";import{L as $}from"./Loader-BJ_yFh5a.js";import{A as ee}from"./AddressInput-C7JpUQiS.js";import{A as te}from"./Alert-cipDnSO8.js";import{D as re,a as se}from"./DeliveryTimePicker-CQz7gcc5.js";import{C as oe}from"./circle-alert-BncYZhnp.js";import{I as ne}from"./info-B7NJElNr.js";import"./ShineEffect-CCEGWZwA.js";import"./Copy-TLmCwI7a.js";import"./createLucideIcon-BjPl0ua2.js";import"./Popover-BYwxVx0y.js";import"./Tooltip-DBg9S1F5.js";import"./capitalize-ChUSrr1V.js";import"./circle-check-gsRbbAn8.js";import"./x-ByYxaui0.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./index-B6OgRaxB.js";import"./GoogleMaps-Dc7f_r0d.js";import"./SelectCountry-AcneJGDj.js";import"./move-left-DwJIasRB.js";import"./Datepicker-OztGanCN.js";const de={inject:["storeState","orderState"],components:{Input:C,Select:A,Switch:E,Button:D},props:{index:{type:Number},cartFee:{type:Object}},data(){return{Trash2:N,RATE_TYPES:I,feeTypes:Object.entries(I).map(([a,t])=>({label:M(t),value:t}))}},computed:{store(){return this.storeState.store}}},ae={class:"space-y-2 bg-gray-50 p-2 border border-gray-300 rounded-lg"},ie={class:"flex items-center space-x-2"},le={class:"w-full flex justify-end"};function ce(a,t,r,y,d,e){const l=c("Input"),h=c("Select"),g=c("Button"),m=c("Switch");return s(),n("div",ae,[i(l,{type:"text",class:"w-full",modelValue:r.cartFee.name,"onUpdate:modelValue":t[0]||(t[0]=u=>r.cartFee.name=u),placeholder:"Packaging",onInput:t[1]||(t[1]=u=>e.orderState.saveStateDebounced("Fee name changed"))},null,8,["modelValue"]),o("div",ie,[i(h,{class:"w-60",search:!1,options:d.feeTypes,modelValue:r.cartFee.rate_type,"onUpdate:modelValue":t[2]||(t[2]=u=>r.cartFee.rate_type=u),placeholder:"Select fee type",onChange:t[3]||(t[3]=u=>e.orderState.saveStateDebounced("Fee type changed"))},null,8,["options","modelValue"]),r.cartFee.rate_type==d.RATE_TYPES.FLAT?(s(),f(l,{key:0,type:"money",class:"w-60",modelValue:r.cartFee.flat_rate,"onUpdate:modelValue":t[4]||(t[4]=u=>r.cartFee.flat_rate=u),currency:e.store.currency.code,onInput:t[5]||(t[5]=u=>e.orderState.saveStateDebounced("Fee amount changed"))},null,8,["modelValue","currency"])):(s(),f(l,{key:1,class:"w-60",type:"percentage",modelValue:r.cartFee.percentage_rate,"onUpdate:modelValue":t[6]||(t[6]=u=>r.cartFee.percentage_rate=u),onInput:t[7]||(t[7]=u=>e.orderState.saveStateDebounced("Fee amount changed"))},null,8,["modelValue"])),o("div",le,[r.cartFee.removable?(s(),f(g,{key:0,size:"xs",type:"danger",leftIcon:d.Trash2,action:()=>e.orderState.removeCartFee(r.index)},{default:x(()=>[...t[10]||(t[10]=[o("span",null,"Remove Fee",-1)])]),_:1},8,["leftIcon","action"])):(s(),f(m,{key:1,size:"xs",prefixText:"Apply fee",modelValue:r.cartFee.active,"onUpdate:modelValue":t[8]||(t[8]=u=>r.cartFee.active=u),onChange:t[9]||(t[9]=u=>e.orderState.saveStateDebounced("Apply fee status changed"))},null,8,["modelValue"]))])])])}const ue=b(de,[["render",ce]]),me={inject:["storeState","orderState"],components:{Button:D,Skeleton:P,OrderFee:ue},data(){return{Plus:V}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},cartFees(){return this.orderState.orderForm.cart_fees},isEditting(){return this.$route.name==="edit-order"},hasCartFees(){return this.cartFees.length>0}},methods:{addNew(){this.orderState.addCartFee()}}},he={class:"bg-white rounded-lg p-4 shadow-sm"},ge={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},ye={class:"w-full space-y-4"},pe={key:1,class:"space-y-2"},_e={class:"flex justify-center pt-2"},fe={key:1,class:"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4 my-4"};function ve(a,t,r,y,d,e){const l=c("Skeleton"),h=c("OrderFee"),g=c("Button");return s(),n("div",he,[t[5]||(t[5]=o("h1",{class:"text-lg font-semibold mb-4"},"Fees",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(s(),n("div",ge,[t[0]||(t[0]=o("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg shrink-0"},[o("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])],-1)),o("div",ye,[i(l,{width:"w-full",shine:!0}),i(l,{width:"w-1/3",shine:!0})])])):(s(),n("div",pe,[e.hasCartFees?(s(),n(v,{key:0},[(s(!0),n(v,null,k(e.cartFees,(m,u)=>(s(),f(h,{key:u,index:u,cartFee:m},null,8,["index","cartFee"]))),128)),o("div",_e,[i(g,{size:"sm",type:"light",action:e.addNew,leftIcon:d.Plus},{default:x(()=>[...t[1]||(t[1]=[o("span",null,"Add Fee",-1)])]),_:1},8,["action","leftIcon"])])],64)):(s(),n("div",fe,[e.hasCartFees?_("",!0):(s(),n(v,{key:0},[t[2]||(t[2]=o("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1)),t[3]||(t[3]=o("span",{class:"text-sm text-gray-500"},"No fees",-1))],64)),i(g,{size:"xs",type:"light",action:e.addNew,leftIcon:d.Plus,buttonClass:"my-2"},{default:x(()=>[...t[4]||(t[4]=[o("span",null,"Add Fee",-1)])]),_:1},8,["action","leftIcon"])]))]))])}const Se=b(me,[["render",ve]]),we={inject:["formState","storeState","orderState","notificationState"],components:{Input:C,Select:A,Skeleton:P,OrderStatusSelect:Q,OrderPaymentStatusSelect:G},data(){return{couriers:[],isLoadingCouriers:!1}},computed:{hasOrder(){return this.orderState.hasOrder},orderForm(){return this.orderState.orderForm},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},statuses(){return["waiting","cancelled","completed","on its way","ready for pickup"].map(t=>({label:M(t),value:t}))},paymentStatuses(){return["paid","unpaid","partially paid","waiting confirmation"].map(t=>({label:M(t),value:t}))}},methods:{async showCouriers(){var a,t;try{if(this.couriers.length)return;this.isLoadingCouriers=!0;let r={params:{per_page:100}};const y=await T.get("/api/couriers",r);this.couriers=y.data.data.map(d=>({label:M(d.name),value:d.id})),this.couriers.unshift({label:"None",value:null})}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching stores";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch stores:",r)}finally{this.isLoadingCouriers=!1}}},created(){this.showCouriers()}},be={class:"bg-white rounded-lg p-4 shadow-sm"},xe={key:0,class:"space-y-2"},ke={key:1,class:"space-y-2"};function Pe(a,t,r,y,d,e){const l=c("Skeleton"),h=c("OrderStatusSelect"),g=c("OrderPaymentStatusSelect"),m=c("Select"),u=c("Input");return s(),n("div",be,[e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(s(),n("div",xe,[(s(),n(v,null,k([1,2,3],(S,w)=>o("div",{key:w,class:"border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},[i(l,{width:"w-full",shine:!0})])),64))])):(s(),n("div",ke,[i(h,{class:"w-full",showLabel:!0,onChange:t[0]||(t[0]=S=>e.orderState.saveStateDebounced(`Status changed to ${e.orderForm.status}`))}),i(g,{class:"w-full",showLabel:!0,onChange:t[1]||(t[1]=S=>e.orderState.saveStateDebounced(`Payment status changed to ${e.orderForm.payment_status}`))}),i(m,{search:!1,label:"Couriers",options:d.couriers,modelValue:e.orderForm.courier_id,"onUpdate:modelValue":t[2]||(t[2]=S=>e.orderForm.courier_id=S),errorText:e.formState.getFormError("courier_id"),onChange:t[3]||(t[3]=S=>e.orderState.saveStateDebounced("Courier changed"))},null,8,["options","modelValue","errorText"]),i(u,{type:"text",label:"Tracking Number",modelValue:e.orderForm.tracking_number,"onUpdate:modelValue":t[4]||(t[4]=S=>e.orderForm.tracking_number=S),errorText:e.formState.getFormError("tracking_number"),onInput:t[5]||(t[5]=S=>e.orderState.saveStateDebounced("Tracking number changed"))},null,8,["modelValue","errorText"]),i(u,{rows:"2",type:"textarea",label:"Internal Note",modelValue:e.orderForm.internal_note,"onUpdate:modelValue":t[6]||(t[6]=S=>e.orderForm.internal_note=S),errorText:e.formState.getFormError("internal_note"),onChange:t[7]||(t[7]=S=>e.orderState.saveStateDebounced("Internal note changed")),tooltipContent:"Internal information about this order only visible to you and other team members"},null,8,["modelValue","errorText"])]))])}const Ce=b(we,[["render",Pe]]),Oe={inject:["orderState","storeState"],components:{Skeleton:P},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},shoppingCart(){return this.orderState.shoppingCart},isInspectingShoppingCart(){return this.orderState.isInspectingShoppingCart},hasDeliveryName(){return this.shoppingCart?this.shoppingCart.totals.delivery.name!=null:this.order.delivery_name!=null},hasFees(){return Object.keys(this.shoppingCart?this.shoppingCart.totals.fees:this.order.order_fees).length>0},hasDiscounts(){return Object.keys(this.shoppingCart?this.shoppingCart.totals.discounts:this.order.order_discounts).length>0},hasTaxAmount(){return(this.shoppingCart?this.shoppingCart.totals.vat.amount.amount:this.order.vat_amount.amount)>0},hasAdjustmentTotal(){return this.shoppingCart?this.shoppingCart.totals.adjustment_total.amount!=0:this.order.adjustment_total.amount!=0},adjustmentTotalPositive(){return this.shoppingCart?this.shoppingCart.totals.adjustment_total.amount>0:this.order.adjustment_total.amount>0},isReady(){return!this.isLoadingStore&&!this.isLoadingOrder&&!this.isInspectingShoppingCart}}},Fe={class:"bg-white rounded-lg p-4 shadow-sm"},De={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},Le={class:"w-full space-y-4"},Me={key:1,class:"bg-blue-50 border border-blue-400 rounded-lg p-4"},Te={key:0,class:"flex items-center justify-between text-sm border-b border-gray-300 border-dashed pb-2 mb-2"},Ie={key:1},je={key:1,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},Ve={key:1},Ae={key:3,class:"text-red-500"},Ee={key:2,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},Ne={class:"flex items-center justify-between text-sm mb-1"},Re={key:1,class:"w-full"},Be={key:3},Ue={key:1,class:"text-xs text-gray-400"},Ze={key:3,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},ze={key:1},He={key:3,class:"text-green-500"},We={key:4,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},qe={class:"flex items-center justify-between text-sm text-gray-500"},Ye={key:1},Ge={key:5,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Qe={class:"flex items-center justify-between text-sm text-gray-500"},Je={key:1},Ke={key:3},Xe={class:"flex items-center justify-between text-lg"},$e={key:1,class:"font-bold"},et={key:1,class:"text-sm"};function tt(a,t,r,y,d,e){const l=c("Skeleton");return s(),n("div",Fe,[e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(s(),n("div",De,[t[0]||(t[0]=o("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg shrink-0"},[o("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])],-1)),o("div",Le,[i(l,{width:"w-full",shine:!0}),i(l,{width:"w-1/3",shine:!0})])])):(s(),n("div",Me,[e.order||e.shoppingCart?(s(),n(v,{key:0},[!e.isReady||e.hasDiscounts||e.hasFees||e.hasDeliveryName?(s(),n("div",Te,[t[1]||(t[1]=o("span",null,"Subtotal",-1)),e.isReady?(s(),n("span",Ie,p(e.shoppingCart?e.shoppingCart.totals.subtotal.amount_with_currency:e.order.subtotal.amount_with_currency),1)):(s(),f(l,{key:0,width:"w-24",color:"bg-blue-200",shine:!0}))])):_("",!0),!e.isReady||e.hasDiscounts?(s(),n("div",je,[(s(!0),n(v,null,k(e.isReady?e.shoppingCart?e.shoppingCart.totals.discounts:e.order.order_discounts:[1],(h,g)=>(s(),n("div",{key:g,class:"flex items-center justify-between text-sm text-gray-500"},[e.isReady?(s(),n("span",Ve,p(h.name),1)):(s(),f(l,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})),e.isReady?(s(),n("span",Ae,"- "+p(h.amount.amount_with_currency),1)):(s(),f(l,{key:2,width:"w-20",color:"bg-blue-200",shine:!0}))]))),128))])):_("",!0),!e.isReady||e.hasTaxAmount?(s(),n("div",Ee,[o("div",Ne,[e.isReady?(s(),n("div",Re,"Tax ("+p(e.shoppingCart?e.shoppingCart.totals.vat.rate.value_symbol:`${e.order.vat_rate}%`)+" "+p(e.shoppingCart?e.shoppingCart.totals.vat.method:e.order.vat_method)+")",1)):(s(),f(l,{key:0,width:"w-16",color:"bg-blue-200",shine:!0})),e.isReady?(s(),n("span",Be,p(e.shoppingCart?e.shoppingCart.totals.vat.amount.amount_with_currency:e.order.vat_amount.amount_with_currency),1)):(s(),f(l,{key:2,width:"w-16",color:"bg-blue-200",shine:!0}))]),e.isReady?(s(),n("p",Ue,"Tax calculated on the discounted subtotal of "+p(e.shoppingCart?e.shoppingCart.totals.subtotal_after_discount.amount_with_currency:e.order.subtotal_after_discount.amount_with_currency),1)):(s(),f(l,{key:0,width:"w-1/3",color:"bg-blue-200",shine:!0}))])):_("",!0),!e.isReady||e.hasFees?(s(),n("div",Ze,[(s(!0),n(v,null,k(e.isReady?e.shoppingCart?e.shoppingCart.totals.fees:e.order.order_fees:[1],(h,g)=>(s(),n("div",{key:g,class:"flex items-center justify-between text-sm text-gray-500"},[e.isReady?(s(),n("span",ze,p(h.name),1)):(s(),f(l,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})),e.isReady?(s(),n("span",He,"+ "+p(h.amount.amount_with_currency),1)):(s(),f(l,{key:2,width:"w-16",color:"bg-blue-200",shine:!0}))]))),128))])):_("",!0),!e.isReady||e.hasAdjustmentTotal?(s(),n("div",We,[o("div",qe,[e.isReady?(s(),n("span",Ye,"Adjustment")):(s(),f(l,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})),e.isReady?(s(),n("span",{key:3,class:O([e.adjustmentTotalPositive?"text-green-500":"text-red-500"])},p(e.adjustmentTotalPositive?"+":"-")+" "+p(`${e.shoppingCart?e.shoppingCart.totals.adjustment_total.amount_with_currency:e.order.adjustment_total.amount_with_currency}`.replace("-","")),3)):(s(),f(l,{key:2,width:"w-16",color:"bg-blue-200",shine:!0}))])])):_("",!0),!e.isReady||e.hasDeliveryName?(s(),n("div",Ge,[o("div",Qe,[e.isReady?(s(),n("span",Je,p(e.shoppingCart?e.shoppingCart.totals.delivery.name:e.order.delivery_name),1)):(s(),f(l,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})),e.isReady?(s(),n("span",Ke,p(e.shoppingCart?e.shoppingCart.totals.delivery.fee.amount_with_currency:e.order.delivery_fee.amount_with_currency),1)):(s(),f(l,{key:2,width:"w-16",color:"bg-blue-200",shine:!0}))])])):_("",!0),o("div",Xe,[t[2]||(t[2]=o("div",{class:"w-full font-bold"},"Grand Total",-1)),e.isReady?(s(),n("span",$e,p(e.shoppingCart?e.shoppingCart.totals.grand_total.amount_with_currency:e.order.grand_total.amount_with_currency),1)):(s(),f(l,{key:0,width:"w-24",color:"bg-blue-200",shine:!0}))])],64)):(s(),n("span",et,"Add products to show total"))]))])}const rt=b(Oe,[["render",tt]]),st={props:{customer:{type:Object},onSelectCustomer:{type:Function}}},ot={class:"text-sm font-semibold"},nt={key:0,class:"text-xs text-gray-500"};function dt(a,t,r,y,d,e){return s(),n("div",{onClick:t[0]||(t[0]=()=>r.onSelectCustomer(r.customer)),class:"flex items-center space-x-2 cursor-pointer p-3 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100"},[t[1]||(t[1]=o("svg",{class:"w-6 h-6 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})],-1)),o("div",null,[o("p",ot,p(r.customer.name),1),r.customer.email||r.customer.mobile_number?(s(),n("p",nt,p(r.customer.email||r.customer.mobile_number.national),1)):_("",!0)])])}const at=b(st,[["render",dt]]),it={components:{CustomerOption:at},props:{customers:{type:Array},onSelectCustomer:{type:Function}}},lt={class:"max-h-80 overflow-y-auto space-y-2 mb-4"};function ct(a,t,r,y,d,e){const l=c("CustomerOption");return s(),n("div",lt,[(s(!0),n(v,null,k(r.customers,(h,g)=>(s(),f(l,{key:g,customer:h,onSelectCustomer:r.onSelectCustomer},null,8,["customer","onSelectCustomer"]))),128))])}const ut=b(it,[["render",ct]]),mt={inject:["formState","orderState","storeState","notificationState"],components:{Input:C,Modal:R,Button:D,Skeleton:P,CustomerOptions:ut},props:{hasCustomer:{type:Boolean}},data(){return{Plus:V,RefreshCcw:J,customers:[],searchTerm:null,lastSearchTerm:null,isLoadingCustomers:!1,hasLoadedInitialCustomers:!1}},watch:{searchTerm(){this.showCustomers()}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},hasCustomers(){return this.customers.length>0}},methods:{isNotEmpty:j,onShow(){this.hasLoadedInitialCustomers=!1,this.lastSearchTerm=null,this.searchTerm=null,this.customers=[],this.showCustomers()},async showCustomers(){var a,t;try{this.isLoadingCustomers=!0;let r={params:{store_id:this.store.id}};this.hasSearchTerm&&(r.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const y=await T.get("/api/customers",r);if(this.searchTerm===this.lastSearchTerm){const d=y.data;this.customers=d.data,this.isLoadingCustomers=!1,this.hasLoadedInitialCustomers=!0}}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching customers";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch customers:",r)}finally{this.isLoadingCustomers=!1}},onSelectCustomer(a){this.$refs.modal.hideModal(),this.orderState.addCartCustomer(a)},addNew(){this.$refs.modal.hideModal(),this.orderState.addCartCustomer()}}},ht={class:"flex justify-center"},gt={key:0,class:"flex justify-center items-center space-x-4 my-2"},yt={key:1,class:"space-y-2 mb-4"},pt={class:"w-full space-y-2"},_t={key:3,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"};function ft(a,t,r,y,d,e){const l=c("Input"),h=c("Button"),g=c("Skeleton"),m=c("CustomerOptions"),u=c("Modal");return s(),n("div",ht,[i(u,{ref:"modal",onShow:e.onShow,triggerSize:"sm",contentClass:"px-4",triggerType:"light",scrollOnContent:!1,showApproveButton:!1,leftTriggerIcon:r.hasCustomer?d.RefreshCcw:d.Plus,header:`${r.hasCustomer?"Change":"Add"} Customer`,triggerText:`${r.hasCustomer?"Change":"Add"} Customer`,triggerLoading:e.isLoadingOrder||e.isEditting&&!e.hasOrder},{content:x(()=>[d.hasLoadedInitialCustomers?(s(),n("div",gt,[i(l,{type:"search",class:"w-full",debounced:!0,modelValue:d.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=S=>d.searchTerm=S),placeholder:"Search customers",onInput:t[1]||(t[1]=S=>d.isLoadingCustomers=!0),skeleton:e.isLoadingOrder||e.isEditting&&!e.hasOrder},null,8,["modelValue","skeleton"]),i(h,{size:"xs",type:"light",leftIcon:d.Plus,action:e.addNew,buttonClass:"my-2"},{default:x(()=>[...t[2]||(t[2]=[o("span",null,"Add New",-1)])]),_:1},8,["leftIcon","action"])])):_("",!0),d.isLoadingCustomers?(s(),n("div",yt,[(s(),n(v,null,k([1,2,3],(S,w)=>o("div",{key:w,class:"flex items-center space-x-2 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50 w-full"},[i(g,{width:"w-10",height:"h-10",rounded:"rounded-lg",shine:!0,class:"shrink-0"}),o("div",pt,[i(g,{width:"w-2/3",shine:!0}),i(g,{width:"w-1/3",shine:!0})])])),64))])):e.hasCustomers?(s(),f(m,{key:2,customers:d.customers,onSelectCustomer:e.onSelectCustomer},null,8,["customers","onSelectCustomer"])):(s(),n("p",_t," No customers found "))]),_:1},8,["onShow","leftTriggerIcon","header","triggerText","triggerLoading"])])}const vt=b(mt,[["render",ft]]),St={inject:["storeState","orderState"],components:{Input:C,Skeleton:P,AddCustomer:vt},data(){return{modified:!1,customer_email:null,customer_last_name:null,customer_first_name:null,customer_mobile_number:null}},watch:{orderForm:{handler(a,t){t==null?(this.customer_email=a.customer_email,this.customer_last_name=a.customer_last_name,this.customer_first_name=a.customer_first_name,this.customer_mobile_number=a.customer_mobile_number):this.modified=a.customer_email!==this.customer_email||a.customer_last_name!==this.customer_last_name||a.customer_first_name!==this.customer_first_name||a.customer_mobile_number!==this.customer_mobile_number},deep:!0}},computed:{hasOrder(){return this.orderState.hasOrder},orderForm(){return this.orderState.orderForm},isEditting(){return this.$route.name==="edit-order"},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasEmail(){return this.isNotEmpty(this.orderForm.customer_email)},hasMobileNumber(){return this.isNotEmpty(this.orderForm.customer_mobile_number)},hasCustomerDetails(){return this.orderState.hasCustomerDetails}},methods:{isNotEmpty:j}},wt={class:"bg-white rounded-lg p-4 shadow-sm"},bt={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},xt={class:"w-full space-y-4"},kt={key:0,class:"space-y-2"},Pt={key:1,class:"border-t border-dashed border-gray-300 pt-4 mt-4"};function Ct(a,t,r,y,d,e){const l=c("Skeleton"),h=c("Input"),g=c("AddCustomer");return s(),n("div",wt,[t[13]||(t[13]=o("h1",{class:"text-lg font-semibold mb-4"},"Customer",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(s(),n("div",bt,[t[10]||(t[10]=o("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg shrink-0"},[o("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])],-1)),o("div",xt,[i(l,{width:"w-full",shine:!0}),i(l,{width:"w-1/3",shine:!0})])])):(s(),n(v,{key:1},[e.hasCustomerDetails||d.modified?(s(),n("div",kt,[i(h,{type:"text",placeholder:"First name",modelValue:e.orderForm.customer_first_name,"onUpdate:modelValue":t[0]||(t[0]=m=>e.orderForm.customer_first_name=m),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder,onInput:t[1]||(t[1]=m=>e.orderState.saveStateDebounced("Customer first name changed"))},null,8,["modelValue","skeleton"]),i(h,{type:"text",placeholder:"Last name",modelValue:e.orderForm.customer_last_name,"onUpdate:modelValue":t[2]||(t[2]=m=>e.orderForm.customer_last_name=m),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder,onInput:t[3]||(t[3]=m=>e.orderState.saveStateDebounced("Customer last name changed"))},null,8,["modelValue","skeleton"]),i(h,{type:"email",placeholder:"Email",modelValue:e.orderForm.customer_email,"onUpdate:modelValue":t[4]||(t[4]=m=>e.orderForm.customer_email=m),onInput:t[5]||(t[5]=m=>e.orderState.saveStateDebounced("Customer email changed")),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},null,8,["modelValue","skeleton"]),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?_("",!0):(s(),f(h,{key:0,type:"text",placeholder:"+26772000001",modelValue:e.orderForm.customer_mobile_number,"onUpdate:modelValue":t[6]||(t[6]=m=>e.orderForm.customer_mobile_number=m),onChange:t[7]||(t[7]=m=>e.orderState.saveStateDebounced("Customer mobile number changed"))},null,8,["modelValue"]))])):_("",!0),e.hasEmail||e.hasMobileNumber?(s(),n("div",Pt,[i(h,{type:"checkbox",inputLabel:"Update customer profile",modelValue:e.orderForm.update_profile,"onUpdate:modelValue":t[8]||(t[8]=m=>e.orderForm.update_profile=m),inputDescription:"Make sure to update both the order customer details and the customer profile",onChange:t[9]||(t[9]=m=>e.orderState.saveStateDebounced(`Update customer profile (${e.orderForm.update_profile?"On":"Off"})`))},null,8,["modelValue"])])):_("",!0),o("div",{class:O([e.hasCustomerDetails||d.modified?"border-t border-dashed border-gray-300 pt-4 mt-4":"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4"])},[!e.hasCustomerDetails&&!d.modified?(s(),n(v,{key:0},[t[11]||(t[11]=o("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})],-1)),t[12]||(t[12]=o("span",{class:"text-sm text-gray-500"},"No customer added",-1))],64)):_("",!0),i(g,{hasCustomerDetails:e.hasCustomerDetails},null,8,["hasCustomerDetails"])],2)],64))])}const Ot=b(St,[["render",Ct]]),Ft={inject:["storeState","orderState"],components:{Tag:K,Input:C,Button:D},props:{index:{type:Number},cartProduct:{type:Object}},data(){return{Trash2:N}},computed:{store(){return this.storeState.store},hasPhotoPath(){return this.photoPath!=null},photoPath(){return this.cartProduct.photo_path},grandTotal(){const a=parseFloat(this.cartProduct.unit_regular_price),t=parseFloat(this.cartProduct.unit_sale_price),r=parseInt(this.cartProduct.quantity),y=this.store.currency.code;return t>0&&t<a?U(t*r,y):U(a*r,y)}}},Dt={class:"rounded-lg overflow-hidden border border-gray-300 py-2 px-4 bg-gray-50"},Lt={class:"w-full flex space-x-4"},Mt=["src"],Tt={key:1,class:"w-6 h-6 text-gray-400 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},It={class:"w-full space-y-4"},jt={class:"w-full text-sm text-left"},Vt={class:"whitespace-nowrap align-top py-2 pr-2"},At={class:"whitespace-nowrap align-top p-2"},Et={class:"whitespace-nowrap align-top py-2 pl-2"},Nt={class:"grid grid-cols-3 my-4"},Rt={class:"col-span-1 col-start-2 flex items-center justify-center space-x-2"},Bt={class:"text-gray-700 text-center"},Ut={class:"col-span-1"},Zt={class:"flex justify-end"};function zt(a,t,r,y,d,e){const l=c("Input"),h=c("Tag"),g=c("Button");return s(),n("div",Dt,[o("div",Lt,[o("div",{class:O(["flex items-center justify-center w-16 h-16 rounded-lg",{"border border-dashed border-gray-200":!e.hasPhotoPath}])},[e.hasPhotoPath?(s(),n("img",{key:0,class:"w-full object-contain rounded-lg shrink-0",src:e.photoPath},null,8,Mt)):(s(),n("svg",Tt,[...t[8]||(t[8]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"},null,-1)])]))],2),o("div",It,[i(l,{type:"text",label:"Name",modelValue:r.cartProduct.name,"onUpdate:modelValue":t[0]||(t[0]=m=>r.cartProduct.name=m),placeholder:"Standard Ticket",onInput:t[1]||(t[1]=m=>e.orderState.saveStateDebounced("Product name changed"))},null,8,["modelValue"]),o("table",jt,[t[9]||(t[9]=o("thead",null,[o("tr",null,[o("th",{class:"whitespace-nowrap align-top px-2 pr-2"},[o("span",{class:"text-gray-700 text-xs font-normal uppercase"},"Regular Price")]),o("th",{class:"whitespace-nowrap align-top px-2"},[o("span",{class:"text-gray-700 text-xs font-normal uppercase"},"Sale Price")]),o("th",{class:"whitespace-nowrap align-top px-2 pl-2"},[o("span",{class:"text-gray-700 text-xs font-normal uppercase"},"Quantity")])])],-1)),o("tbody",null,[o("tr",null,[o("td",Vt,[i(l,{type:"money",currency:e.store.currency.code,modelValue:r.cartProduct.unit_regular_price,"onUpdate:modelValue":t[2]||(t[2]=m=>r.cartProduct.unit_regular_price=m),onInput:t[3]||(t[3]=m=>e.orderState.saveStateDebounced("Product regular price changed"))},null,8,["currency","modelValue"])]),o("td",At,[i(l,{type:"money",currency:e.store.currency.code,modelValue:r.cartProduct.unit_sale_price,"onUpdate:modelValue":t[4]||(t[4]=m=>r.cartProduct.unit_sale_price=m),onInput:t[5]||(t[5]=m=>e.orderState.saveStateDebounced("Product sale price changed"))},null,8,["currency","modelValue"])]),o("td",Et,[i(l,{type:"number",modelValue:r.cartProduct.quantity,"onUpdate:modelValue":t[6]||(t[6]=m=>r.cartProduct.quantity=m),onInput:t[7]||(t[7]=m=>e.orderState.saveStateDebounced("Product quantity changed"))},null,8,["modelValue"])])])])])])]),o("div",Nt,[o("div",Rt,[i(h,{size:"16",class:"text-gray-500"}),o("span",Bt,p(e.store.currency.symbol)+p(e.grandTotal),1)]),o("div",Ut,[o("div",Zt,[i(g,{size:"xs",type:"danger",leftIcon:d.Trash2,action:()=>e.orderState.removeCartProduct(r.index)},{default:x(()=>[...t[10]||(t[10]=[o("span",null,"Remove",-1)])]),_:1},8,["leftIcon","action"])])])])])}const Ht=b(Ft,[["render",zt]]),Wt={components:{Pill:Z},props:{parentProduct:{type:Object,default:null},product:{type:Object},onSelectProduct:{type:Function}},computed:{photo(){return this.product.photo},hasPhoto(){return this.photo!=null}}},qt=["src"],Yt={key:1,class:"w-6 h-6 text-gray-400 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},Gt={class:"w-full flex items-center justify-between"},Qt={class:"text-sm font-semibold"},Jt={class:"text-xs space-x-2"},Kt={key:0};function Xt(a,t,r,y,d,e){const l=c("Pill");return s(),n("div",{onClick:t[0]||(t[0]=()=>r.onSelectProduct(r.product,r.parentProduct)),class:"flex justify-between items-center cursor-pointer p-2 space-x-4 rounded-lg bg-gray-50 hover:bg-gray-100"},[o("div",{class:O(["flex items-center justify-center w-10 h-10 rounded-lg",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(s(),n("img",{key:0,class:"w-full max-h-10 object-contain rounded-lg shrink-0",src:e.photo.path},null,8,qt)):(s(),n("svg",Yt,[...t[1]||(t[1]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"},null,-1)])]))],2),o("div",Gt,[o("div",null,[o("p",Qt,p(r.product.name),1),o("p",Jt,[o("span",{class:O({"line-through text-gray-500":r.product.on_sale})},p(r.product.unit_regular_price.amount_with_currency),3),r.product.on_sale?(s(),n("span",Kt,p(r.product.unit_sale_price.amount_with_currency),1)):_("",!0)])]),r.product.variants&&r.product.variants.length?(s(),f(l,{key:0,type:"light",size:"xs"},{default:x(()=>[F(p(r.product.variants.length)+" "+p(r.product.variants.length==1?"option":"options"),1)]),_:1})):_("",!0)])])}const $t=b(Wt,[["render",Xt]]),er={components:{ProductOption:$t},props:{parentProduct:{type:Object,default:null},products:{type:Array},onSelectProduct:{type:Function}}},tr={class:"max-h-80 overflow-y-auto space-y-2 mb-4"};function rr(a,t,r,y,d,e){const l=c("ProductOption");return s(),n("div",tr,[(s(!0),n(v,null,k(r.products,(h,g)=>(s(),f(l,{key:g,product:h,parentProduct:r.parentProduct,onSelectProduct:r.onSelectProduct},null,8,["product","parentProduct","onSelectProduct"]))),128))])}const z=b(er,[["render",rr]]),sr={components:{ProductOptions:z},props:{selectedProduct:{type:Object},onSelectProduct:{type:Function}}},or={class:"space-y-2 mb-4"};function nr(a,t,r,y,d,e){const l=c("ProductOptions");return s(),n("div",or,[i(l,{parentProduct:r.selectedProduct,onSelectProduct:r.onSelectProduct,products:r.selectedProduct.variants},null,8,["parentProduct","onSelectProduct","products"])])}const dr=b(sr,[["render",nr]]),ar={inject:["formState","orderState","storeState","notificationState"],components:{Input:C,Modal:R,Button:D,Skeleton:P,ProductOptions:z,ProductVariationOptions:dr},data(){return{Plus:V,ArrowLeft:X,products:[],searchTerm:null,lastSearchTerm:null,selectedProduct:null,isLoadingProducts:!1,hasLoadedInitialProducts:!1}},watch:{searchTerm(){this.showProducts()}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},hasProducts(){return this.products.length>0}},methods:{isNotEmpty:j,onShow(){this.hasLoadedInitialProducts=!1,this.selectedProduct=null,this.lastSearchTerm=null,this.searchTerm=null,this.products=[],this.showProducts()},async showProducts(){var a,t;try{this.isLoadingProducts=!0;let r={params:{store_id:this.store.id,association:"team member",_relationships:"photo,variants"}};this.hasSearchTerm&&(r.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const y=await T.get("/api/products",r);if(this.searchTerm===this.lastSearchTerm){const d=y.data;this.products=d.data,this.isLoadingProducts=!1,this.hasLoadedInitialProducts=!0}}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching products";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch products:",r)}finally{this.isLoadingProducts=!1}},onSelectProduct(a,t){a.variants&&a.variants.length>0?this.selectedProduct=a:(this.$refs.modal.hideModal(),this.orderState.addCartProductUsingProduct(a,t,null,!0))},removeSelectedProduct(){this.selectedProduct=null},addNew(){this.$refs.modal.hideModal(),this.orderState.addCartProduct()}}},ir={class:"flex justify-center"},lr={key:0,class:"flex justify-center items-center space-x-4 my-2"},cr={key:1,class:"space-y-2 mb-4"},ur={class:"w-full space-y-2"},mr={class:"flex items-center space-x-4 border-b border-dashed border-gray-300 my-4 pb-4"},hr={class:"flex items-center space-x-2"},gr={key:0,class:"flex items-center justify-center w-10 h-10 rounded-lg"},yr=["src"],pr={class:"text-lg font-bold"},_r={key:4,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"};function fr(a,t,r,y,d,e){const l=c("Input"),h=c("Button"),g=c("Skeleton"),m=c("ProductVariationOptions"),u=c("ProductOptions"),S=c("Modal");return s(),n("div",ir,[i(S,{ref:"modal",onShow:e.onShow,triggerSize:"sm",contentClass:"px-4",triggerType:"light",header:"Add Product",leftTriggerIcon:d.Plus,scrollOnContent:!1,triggerText:"Add Product",showApproveButton:!1,triggerLoading:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},{content:x(()=>[d.hasLoadedInitialProducts&&!d.selectedProduct?(s(),n("div",lr,[i(l,{type:"search",class:"w-full",debounced:!0,modelValue:d.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=w=>d.searchTerm=w),placeholder:"Search products",onInput:t[1]||(t[1]=w=>d.isLoadingProducts=!0),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},null,8,["modelValue","skeleton"]),i(h,{size:"xs",type:"light",leftIcon:d.Plus,action:e.addNew,buttonClass:"my-2"},{default:x(()=>[...t[2]||(t[2]=[o("span",null,"Add New",-1)])]),_:1},8,["leftIcon","action"])])):_("",!0),d.isLoadingProducts?(s(),n("div",cr,[(s(),n(v,null,k([1,2,3],(w,L)=>o("div",{key:L,class:"flex items-center space-x-2 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50 w-full"},[i(g,{width:"w-10",height:"h-10",rounded:"rounded-lg",shine:!0,class:"shrink-0"}),o("div",ur,[i(g,{width:"w-2/3",shine:!0}),i(g,{width:"w-1/3",shine:!0})])])),64))])):d.selectedProduct?(s(),n(v,{key:2},[o("div",mr,[i(h,{size:"xs",type:"light",leftIcon:d.ArrowLeft,action:e.removeSelectedProduct},{default:x(()=>[...t[3]||(t[3]=[o("span",null,"Back",-1)])]),_:1},8,["leftIcon","action"]),o("div",hr,[d.selectedProduct.photo.path?(s(),n("div",gr,[o("img",{class:"w-full max-h-10 object-contain rounded-lg shrink-0",src:d.selectedProduct.photo.path},null,8,yr)])):_("",!0),o("p",pr,p(d.selectedProduct.name),1)])]),i(m,{onSelectProduct:e.onSelectProduct,selectedProduct:d.selectedProduct},null,8,["onSelectProduct","selectedProduct"])],64)):e.hasProducts?(s(),f(u,{key:3,products:d.products,onSelectProduct:e.onSelectProduct},null,8,["products","onSelectProduct"])):(s(),n("p",_r," No products found "))]),_:1},8,["onShow","leftTriggerIcon","triggerLoading"])])}const vr=b(ar,[["render",fr]]),Sr={inject:["storeState","orderState"],components:{Skeleton:P,AddProduct:vr,OrderProduct:Ht},computed:{hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},cartProducts(){return this.orderState.orderForm.cart_products},isEditting(){return this.$route.name==="edit-order"},hasCartProducts(){return this.cartProducts.length>0}}},wr={class:"bg-white rounded-lg p-4 shadow-sm"},br={key:0,class:"space-y-2"},xr={class:"w-full space-y-4"},kr={key:1,class:"space-y-4"};function Pr(a,t,r,y,d,e){const l=c("Skeleton"),h=c("OrderProduct"),g=c("AddProduct");return s(),n("div",wr,[t[3]||(t[3]=o("h1",{class:"text-lg font-semibold mb-4"},"Products",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(s(),n("div",br,[(s(),n(v,null,k([1,2,3],(m,u)=>o("div",{key:u,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},[t[0]||(t[0]=o("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg shrink-0"},[o("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})])],-1)),o("div",xr,[i(l,{width:"w-full",shine:!0}),i(l,{width:"w-1/3",shine:!0})])])),64))])):(s(),n("div",kr,[e.hasCartProducts?(s(!0),n(v,{key:0},k(e.cartProducts,(m,u)=>(s(),f(h,{key:u,index:u,cartProduct:m},null,8,["index","cartProduct"]))),128)):_("",!0),o("div",{class:O([{"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4 my-4":!e.hasCartProducts}])},[e.hasCartProducts?_("",!0):(s(),n(v,{key:0},[t[1]||(t[1]=o("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"})],-1)),t[2]||(t[2]=o("span",{class:"text-sm text-gray-500"},"No products added",-1))],64)),i(g)],2)]))])}const Cr=b(Sr,[["render",Pr]]),Or={inject:["storeState","orderState"],components:{Input:C,Button:D,Switch:E,Select:A},props:{index:{type:Number},cartPromotion:{type:Object}},data(){return{Trash2:N,RATE_TYPES:I,discountRateTypes:Object.entries(I).map(([a,t])=>({label:M(t),value:t}))}},computed:{store(){return this.storeState.store}}},Fr={class:"rounded-lg border border-fuchsia-300 py-2 px-4 bg-fuchsia-50"},Dr={class:"w-full space-y-4"},Lr={class:"grid grid-cols-3 gap-1"},Mr={class:"flex justify-between my-4"};function Tr(a,t,r,y,d,e){const l=c("Input"),h=c("Switch"),g=c("Select"),m=c("Button");return s(),n("div",Fr,[o("div",Dr,[i(l,{type:"text",label:"Name",modelValue:r.cartPromotion.name,"onUpdate:modelValue":t[0]||(t[0]=u=>r.cartPromotion.name=u),placeholder:"Standard Ticket",onInput:t[1]||(t[1]=u=>e.orderState.saveStateDebounced("Promotion name changed"))},null,8,["modelValue"]),o("div",Lr,[i(h,{size:"xs",suffixText:"Offer discount",modelValue:r.cartPromotion.offer_discount,"onUpdate:modelValue":t[2]||(t[2]=u=>r.cartPromotion.offer_discount=u),onInput:t[3]||(t[3]=u=>e.orderState.saveStateDebounced("Promotion discount offer changed"))},null,8,["modelValue"]),r.cartPromotion.offer_discount?(s(),n(v,{key:0},[i(g,{class:"w-full",search:!1,options:d.discountRateTypes,placeholder:"Select discount type",modelValue:r.cartPromotion.discount_rate_type,"onUpdate:modelValue":t[4]||(t[4]=u=>r.cartPromotion.discount_rate_type=u),onChange:t[5]||(t[5]=u=>e.orderState.saveStateDebounced("Promotion discount type changed"))},null,8,["options","modelValue"]),r.cartPromotion.discount_rate_type==d.RATE_TYPES.FLAT?(s(),f(l,{key:0,type:"money",currency:e.store.currency.code,modelValue:r.cartPromotion.discount_flat_rate,"onUpdate:modelValue":t[6]||(t[6]=u=>r.cartPromotion.discount_flat_rate=u),onInput:t[7]||(t[7]=u=>e.orderState.saveStateDebounced("Promotion discount amount changed"))},null,8,["currency","modelValue"])):(s(),f(l,{key:1,type:"percentage",modelValue:r.cartPromotion.discount_percentage_rate,"onUpdate:modelValue":t[8]||(t[8]=u=>r.cartPromotion.discount_percentage_rate=u),onInput:t[9]||(t[9]=u=>e.orderState.saveStateDebounced("Promotion discount amount changed"))},null,8,["modelValue"]))],64)):_("",!0)])]),o("div",Mr,[i(h,{size:"xs",suffixText:"Offer free delivery",modelValue:r.cartPromotion.offer_free_delivery,"onUpdate:modelValue":t[10]||(t[10]=u=>r.cartPromotion.offer_free_delivery=u),onInput:t[11]||(t[11]=u=>e.orderState.saveStateDebounced("Promotion fee delivery offer changed"))},null,8,["modelValue"]),i(m,{size:"xs",type:"danger",leftIcon:d.Trash2,action:()=>e.orderState.removeCartPromotion(r.index)},{default:x(()=>[...t[12]||(t[12]=[o("span",null,"Remove Promotion",-1)])]),_:1},8,["leftIcon","action"])])])}const Ir=b(Or,[["render",Tr]]),jr={components:{Pill:Z},props:{promotion:{type:Object},onSelectPromotion:{type:Function}}},Vr={class:"w-full flex items-center justify-between"},Ar={class:"text-sm font-semibold"},Er={class:"flex items-center space-x-1"};function Nr(a,t,r,y,d,e){const l=c("Pill");return s(),n("div",{onClick:t[0]||(t[0]=()=>r.onSelectPromotion(r.promotion)),class:"flex justify-between items-center cursor-pointer p-3 space-x-4 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100"},[o("div",Vr,[o("div",null,[o("p",Ar,p(r.promotion.name),1)]),o("div",Er,[r.promotion.offer_discount?(s(),f(l,{key:0,type:"success",size:"xs"},{default:x(()=>[...t[1]||(t[1]=[F("discount",-1)])]),_:1})):_("",!0),r.promotion.offer_free_delivery?(s(),f(l,{key:1,type:"success",size:"xs"},{default:x(()=>[...t[2]||(t[2]=[F("free delivery",-1)])]),_:1})):_("",!0)])])])}const Rr=b(jr,[["render",Nr]]),Br={components:{PromotionOption:Rr},props:{promotions:{type:Array},onSelectPromotion:{type:Function}}},Ur={class:"max-h-80 overflow-y-auto space-y-2 mb-4"};function Zr(a,t,r,y,d,e){const l=c("PromotionOption");return s(),n("div",Ur,[(s(!0),n(v,null,k(r.promotions,(h,g)=>(s(),f(l,{key:g,promotion:h,onSelectPromotion:r.onSelectPromotion},null,8,["promotion","onSelectPromotion"]))),128))])}const zr=b(Br,[["render",Zr]]),Hr={inject:["formState","orderState","storeState","notificationState"],components:{Input:C,Modal:R,Button:D,Skeleton:P,PromotionOptions:zr},data(){return{Plus:V,promotions:[],searchTerm:null,lastSearchTerm:null,isLoadingPromotions:!1,hasLoadedInitialPromotions:!1}},watch:{searchTerm(){this.showPromotions()}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},hasPromotions(){return this.promotions.length>0}},methods:{isNotEmpty:j,onShow(){this.hasLoadedInitialPromotions=!1,this.lastSearchTerm=null,this.searchTerm=null,this.promotions=[],this.showPromotions()},async showPromotions(){var a,t;try{this.isLoadingPromotions=!0;let r={params:{store_id:this.store.id}};this.hasSearchTerm&&(r.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const y=await T.get("/api/promotions",r);if(this.searchTerm===this.lastSearchTerm){const d=y.data;this.promotions=d.data,this.isLoadingPromotions=!1,this.hasLoadedInitialPromotions=!0}}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching promotions";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch promotions:",r)}finally{this.isLoadingPromotions=!1}},onSelectPromotion(a){this.$refs.modal.hideModal(),this.orderState.addCartPromotionUsingPromotion(a)},addNew(){this.$refs.modal.hideModal(),this.orderState.addCartPromotion()}}},Wr={class:"flex justify-center"},qr={key:0,class:"flex justify-center items-center space-x-4 my-2"},Yr={key:1,class:"space-y-2 mb-4"},Gr={class:"w-full space-y-2"},Qr={key:3,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"};function Jr(a,t,r,y,d,e){const l=c("Input"),h=c("Button"),g=c("Skeleton"),m=c("PromotionOptions"),u=c("Modal");return s(),n("div",Wr,[i(u,{ref:"modal",onShow:e.onShow,triggerSize:"sm",leftTriggerIcon:d.Plus,contentClass:"px-4",triggerType:"light",header:"Add Promotion",scrollOnContent:!1,showApproveButton:!1,triggerText:"Add Promotion",triggerLoading:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},{content:x(()=>[d.hasLoadedInitialPromotions?(s(),n("div",qr,[i(l,{type:"search",class:"w-full",debounced:!0,modelValue:d.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=S=>d.searchTerm=S),placeholder:"Search promotions",onInput:t[1]||(t[1]=S=>d.isLoadingPromotions=!0),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},null,8,["modelValue","skeleton"]),i(h,{size:"xs",type:"light",action:e.addNew,leftIcon:d.Plus,buttonClass:"my-2"},{default:x(()=>[...t[2]||(t[2]=[o("span",null,"Add New",-1)])]),_:1},8,["action","leftIcon"])])):_("",!0),d.isLoadingPromotions?(s(),n("div",Yr,[(s(),n(v,null,k([1,2,3],(S,w)=>o("div",{key:w,class:"flex items-center space-x-2 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50 w-full"},[i(g,{width:"w-10",height:"h-10",rounded:"rounded-lg",shine:!0,class:"shrink-0"}),o("div",Gr,[i(g,{width:"w-2/3",shine:!0}),i(g,{width:"w-1/3",shine:!0})])])),64))])):e.hasPromotions?(s(),f(m,{key:2,promotions:d.promotions,onSelectPromotion:e.onSelectPromotion},null,8,["promotions","onSelectPromotion"])):(s(),n("p",Qr," No promotions found "))]),_:1},8,["onShow","leftTriggerIcon","triggerLoading"])])}const Kr=b(Hr,[["render",Jr]]),Xr={inject:["storeState","orderState"],components:{Skeleton:P,AddPromotion:Kr,OrderPromotion:Ir},computed:{hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},cartPromotions(){return this.orderState.orderForm.cart_promotions},isEditting(){return this.$route.name==="edit-order"},hasCartPromotions(){return this.cartPromotions.length>0}}},$r={class:"bg-white rounded-lg p-4 shadow-sm"},es={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},ts={class:"w-full space-y-4"},rs={key:1,class:"space-y-4"};function ss(a,t,r,y,d,e){const l=c("Skeleton"),h=c("OrderPromotion"),g=c("AddPromotion");return s(),n("div",$r,[t[3]||(t[3]=o("h1",{class:"text-lg font-semibold mb-4"},"Promotions",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(s(),n("div",es,[t[0]||(t[0]=o("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg shrink-0"},[o("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.99 14.993 6-6m6 3.001c0 1.268-.63 2.39-1.593 3.069a3.746 3.746 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043 3.745 3.745 0 0 1-3.068 1.593c-1.268 0-2.39-.63-3.068-1.593a3.745 3.745 0 0 1-3.296-1.043 3.746 3.746 0 0 1-1.043-3.297 3.746 3.746 0 0 1-1.593-3.068c0-1.268.63-2.39 1.593-3.068a3.746 3.746 0 0 1 1.043-3.297 3.745 3.745 0 0 1 3.296-1.042 3.745 3.745 0 0 1 3.068-1.594c1.268 0 2.39.63 3.068 1.593a3.745 3.745 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.297 3.746 3.746 0 0 1 1.593 3.068ZM9.74 9.743h.008v.007H9.74v-.007Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm4.125 4.5h.008v.008h-.008v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})])],-1)),o("div",ts,[i(l,{width:"w-full",shine:!0}),i(l,{width:"w-1/3",shine:!0})])])):(s(),n("div",rs,[e.hasCartPromotions?(s(!0),n(v,{key:0},k(e.cartPromotions,(m,u)=>(s(),f(h,{key:u,index:u,cartPromotion:m},null,8,["index","cartPromotion"]))),128)):_("",!0),o("div",{class:O([{"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4":!e.hasCartPromotions}])},[e.hasCartPromotions?_("",!0):(s(),n(v,{key:0},[t[1]||(t[1]=o("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.99 14.993 6-6m6 3.001c0 1.268-.63 2.39-1.593 3.069a3.746 3.746 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043 3.745 3.745 0 0 1-3.068 1.593c-1.268 0-2.39-.63-3.068-1.593a3.745 3.745 0 0 1-3.296-1.043 3.746 3.746 0 0 1-1.043-3.297 3.746 3.746 0 0 1-1.593-3.068c0-1.268.63-2.39 1.593-3.068a3.746 3.746 0 0 1 1.043-3.297 3.745 3.745 0 0 1 3.296-1.042 3.745 3.745 0 0 1 3.068-1.594c1.268 0 2.39.63 3.068 1.593a3.745 3.745 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.297 3.746 3.746 0 0 1 1.593 3.068ZM9.74 9.743h.008v.007H9.74v-.007Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm4.125 4.5h.008v.008h-.008v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})],-1)),t[2]||(t[2]=o("span",{class:"text-sm text-gray-500"},"No promotions added",-1))],64)),i(g)],2)]))])}const os=b(Xr,[["render",ss]]),ns={inject:["formState","storeState","orderState"],components:{Input:C,Skeleton:P},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isEditting(){return this.$route.name==="edit-order"},orderForm(){return this.orderState.orderForm},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder}}},ds={class:"bg-white rounded-lg p-4 shadow-sm"},as={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},is={class:"w-full space-y-4"},ls={key:1,class:"space-y-2"};function cs(a,t,r,y,d,e){const l=c("Skeleton"),h=c("Input");return s(),n("div",ds,[t[5]||(t[5]=o("h1",{class:"text-lg font-semibold mb-4"},"Other",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(s(),n("div",as,[t[4]||(t[4]=o("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg shrink-0"},[o("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])],-1)),o("div",is,[i(l,{width:"w-full",shine:!0}),i(l,{width:"w-1/3",shine:!0})])])):(s(),n("div",ls,[i(h,{rows:"2",label:"Remark",type:"textarea",placeholder:"Optional",modelValue:e.orderForm.remark,"onUpdate:modelValue":t[0]||(t[0]=g=>e.orderForm.remark=g),description:"Visible to customers",errorText:e.formState.getFormError("remark"),onChange:t[1]||(t[1]=g=>e.orderState.saveStateDebounced("Remark changed")),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder,tooltipContent:"Use the Remark field to add a note that will be visible to the customer, such as special instructions, order details, or personalized messages."},null,8,["modelValue","errorText","skeleton"]),i(h,{type:"money",label:"Adjustment",allowNegativeAmounts:!0,currency:e.store.currency.code,modelValue:e.orderForm.adjustment,"onUpdate:modelValue":t[2]||(t[2]=g=>e.orderForm.adjustment=g),errorText:e.formState.getFormError("adjustment"),onChange:t[3]||(t[3]=g=>e.orderState.saveStateDebounced("Adjustment changed")),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder,description:"Modify the order total by adding or subtracting an arbitrary amount",tooltipContent:"Use the Adjustment field to manually add or subtract an amount for discounts, extra charges, or price corrections."},null,8,["currency","modelValue","errorText","skeleton"])]))])}const us=b(ns,[["render",cs]]),ms={inject:["formState","orderState"],components:{Loader:$,AddressInput:ee},props:{index:{type:Number},deliveryMethod:{type:Object}},computed:{orderForm(){return this.orderState.orderForm},selectedDeliveryMethod(){return this.orderState.selectedDeliveryMethod},pinLocationOnMap(){return(this.shoppingCartDeliveryMethodOption||{}).pin_location_on_map||!1},deliveryAddressIsRequired(){return(this.shoppingCartDeliveryMethodOption||{}).delivery_address_is_required||!1},shoppingCartDeliveryMethodOption(){return this.orderState.getShoppingCartDeliveryMethodOption(this.deliveryMethod)},errorText(){return this.formState.getFormError(`delivery_methods.${this.index}.address`)}},methods:{setAddress(a){this.orderState.orderForm.delivery_address=a,this.orderState.saveStateDebounced("Delivery address changed")},unsetAddress(){this.orderState.orderForm.delivery_address=null,this.orderState.saveStateDebounced("Delivery address removed")}},created(){this.orderState.orderForm.delivery_address&&(this.loadingMap=!0,setTimeout(()=>{this.loadingMap=!1},1500))}},hs={key:0,class:"mt-2 pt-2 border-t border-dashed border-gray-200"},gs={key:0,class:"scroll-to-error font-medium text-red-500 text-xs mt-1 ml-1"},ys={key:1,class:"flex items-center justify-center py-2"};function ps(a,t,r,y,d,e){const l=c("Loader"),h=c("AddressInput");return e.deliveryAddressIsRequired?(s(),n("div",hs,[e.errorText?(s(),n("span",gs,p(e.errorText),1)):_("",!0),a.loadingMap?(s(),n("div",ys,[i(l,null,{default:x(()=>[...t[0]||(t[0]=[o("span",{class:"text-sm ml-2"},"Preparing address",-1)])]),_:1})])):(s(),f(h,{key:2,triggerClass:"",onlyValidate:!0,onOnDeleted:e.unsetAddress,onOnValidated:e.setAddress,pinLocationOnMap:e.pinLocationOnMap,address:e.orderForm.delivery_address},null,8,["onOnDeleted","onOnValidated","pinLocationOnMap","address"]))])):_("",!0)}const _s=b(ms,[["render",ps]]),fs={inject:["formState","orderState"],components:{Alert:te,Input:C,Switch:E,Skeleton:P,DeliveryDatePicker:se,DeliveryTimePicker:re},props:{index:{type:Number},deliveryMethod:{type:Object}},data(){return{originalDeliveryDate:null,isLoadingDateOptions:!1,originalDeliveryTimeslot:null,originalDeliveryDateIsPast:!1}},watch:{"orderForm.schedule.change_delivery_schedule"(a){a?this.originalDeliveryDateIsPast&&!this.orderForm.schedule.show_all_dates&&(this.orderForm.delivery_date=null,this.orderForm.delivery_timeslot=null):(this.orderForm.delivery_date=this.originalDeliveryDate,this.orderForm.delivery_timeslot=this.originalDeliveryTimeslot)},"orderForm.schedule.show_all_dates"(a){a?(this.orderForm.delivery_date=this.originalDeliveryDate,this.orderForm.delivery_timeslot=this.originalDeliveryTimeslot):this.originalDeliveryDateIsPast&&(this.orderForm.delivery_date=null,this.orderForm.delivery_timeslot=null),this.orderForm.schedule.show_all_timeslots=a}},computed:{isCreating(){return this.$route.name==="create-order"},shoppingCart(){return this.orderState.shoppingCart},orderForm(){return this.orderState.orderForm},isInspectingShoppingCart(){return this.orderState.isInspectingShoppingCart},deliveryDateIsPast(){return this.orderForm.delivery_date&&B(this.orderForm.delivery_date)},scheduleIsRequired(){return(this.shoppingCartDeliveryMethodOption||{}).schedule_is_required||!1},scheduleIncompleteReasons(){return(this.shoppingCartDeliveryMethodOption||{}).schedule_incomplete_reasons||[]},shoppingCartDeliveryMethodOption(){return this.orderState.getShoppingCartDeliveryMethodOption(this.deliveryMethod)},errorText(){return this.formState.getFormError(`delivery_methods.${this.index}.schedule`)}},methods:{formattedShortWeekday:H,onIsLoadingDateOptions(a){this.isLoadingDateOptions=a}},created(){this.originalDeliveryDate=this.orderForm.delivery_date,this.originalDeliveryTimeslot=this.orderForm.delivery_timeslot,this.originalDeliveryDateIsPast=this.originalDeliveryDate&&B(this.originalDeliveryDate)}},vs={key:0,class:"space-y-4 pt-4 px-4"},Ss={class:"space-y-2"},ws={class:"text-sm text-gray-500"},bs={key:0,class:"space-y-2"},xs={class:"flex items-center space-x-4"},ks={key:0,class:"scroll-to-error font-medium text-red-500 text-xs mt-1 ml-1"},Ps={key:1,class:"flex items-center space-x-1 md:space-x-2"},Cs={class:"font-medium text-red-500 text-xs md:text-sm"},Os={key:2,class:"space-y-2 border-t border-b border-dashed border-gray-300 py-4"},Fs={key:0,class:"text-sm"},Ds={class:"font-bold"},Ls={key:1,class:"text-sm"},Ms={class:"font-bold"};function Ts(a,t,r,y,d,e){const l=c("Switch"),h=c("Input"),g=c("Alert"),m=c("DeliveryDatePicker"),u=c("DeliveryTimePicker"),S=c("Skeleton");return e.scheduleIsRequired?(s(),n("div",vs,[o("div",Ss,[t[8]||(t[8]=o("p",{class:"font-bold text-md"},"Schedule",-1)),o("div",null,[o("p",ws,[r.deliveryMethod.schedule_type=="date"?(s(),n(v,{key:0},[e.isCreating?(s(),n(v,{key:0},[F("Specify the delivery date for this order")],64)):(s(),n(v,{key:1},[F("The delivery date for this order")],64))],64)):r.deliveryMethod.schedule_type=="date and time"?(s(),n(v,{key:1},[e.isCreating?(s(),n(v,{key:0},[F("Specify the delivery date and time for this order")],64)):(s(),n(v,{key:1},[F("The delivery date and time for this order")],64))],64)):_("",!0)])])]),d.originalDeliveryDate?(s(),n("div",bs,[o("div",xs,[i(l,{size:"xs",suffixText:"Change delivery schedule",modelValue:e.orderForm.schedule.change_delivery_schedule,"onUpdate:modelValue":t[0]||(t[0]=w=>e.orderForm.schedule.change_delivery_schedule=w),onChange:t[1]||(t[1]=w=>e.orderState.saveStateDebounced(`Change delivery schedule (${e.orderForm.schedule.change_delivery_schedule?"On":"Off"})`))},null,8,["modelValue"]),e.orderForm.schedule.change_delivery_schedule?(s(),f(h,{key:0,type:"checkbox",modelValue:e.orderForm.schedule.show_all_dates,"onUpdate:modelValue":t[2]||(t[2]=w=>e.orderForm.schedule.show_all_dates=w),inputLabel:r.deliveryMethod.schedule_type=="date"?"Show all dates":"Show all dates and timeslots",onChange:t[3]||(t[3]=w=>e.orderState.saveStateDebounced(`Show all ${r.deliveryMethod.schedule_type=="date"?"dates":"dates and timeslots"} (${e.orderForm.schedule.show_all_dates?"On":"Off"})`))},null,8,["modelValue","inputLabel"])):_("",!0)]),e.orderForm.schedule.change_delivery_schedule&&e.deliveryDateIsPast?(s(),f(g,{key:0,type:"warning",dismissable:!0,title:"Delivery date passed",description:"Update the delivery date to a future date if the order hasnt been delivered, otherwise ignore this message."})):_("",!0)])):_("",!0),!d.originalDeliveryDate||d.originalDeliveryDate&&e.orderForm.schedule.change_delivery_schedule?(s(),n(v,{key:1},[e.errorText?(s(),n("span",ks,p(e.errorText),1)):_("",!0),i(m,{deliveryMethod:r.deliveryMethod,onIsLoading:e.onIsLoadingDateOptions,modelValue:e.orderForm.delivery_date,"onUpdate:modelValue":t[4]||(t[4]=w=>e.orderForm.delivery_date=w),showAllDates:e.orderForm.schedule.show_all_dates,onChange:t[5]||(t[5]=w=>this.orderState.saveStateDebounced("Delivery date changed"))},null,8,["deliveryMethod","onIsLoading","modelValue","showAllDates"]),e.orderForm.delivery_date&&!d.isLoadingDateOptions&&r.deliveryMethod.schedule_type=="date and time"?(s(),f(u,{key:1,class:"w-full",deliveryMethod:r.deliveryMethod,autoSelectFirstTimeslot:e.isCreating,modelValue:e.orderForm.delivery_timeslot,"onUpdate:modelValue":t[6]||(t[6]=w=>e.orderForm.delivery_timeslot=w),deliveryDate:e.orderForm.delivery_date,showAllDates:e.orderForm.schedule.show_all_dates,showAllTimeslots:e.orderForm.schedule.show_all_timeslots,onChange:t[7]||(t[7]=w=>this.orderState.saveStateDebounced("Delivery time changed"))},null,8,["deliveryMethod","autoSelectFirstTimeslot","modelValue","deliveryDate","showAllDates","showAllTimeslots"])):_("",!0),(s(!0),n(v,null,k(e.scheduleIncompleteReasons,(w,L)=>(s(),n("div",{key:L},[e.isInspectingShoppingCart?(s(),f(S,{key:0,width:"w-1/3",shine:!0})):(s(),n("div",Ps,[t[9]||(t[9]=o("svg",{class:"w-4 h-4 md:w-6 md:h-6 shrink-0 text-red-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})],-1)),o("span",Cs,p(w),1)]))]))),128))],64)):_("",!0),e.orderForm.delivery_date||e.orderForm.delivery_timeslot?(s(),n("div",Os,[e.orderForm.delivery_date?(s(),n("div",Fs,[t[10]||(t[10]=o("span",null,"Delivery date: ",-1)),o("span",Ds,p(e.orderForm.delivery_date)+" ("+p(e.formattedShortWeekday(e.orderForm.delivery_date))+") ",1)])):_("",!0),e.orderForm.delivery_timeslot?(s(),n("div",Ls,[t[11]||(t[11]=o("span",null,"Delivery time: ",-1)),o("span",Ms,p(e.orderForm.delivery_timeslot),1)])):_("",!0)])):_("",!0)])):_("",!0)}const Is=b(fs,[["render",Ts]]),js={inject:["formState","orderState"],components:{Info:ne,CircleAlert:oe,Skeleton:P,OrderDeliveryMethodMap:_s,OrderDeliveryMethodSchedule:Is},props:{index:{type:Number},deliveryMethod:{type:Object}},computed:{shoppingCart(){return this.orderState.shoppingCart},orderForm(){return this.orderState.orderForm},isInspectingShoppingCart(){return this.orderState.isInspectingShoppingCart},usesFlatFee(){return this.deliveryMethod.fee_type=="flat fee"},usesPercentageFee(){return this.deliveryMethod.fee_type=="percentage fee"},usesFeeByWeight(){return this.deliveryMethod.fee_type=="fee by weight"},usesFeeByDistance(){return this.deliveryMethod.fee_type=="fee by distance"},usesFeeByPostalCode(){return this.deliveryMethod.fee_type=="fee by postal code"},isSelectedDeliveryMethod(){return this.orderForm.delivery_method_id===this.deliveryMethod.id},shoppingCartDeliveryMethodOption(){return((this.shoppingCart||{}).delivery_method_options||[]).find(a=>a.id==this.deliveryMethod.id)},amount(){return(this.shoppingCartDeliveryMethodOption||{}).amount},offersFreeDelivery(){return(this.shoppingCartDeliveryMethodOption||{}).free_delivery},tips(){return(this.shoppingCartDeliveryMethodOption||{}).tips||[]},unavailabilityReasons(){return(this.shoppingCartDeliveryMethodOption||{}).unavailability_reasons||[]},hasTips(){return this.tips.length>0},hasUnavailabilityReasons(){return this.unavailabilityReasons.length>0},errorText(){return this.formState.getFormError(`delivery_methods.${this.index}`)}},methods:{selectDeliveryMethod(){this.orderForm.delivery_method_id=this.deliveryMethod.id,this.orderState.saveStateDebounced("Delivery method changed")}}},Vs={class:"flex items-center space-x-2"},As={key:0,class:"w-6 h-6 text-green-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},Es={key:1,class:"w-6 h-6 flex justify-center items-center"},Ns={class:"w-full"},Rs={class:"font-bold text-sm transition-colors"},Bs={class:"text-sm transition-colors"},Us={key:0,class:"text-sm transition-colors text-green-500 font-bold"},Zs={key:1,class:"text-sm transition-colors"},zs={key:2,class:"text-sm transition-colors"},Hs={key:3,class:"text-sm transition-colors"},Ws={key:4,class:"text-sm transition-colors"},qs={key:5,class:"text-sm transition-colors"},Ys={key:1,class:"bg-red-50 mt-2 p-4"},Gs={key:1,class:"flex items-center space-x-1 md:space-x-2"},Qs={key:2,class:"bg-blue-50 mt-2 p-4"},Js={key:1,class:"flex items-center space-x-1 md:space-x-2"},Ks={class:"font-medium italic text-xs md:text-sm text-blue-500"},Xs={key:0,class:"scroll-to-error font-medium text-red-500 text-xs mt-1 ml-1"};function $s(a,t,r,y,d,e){const l=c("Skeleton"),h=c("Info"),g=c("OrderDeliveryMethodSchedule"),m=c("OrderDeliveryMethodMap");return s(),n("div",{onClick:t[0]||(t[0]=q((...u)=>e.selectDeliveryMethod&&e.selectDeliveryMethod(...u),["stop"])),class:"cursor-pointer p-4 bg-gray-50 border border-gray-300 rounded-lg transition-colors group"},[o("div",Vs,[i(W,{name:"fade-1",mode:"out-in"},{default:x(()=>[e.isSelectedDeliveryMethod?(s(),n("svg",As,[...t[1]||(t[1]=[o("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"},null,-1)])])):(s(),n("div",Es,[...t[2]||(t[2]=[o("div",{class:"w-4 h-4 bg-gray-100 border border-gray-300 rounded-full"},null,-1)])]))]),_:1}),o("div",Ns,[o("p",Rs,p(r.deliveryMethod.name),1),o("p",Bs,p(r.deliveryMethod.description),1),r.deliveryMethod.charge_fee&&(e.offersFreeDelivery||e.amount)?(s(),n(v,{key:0},[e.offersFreeDelivery?(s(),n("p",Us," Free delivery ")):e.usesFlatFee?(s(),n("p",Zs," Flat fee of "+p(e.amount.amount_with_currency),1)):e.usesPercentageFee?(s(),n("p",zs," Percentage fee of "+p(e.amount.amount_with_currency)+" ("+p(r.deliveryMethod.percentage_fee_rate)+"%) ",1)):e.usesFeeByWeight?(s(),n("p",Hs," Weight fee of "+p(e.amount.amount_with_currency)+" ("+p(e.shoppingCartDeliveryMethodOption.weight.text)+") ",1)):e.usesFeeByDistance?(s(),n("p",Ws," Distance fee of "+p(e.amount.amount_with_currency)+" ("+p(e.shoppingCartDeliveryMethodOption.distance.text)+") ",1)):e.usesFeeByPostalCode?(s(),n("p",qs," Distance fee of "+p(e.amount.amount_with_currency)+" ("+p(e.shoppingCartDeliveryMethodOption.distance.text)+") ",1)):_("",!0)],64)):_("",!0),e.hasUnavailabilityReasons?(s(),n("div",Ys,[(s(!0),n(v,null,k(e.unavailabilityReasons,(u,S)=>(s(),n("div",{key:S},[e.isInspectingShoppingCart?(s(),f(l,{key:0,width:"w-1/3",shine:!0})):(s(),n("div",Gs,[i(h,{size:"16",class:O(["shrink-0",e.isSelectedDeliveryMethod?"text-red-500":"text-blue-500"])},null,8,["class"]),o("span",{class:O(["font-medium italic text-xs md:text-sm",e.isSelectedDeliveryMethod?"text-red-500":"text-blue-500"])},p(u),3)]))]))),128))])):_("",!0),e.hasTips&&!e.hasUnavailabilityReasons?(s(),n("div",Qs,[(s(!0),n(v,null,k(e.tips,(u,S)=>(s(),n("div",{key:S},[e.isInspectingShoppingCart?(s(),f(l,{key:0,width:"w-1/3",shine:!0})):(s(),n("div",Js,[i(h,{size:"16",class:"shrink-0 text-blue-500"}),o("span",Ks,p(u),1)]))]))),128))])):_("",!0)])]),e.isSelectedDeliveryMethod?(s(),n(v,{key:0},[e.errorText?(s(),n("span",Xs,p(e.errorText),1)):_("",!0),i(g,{index:r.index,deliveryMethod:r.deliveryMethod},null,8,["index","deliveryMethod"]),i(m,{index:r.index,deliveryMethod:r.deliveryMethod},null,8,["index","deliveryMethod"])],64)):_("",!0)])}const eo=b(js,[["render",$s]]),to={inject:["formState","storeState","orderState","notificationState"],components:{Skeleton:P,OrderDeliveryMethod:eo},watch:{store(a,t){!t&&a&&this.showDeliveryMethods()}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},orderForm(){return this.orderState.orderForm},isEditting(){return this.$route.name==="edit-order"},deliveryMethod(){return this.orderState.deliveryMethod},deliveryMethods(){return this.orderState.deliveryMethods},hasDeliveryMethods(){return this.orderState.hasDeliveryMethods},errorText(){return this.formState.getFormError("delivery_methods")}},methods:{async showDeliveryMethods(){var a,t;try{this.orderState.isLoadingDeliveryMethods=!0;let r={params:{per_page:100,store_id:this.store.id}};const d=(await T.get("/api/delivery-methods",r)).data;this.orderState.deliveryMethods=d.data}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching delivery methods";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch delivery methods:",r)}finally{this.orderState.isLoadingDeliveryMethods=!1}}},created(){this.store&&this.showDeliveryMethods()}},ro={class:"bg-white rounded-lg p-4 shadow-sm"},so={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},oo={class:"w-full space-y-4"},no={key:1,class:"space-y-2"},ao={key:0,class:"scroll-to-error font-medium text-red-500 text-xs mt-1 ml-1"},io={key:1,class:"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4 my-4"};function lo(a,t,r,y,d,e){const l=c("Skeleton"),h=c("OrderDeliveryMethod");return s(),n("div",ro,[t[3]||(t[3]=o("h1",{class:"text-lg font-semibold mb-4"},"Delivery Method",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(s(),n("div",so,[t[0]||(t[0]=o("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg shrink-0"},[o("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})])],-1)),o("div",oo,[i(l,{width:"w-full",shine:!0}),i(l,{width:"w-1/3",shine:!0})])])):(s(),n("div",no,[e.hasDeliveryMethods?(s(),n(v,{key:0},[(s(!0),n(v,null,k(e.deliveryMethods,(g,m)=>(s(),f(h,{key:m,index:m,deliveryMethod:g},null,8,["index","deliveryMethod"]))),128)),e.errorText?(s(),n("span",ao,p(e.errorText),1)):_("",!0)],64)):(s(),n("div",io,[e.hasDeliveryMethods?_("",!0):(s(),n(v,{key:0},[t[1]||(t[1]=o("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 0 0-3.213-9.193 2.056 2.056 0 0 0-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 0 0-10.026 0 1.106 1.106 0 0 0-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12"})],-1)),t[2]||(t[2]=o("span",{class:"text-sm text-gray-500"},"No delivery methods",-1))],64))]))]))])}const co=b(to,[["render",lo]]),uo={inject:["formState","orderState","storeState","changeHistoryState","notificationState"],components:{OrderFees:Se,OrderBasics:Ce,OrderTotals:rt,OrderCustomer:Ot,OrderProducts:Cr,OrderPromotions:os,OrderMiscellaneous:us,OrderDeliveryMethods:co},data(){return{shoppingCartReady:!1}},watch:{orderForm:{handler(a){a&&(this.shoppingCartReady?(this.orderState.setIsInspectingShoppingCart(!0),this.inspectShoppingCartDelayed()):this.shoppingCartReady=!0)},deep:!0}},computed:{store(){return this.storeState.store},orderForm(){return this.orderState.orderForm},isEditing(){return this.$route.name==="edit-order"},isCreating(){return this.$route.name==="create-order"}},methods:{inspectShoppingCartDelayed:Y(function(){this.changeHistoryState.hasChanges?this.inspectShoppingCart():(this.orderState.setShoppingCart(null),this.orderState.setIsInspectingShoppingCart(!1))},1e3),async inspectShoppingCart(){var a,t;try{this.orderState.setIsInspectingShoppingCart(!0);const r={inspect:!0,...this.orderForm,store_id:this.store.id,association:"team member"},y=await axios.post("/api/orders",r);this.orderState.setShoppingCart(y.data)}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while inspecting shopping cart";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to inspect shopping cart:",r)}finally{this.orderState.setIsInspectingShoppingCart(!1)}}}},mo={class:"select-none grid grid-cols-12 gap-4 mb-40"},ho={class:"col-span-8 space-y-4"},go={class:"col-span-4 space-y-4"};function yo(a,t,r,y,d,e){const l=c("OrderProducts"),h=c("OrderPromotions"),g=c("OrderFees"),m=c("OrderDeliveryMethods"),u=c("OrderMiscellaneous"),S=c("OrderTotals"),w=c("OrderCustomer"),L=c("OrderBasics");return s(),n("div",mo,[o("div",ho,[i(l),i(h),i(g),i(m),i(u),i(S)]),o("div",go,[i(w),i(L)])])}const $o=b(uo,[["render",yo]]);export{$o as default};
