import{i as x}from"./index-ChmBBGBv.js";import{I as C}from"./Input-Ch5FVRoG.js";import{M}from"./Modal-X3iEO6Sa.js";import{H as h,d as y,g as m,r as A,o as d,b as r,k as w,c as n,e as u,t as f,F as _,a as c}from"./app-811fDb4C.js";import{B as k}from"./Button-0Fhg4Aii.js";import{a as F}from"./stringUtils-Bvzw0-oW.js";import{G as O}from"./GoogleMaps-RFPisK6o.js";import{S as V}from"./SelectCountry-CJD2sKOm.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as E}from"./refresh-ccw-fYK0zSuq.js";import{M as T}from"./move-left-C1am2jSW.js";import{T as N}from"./trash-2-COAOku7K.js";import{P as I}from"./plus-BU4OPlaU.js";const B={inject:["formState","notificationState"],components:{Input:C,Modal:M,Button:k,GoogleMaps:O,SelectCountry:V},props:{address:{type:[Object,null],default:null},ownerId:{type:[String,null],default:null},ownerType:{type:[String,null],default:null},title:{type:String,default:null},subtitle:{type:String,default:null},pinLocationOnMap:{type:Boolean,default:!0},onlyValidate:{type:Boolean,default:!1},editable:{type:Boolean,default:!0},height:{type:String,default:"350px"},triggerClass:{type:String,default:"space-y-4 p-4 border border-gray-300 rounded-lg shadow-lg bg-white"},triggerText:{type:String,default:"Add Address"},targetClass:{type:String,default:"body"}},emits:["change","onValidated","onCreated","onUpdated","onDeleted"],data(){return{Plus:I,Trash2:N,step:1,MoveLeft:T,RefreshCcw:E,form:{city:null,state:null,country:"BW",place_id:null,latitude:null,longitude:null,postal_code:null,address_line:null,address_line2:null,owner_id:this.ownerId,owner_type:this.ownerType},originalForm:null,localAddress:null,isSubmitting:!1,previewLatitude:null,previewLongitude:null,countryAddressOptions:[],isLoadingCountryAddressOptions:!1}},watch:{address(t){this.setFields(t),this.localAddress=t}},computed:{submitText(){return this.pinLocationOnMap&&this.step==1?"Next":this.localAddress?"Save Address":"Add Address"},cityWrapperClass(){const t=this.countryAddressOption.state.required,i=this.countryAddressOption.postal_code.required;return t&&i||!t&&!i?"col-span-1":"col-span-2"},countryWrapperClass(){const t=this.countryAddressOption.city.required,i=this.countryAddressOption.state.required,e=this.countryAddressOption.postal_code.required;return t||i||e?"col-span-1":"col-span-2"},hasCountryAddressOption(){return Object.keys(this.countryAddressOptions).length>0},countryAddressOption(){return this.hasCountryAddressOption?this.countryAddressOptions[this.form.country]:null},googleMapsAddress(){var t=this.form.address_line;return this.isNotEmpty(this.form.address_line2)&&(t+=", "+this.form.address_line2),this.isNotEmpty(this.form.city)&&(t+=", "+this.form.city),this.isNotEmpty(this.form.state)&&(t+=", "+this.form.state),this.isNotEmpty(this.form.postal_code)&&(t+=", "+this.form.postal_code),this.isNotEmpty(this.form.country)&&(t+=", "+this.form.country),t},hasAddress(){var t;return((t=this.address)==null?void 0:t.id)!=null},formHasChanged(){var t=h(this.form),i=h(this.originalForm);return!x(t,i)},mustSaveChanges(){return this.formHasChanged&&!this.isSubmitting}},methods:{isNotEmpty:F,showModal(){this.step=1,this.copyOriginalForm(),this.$refs.modal.showModal()},hideModal(){this.$refs.modal.hideModal()},markerMoved(t){this.form.place_id=null,this.form.latitude=t.latitude,this.form.longitude=t.longitude},addedMarker(t){this.form.place_id=t.place_id,this.form.latitude=t.latitude,this.form.longitude=t.longitude},setFields(t){t?(this.form.city=t.city,this.form.state=t.state,this.form.country=t.country,this.form.place_id=t.place_id,this.form.owner_id=t.owner_id,this.form.owner_type=t.owner_type,this.form.postal_code=t.postal_code,this.form.address_line=t.address_line,this.form.address_line2=t.address_line2,this.form.latitude=t.latitude?parseFloat(t.latitude):null,this.form.longitude=t.longitude?parseFloat(t.longitude):null,this.previewLatitude=this.form.latitude,this.previewLongitude=this.form.longitude):(this.form.city=null,this.form.state=null,this.form.country="BW",this.form.place_id=null,this.form.latitude=null,this.form.longitude=null,this.form.postal_code=null,this.form.address_line=null,this.form.address_line2=null,this.previewLatitude=null,this.previewLongitude=null),this.originalForm=h(this.form)},copyOriginalForm(){this.form=h(this.originalForm)},submit(){this.pinLocationOnMap&&this.step==1?this.step=2:this.onlyValidate?this.validateAddress():this.hasAddress?this.updateAddress():this.createAddress()},async showCountryAddressOptions(){var t,i;try{this.isLoadingCountryAddressOptions=!0;const e=await axios.get("/api/addresses/country/options");this.countryAddressOptions=e.data}catch(e){const l=((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Something went wrong while fetching country address options";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to fetch country address options:",e)}finally{this.isLoadingCountryAddressOptions=!1}},async validateAddress(){var t,i;try{this.isSubmitting=!0;const e={...this.form},l=await axios.post("/api/addresses/validate",e);this.localAddress=l.data,this.setFields(this.localAddress);let s=h(this.localAddress);this.$emit("onValidated",s),this.$emit("change",s),this.hideModal()}catch(e){const l=((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Something went wrong while validating address";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to validate address:",e)}finally{this.isSubmitting=!1}},async createAddress(){var t,i;try{this.isSubmitting=!0;const e={return:"1",...this.form},l=await axios.post("/api/addresses",e);this.localAddress=l.data,this.setFields(this.localAddress);let s=h(this.localAddress);this.$emit("onCreated",s),this.$emit("change",s),this.notificationState.showSuccessNotification("Address created"),this.hideModal()}catch(e){const l=((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Something went wrong while creating address";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to create address:",e)}finally{this.isSubmitting=!1}},async updateAddress(){var t,i;try{this.isSubmitting=!0;const e={return:"1",...this.form},l=await axios.put(`/api/addresses/${this.localAddress.id}`,e);this.localAddress=l.data,this.setFields(this.localAddress);let s=h(this.localAddress);this.$emit("onUpdated",s),this.$emit("change",s),this.notificationState.showSuccessNotification("Address updated"),this.hideModal()}catch(e){const l=((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Something went wrong while updating address";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to update address:",e)}finally{this.isSubmitting=!1}},async deleteAddress(){var t,i;try{if(!this.hasAddress){this.$emit("onDeleted"),this.$emit("change"),this.localAddress=null,this.setFields(null),this.hideModal();return}this.isSubmitting=!0;const e=await axios.delete(`/api/addresses/${this.localAddress.id}`);this.setFields(null),this.localAddress=null,this.$emit("onDeleted"),this.$emit("change"),this.notificationState.showSuccessNotification("Address deleted"),this.hideModal()}catch(e){const l=((i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.message)||(e==null?void 0:e.message)||"Something went wrong while deleting address";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to delete address:",e)}finally{this.isSubmitting=!1}}},created(){this.setFields(this.address),this.showCountryAddressOptions(),this.localAddress=this.address}},q={class:"grid grid-cols-2 gap-2"},W={class:"font-lg font-bold my-2"},D={class:"col-span-2 space-y-2"},R={key:1,class:"col-span-1"},U={key:2,class:"col-span-1"},z={key:2,class:"col-span-2"},j={class:"col-span-2 flex space-x-2 mt-4"},G={key:0,class:"flex items-center font-lg font-bold"},H={key:1,class:"text-sm text-gray-500 mb-2 pb-4 border-b border-dashed border-gray-300"},P={key:0,class:"space-y-2 mb-4"},Z={class:"text-sm"},J={class:"flex justify-end items-center space-x-2"};function K(t,i,e,l,s,o){const g=A("Input"),b=A("SelectCountry"),S=A("GoogleMaps"),p=A("Button"),v=A("Modal");return d(),y(v,{ref:"modal",showFooter:!1,scrollOnContent:!1,targetClass:e.targetClass},{content:m(()=>[r("div",q,[r("h1",W,f(s.localAddress?"Edit Address":"Add Address"),1),s.isLoadingCountryAddressOptions?(d(),n(_,{key:0},[],64)):s.step==1?(d(),n(_,{key:1},[r("div",D,[c(g,{type:"text",modelValue:s.form.address_line,"onUpdate:modelValue":i[0]||(i[0]=a=>s.form.address_line=a),placeholder:"Street address",errorText:o.formState.getFormError("address_line")},null,8,["modelValue","errorText"]),c(g,{type:"text",modelValue:s.form.address_line2,"onUpdate:modelValue":i[1]||(i[1]=a=>s.form.address_line2=a),errorText:o.formState.getFormError("address_line2"),placeholder:"Apartment, unit number, suite, etc. (optional)"},null,8,["modelValue","errorText"])]),o.countryAddressOption.city.required?(d(),n("div",{key:0,class:w(o.cityWrapperClass)},[c(g,{type:"text",modelValue:s.form.city,"onUpdate:modelValue":i[2]||(i[2]=a=>s.form.city=a),errorText:o.formState.getFormError("city"),placeholder:o.countryAddressOption.city.label},null,8,["modelValue","errorText","placeholder"])],2)):u("",!0),o.countryAddressOption.state.required?(d(),n("div",R,[c(g,{type:"text",modelValue:s.form.state,"onUpdate:modelValue":i[3]||(i[3]=a=>s.form.state=a),errorText:o.formState.getFormError("state"),placeholder:o.countryAddressOption.state.label},null,8,["modelValue","errorText","placeholder"])])):u("",!0),o.countryAddressOption.postal_code.required?(d(),n("div",U,[c(g,{type:"text",modelValue:s.form.postal_code,"onUpdate:modelValue":i[4]||(i[4]=a=>s.form.postal_code=a),errorText:o.formState.getFormError("postal_code"),placeholder:o.countryAddressOption.postal_code.label},null,8,["modelValue","errorText","placeholder"])])):u("",!0),r("div",{class:w(o.countryWrapperClass)},[c(b,{class:"w-full",modelValue:s.form.country,"onUpdate:modelValue":i[5]||(i[5]=a=>s.form.country=a)},null,8,["modelValue"])],2)],64)):s.step==2?(d(),n("div",z,[c(S,{height:"350px",onMarkerMoved:o.markerMoved,onAddedMarker:o.addedMarker,address:o.googleMapsAddress,placeId:o.mustSaveChanges?null:s.form.place_id,latitude:o.mustSaveChanges?null:s.form.latitude,longitude:o.mustSaveChanges?null:s.form.longitude},null,8,["onMarkerMoved","onAddedMarker","address","placeId","latitude","longitude"])])):u("",!0),r("div",j,[s.step==1&&s.localAddress?(d(),y(p,{key:0,size:"sm",type:"danger",action:o.deleteAddress,disabled:s.isSubmitting},{default:m(()=>[...i[6]||(i[6]=[r("span",null,"Delete",-1)])]),_:1},8,["action","disabled"])):u("",!0),s.step==2?(d(),y(p,{key:1,size:"sm",type:"light",class:"w-24",leftIcon:s.MoveLeft,action:()=>s.step=1},{default:m(()=>[...i[7]||(i[7]=[r("span",null,"Back",-1)])]),_:1},8,["leftIcon","action"])):u("",!0),c(p,{size:"sm",type:"primary",action:o.submit,buttonClass:"w-full",wrapperClass:"w-full",disabled:!e.pinLocationOnMap&&!o.mustSaveChanges},{default:m(()=>[r("span",null,f(o.submitText),1)]),_:1},8,["action","disabled"])])])]),trigger:m(()=>[r("div",{class:w(e.triggerClass)},[e.title?(d(),n("h1",G,[i[8]||(i[8]=r("svg",{class:"w-6 h-6 mr-2 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})],-1)),r("span",null,f(e.title),1)])):u("",!0),e.subtitle?(d(),n("p",H,f(e.subtitle),1)):u("",!0),e.editable?(d(),n(_,{key:2},[s.localAddress?(d(),n("div",P,[r("p",Z,f(s.localAddress.complete_address),1),r("div",J,[c(p,{size:"xs",type:"light",action:o.showModal,leftIcon:s.RefreshCcw},{default:m(()=>[...i[9]||(i[9]=[r("span",{class:"whitespace-nowrap ml-1"},"Change",-1)])]),_:1},8,["action","leftIcon"]),c(p,{size:"xs",leftIcon:s.Trash2,type:"outlineDanger",action:o.deleteAddress,disabled:s.isSubmitting},null,8,["leftIcon","action","disabled"])])])):(d(),y(p,{key:1,size:"xs",type:"light",leftIcon:s.Plus,action:o.showModal,buttonClass:"w-full"},{default:m(()=>[r("span",null,f(e.triggerText),1)]),_:1},8,["leftIcon","action"]))],64)):u("",!0),s.previewLatitude&&s.previewLongitude?(d(),y(S,{key:3,height:e.height,gmpDraggable:!1,latitude:s.previewLatitude,longitude:s.previewLongitude},null,8,["height","latitude","longitude"])):u("",!0)],2)]),_:1},8,["targetClass"])}const ne=L(B,[["render",K]]);export{ne as A};
