import{c as i,b as o,d as h,e as f,t as _,i as w,F as x,a as l,g as p,f as R,z as W,r as d,o as a,k as v,w as N}from"./app-BdtgzR1l.js";import{Q as z}from"./browser-DAxVTFCT.js";import{a as U,C as j}from"./Copy-DcyQ5giz.js";import{L as B}from"./Loader-DFjvkDgo.js";import{B as E}from"./Button-HzXB0hWC.js";import{S as Q}from"./Skeleton-BWgMm33A.js";import{V as A}from"./vue-slide-up-down-cMbdnVIh.js";import{S as D}from"./StoreLogo-CBj6UzC0.js";import{a as F}from"./stringUtils-Bvzw0-oW.js";import{W as q}from"./WhatsappIcon-C1Z43tYr.js";import{W as V}from"./WhatsappMessage-g6kMYpGT.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as H}from"./chevron-down-BXvwokPa.js";import{C as Y}from"./chevron-up-fRpV2ekC.js";import{R as J}from"./receipt-text-CodbZQV5.js";import{A as K}from"./arrow-left-LEjw8PsW.js";import"./ShineEffect-Dr0WlC0V.js";import"./createLucideIcon-BOaOvfG7.js";import"./plus-YSNtgxvu.js";import"./trash-2-BsHN7UDw.js";const X={inject:["formState","storeState","orderState","notificationState"],components:{Copy:U,Loader:B,Button:E,Skeleton:Q,VueSlideUpDown:A,ReceiptText:J,ChevronUp:Y,ChevronDown:H,StoreLogo:D,WhatsappIcon:q,WhatsappMessage:V},data(){return{CopyIcon:j,ArrowLeft:K,qrCode:null,clicked:!1,storePaymentMethod:null,now:W().format("HH:mm"),isCreatingTransaction:!1,isLoadingStorePaymentMethod:!1,accordions:[{label:"Open in external browser",expanded:!1},{label:"Send order details manually",expanded:!1},{label:"Scan QR code to open this page on your mobile",expanded:!1}]}},watch:{order(s,e){!e&&s&&this.setup()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},storePaymentMethodId(){return this.$route.query.store_payment_method_id??null},orderUrl(){return`${window.location.origin+this.$router.resolve({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}}).href}`},currentPageUrl(){return window.location.origin+this.$router.resolve({name:"show-shop-confirming-payment",params:{alias:this.store.alias,order_id:this.order.id}}).href},whatsappMessage(){if(this.order){let s="";s+=`*Order #${this.order.number}*
`;for(let n=0;n<this.order.order_products.length;n++){const t=this.order.order_products[n];s+=`
*${t.quantity}x* ${t.name} ${t.grand_total.amount_with_currency}`}s+=`

*Grand Total: ${this.order.grand_total.amount_with_currency}* (Qty: ${this.order.total_uncancelled_product_quantities})
`;const e=this.isNotEmpty(this.order.customer_name),r=this.isNotEmpty(this.order.customer_email),c=this.isNotEmpty(this.order.customer_mobile_number);return e&&(s+=`
Name: ${this.order.customer_name}`),c&&(s+=`
Mobile: ${this.order.customer_mobile_number.international}`),r&&(s+=`
Email: ${this.order.customer_email}`),(e||c||r)&&(s+=`
`),this.storePaymentMethod!=null&&(s+=`
Payment : ${this.storePaymentMethod.name} (Confirm Payment)
`),this.order.delivery_method!=null&&(s+=`
Delivery: ${this.order.delivery_method.name}`),this.order.delivery_address!=null&&(s+=`
Address: ${this.order.delivery_address.complete_address}`),s+=`

See invoice ${this.orderUrl}`,s}return null}},methods:{isNotEmpty:F,async setup(){this.store&&this.order&&(this.generateQRCode(),await this.showStorePaymentMethod(),["paid"].includes(this.order.payment_status)||this.createTransaction())},toggleAccordian(s){for(let e=0;e<this.accordions.length;e++)e==s?this.accordions[e].expanded=!this.accordions[e].expanded:this.accordions[e].expanded=!1},async generateQRCode(){try{this.qrCode=await z.toDataURL(this.currentPageUrl,{margin:2,width:150,color:{dark:"#000000",light:"#ffffff"}})}catch(s){console.error("Failed to generate QR code:",s)}},async navigateToShowShopOrder(){await this.$router.push({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}})},async navigateToStorefront(){await this.$router.push({name:"show-storefront",params:{alias:this.store.alias}})},sendUsingWhatsapp(){const s=this.store.whatsapp_mobile_number?`phone=${this.store.whatsapp_mobile_number.international.replace("+","")}&`:"";window.open(`https://wa.me/?${s}text=${encodeURIComponent(this.whatsappMessage)}`,"_blank"),this.clicked=!0},async showStorePaymentMethod(){var s,e;try{this.isLoadingStorePaymentMethod=!0;let r={params:{_relationships:["logo","paymentMethod"].join(",")}};const c=await axios.get(`/api/store-payment-methods/${this.storePaymentMethodId}`,r);this.storePaymentMethod=c.data}catch(r){const c=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Something went wrong while fetching payment method";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(r),console.error("Failed to fetch payment method:",r)}finally{this.isLoadingStorePaymentMethod=!1}},async createTransaction(){var s,e;try{this.isCreatingTransaction=!0;const r={owner_type:"order",owner_id:this.order.id,store_id:this.store.id,currency:this.store.currency,payment_status:"waiting confirmation",amount:this.order.outstanding_total.amount,store_payment_method_id:this.storePaymentMethod.id};console.log("createTransaction !!!"),console.log("createTransaction !!!"),console.log("createTransaction !!!"),console.log("createTransaction !!!"),console.log("createTransaction !!!"),await axios.post("/api/transactions",r)}catch(r){const c=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Something went wrong while creating payment";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(r),console.error("Failed to create payment:",r)}finally{this.isCreatingTransaction=!1}}},created(){this.setup()}},Z={class:"select-none max-w-xl mx-auto pt-16"},$={class:"p-4 flex items-center space-x-4"},ee={class:"w-full flex justify-between space-x-4"},te={class:"w-full"},oe={key:1,class:"text-gray-700 font-semibold text-sm"},se={key:3,class:"text-gray-500 text-sm"},re={key:1,class:"text-right text-gray-400 text-xs"},ae={class:"w-full bg-gray-50 border border-gray-100 shadow rounded-xl p-10"},ne={class:"w-16 h-16 mx-auto flex items-center justify-center bg-green-100 text-green-500 rounded-full mb-4"},ie={class:"flex justify-center space-x-2 mb-4"},de={key:0},le=["onClick"],ce={class:"text-sm text-gray-700"},me={key:1,class:"p-4 space-y-2"},he={key:0,class:"flex items-center justify-between"},pe={class:"text-gray-700 font-semibold text-xs"},ue={class:"flex items-center justify-end"},ge=["src"],ye={key:1,class:"flex justify-center"},fe={class:"flex items-center space-x-1"};function _e(s,e,r,c,n,t){const C=d("StoreLogo"),b=d("Skeleton"),k=d("Loader"),L=d("ReceiptText"),y=d("Button"),T=d("ChevronUp"),M=d("ChevronDown"),S=d("Copy"),P=d("WhatsappMessage"),I=d("vue-slide-up-down"),O=d("WhatsappIcon");return a(),i("div",Z,[o("div",{onClick:e[0]||(e[0]=(...u)=>t.navigateToShowShopOrder&&t.navigateToShowShopOrder(...u)),class:"w-full bg-white border border-gray-100 shadow-sm rounded-xl cursor-pointer hover:bg-gray-50 hover:scale-105 active:opacity-80 active:scale-100 transition-all duration-300 mb-4"},[o("div",$,[t.store&&t.store.logo?(a(),h(C,{key:0,size:"w-10 h-10",showButton:!1})):f("",!0),o("div",ee,[o("div",te,[t.isLoadingStore||t.isLoadingOrder?(a(),h(b,{key:0,width:"w-40",height:"h-2",class:"mb-2",shine:!0})):(a(),i("p",oe,_(t.order.customer_name),1)),t.isLoadingStore||t.isLoadingOrder?(a(),h(b,{key:2,width:"w-2/3",height:"h-2",shine:!0})):(a(),i("p",se,_(t.order.summary),1))]),t.isLoadingStore||t.isLoadingOrder?(a(),h(b,{key:0,width:"w-2/3",height:"h-2",class:"",shine:!0})):(a(),i("p",re,"Order #"+_(t.order.number),1))])])]),o("div",ae,[o("div",ne,[n.isLoadingStorePaymentMethod||n.isCreatingTransaction?(a(),h(k,{key:0,type:"primary"})):(a(),h(L,{key:1,size:"24"}))]),e[11]||(e[11]=o("p",{class:"text-xl font-semibold text-center mb-2"},"Confirming Payment",-1)),e[12]||(e[12]=o("p",{class:"text-sm text-gray-500 text-center mb-8"},[w(" Your order has been received and our team is confirming your payment. "),o("br"),w(" Send us a message to keep up with your order. ")],-1)),n.clicked?(a(),i(x,{key:0},[o("div",ie,[l(y,{size:"md",type:"light",leftIcon:n.ArrowLeft,action:t.navigateToStorefront},{default:p(()=>[...e[1]||(e[1]=[o("span",{class:"text-xs"},"Back to shop",-1)])]),_:1},8,["leftIcon","action"]),l(y,{size:"md",type:"success",action:t.navigateToShowShopOrder},{default:p(()=>[...e[2]||(e[2]=[o("span",{class:"text-xs"},"Go to invoice",-1)])]),_:1},8,["action"])]),!t.isLoadingStore&&!t.isLoadingOrder?(a(),i("div",de,[e[9]||(e[9]=o("p",{class:"text-sm text-red-500 text-center mt-8 mb-4"},"WhatsApp is not opening?",-1)),(a(!0),i(x,null,R(n.accordions,(u,m)=>(a(),i("div",{key:m,onClick:N(()=>t.toggleAccordian(m),["stop"]),class:v(["border border-gray-300",{"rounded-t-lg":m==0},{"rounded-b-lg":m==n.accordions.length-1}])},[o("div",{class:v(["flex items-center justify-between bg-gray-50 hover:bg-gray-100 p-2 cursor-pointer",{shadow:u.expanded},{"rounded-t-lg":m==0},{"rounded-b-lg":m==n.accordions.length-1&&!u.expanded}])},[o("p",ce,_(u.label),1),u.expanded?(a(),h(T,{key:0,size:"16"})):(a(),h(M,{key:1,size:"16"}))],2),l(I,{active:u.expanded},{default:p(()=>[m==0?(a(),i(x,{key:0},[e[3]||(e[3]=o("p",{class:"text-xs text-gray-500 p-4 mb-4"},[w(" Look for the option called "),o("span",{class:"font-bold"},'"Open in external browser"')],-1)),e[4]||(e[4]=o("img",{src:"/images/open_in_external_browser.png",class:"max-w-80 rounded-lg overflow-hidden m-4 mx-auto"},null,-1))],64)):m==1?(a(),i("div",me,[e[7]||(e[7]=o("p",{class:"text-xs text-gray-500 mb-4"},[w(" Copy order details below and send to our "),o("span",{class:"font-bold"},"Whatsapp number")],-1)),t.store.whatsapp_mobile_number?(a(),i("div",he,[o("span",pe,_(t.store.whatsapp_mobile_number.international),1),l(S,{showText:!1,text:t.store.whatsapp_mobile_number.international},{trigger:p(g=>[l(y,{size:"xs",type:"light",leftIconSize:"14",leftIcon:n.CopyIcon,action:()=>g.loading?g.copyToClipboardNotReady():g.copyToClipboard()},{default:p(()=>[...e[5]||(e[5]=[o("span",{class:"text-xs ml-1"},"copy our whatsapp number",-1)])]),_:1},8,["leftIcon","action"])]),_:1},8,["text"])])):f("",!0),t.whatsappMessage?(a(),i(x,{key:1},[o("div",ue,[l(S,{showText:!1,text:t.whatsappMessage},{trigger:p(g=>[l(y,{size:"xs",type:"light",leftIconSize:"14",leftIcon:n.CopyIcon,action:()=>g.loading?g.copyToClipboardNotReady():g.copyToClipboard()},{default:p(()=>[...e[6]||(e[6]=[o("span",{class:"text-xs ml-1"},"copy order details",-1)])]),_:1},8,["leftIcon","action"])]),_:1},8,["text"])]),l(P,{class:"h-60",animate:!1,loopAnimation:!1,messages:[{sender:"You",text:t.whatsappMessage,timestamp:n.now,isOwnMessage:!0}]},null,8,["messages"])],64)):f("",!0)])):m==2?(a(),i(x,{key:2},[e[8]||(e[8]=o("p",{class:"text-xs text-gray-500 p-4 mb-4"},[w(" Use your mobile camera to scan this "),o("span",{class:"font-bold"},"QR Code")],-1)),o("img",{src:n.qrCode,alt:"QR Code",class:"my-4 mx-auto border border-gray-300 rounded-lg shadow max-w-60"},null,8,ge)],64)):f("",!0)]),_:2},1032,["active"])],10,le))),128))])):f("",!0)],64)):(a(),i("div",ye,[l(y,{size:"xs",type:"success",action:t.sendUsingWhatsapp},{default:p(()=>[o("div",fe,[l(O,{color:"#ffffff",class:"mx-2"}),e[10]||(e[10]=o("span",{class:"text-xs"},"Send using Whatsapp",-1))])]),_:1},8,["action"])]))])])}const Ee=G(X,[["render",_e]]);export{Ee as default};
