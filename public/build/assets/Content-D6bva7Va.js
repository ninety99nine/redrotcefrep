import{c as n,a as i,b as s,d as f,g as b,r as l,o,F as v,f as k,e as p,h as T,t as _,k as O,i as F,G as H,y as R,T as q,w as W,l as Y}from"./app-qohHnai2.js";import{B as D}from"./Button-CPqWnTAQ.js";import{S as P}from"./Skeleton-TldU7eME.js";import{I as C,b as U}from"./Input-B2ak7xuW.js";import{S as A}from"./Select-C8qxM4tY.js";import{S as E}from"./Switch-DC-AVpIl.js";import{R as I}from"./enums-DDsOf2xw.js";import{c as M,a as j}from"./stringUtils-Bvzw0-oW.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as B}from"./trash-2-C_1A6Ztu.js";import{P as V}from"./plus-Dn-tsknJ.js";import{O as G,a as Q}from"./OrderPaymentStatusSelect-pfvBaFjA.js";import{M as N}from"./Modal-COpD3FzR.js";import{R as J}from"./refresh-ccw-gHkE3gSp.js";import{c as K}from"./createLucideIcon-DFF6csNE.js";import{P as Z}from"./Pill-BNjRcmXt.js";import{A as X}from"./arrow-left-Clyj-luM.js";import{L as $}from"./Loader-BkdSj3Qz.js";import{A as ee}from"./AddressInput-B5cGxsnk.js";import{A as te}from"./Alert-CQid1sw2.js";import{D as re,a as oe}from"./DeliveryTimePicker-CoHnUtlT.js";import{C as se}from"./circle-alert-y8k_vQsc.js";import{I as ne}from"./info-DK73QrUb.js";import"./ShineEffect-bdFyZnCD.js";import"./Copy-BivnTeSq.js";import"./Popover-BLOHpHVX.js";import"./Tooltip-DNCrFSbg.js";import"./capitalize-ChUSrr1V.js";import"./circle-check-CkMv-4m2.js";import"./x-D2eEjOWs.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./index-DP0-bHZg.js";import"./GoogleMaps-Cgax2FDC.js";import"./SelectCountry-ButpYYUj.js";import"./move-left-RxSrJ1xh.js";import"./Datepicker-2adGzhQe.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=K("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),ae={inject:["storeState","orderState"],components:{Input:C,Select:A,Switch:E,Button:D},props:{index:{type:Number},cartFee:{type:Object}},data(){return{Trash2:B,RATE_TYPES:I,feeTypes:Object.entries(I).map(([a,t])=>({label:M(t),value:t}))}},computed:{store(){return this.storeState.store}}},ie={class:"space-y-2 bg-gray-50 p-2 border border-gray-300 rounded-lg"},le={class:"flex items-center space-x-2"},ce={class:"w-full flex justify-end"};function ue(a,t,r,y,d,e){const c=l("Input"),h=l("Select"),g=l("Button"),m=l("Switch");return o(),n("div",ie,[i(c,{type:"text",class:"w-full",modelValue:r.cartFee.name,"onUpdate:modelValue":t[0]||(t[0]=u=>r.cartFee.name=u),placeholder:"Packaging",onInput:t[1]||(t[1]=u=>e.orderState.saveStateDebounced("Fee name changed"))},null,8,["modelValue"]),s("div",le,[i(h,{class:"w-60",search:!1,options:d.feeTypes,modelValue:r.cartFee.rate_type,"onUpdate:modelValue":t[2]||(t[2]=u=>r.cartFee.rate_type=u),placeholder:"Select fee type",onChange:t[3]||(t[3]=u=>e.orderState.saveStateDebounced("Fee type changed"))},null,8,["options","modelValue"]),r.cartFee.rate_type==d.RATE_TYPES.FLAT?(o(),f(c,{key:0,type:"money",class:"w-60",modelValue:r.cartFee.flat_rate,"onUpdate:modelValue":t[4]||(t[4]=u=>r.cartFee.flat_rate=u),currency:e.store.currency.code,onInput:t[5]||(t[5]=u=>e.orderState.saveStateDebounced("Fee amount changed"))},null,8,["modelValue","currency"])):(o(),f(c,{key:1,class:"w-60",type:"percentage",modelValue:r.cartFee.percentage_rate,"onUpdate:modelValue":t[6]||(t[6]=u=>r.cartFee.percentage_rate=u),onInput:t[7]||(t[7]=u=>e.orderState.saveStateDebounced("Fee amount changed"))},null,8,["modelValue"])),s("div",ce,[r.cartFee.removable?(o(),f(g,{key:0,size:"xs",type:"danger",leftIcon:d.Trash2,action:()=>e.orderState.removeCartFee(r.index)},{default:b(()=>[...t[10]||(t[10]=[s("span",null,"Remove Fee",-1)])]),_:1},8,["leftIcon","action"])):(o(),f(m,{key:1,size:"xs",prefixText:"Apply fee",modelValue:r.cartFee.active,"onUpdate:modelValue":t[8]||(t[8]=u=>r.cartFee.active=u),onChange:t[9]||(t[9]=u=>e.orderState.saveStateDebounced("Apply fee status changed"))},null,8,["modelValue"]))])])])}const me=x(ae,[["render",ue]]),he={inject:["storeState","orderState"],components:{Button:D,Skeleton:P,OrderFee:me},data(){return{Plus:V}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},cartFees(){return this.orderState.orderForm.cart_fees},isEditting(){return this.$route.name==="edit-order"},hasCartFees(){return this.cartFees.length>0}},methods:{addNew(){this.orderState.addCartFee()}}},ge={class:"bg-white rounded-lg p-4 shadow-sm"},ye={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},pe={class:"w-full space-y-4"},_e={key:1,class:"space-y-2"},fe={class:"flex justify-center pt-2"},ve={key:1,class:"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4 my-4"};function Se(a,t,r,y,d,e){const c=l("Skeleton"),h=l("OrderFee"),g=l("Button");return o(),n("div",ge,[t[5]||(t[5]=s("h1",{class:"text-lg font-semibold mb-4"},"Fees",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(o(),n("div",ye,[t[0]||(t[0]=s("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},[s("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])],-1)),s("div",pe,[i(c,{width:"w-full",shine:!0}),i(c,{width:"w-1/3",shine:!0})])])):(o(),n("div",_e,[e.hasCartFees?(o(),n(v,{key:0},[(o(!0),n(v,null,k(e.cartFees,(m,u)=>(o(),f(h,{key:u,index:u,cartFee:m},null,8,["index","cartFee"]))),128)),s("div",fe,[i(g,{size:"sm",type:"light",action:e.addNew,leftIcon:d.Plus},{default:b(()=>[...t[1]||(t[1]=[s("span",null,"Add Fee",-1)])]),_:1},8,["action","leftIcon"])])],64)):(o(),n("div",ve,[e.hasCartFees?p("",!0):(o(),n(v,{key:0},[t[2]||(t[2]=s("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})],-1)),t[3]||(t[3]=s("span",{class:"text-sm text-gray-500"},"No fees",-1))],64)),i(g,{size:"xs",type:"light",action:e.addNew,leftIcon:d.Plus,buttonClass:"my-2"},{default:b(()=>[...t[4]||(t[4]=[s("span",null,"Add Fee",-1)])]),_:1},8,["action","leftIcon"])]))]))])}const we=x(he,[["render",Se]]),xe={inject:["formState","storeState","orderState","notificationState"],components:{Input:C,Select:A,Skeleton:P,OrderStatusSelect:Q,OrderPaymentStatusSelect:G},data(){return{couriers:[],isLoadingCouriers:!1}},computed:{hasOrder(){return this.orderState.hasOrder},orderForm(){return this.orderState.orderForm},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},statuses(){return["waiting","cancelled","completed","on its way","ready for pickup"].map(t=>({label:M(t),value:t}))},paymentStatuses(){return["paid","unpaid","partially paid","waiting confirmation"].map(t=>({label:M(t),value:t}))}},methods:{async showCouriers(){var a,t;try{if(this.couriers.length)return;this.isLoadingCouriers=!0;let r={params:{per_page:100}};const y=await T.get("/api/couriers",r);this.couriers=y.data.data.map(d=>({label:M(d.name),value:d.id})),this.couriers.unshift({label:"None",value:null})}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching stores";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch stores:",r)}finally{this.isLoadingCouriers=!1}}},created(){this.showCouriers()}},be={class:"bg-white rounded-lg p-4 shadow-sm"},ke={key:0,class:"space-y-2"},Pe={key:1,class:"space-y-2"};function Ce(a,t,r,y,d,e){const c=l("Skeleton"),h=l("OrderStatusSelect"),g=l("OrderPaymentStatusSelect"),m=l("Select"),u=l("Input");return o(),n("div",be,[e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(o(),n("div",ke,[(o(),n(v,null,k([1,2,3],(S,w)=>s("div",{key:w,class:"border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},[i(c,{width:"w-full",shine:!0})])),64))])):(o(),n("div",Pe,[i(h,{class:"w-full",showLabel:!0,onChange:t[0]||(t[0]=S=>e.orderState.saveStateDebounced(`Status changed to ${e.orderForm.status}`))}),i(g,{class:"w-full",showLabel:!0,onChange:t[1]||(t[1]=S=>e.orderState.saveStateDebounced(`Payment status changed to ${e.orderForm.payment_status}`))}),i(m,{search:!1,label:"Couriers",options:d.couriers,modelValue:e.orderForm.courier_id,"onUpdate:modelValue":t[2]||(t[2]=S=>e.orderForm.courier_id=S),errorText:e.formState.getFormError("courier_id"),onChange:t[3]||(t[3]=S=>e.orderState.saveStateDebounced("Courier changed"))},null,8,["options","modelValue","errorText"]),i(u,{type:"text",label:"Tracking Number",modelValue:e.orderForm.tracking_number,"onUpdate:modelValue":t[4]||(t[4]=S=>e.orderForm.tracking_number=S),errorText:e.formState.getFormError("tracking_number"),onInput:t[5]||(t[5]=S=>e.orderState.saveStateDebounced("Tracking number changed"))},null,8,["modelValue","errorText"]),i(u,{rows:"2",type:"textarea",label:"Internal Note",modelValue:e.orderForm.internal_note,"onUpdate:modelValue":t[6]||(t[6]=S=>e.orderForm.internal_note=S),errorText:e.formState.getFormError("internal_note"),onChange:t[7]||(t[7]=S=>e.orderState.saveStateDebounced("Internal note changed")),tooltipContent:"Internal information about this order only visible to you and other team members"},null,8,["modelValue","errorText"])]))])}const Oe=x(xe,[["render",Ce]]),Fe={inject:["orderState","storeState"],components:{Skeleton:P},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},shoppingCart(){return this.orderState.shoppingCart},isInspectingShoppingCart(){return this.orderState.isInspectingShoppingCart},hasFees(){return Object.keys(this.shoppingCart?this.shoppingCart.totals.fees:this.order.order_fees).length>0},hasDiscounts(){return Object.keys(this.shoppingCart?this.shoppingCart.totals.discounts:this.order.order_discounts).length>0},hasTaxAmount(){return(this.shoppingCart?this.shoppingCart.totals.vat.amount.amount:this.order.vat_amount.amount)>0},hasAdjustmentTotal(){return this.shoppingCart?this.shoppingCart.totals.adjustment_total.amount!=0:this.order.adjustment_total.amount!=0},adjustmentTotalPositive(){return this.shoppingCart?this.shoppingCart.totals.adjustment_total.amount>0:this.order.adjustment_total.amount>0},isReady(){return!this.isLoadingStore&&!this.isLoadingOrder&&!this.isInspectingShoppingCart}}},De={class:"bg-white rounded-lg p-4 shadow-sm"},Le={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},Me={class:"w-full space-y-4"},Te={key:1,class:"bg-blue-50 border border-blue-400 rounded-lg p-4"},Ie={key:0,class:"flex items-center justify-between text-sm border-b border-gray-300 border-dashed pb-2 mb-2"},je={key:1},Ve={key:1,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},Ae={key:1},Ee={key:3,class:"text-red-500"},Be={key:2,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},Ne={class:"flex items-center justify-between text-sm mb-1"},Re={key:1,class:"w-full"},Ue={key:3},Ze={key:1,class:"text-xs text-gray-400"},ze={key:3,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},He={key:1},qe={key:3,class:"text-green-500"},We={key:4,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},Ye={class:"flex items-center justify-between text-sm text-gray-500"},Ge={key:1},Qe={class:"flex items-center justify-between text-lg"},Je={key:1,class:"font-bold"},Ke={key:1,class:"text-sm"};function Xe(a,t,r,y,d,e){const c=l("Skeleton");return o(),n("div",De,[e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(o(),n("div",Le,[t[0]||(t[0]=s("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},[s("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])],-1)),s("div",Me,[i(c,{width:"w-full",shine:!0}),i(c,{width:"w-1/3",shine:!0})])])):(o(),n("div",Te,[e.order||e.shoppingCart?(o(),n(v,{key:0},[!e.isReady||e.hasDiscounts||e.hasFees?(o(),n("div",Ie,[t[1]||(t[1]=s("span",null,"Subtotal",-1)),e.isReady?(o(),n("span",je,_(e.shoppingCart?e.shoppingCart.totals.subtotal.amount_with_currency:e.order.subtotal.amount_with_currency),1)):(o(),f(c,{key:0,width:"w-24",color:"bg-blue-200",shine:!0}))])):p("",!0),!e.isReady||e.hasDiscounts?(o(),n("div",Ve,[(o(!0),n(v,null,k(e.isReady?e.shoppingCart?e.shoppingCart.totals.discounts:e.order.order_discounts:[1],(h,g)=>(o(),n("div",{key:g,class:"flex items-center justify-between text-sm text-gray-500"},[e.isReady?(o(),n("span",Ae,_(h.name),1)):(o(),f(c,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})),e.isReady?(o(),n("span",Ee,"- "+_(h.amount.amount_with_currency),1)):(o(),f(c,{key:2,width:"w-20",color:"bg-blue-200",shine:!0}))]))),128))])):p("",!0),!e.isReady||e.hasTaxAmount?(o(),n("div",Be,[s("div",Ne,[e.isReady?(o(),n("div",Re,"Tax ("+_(e.shoppingCart?e.shoppingCart.totals.vat.rate.value_symbol:`${e.order.vat_rate}%`)+" "+_(e.shoppingCart?e.shoppingCart.totals.vat.method:e.order.vat_method)+")",1)):(o(),f(c,{key:0,width:"w-16",color:"bg-blue-200",shine:!0})),e.isReady?(o(),n("span",Ue,_(e.shoppingCart?e.shoppingCart.totals.vat.amount.amount_with_currency:e.order.vat_amount.amount_with_currency),1)):(o(),f(c,{key:2,width:"w-16",color:"bg-blue-200",shine:!0}))]),e.isReady?(o(),n("p",Ze,"Tax calculated on the discounted subtotal of "+_(e.shoppingCart?e.shoppingCart.totals.subtotal_after_discount.amount_with_currency:e.order.subtotal_after_discount.amount_with_currency),1)):(o(),f(c,{key:0,width:"w-1/3",color:"bg-blue-200",shine:!0}))])):p("",!0),!e.isReady||e.hasFees?(o(),n("div",ze,[(o(!0),n(v,null,k(e.isReady?e.shoppingCart?e.shoppingCart.totals.fees:e.order.order_fees:[1],(h,g)=>(o(),n("div",{key:g,class:"flex items-center justify-between text-sm text-gray-500"},[e.isReady?(o(),n("span",He,_(h.name),1)):(o(),f(c,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})),e.isReady?(o(),n("span",qe,"+ "+_(h.amount.amount_with_currency),1)):(o(),f(c,{key:2,width:"w-16",color:"bg-blue-200",shine:!0}))]))),128))])):p("",!0),!e.isReady||e.hasAdjustmentTotal?(o(),n("div",We,[s("div",Ye,[e.isReady?(o(),n("span",Ge,"Adjustment")):(o(),f(c,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})),e.isReady?(o(),n("span",{key:3,class:O([e.adjustmentTotalPositive?"text-green-500":"text-red-500"])},_(e.adjustmentTotalPositive?"+":"-")+" "+_(`${e.shoppingCart?e.shoppingCart.totals.adjustment_total.amount_with_currency:e.order.adjustment_total.amount_with_currency}`.replace("-","")),3)):(o(),f(c,{key:2,width:"w-16",color:"bg-blue-200",shine:!0}))])])):p("",!0),s("div",Qe,[t[2]||(t[2]=s("div",{class:"w-full font-bold"},"Grand Total",-1)),e.isReady?(o(),n("span",Je,_(e.shoppingCart?e.shoppingCart.totals.grand_total.amount_with_currency:e.order.grand_total.amount_with_currency),1)):(o(),f(c,{key:0,width:"w-24",color:"bg-blue-200",shine:!0}))])],64)):(o(),n("span",Ke,"Add products to show total"))]))])}const $e=x(Fe,[["render",Xe]]),et={props:{customer:{type:Object},onSelectCustomer:{type:Function}}},tt={class:"text-sm font-semibold"},rt={key:0,class:"text-xs text-gray-500"};function ot(a,t,r,y,d,e){return o(),n("div",{onClick:t[0]||(t[0]=()=>r.onSelectCustomer(r.customer)),class:"flex items-center space-x-2 cursor-pointer p-3 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100"},[t[1]||(t[1]=s("svg",{class:"w-6 h-6 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})],-1)),s("div",null,[s("p",tt,_(r.customer.name),1),r.customer.email||r.customer.mobile_number?(o(),n("p",rt,_(r.customer.email||r.customer.mobile_number.national),1)):p("",!0)])])}const st=x(et,[["render",ot]]),nt={components:{CustomerOption:st},props:{customers:{type:Array},onSelectCustomer:{type:Function}}},dt={class:"max-h-80 overflow-y-auto space-y-2 mb-4"};function at(a,t,r,y,d,e){const c=l("CustomerOption");return o(),n("div",dt,[(o(!0),n(v,null,k(r.customers,(h,g)=>(o(),f(c,{key:g,customer:h,onSelectCustomer:r.onSelectCustomer},null,8,["customer","onSelectCustomer"]))),128))])}const it=x(nt,[["render",at]]),lt={inject:["formState","orderState","storeState","notificationState"],components:{Input:C,Modal:N,Button:D,Skeleton:P,CustomerOptions:it},props:{hasCustomer:{type:Boolean}},data(){return{Plus:V,RefreshCcw:J,customers:[],searchTerm:null,lastSearchTerm:null,isLoadingCustomers:!1,hasLoadedInitialCustomers:!1}},watch:{searchTerm(){this.showCustomers()}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},hasCustomers(){return this.customers.length>0}},methods:{isNotEmpty:j,onShow(){this.hasLoadedInitialCustomers=!1,this.lastSearchTerm=null,this.searchTerm=null,this.customers=[],this.showCustomers()},async showCustomers(){var a,t;try{this.isLoadingCustomers=!0;let r={params:{store_id:this.store.id}};this.hasSearchTerm&&(r.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const y=await T.get("/api/customers",r);if(this.searchTerm===this.lastSearchTerm){const d=y.data;this.customers=d.data,this.isLoadingCustomers=!1,this.hasLoadedInitialCustomers=!0}}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching customers";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch customers:",r)}finally{this.isLoadingCustomers=!1}},onSelectCustomer(a){this.$refs.modal.hideModal(),this.orderState.addCartCustomer(a)},addNew(){this.$refs.modal.hideModal(),this.orderState.addCartCustomer()}}},ct={class:"flex justify-center"},ut={key:0,class:"flex justify-center items-center space-x-4 my-2"},mt={key:1,class:"space-y-2 mb-4"},ht={class:"w-full space-y-2"},gt={key:3,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"};function yt(a,t,r,y,d,e){const c=l("Input"),h=l("Button"),g=l("Skeleton"),m=l("CustomerOptions"),u=l("Modal");return o(),n("div",ct,[i(u,{ref:"modal",onShow:e.onShow,triggerSize:"sm",contentClass:"px-4",triggerType:"light",scrollOnContent:!1,showApproveButton:!1,leftTriggerIcon:r.hasCustomer?d.RefreshCcw:d.Plus,header:`${r.hasCustomer?"Change":"Add"} Customer`,triggerText:`${r.hasCustomer?"Change":"Add"} Customer`,triggerLoading:e.isLoadingOrder||e.isEditting&&!e.hasOrder},{content:b(()=>[d.hasLoadedInitialCustomers?(o(),n("div",ut,[i(c,{type:"search",class:"w-full",debounced:!0,modelValue:d.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=S=>d.searchTerm=S),placeholder:"Search customers",onInput:t[1]||(t[1]=S=>d.isLoadingCustomers=!0),skeleton:e.isLoadingOrder||e.isEditting&&!e.hasOrder},null,8,["modelValue","skeleton"]),i(h,{size:"xs",type:"light",leftIcon:d.Plus,action:e.addNew,buttonClass:"my-2"},{default:b(()=>[...t[2]||(t[2]=[s("span",null,"Add New",-1)])]),_:1},8,["leftIcon","action"])])):p("",!0),d.isLoadingCustomers?(o(),n("div",mt,[(o(),n(v,null,k([1,2,3],(S,w)=>s("div",{key:w,class:"flex items-center space-x-2 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50 w-full"},[i(g,{width:"w-10",height:"h-10",rounded:"rounded-lg",shine:!0,class:"flex-shrink-0"}),s("div",ht,[i(g,{width:"w-2/3",shine:!0}),i(g,{width:"w-1/3",shine:!0})])])),64))])):e.hasCustomers?(o(),f(m,{key:2,customers:d.customers,onSelectCustomer:e.onSelectCustomer},null,8,["customers","onSelectCustomer"])):(o(),n("p",gt," No customers found "))]),_:1},8,["onShow","leftTriggerIcon","header","triggerText","triggerLoading"])])}const pt=x(lt,[["render",yt]]),_t={inject:["storeState","orderState"],components:{Input:C,Skeleton:P,AddCustomer:pt},data(){return{modified:!1,customer_email:null,customer_last_name:null,customer_first_name:null,customer_mobile_number:null}},watch:{orderForm:{handler(a,t){t==null?(this.customer_email=a.customer_email,this.customer_last_name=a.customer_last_name,this.customer_first_name=a.customer_first_name,this.customer_mobile_number=a.customer_mobile_number):this.modified=a.customer_email!==this.customer_email||a.customer_last_name!==this.customer_last_name||a.customer_first_name!==this.customer_first_name||a.customer_mobile_number!==this.customer_mobile_number},deep:!0}},computed:{hasOrder(){return this.orderState.hasOrder},orderForm(){return this.orderState.orderForm},isEditting(){return this.$route.name==="edit-order"},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasEmail(){return this.isNotEmpty(this.orderForm.customer_email)},hasMobileNumber(){return this.isNotEmpty(this.orderForm.customer_mobile_number)},hasCustomerDetails(){return this.orderState.hasCustomerDetails}},methods:{isNotEmpty:j}},ft={class:"bg-white rounded-lg p-4 shadow-sm"},vt={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},St={class:"w-full space-y-4"},wt={key:0,class:"space-y-2"},xt={key:1,class:"border-t border-dashed border-gray-300 pt-4 mt-4"};function bt(a,t,r,y,d,e){const c=l("Skeleton"),h=l("Input"),g=l("AddCustomer");return o(),n("div",ft,[t[13]||(t[13]=s("h1",{class:"text-lg font-semibold mb-4"},"Customer",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(o(),n("div",vt,[t[10]||(t[10]=s("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},[s("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])],-1)),s("div",St,[i(c,{width:"w-full",shine:!0}),i(c,{width:"w-1/3",shine:!0})])])):(o(),n(v,{key:1},[e.hasCustomerDetails||d.modified?(o(),n("div",wt,[i(h,{type:"text",placeholder:"First name",modelValue:e.orderForm.customer_first_name,"onUpdate:modelValue":t[0]||(t[0]=m=>e.orderForm.customer_first_name=m),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder,onInput:t[1]||(t[1]=m=>e.orderState.saveStateDebounced("Customer first name changed"))},null,8,["modelValue","skeleton"]),i(h,{type:"text",placeholder:"Last name",modelValue:e.orderForm.customer_last_name,"onUpdate:modelValue":t[2]||(t[2]=m=>e.orderForm.customer_last_name=m),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder,onInput:t[3]||(t[3]=m=>e.orderState.saveStateDebounced("Customer last name changed"))},null,8,["modelValue","skeleton"]),i(h,{type:"email",placeholder:"Email",modelValue:e.orderForm.customer_email,"onUpdate:modelValue":t[4]||(t[4]=m=>e.orderForm.customer_email=m),onInput:t[5]||(t[5]=m=>e.orderState.saveStateDebounced("Customer email changed")),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},null,8,["modelValue","skeleton"]),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?p("",!0):(o(),f(h,{key:0,type:"text",placeholder:"+26772000001",modelValue:e.orderForm.customer_mobile_number,"onUpdate:modelValue":t[6]||(t[6]=m=>e.orderForm.customer_mobile_number=m),onChange:t[7]||(t[7]=m=>e.orderState.saveStateDebounced("Customer mobile number changed"))},null,8,["modelValue"]))])):p("",!0),e.hasEmail||e.hasMobileNumber?(o(),n("div",xt,[i(h,{type:"checkbox",inputLabel:"Update customer profile",modelValue:e.orderForm.update_profile,"onUpdate:modelValue":t[8]||(t[8]=m=>e.orderForm.update_profile=m),inputDescription:"Make sure to update both the order customer details and the customer profile",onChange:t[9]||(t[9]=m=>e.orderState.saveStateDebounced(`Update customer profile (${e.orderForm.update_profile?"On":"Off"})`))},null,8,["modelValue"])])):p("",!0),s("div",{class:O([e.hasCustomerDetails||d.modified?"border-t border-dashed border-gray-300 pt-4 mt-4":"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4"])},[!e.hasCustomerDetails&&!d.modified?(o(),n(v,{key:0},[t[11]||(t[11]=s("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})],-1)),t[12]||(t[12]=s("span",{class:"text-sm text-gray-500"},"No customer added",-1))],64)):p("",!0),i(g,{hasCustomerDetails:e.hasCustomerDetails},null,8,["hasCustomerDetails"])],2)],64))])}const kt=x(_t,[["render",bt]]),Pt={inject:["storeState","orderState"],components:{Tag:de,Input:C,Button:D},props:{index:{type:Number},cartProduct:{type:Object}},data(){return{Trash2:B}},computed:{store(){return this.storeState.store},hasPhotoPath(){return this.photoPath!=null},photoPath(){return this.cartProduct.photo_path},grandTotal(){const a=parseFloat(this.cartProduct.unit_regular_price),t=parseFloat(this.cartProduct.unit_sale_price),r=parseInt(this.cartProduct.quantity),y=this.store.currency.code;return t>0&&t<a?U(t*r,y):U(a*r,y)}}},Ct={class:"rounded-lg overflow-hidden border border-gray-300 py-2 px-4 bg-gray-50"},Ot={class:"w-full flex space-x-4"},Ft=["src"],Dt={key:1,class:"w-6 h-6 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},Lt={class:"w-full space-y-4"},Mt={class:"w-full text-sm text-left"},Tt={class:"whitespace-nowrap align-top py-2 pr-2"},It={class:"whitespace-nowrap align-top p-2"},jt={class:"whitespace-nowrap align-top py-2 pl-2"},Vt={class:"grid grid-cols-3 my-4"},At={class:"col-span-1 col-start-2 flex items-center justify-center space-x-2"},Et={class:"text-gray-700 text-center"},Bt={class:"col-span-1"},Nt={class:"flex justify-end"};function Rt(a,t,r,y,d,e){const c=l("Input"),h=l("Tag"),g=l("Button");return o(),n("div",Ct,[s("div",Ot,[s("div",{class:O(["flex items-center justify-center w-16 h-16 rounded-lg",{"border border-dashed border-gray-200":!e.hasPhotoPath}])},[e.hasPhotoPath?(o(),n("img",{key:0,class:"w-full object-contain rounded-lg flex-shrink-0",src:e.photoPath},null,8,Ft)):(o(),n("svg",Dt,[...t[8]||(t[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"},null,-1)])]))],2),s("div",Lt,[i(c,{type:"text",label:"Name",modelValue:r.cartProduct.name,"onUpdate:modelValue":t[0]||(t[0]=m=>r.cartProduct.name=m),placeholder:"Standard Ticket",onInput:t[1]||(t[1]=m=>e.orderState.saveStateDebounced("Product name changed"))},null,8,["modelValue"]),s("table",Mt,[t[9]||(t[9]=s("thead",null,[s("tr",null,[s("th",{class:"whitespace-nowrap align-top px-2 pr-2"},[s("span",{class:"text-gray-700 text-xs font-normal uppercase"},"Regular Price")]),s("th",{class:"whitespace-nowrap align-top px-2"},[s("span",{class:"text-gray-700 text-xs font-normal uppercase"},"Sale Price")]),s("th",{class:"whitespace-nowrap align-top px-2 pl-2"},[s("span",{class:"text-gray-700 text-xs font-normal uppercase"},"Quantity")])])],-1)),s("tbody",null,[s("tr",null,[s("td",Tt,[i(c,{type:"money",currency:e.store.currency.code,modelValue:r.cartProduct.unit_regular_price,"onUpdate:modelValue":t[2]||(t[2]=m=>r.cartProduct.unit_regular_price=m),onInput:t[3]||(t[3]=m=>e.orderState.saveStateDebounced("Product regular price changed"))},null,8,["currency","modelValue"])]),s("td",It,[i(c,{type:"money",currency:e.store.currency.code,modelValue:r.cartProduct.unit_sale_price,"onUpdate:modelValue":t[4]||(t[4]=m=>r.cartProduct.unit_sale_price=m),onInput:t[5]||(t[5]=m=>e.orderState.saveStateDebounced("Product sale price changed"))},null,8,["currency","modelValue"])]),s("td",jt,[i(c,{type:"number",modelValue:r.cartProduct.quantity,"onUpdate:modelValue":t[6]||(t[6]=m=>r.cartProduct.quantity=m),onInput:t[7]||(t[7]=m=>e.orderState.saveStateDebounced("Product quantity changed"))},null,8,["modelValue"])])])])])])]),s("div",Vt,[s("div",At,[i(h,{size:"16",class:"text-gray-500"}),s("span",Et,_(e.store.currency.symbol)+_(e.grandTotal),1)]),s("div",Bt,[s("div",Nt,[i(g,{size:"xs",type:"danger",leftIcon:d.Trash2,action:()=>e.orderState.removeCartProduct(r.index)},{default:b(()=>[...t[10]||(t[10]=[s("span",null,"Remove",-1)])]),_:1},8,["leftIcon","action"])])])])])}const Ut=x(Pt,[["render",Rt]]),Zt={components:{Pill:Z},props:{parentProduct:{type:Object,default:null},product:{type:Object},onSelectProduct:{type:Function}},computed:{photo(){return this.product.photo},hasPhoto(){return this.photo!=null}}},zt=["src"],Ht={key:1,class:"w-6 h-6 text-gray-400 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},qt={class:"w-full flex items-center justify-between"},Wt={class:"text-sm font-semibold"},Yt={class:"text-xs space-x-2"},Gt={key:0};function Qt(a,t,r,y,d,e){const c=l("Pill");return o(),n("div",{onClick:t[0]||(t[0]=()=>r.onSelectProduct(r.product,r.parentProduct)),class:"flex justify-between items-center cursor-pointer p-2 space-x-4 rounded-lg bg-gray-50 hover:bg-gray-100"},[s("div",{class:O(["flex items-center justify-center w-10 h-10 rounded-lg",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),n("img",{key:0,class:"w-full max-h-10 object-contain rounded-lg flex-shrink-0",src:e.photo.path},null,8,zt)):(o(),n("svg",Ht,[...t[1]||(t[1]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"},null,-1)])]))],2),s("div",qt,[s("div",null,[s("p",Wt,_(r.product.name),1),s("p",Yt,[s("span",{class:O({"line-through text-gray-500":r.product.on_sale})},_(r.product.unit_regular_price.amount_with_currency),3),r.product.on_sale?(o(),n("span",Gt,_(r.product.unit_sale_price.amount_with_currency),1)):p("",!0)])]),r.product.variants&&r.product.variants.length?(o(),f(c,{key:0,type:"light",size:"xs"},{default:b(()=>[F(_(r.product.variants.length)+" "+_(r.product.variants.length==1?"option":"options"),1)]),_:1})):p("",!0)])])}const Jt=x(Zt,[["render",Qt]]),Kt={components:{ProductOption:Jt},props:{parentProduct:{type:Object,default:null},products:{type:Array},onSelectProduct:{type:Function}}},Xt={class:"max-h-80 overflow-y-auto space-y-2 mb-4"};function $t(a,t,r,y,d,e){const c=l("ProductOption");return o(),n("div",Xt,[(o(!0),n(v,null,k(r.products,(h,g)=>(o(),f(c,{key:g,product:h,parentProduct:r.parentProduct,onSelectProduct:r.onSelectProduct},null,8,["product","parentProduct","onSelectProduct"]))),128))])}const z=x(Kt,[["render",$t]]),er={components:{ProductOptions:z},props:{selectedProduct:{type:Object},onSelectProduct:{type:Function}}},tr={class:"space-y-2 mb-4"};function rr(a,t,r,y,d,e){const c=l("ProductOptions");return o(),n("div",tr,[i(c,{parentProduct:r.selectedProduct,onSelectProduct:r.onSelectProduct,products:r.selectedProduct.variants},null,8,["parentProduct","onSelectProduct","products"])])}const or=x(er,[["render",rr]]),sr={inject:["formState","orderState","storeState","notificationState"],components:{Input:C,Modal:N,Button:D,Skeleton:P,ProductOptions:z,ProductVariationOptions:or},data(){return{Plus:V,ArrowLeft:X,products:[],searchTerm:null,lastSearchTerm:null,selectedProduct:null,isLoadingProducts:!1,hasLoadedInitialProducts:!1}},watch:{searchTerm(){this.showProducts()}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},hasProducts(){return this.products.length>0}},methods:{isNotEmpty:j,onShow(){this.hasLoadedInitialProducts=!1,this.selectedProduct=null,this.lastSearchTerm=null,this.searchTerm=null,this.products=[],this.showProducts()},async showProducts(){var a,t;try{this.isLoadingProducts=!0;let r={params:{store_id:this.store.id,association:"team member",_relationships:"photo,variants"}};this.hasSearchTerm&&(r.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const y=await T.get("/api/products",r);if(this.searchTerm===this.lastSearchTerm){const d=y.data;this.products=d.data,this.isLoadingProducts=!1,this.hasLoadedInitialProducts=!0}}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching products";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch products:",r)}finally{this.isLoadingProducts=!1}},onSelectProduct(a,t){a.variants&&a.variants.length>0?this.selectedProduct=a:(this.$refs.modal.hideModal(),this.orderState.addCartProductUsingProduct(a,t,null,!0))},removeSelectedProduct(){this.selectedProduct=null},addNew(){this.$refs.modal.hideModal(),this.orderState.addCartProduct()}}},nr={class:"flex justify-center"},dr={key:0,class:"flex justify-center items-center space-x-4 my-2"},ar={key:1,class:"space-y-2 mb-4"},ir={class:"w-full space-y-2"},lr={class:"flex items-center space-x-4 border-b border-dashed border-gray-300 my-4 pb-4"},cr={class:"flex items-center space-x-2"},ur={key:0,class:"flex items-center justify-center w-10 h-10 rounded-lg"},mr=["src"],hr={class:"text-lg font-bold"},gr={key:4,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"};function yr(a,t,r,y,d,e){const c=l("Input"),h=l("Button"),g=l("Skeleton"),m=l("ProductVariationOptions"),u=l("ProductOptions"),S=l("Modal");return o(),n("div",nr,[i(S,{ref:"modal",onShow:e.onShow,triggerSize:"sm",contentClass:"px-4",triggerType:"light",header:"Add Product",leftTriggerIcon:d.Plus,scrollOnContent:!1,triggerText:"Add Product",showApproveButton:!1,triggerLoading:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},{content:b(()=>[d.hasLoadedInitialProducts&&!d.selectedProduct?(o(),n("div",dr,[i(c,{type:"search",class:"w-full",debounced:!0,modelValue:d.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=w=>d.searchTerm=w),placeholder:"Search products",onInput:t[1]||(t[1]=w=>d.isLoadingProducts=!0),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},null,8,["modelValue","skeleton"]),i(h,{size:"xs",type:"light",leftIcon:d.Plus,action:e.addNew,buttonClass:"my-2"},{default:b(()=>[...t[2]||(t[2]=[s("span",null,"Add New",-1)])]),_:1},8,["leftIcon","action"])])):p("",!0),d.isLoadingProducts?(o(),n("div",ar,[(o(),n(v,null,k([1,2,3],(w,L)=>s("div",{key:L,class:"flex items-center space-x-2 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50 w-full"},[i(g,{width:"w-10",height:"h-10",rounded:"rounded-lg",shine:!0,class:"flex-shrink-0"}),s("div",ir,[i(g,{width:"w-2/3",shine:!0}),i(g,{width:"w-1/3",shine:!0})])])),64))])):d.selectedProduct?(o(),n(v,{key:2},[s("div",lr,[i(h,{size:"xs",type:"light",leftIcon:d.ArrowLeft,action:e.removeSelectedProduct},{default:b(()=>[...t[3]||(t[3]=[s("span",null,"Back",-1)])]),_:1},8,["leftIcon","action"]),s("div",cr,[d.selectedProduct.photo.path?(o(),n("div",ur,[s("img",{class:"w-full max-h-10 object-contain rounded-lg flex-shrink-0",src:d.selectedProduct.photo.path},null,8,mr)])):p("",!0),s("p",hr,_(d.selectedProduct.name),1)])]),i(m,{onSelectProduct:e.onSelectProduct,selectedProduct:d.selectedProduct},null,8,["onSelectProduct","selectedProduct"])],64)):e.hasProducts?(o(),f(u,{key:3,products:d.products,onSelectProduct:e.onSelectProduct},null,8,["products","onSelectProduct"])):(o(),n("p",gr," No products found "))]),_:1},8,["onShow","leftTriggerIcon","triggerLoading"])])}const pr=x(sr,[["render",yr]]),_r={inject:["storeState","orderState"],components:{Skeleton:P,AddProduct:pr,OrderProduct:Ut},computed:{hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},cartProducts(){return this.orderState.orderForm.cart_products},isEditting(){return this.$route.name==="edit-order"},hasCartProducts(){return this.cartProducts.length>0}}},fr={class:"bg-white rounded-lg p-4 shadow-sm"},vr={key:0,class:"space-y-2"},Sr={class:"w-full space-y-4"},wr={key:1,class:"space-y-4"};function xr(a,t,r,y,d,e){const c=l("Skeleton"),h=l("OrderProduct"),g=l("AddProduct");return o(),n("div",fr,[t[3]||(t[3]=s("h1",{class:"text-lg font-semibold mb-4"},"Products",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(o(),n("div",vr,[(o(),n(v,null,k([1,2,3],(m,u)=>s("div",{key:u,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},[t[0]||(t[0]=s("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},[s("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})])],-1)),s("div",Sr,[i(c,{width:"w-full",shine:!0}),i(c,{width:"w-1/3",shine:!0})])])),64))])):(o(),n("div",wr,[e.hasCartProducts?(o(!0),n(v,{key:0},k(e.cartProducts,(m,u)=>(o(),f(h,{key:u,index:u,cartProduct:m},null,8,["index","cartProduct"]))),128)):p("",!0),s("div",{class:O([{"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4 my-4":!e.hasCartProducts}])},[e.hasCartProducts?p("",!0):(o(),n(v,{key:0},[t[1]||(t[1]=s("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"})],-1)),t[2]||(t[2]=s("span",{class:"text-sm text-gray-500"},"No products added",-1))],64)),i(g)],2)]))])}const br=x(_r,[["render",xr]]),kr={inject:["storeState","orderState"],components:{Input:C,Button:D,Switch:E,Select:A},props:{index:{type:Number},cartPromotion:{type:Object}},data(){return{Trash2:B,RATE_TYPES:I,discountRateTypes:Object.entries(I).map(([a,t])=>({label:M(t),value:t}))}},computed:{store(){return this.storeState.store}}},Pr={class:"rounded-lg border border-fuchsia-300 py-2 px-4 bg-fuchsia-50"},Cr={class:"w-full space-y-4"},Or={class:"grid grid-cols-3 gap-1"},Fr={class:"flex justify-between my-4"};function Dr(a,t,r,y,d,e){const c=l("Input"),h=l("Switch"),g=l("Select"),m=l("Button");return o(),n("div",Pr,[s("div",Cr,[i(c,{type:"text",label:"Name",modelValue:r.cartPromotion.name,"onUpdate:modelValue":t[0]||(t[0]=u=>r.cartPromotion.name=u),placeholder:"Standard Ticket",onInput:t[1]||(t[1]=u=>e.orderState.saveStateDebounced("Promotion name changed"))},null,8,["modelValue"]),s("div",Or,[i(h,{size:"xs",suffixText:"Offer discount",modelValue:r.cartPromotion.offer_discount,"onUpdate:modelValue":t[2]||(t[2]=u=>r.cartPromotion.offer_discount=u),onInput:t[3]||(t[3]=u=>e.orderState.saveStateDebounced("Promotion discount offer changed"))},null,8,["modelValue"]),r.cartPromotion.offer_discount?(o(),n(v,{key:0},[i(g,{class:"w-full",search:!1,options:d.discountRateTypes,placeholder:"Select discount type",modelValue:r.cartPromotion.discount_rate_type,"onUpdate:modelValue":t[4]||(t[4]=u=>r.cartPromotion.discount_rate_type=u),onChange:t[5]||(t[5]=u=>e.orderState.saveStateDebounced("Promotion discount type changed"))},null,8,["options","modelValue"]),r.cartPromotion.discount_rate_type==d.RATE_TYPES.FLAT?(o(),f(c,{key:0,type:"money",currency:e.store.currency.code,modelValue:r.cartPromotion.discount_flat_rate,"onUpdate:modelValue":t[6]||(t[6]=u=>r.cartPromotion.discount_flat_rate=u),onInput:t[7]||(t[7]=u=>e.orderState.saveStateDebounced("Promotion discount amount changed"))},null,8,["currency","modelValue"])):(o(),f(c,{key:1,type:"percentage",modelValue:r.cartPromotion.discount_percentage_rate,"onUpdate:modelValue":t[8]||(t[8]=u=>r.cartPromotion.discount_percentage_rate=u),onInput:t[9]||(t[9]=u=>e.orderState.saveStateDebounced("Promotion discount amount changed"))},null,8,["modelValue"]))],64)):p("",!0)])]),s("div",Fr,[i(h,{size:"xs",suffixText:"Offer free delivery",modelValue:r.cartPromotion.offer_free_delivery,"onUpdate:modelValue":t[10]||(t[10]=u=>r.cartPromotion.offer_free_delivery=u),onInput:t[11]||(t[11]=u=>e.orderState.saveStateDebounced("Promotion fee delivery offer changed"))},null,8,["modelValue"]),i(m,{size:"xs",type:"danger",leftIcon:d.Trash2,action:()=>e.orderState.removeCartPromotion(r.index)},{default:b(()=>[...t[12]||(t[12]=[s("span",null,"Remove Promotion",-1)])]),_:1},8,["leftIcon","action"])])])}const Lr=x(kr,[["render",Dr]]),Mr={components:{Pill:Z},props:{promotion:{type:Object},onSelectPromotion:{type:Function}}},Tr={class:"w-full flex items-center justify-between"},Ir={class:"text-sm font-semibold"},jr={class:"flex items-center space-x-1"};function Vr(a,t,r,y,d,e){const c=l("Pill");return o(),n("div",{onClick:t[0]||(t[0]=()=>r.onSelectPromotion(r.promotion)),class:"flex justify-between items-center cursor-pointer p-3 space-x-4 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100"},[s("div",Tr,[s("div",null,[s("p",Ir,_(r.promotion.name),1)]),s("div",jr,[r.promotion.offer_discount?(o(),f(c,{key:0,type:"success",size:"xs"},{default:b(()=>[...t[1]||(t[1]=[F("discount",-1)])]),_:1})):p("",!0),r.promotion.offer_free_delivery?(o(),f(c,{key:1,type:"success",size:"xs"},{default:b(()=>[...t[2]||(t[2]=[F("free delivery",-1)])]),_:1})):p("",!0)])])])}const Ar=x(Mr,[["render",Vr]]),Er={components:{PromotionOption:Ar},props:{promotions:{type:Array},onSelectPromotion:{type:Function}}},Br={class:"max-h-80 overflow-y-auto space-y-2 mb-4"};function Nr(a,t,r,y,d,e){const c=l("PromotionOption");return o(),n("div",Br,[(o(!0),n(v,null,k(r.promotions,(h,g)=>(o(),f(c,{key:g,promotion:h,onSelectPromotion:r.onSelectPromotion},null,8,["promotion","onSelectPromotion"]))),128))])}const Rr=x(Er,[["render",Nr]]),Ur={inject:["formState","orderState","storeState","notificationState"],components:{Input:C,Modal:N,Button:D,Skeleton:P,PromotionOptions:Rr},data(){return{Plus:V,promotions:[],searchTerm:null,lastSearchTerm:null,isLoadingPromotions:!1,hasLoadedInitialPromotions:!1}},watch:{searchTerm(){this.showPromotions()}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},isEditting(){return this.$route.name==="edit-order"},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},hasPromotions(){return this.promotions.length>0}},methods:{isNotEmpty:j,onShow(){this.hasLoadedInitialPromotions=!1,this.lastSearchTerm=null,this.searchTerm=null,this.promotions=[],this.showPromotions()},async showPromotions(){var a,t;try{this.isLoadingPromotions=!0;let r={params:{store_id:this.store.id}};this.hasSearchTerm&&(r.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const y=await T.get("/api/promotions",r);if(this.searchTerm===this.lastSearchTerm){const d=y.data;this.promotions=d.data,this.isLoadingPromotions=!1,this.hasLoadedInitialPromotions=!0}}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching promotions";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch promotions:",r)}finally{this.isLoadingPromotions=!1}},onSelectPromotion(a){this.$refs.modal.hideModal(),this.orderState.addCartPromotionUsingPromotion(a)},addNew(){this.$refs.modal.hideModal(),this.orderState.addCartPromotion()}}},Zr={class:"flex justify-center"},zr={key:0,class:"flex justify-center items-center space-x-4 my-2"},Hr={key:1,class:"space-y-2 mb-4"},qr={class:"w-full space-y-2"},Wr={key:3,class:"text-sm text-center p-4 rounded-lg bg-gray-50 mb-4"};function Yr(a,t,r,y,d,e){const c=l("Input"),h=l("Button"),g=l("Skeleton"),m=l("PromotionOptions"),u=l("Modal");return o(),n("div",Zr,[i(u,{ref:"modal",onShow:e.onShow,triggerSize:"sm",leftTriggerIcon:d.Plus,contentClass:"px-4",triggerType:"light",header:"Add Promotion",scrollOnContent:!1,showApproveButton:!1,triggerText:"Add Promotion",triggerLoading:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},{content:b(()=>[d.hasLoadedInitialPromotions?(o(),n("div",zr,[i(c,{type:"search",class:"w-full",debounced:!0,modelValue:d.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=S=>d.searchTerm=S),placeholder:"Search promotions",onInput:t[1]||(t[1]=S=>d.isLoadingPromotions=!0),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder},null,8,["modelValue","skeleton"]),i(h,{size:"xs",type:"light",action:e.addNew,leftIcon:d.Plus,buttonClass:"my-2"},{default:b(()=>[...t[2]||(t[2]=[s("span",null,"Add New",-1)])]),_:1},8,["action","leftIcon"])])):p("",!0),d.isLoadingPromotions?(o(),n("div",Hr,[(o(),n(v,null,k([1,2,3],(S,w)=>s("div",{key:w,class:"flex items-center space-x-2 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50 w-full"},[i(g,{width:"w-10",height:"h-10",rounded:"rounded-lg",shine:!0,class:"flex-shrink-0"}),s("div",qr,[i(g,{width:"w-2/3",shine:!0}),i(g,{width:"w-1/3",shine:!0})])])),64))])):e.hasPromotions?(o(),f(m,{key:2,promotions:d.promotions,onSelectPromotion:e.onSelectPromotion},null,8,["promotions","onSelectPromotion"])):(o(),n("p",Wr," No promotions found "))]),_:1},8,["onShow","leftTriggerIcon","triggerLoading"])])}const Gr=x(Ur,[["render",Yr]]),Qr={inject:["storeState","orderState"],components:{Skeleton:P,AddPromotion:Gr,OrderPromotion:Lr},computed:{hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},cartPromotions(){return this.orderState.orderForm.cart_promotions},isEditting(){return this.$route.name==="edit-order"},hasCartPromotions(){return this.cartPromotions.length>0}}},Jr={class:"bg-white rounded-lg p-4 shadow-sm"},Kr={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},Xr={class:"w-full space-y-4"},$r={key:1,class:"space-y-4"};function eo(a,t,r,y,d,e){const c=l("Skeleton"),h=l("OrderPromotion"),g=l("AddPromotion");return o(),n("div",Jr,[t[3]||(t[3]=s("h1",{class:"text-lg font-semibold mb-4"},"Promotions",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(o(),n("div",Kr,[t[0]||(t[0]=s("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},[s("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.99 14.993 6-6m6 3.001c0 1.268-.63 2.39-1.593 3.069a3.746 3.746 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043 3.745 3.745 0 0 1-3.068 1.593c-1.268 0-2.39-.63-3.068-1.593a3.745 3.745 0 0 1-3.296-1.043 3.746 3.746 0 0 1-1.043-3.297 3.746 3.746 0 0 1-1.593-3.068c0-1.268.63-2.39 1.593-3.068a3.746 3.746 0 0 1 1.043-3.297 3.745 3.745 0 0 1 3.296-1.042 3.745 3.745 0 0 1 3.068-1.594c1.268 0 2.39.63 3.068 1.593a3.745 3.745 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.297 3.746 3.746 0 0 1 1.593 3.068ZM9.74 9.743h.008v.007H9.74v-.007Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm4.125 4.5h.008v.008h-.008v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})])],-1)),s("div",Xr,[i(c,{width:"w-full",shine:!0}),i(c,{width:"w-1/3",shine:!0})])])):(o(),n("div",$r,[e.hasCartPromotions?(o(!0),n(v,{key:0},k(e.cartPromotions,(m,u)=>(o(),f(h,{key:u,index:u,cartPromotion:m},null,8,["index","cartPromotion"]))),128)):p("",!0),s("div",{class:O([{"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4":!e.hasCartPromotions}])},[e.hasCartPromotions?p("",!0):(o(),n(v,{key:0},[t[1]||(t[1]=s("svg",{class:"w-10 h-10 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.99 14.993 6-6m6 3.001c0 1.268-.63 2.39-1.593 3.069a3.746 3.746 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043 3.745 3.745 0 0 1-3.068 1.593c-1.268 0-2.39-.63-3.068-1.593a3.745 3.745 0 0 1-3.296-1.043 3.746 3.746 0 0 1-1.043-3.297 3.746 3.746 0 0 1-1.593-3.068c0-1.268.63-2.39 1.593-3.068a3.746 3.746 0 0 1 1.043-3.297 3.745 3.745 0 0 1 3.296-1.042 3.745 3.745 0 0 1 3.068-1.594c1.268 0 2.39.63 3.068 1.593a3.745 3.745 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.297 3.746 3.746 0 0 1 1.593 3.068ZM9.74 9.743h.008v.007H9.74v-.007Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm4.125 4.5h.008v.008h-.008v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})],-1)),t[2]||(t[2]=s("span",{class:"text-sm text-gray-500"},"No promotions added",-1))],64)),i(g)],2)]))])}const to=x(Qr,[["render",eo]]),ro={inject:["formState","storeState","orderState"],components:{Input:C,Skeleton:P},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isEditting(){return this.$route.name==="edit-order"},orderForm(){return this.orderState.orderForm},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder}}},oo={class:"bg-white rounded-lg p-4 shadow-sm"},so={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},no={class:"w-full space-y-4"},ao={key:1,class:"space-y-2"};function io(a,t,r,y,d,e){const c=l("Skeleton"),h=l("Input");return o(),n("div",oo,[t[5]||(t[5]=s("h1",{class:"text-lg font-semibold mb-4"},"Other",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(o(),n("div",so,[t[4]||(t[4]=s("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},[s("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])],-1)),s("div",no,[i(c,{width:"w-full",shine:!0}),i(c,{width:"w-1/3",shine:!0})])])):(o(),n("div",ao,[i(h,{rows:"2",label:"Remark",type:"textarea",placeholder:"Optional",modelValue:e.orderForm.remark,"onUpdate:modelValue":t[0]||(t[0]=g=>e.orderForm.remark=g),description:"Visible to customers",errorText:e.formState.getFormError("remark"),onChange:t[1]||(t[1]=g=>e.orderState.saveStateDebounced("Remark changed")),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder,tooltipContent:"Use the Remark field to add a note that will be visible to the customer, such as special instructions, order details, or personalized messages."},null,8,["modelValue","errorText","skeleton"]),i(h,{type:"money",label:"Adjustment",allowNegativeAmounts:!0,currency:e.store.currency.code,modelValue:e.orderForm.adjustment,"onUpdate:modelValue":t[2]||(t[2]=g=>e.orderForm.adjustment=g),errorText:e.formState.getFormError("adjustment"),onChange:t[3]||(t[3]=g=>e.orderState.saveStateDebounced("Adjustment changed")),skeleton:e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder,description:"Modify the order total by adding or subtracting an arbitrary amount",tooltipContent:"Use the Adjustment field to manually add or subtract an amount for discounts, extra charges, or price corrections."},null,8,["currency","modelValue","errorText","skeleton"])]))])}const lo=x(ro,[["render",io]]),co={inject:["formState","orderState"],components:{Loader:$,AddressInput:ee},props:{index:{type:Number},deliveryMethod:{type:Object}},computed:{orderForm(){return this.orderState.orderForm},selectedDeliveryMethod(){return this.orderState.selectedDeliveryMethod},pinLocationOnMap(){return(this.shoppingCartDeliveryMethodOption||{}).pin_location_on_map||!1},deliveryAddressIsRequired(){return(this.shoppingCartDeliveryMethodOption||{}).delivery_address_is_required||!1},shoppingCartDeliveryMethodOption(){return this.orderState.getShoppingCartDeliveryMethodOption(this.deliveryMethod)},errorText(){return this.formState.getFormError(`delivery_methods.${this.index}.address`)}},methods:{setAddress(a){this.orderState.orderForm.delivery_address=a,this.orderState.saveStateDebounced("Delivery address changed")},unsetAddress(){this.orderState.orderForm.delivery_address=null,this.orderState.saveStateDebounced("Delivery address removed")}},created(){this.orderState.orderForm.delivery_address&&(this.loadingMap=!0,setTimeout(()=>{this.loadingMap=!1},1500))}},uo={key:0,class:"mt-2 pt-2 border-t border-dashed border-gray-200"},mo={key:0,class:"scroll-to-error font-medium text-red-500 text-xs mt-1 ml-1"},ho={key:1,class:"flex items-center justify-center py-2"};function go(a,t,r,y,d,e){const c=l("Loader"),h=l("AddressInput");return e.deliveryAddressIsRequired?(o(),n("div",uo,[e.errorText?(o(),n("span",mo,_(e.errorText),1)):p("",!0),a.loadingMap?(o(),n("div",ho,[i(c,null,{default:b(()=>[...t[0]||(t[0]=[s("span",{class:"text-sm ml-2"},"Preparing address",-1)])]),_:1})])):(o(),f(h,{key:2,triggerClass:"",onlyValidate:!0,onOnDeleted:e.unsetAddress,onOnValidated:e.setAddress,pinLocationOnMap:e.pinLocationOnMap,address:e.orderForm.delivery_address},null,8,["onOnDeleted","onOnValidated","pinLocationOnMap","address"]))])):p("",!0)}const yo=x(co,[["render",go]]),po={inject:["formState","orderState"],components:{Alert:te,Input:C,Switch:E,Skeleton:P,DeliveryDatePicker:oe,DeliveryTimePicker:re},props:{index:{type:Number},deliveryMethod:{type:Object}},data(){return{originalDeliveryDate:null,isLoadingDateOptions:!1,originalDeliveryTimeslot:null,originalDeliveryDateIsPast:!1}},watch:{"orderForm.schedule.change_delivery_schedule"(a){a?this.originalDeliveryDateIsPast&&!this.orderForm.schedule.show_all_dates&&(this.orderForm.delivery_date=null,this.orderForm.delivery_timeslot=null):(this.orderForm.delivery_date=this.originalDeliveryDate,this.orderForm.delivery_timeslot=this.originalDeliveryTimeslot)},"orderForm.schedule.show_all_dates"(a){a?(this.orderForm.delivery_date=this.originalDeliveryDate,this.orderForm.delivery_timeslot=this.originalDeliveryTimeslot):this.originalDeliveryDateIsPast&&(this.orderForm.delivery_date=null,this.orderForm.delivery_timeslot=null),this.orderForm.schedule.show_all_timeslots=a}},computed:{isCreating(){return this.$route.name==="create-order"},shoppingCart(){return this.orderState.shoppingCart},orderForm(){return this.orderState.orderForm},isInspectingShoppingCart(){return this.orderState.isInspectingShoppingCart},deliveryDateIsPast(){return this.orderForm.delivery_date&&R(this.orderForm.delivery_date)},scheduleIsRequired(){return(this.shoppingCartDeliveryMethodOption||{}).schedule_is_required||!1},scheduleIncompleteReasons(){return(this.shoppingCartDeliveryMethodOption||{}).schedule_incomplete_reasons||[]},shoppingCartDeliveryMethodOption(){return this.orderState.getShoppingCartDeliveryMethodOption(this.deliveryMethod)},errorText(){return this.formState.getFormError(`delivery_methods.${this.index}.schedule`)}},methods:{formattedShortWeekday:H,onIsLoadingDateOptions(a){this.isLoadingDateOptions=a}},created(){this.originalDeliveryDate=this.orderForm.delivery_date,this.originalDeliveryTimeslot=this.orderForm.delivery_timeslot,this.originalDeliveryDateIsPast=this.originalDeliveryDate&&R(this.originalDeliveryDate)}},_o={key:0,class:"space-y-4 pt-4 px-4"},fo={class:"space-y-2"},vo={class:"text-sm text-gray-500"},So={key:0,class:"space-y-2"},wo={class:"flex items-center space-x-4"},xo={key:0,class:"scroll-to-error font-medium text-red-500 text-xs mt-1 ml-1"},bo={key:1,class:"flex items-center space-x-1 md:space-x-2"},ko={class:"font-medium text-red-500 text-xs md:text-sm"},Po={key:2,class:"space-y-2 border-t border-b border-dashed border-gray-300 py-4"},Co={key:0,class:"text-sm"},Oo={class:"font-bold"},Fo={key:1,class:"text-sm"},Do={class:"font-bold"};function Lo(a,t,r,y,d,e){const c=l("Switch"),h=l("Input"),g=l("Alert"),m=l("DeliveryDatePicker"),u=l("DeliveryTimePicker"),S=l("Skeleton");return e.scheduleIsRequired?(o(),n("div",_o,[s("div",fo,[t[8]||(t[8]=s("p",{class:"font-bold text-md"},"Schedule",-1)),s("div",null,[s("p",vo,[r.deliveryMethod.schedule_type=="date"?(o(),n(v,{key:0},[e.isCreating?(o(),n(v,{key:0},[F("Specify the delivery date for this order")],64)):(o(),n(v,{key:1},[F("The delivery date for this order")],64))],64)):r.deliveryMethod.schedule_type=="date and time"?(o(),n(v,{key:1},[e.isCreating?(o(),n(v,{key:0},[F("Specify the delivery date and time for this order")],64)):(o(),n(v,{key:1},[F("The delivery date and time for this order")],64))],64)):p("",!0)])])]),d.originalDeliveryDate?(o(),n("div",So,[s("div",wo,[i(c,{size:"xs",suffixText:"Change delivery schedule",modelValue:e.orderForm.schedule.change_delivery_schedule,"onUpdate:modelValue":t[0]||(t[0]=w=>e.orderForm.schedule.change_delivery_schedule=w),onChange:t[1]||(t[1]=w=>e.orderState.saveStateDebounced(`Change delivery schedule (${e.orderForm.schedule.change_delivery_schedule?"On":"Off"})`))},null,8,["modelValue"]),e.orderForm.schedule.change_delivery_schedule?(o(),f(h,{key:0,type:"checkbox",modelValue:e.orderForm.schedule.show_all_dates,"onUpdate:modelValue":t[2]||(t[2]=w=>e.orderForm.schedule.show_all_dates=w),inputLabel:r.deliveryMethod.schedule_type=="date"?"Show all dates":"Show all dates and timeslots",onChange:t[3]||(t[3]=w=>e.orderState.saveStateDebounced(`Show all ${r.deliveryMethod.schedule_type=="date"?"dates":"dates and timeslots"} (${e.orderForm.schedule.show_all_dates?"On":"Off"})`))},null,8,["modelValue","inputLabel"])):p("",!0)]),e.orderForm.schedule.change_delivery_schedule&&e.deliveryDateIsPast?(o(),f(g,{key:0,type:"warning",dismissable:!0,title:"Delivery date passed",description:"Update the delivery date to a future date if the order hasnt been delivered, otherwise ignore this message."})):p("",!0)])):p("",!0),!d.originalDeliveryDate||d.originalDeliveryDate&&e.orderForm.schedule.change_delivery_schedule?(o(),n(v,{key:1},[e.errorText?(o(),n("span",xo,_(e.errorText),1)):p("",!0),i(m,{deliveryMethod:r.deliveryMethod,onIsLoading:e.onIsLoadingDateOptions,modelValue:e.orderForm.delivery_date,"onUpdate:modelValue":t[4]||(t[4]=w=>e.orderForm.delivery_date=w),showAllDates:e.orderForm.schedule.show_all_dates,onChange:t[5]||(t[5]=w=>this.orderState.saveStateDebounced("Delivery date changed"))},null,8,["deliveryMethod","onIsLoading","modelValue","showAllDates"]),e.orderForm.delivery_date&&!d.isLoadingDateOptions&&r.deliveryMethod.schedule_type=="date and time"?(o(),f(u,{key:1,class:"w-full",deliveryMethod:r.deliveryMethod,autoSelectFirstTimeslot:e.isCreating,modelValue:e.orderForm.delivery_timeslot,"onUpdate:modelValue":t[6]||(t[6]=w=>e.orderForm.delivery_timeslot=w),deliveryDate:e.orderForm.delivery_date,showAllDates:e.orderForm.schedule.show_all_dates,showAllTimeslots:e.orderForm.schedule.show_all_timeslots,onChange:t[7]||(t[7]=w=>this.orderState.saveStateDebounced("Delivery time changed"))},null,8,["deliveryMethod","autoSelectFirstTimeslot","modelValue","deliveryDate","showAllDates","showAllTimeslots"])):p("",!0),(o(!0),n(v,null,k(e.scheduleIncompleteReasons,(w,L)=>(o(),n("div",{key:L},[e.isInspectingShoppingCart?(o(),f(S,{key:0,width:"w-1/3",shine:!0})):(o(),n("div",bo,[t[9]||(t[9]=s("svg",{class:"w-4 h-4 md:w-6 md:h-6 flex-shrink-0 text-red-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})],-1)),s("span",ko,_(w),1)]))]))),128))],64)):p("",!0),e.orderForm.delivery_date||e.orderForm.delivery_timeslot?(o(),n("div",Po,[e.orderForm.delivery_date?(o(),n("div",Co,[t[10]||(t[10]=s("span",null,"Delivery date: ",-1)),s("span",Oo,_(e.orderForm.delivery_date)+" ("+_(e.formattedShortWeekday(e.orderForm.delivery_date))+") ",1)])):p("",!0),e.orderForm.delivery_timeslot?(o(),n("div",Fo,[t[11]||(t[11]=s("span",null,"Delivery time: ",-1)),s("span",Do,_(e.orderForm.delivery_timeslot),1)])):p("",!0)])):p("",!0)])):p("",!0)}const Mo=x(po,[["render",Lo]]),To={inject:["formState","orderState"],components:{Info:ne,CircleAlert:se,Skeleton:P,OrderDeliveryMethodMap:yo,OrderDeliveryMethodSchedule:Mo},props:{index:{type:Number},deliveryMethod:{type:Object}},computed:{shoppingCart(){return this.orderState.shoppingCart},orderForm(){return this.orderState.orderForm},isInspectingShoppingCart(){return this.orderState.isInspectingShoppingCart},usesFlatFee(){return this.deliveryMethod.fee_type=="flat fee"},usesPercentageFee(){return this.deliveryMethod.fee_type=="percentage fee"},usesFeeByWeight(){return this.deliveryMethod.fee_type=="fee by weight"},usesFeeByDistance(){return this.deliveryMethod.fee_type=="fee by distance"},usesFeeByPostalCode(){return this.deliveryMethod.fee_type=="fee by postal code"},isSelectedDeliveryMethod(){return this.orderForm.delivery_method_id===this.deliveryMethod.id},shoppingCartDeliveryMethodOption(){return((this.shoppingCart||{}).delivery_method_options||[]).find(a=>a.id==this.deliveryMethod.id)},amount(){return(this.shoppingCartDeliveryMethodOption||{}).amount},offersFreeDelivery(){return(this.shoppingCartDeliveryMethodOption||{}).free_delivery},tips(){return(this.shoppingCartDeliveryMethodOption||{}).tips||[]},unavailabilityReasons(){return(this.shoppingCartDeliveryMethodOption||{}).unavailability_reasons||[]},hasTips(){return this.tips.length>0},hasUnavailabilityReasons(){return this.unavailabilityReasons.length>0},errorText(){return this.formState.getFormError(`delivery_methods.${this.index}`)}},methods:{selectDeliveryMethod(){this.orderForm.delivery_method_id=this.deliveryMethod.id,this.orderState.saveStateDebounced("Delivery method changed")}}},Io={class:"flex items-center space-x-2"},jo={key:0,class:"w-6 h-6 text-green-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},Vo={key:1,class:"w-6 h-6 flex justify-center items-center"},Ao={class:"w-full"},Eo={class:"font-bold text-sm transition-colors"},Bo={class:"text-sm transition-colors"},No={key:0,class:"text-sm transition-colors text-green-500 font-bold"},Ro={key:1,class:"text-sm transition-colors"},Uo={key:2,class:"text-sm transition-colors"},Zo={key:3,class:"text-sm transition-colors"},zo={key:4,class:"text-sm transition-colors"},Ho={key:5,class:"text-sm transition-colors"},qo={key:1,class:"bg-red-50 mt-2 p-4"},Wo={key:1,class:"flex items-center space-x-1 md:space-x-2"},Yo={key:2,class:"bg-blue-50 mt-2 p-4"},Go={key:1,class:"flex items-center space-x-1 md:space-x-2"},Qo={class:"font-medium italic text-xs md:text-sm text-blue-500"},Jo={key:0,class:"scroll-to-error font-medium text-red-500 text-xs mt-1 ml-1"};function Ko(a,t,r,y,d,e){const c=l("Skeleton"),h=l("Info"),g=l("OrderDeliveryMethodSchedule"),m=l("OrderDeliveryMethodMap");return o(),n("div",{onClick:t[0]||(t[0]=W((...u)=>e.selectDeliveryMethod&&e.selectDeliveryMethod(...u),["stop"])),class:"cursor-pointer p-4 bg-gray-50 border border-gray-300 rounded-lg transition-colors group"},[s("div",Io,[i(q,{name:"fade-1",mode:"out-in"},{default:b(()=>[e.isSelectedDeliveryMethod?(o(),n("svg",jo,[...t[1]||(t[1]=[s("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"},null,-1)])])):(o(),n("div",Vo,[...t[2]||(t[2]=[s("div",{class:"w-4 h-4 bg-gray-100 border border-gray-300 rounded-full"},null,-1)])]))]),_:1}),s("div",Ao,[s("p",Eo,_(r.deliveryMethod.name),1),s("p",Bo,_(r.deliveryMethod.description),1),r.deliveryMethod.charge_fee&&(e.offersFreeDelivery||e.amount)?(o(),n(v,{key:0},[e.offersFreeDelivery?(o(),n("p",No," Free delivery ")):e.usesFlatFee?(o(),n("p",Ro," Flat fee of "+_(e.amount.amount_with_currency),1)):e.usesPercentageFee?(o(),n("p",Uo," Percentage fee of "+_(e.amount.amount_with_currency)+" ("+_(r.deliveryMethod.percentage_fee_rate)+"%) ",1)):e.usesFeeByWeight?(o(),n("p",Zo," Weight fee of "+_(e.amount.amount_with_currency)+" ("+_(e.shoppingCartDeliveryMethodOption.weight.text)+") ",1)):e.usesFeeByDistance?(o(),n("p",zo," Distance fee of "+_(e.amount.amount_with_currency)+" ("+_(e.shoppingCartDeliveryMethodOption.distance.text)+") ",1)):e.usesFeeByPostalCode?(o(),n("p",Ho," Distance fee of "+_(e.amount.amount_with_currency)+" ("+_(e.shoppingCartDeliveryMethodOption.distance.text)+") ",1)):p("",!0)],64)):p("",!0),e.hasUnavailabilityReasons?(o(),n("div",qo,[(o(!0),n(v,null,k(e.unavailabilityReasons,(u,S)=>(o(),n("div",{key:S},[e.isInspectingShoppingCart?(o(),f(c,{key:0,width:"w-1/3",shine:!0})):(o(),n("div",Wo,[i(h,{size:"16",class:O(["flex-shrink-0",e.isSelectedDeliveryMethod?"text-red-500":"text-blue-500"])},null,8,["class"]),s("span",{class:O(["font-medium italic text-xs md:text-sm",e.isSelectedDeliveryMethod?"text-red-500":"text-blue-500"])},_(u),3)]))]))),128))])):p("",!0),e.hasTips&&!e.hasUnavailabilityReasons?(o(),n("div",Yo,[(o(!0),n(v,null,k(e.tips,(u,S)=>(o(),n("div",{key:S},[e.isInspectingShoppingCart?(o(),f(c,{key:0,width:"w-1/3",shine:!0})):(o(),n("div",Go,[i(h,{size:"16",class:"flex-shrink-0 text-blue-500"}),s("span",Qo,_(u),1)]))]))),128))])):p("",!0)])]),e.isSelectedDeliveryMethod?(o(),n(v,{key:0},[e.errorText?(o(),n("span",Jo,_(e.errorText),1)):p("",!0),i(g,{index:r.index,deliveryMethod:r.deliveryMethod},null,8,["index","deliveryMethod"]),i(m,{index:r.index,deliveryMethod:r.deliveryMethod},null,8,["index","deliveryMethod"])],64)):p("",!0)])}const Xo=x(To,[["render",Ko]]),$o={inject:["formState","storeState","orderState","notificationState"],components:{Skeleton:P,OrderDeliveryMethod:Xo},watch:{store(a,t){!t&&a&&this.showDeliveryMethods()}},computed:{store(){return this.storeState.store},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},orderForm(){return this.orderState.orderForm},isEditting(){return this.$route.name==="edit-order"},deliveryMethod(){return this.orderState.deliveryMethod},deliveryMethods(){return this.orderState.deliveryMethods},hasDeliveryMethods(){return this.orderState.hasDeliveryMethods},errorText(){return this.formState.getFormError("delivery_methods")}},methods:{async showDeliveryMethods(){var a,t;try{this.orderState.isLoadingDeliveryMethods=!0;let r={params:{per_page:100,store_id:this.store.id}};const d=(await T.get("/api/delivery-methods",r)).data;this.orderState.deliveryMethods=d.data}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching delivery methods";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to fetch delivery methods:",r)}finally{this.orderState.isLoadingDeliveryMethods=!1}}},created(){this.store&&this.showDeliveryMethods()}},es={class:"bg-white rounded-lg p-4 shadow-sm"},ts={key:0,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg py-6 px-4 bg-gray-50"},rs={class:"w-full space-y-4"},os={key:1,class:"space-y-2"},ss={key:0,class:"scroll-to-error font-medium text-red-500 text-xs mt-1 ml-1"},ns={key:1,class:"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg space-y-4 my-4"};function ds(a,t,r,y,d,e){const c=l("Skeleton"),h=l("OrderDeliveryMethod");return o(),n("div",es,[t[3]||(t[3]=s("h1",{class:"text-lg font-semibold mb-4"},"Delivery Method",-1)),e.isLoadingStore||e.isLoadingOrder||e.isEditting&&!e.hasOrder?(o(),n("div",ts,[t[0]||(t[0]=s("div",{class:"flex items-center justify-center w-16 h-16 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},[s("svg",{class:"w-6 h-6 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})])],-1)),s("div",rs,[i(c,{width:"w-full",shine:!0}),i(c,{width:"w-1/3",shine:!0})])])):(o(),n("div",os,[e.hasDeliveryMethods?(o(),n(v,{key:0},[(o(!0),n(v,null,k(e.deliveryMethods,(g,m)=>(o(),f(h,{key:m,index:m,deliveryMethod:g},null,8,["index","deliveryMethod"]))),128)),e.errorText?(o(),n("span",ss,_(e.errorText),1)):p("",!0)],64)):(o(),n("div",ns,[e.hasDeliveryMethods?p("",!0):(o(),n(v,{key:0},[t[1]||(t[1]=s("svg",{class:"w-10 h-10 text-green-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 0 0-3.213-9.193 2.056 2.056 0 0 0-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 0 0-10.026 0 1.106 1.106 0 0 0-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12"})],-1)),t[2]||(t[2]=s("span",{class:"text-sm text-gray-500"},"No delivery methods",-1))],64))]))]))])}const as=x($o,[["render",ds]]),is={inject:["formState","orderState","storeState","changeHistoryState","notificationState"],components:{OrderFees:we,OrderBasics:Oe,OrderTotals:$e,OrderCustomer:kt,OrderProducts:br,OrderPromotions:to,OrderMiscellaneous:lo,OrderDeliveryMethods:as},data(){return{shoppingCartReady:!1}},watch:{orderForm:{handler(a){a&&(this.shoppingCartReady?(this.orderState.setIsInspectingShoppingCart(!0),this.inspectShoppingCartDelayed()):this.shoppingCartReady=!0)},deep:!0}},computed:{store(){return this.storeState.store},orderForm(){return this.orderState.orderForm},isEditing(){return this.$route.name==="edit-order"},isCreating(){return this.$route.name==="create-order"}},methods:{inspectShoppingCartDelayed:Y(function(){this.changeHistoryState.hasChanges?this.inspectShoppingCart():(this.orderState.setShoppingCart(null),this.orderState.setIsInspectingShoppingCart(!1))},1e3),async inspectShoppingCart(){var a,t;try{this.orderState.setIsInspectingShoppingCart(!0);const r={inspect:!0,...this.orderForm,store_id:this.store.id,association:"team member"},y=await axios.post("/api/orders",r);this.orderState.setShoppingCart(y.data)}catch(r){const y=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while inspecting shopping cart";this.notificationState.showWarningNotification(y),this.formState.setServerFormErrors(r),console.error("Failed to inspect shopping cart:",r)}finally{this.orderState.setIsInspectingShoppingCart(!1)}}}},ls={class:"select-none grid grid-cols-12 gap-4 mb-40"},cs={class:"col-span-8 space-y-4"},us={class:"col-span-4 space-y-4"};function ms(a,t,r,y,d,e){const c=l("OrderProducts"),h=l("OrderPromotions"),g=l("OrderFees"),m=l("OrderDeliveryMethods"),u=l("OrderMiscellaneous"),S=l("OrderTotals"),w=l("OrderCustomer"),L=l("OrderBasics");return o(),n("div",ls,[s("div",cs,[i(c),i(h),i(g),i(m),i(u),i(S)]),s("div",us,[i(w),i(L)])])}const Qs=x(is,[["render",ms]]);export{Qs as default};
