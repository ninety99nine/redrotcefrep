import{B as T}from"./Button-C5PjVjk3.js";import{L as F}from"./Loader-BQyLZa88.js";import{P as R}from"./Popover-CDw03pE7.js";import{c as m,b as a,e as r,a as p,d as y,j as f,t as l,F as g,f as z,g as u,av as P,m as I,r as d,o as i}from"./app-GlJHzU_x.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as B}from"./circle-check-D0AZ00dD.js";import{C as N}from"./circle-alert-DHQrfF2Y.js";import{C as x}from"./credit-card-D2Zz4sOg.js";import{C as j}from"./clock-11vp7dsc.js";import{R as E}from"./refresh-ccw-Bc4GdQ8O.js";import{M as D}from"./move-right-r29Ekn9t.js";import"./ShineEffect-B9_RJRQO.js";import"./createLucideIcon-BHEQ_wZh.js";const H={inject:["formState","storeState","notificationState"],components:{Button:T,Loader:F,Popover:R,Clock:j,CreditCard:x,CircleAlert:N,CircleCheck:B},data(){return{MoveRight:D,CreditCard:x,RefreshCcw:E,isPastDate:P,formattedDatetime:I,transaction:null,isVerifyingPayment:!1,isLoadingTransaction:!1,isRenewTransactionPaymentLink:!1}},watch:{store:{handler:async function(o){o&&(await this.showTransaction(),this.verifyPricingPlanPayment())}}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},pricingPlan(){return this.transaction.owner},isPaid(){return this.transaction.payment_status=="paid"},isFailedPayment(){return this.transaction.payment_status=="failed payment"},isPendingPayment(){return this.transaction.payment_status=="pending payment"},dpoPaymentUrl(){return this.transaction.metadata.dpo_payment_url},dpoPaymentLinkHasExpired(){return P(this.transaction.metadata.dpo_payment_url_expires_at)}},methods:{navigateToStoreHome(){this.$router.push({name:"show-store-home",params:{store_id:this.store.id}})},async showTransaction(){var o,n;try{this.isLoadingTransaction=!0;const t=this.$route.query.transaction_id;let c={params:{store_id:this.store.id,_relationships:["owner"].join(",")}};const e=await axios.get(`/api/transactions/${t}`,c);this.transaction=e.data}catch(t){const c=((n=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while fetching transaction";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to fetch transaction:",t)}finally{this.isLoadingTransaction=!1}},makePayment(){this.isRenewTransactionPaymentLink||(this.dpoPaymentLinkHasExpired?this.renewTransactionPaymentLink():(this.isRenewTransactionPaymentLink=!0,window.location.assign(this.dpoPaymentUrl)))},async renewTransactionPaymentLink(){var o,n;try{this.isRenewTransactionPaymentLink=!0;let t={store_id:this.store.id};const e=(await axios.post(`/api/transactions/${this.transaction.id}/renew`,t)).data;window.location.href=e.metadata.dpo_payment_url}catch(t){const c=((n=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while renewing payment link";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to renew payment link:",t)}finally{this.isRenewTransactionPaymentLink=!1}},async verifyPricingPlanPayment(){var o,n;try{this.isVerifyingPayment=!0;const t=this.$route.query.transaction_id;let c={store_id:this.store.id};const e=await axios.post(`/api/pricing-plans/${this.pricingPlan.id}/pay/verify/${t}`,c);this.notificationState.showSuccessNotification("Payment verified!"),this.transaction=e.data}catch(t){const c=((n=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:n.message)||(t==null?void 0:t.message)||"Something went wrong while verifying payment";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to verify payment:",t)}finally{this.isVerifyingPayment=!1}}}},M={class:"min-h-screen relative"},W={class:"z-10 pt-32 px-20 relative"},A={key:0,class:"flex flex-col items-center"},q={class:"flex justify-center items-center space-x-2 text-xl text-gray-700 font-semibold mb-4"},U={key:1,class:"flex flex-col items-center justify-center space-y-4 mb-8"},G={class:"flex items-center space-x-2 mb-2"},O={key:0,class:"text-red-600 p-4 bg-red-50 border border-red-300 rounded-lg mb-4"},J={class:"text-sm font-semibold mb-2"},K={key:0,class:"text-xs"},Q={key:1,class:"bg-gray-50 border p-4 rounded-lg mb-4"},X={class:"text-gray-600 text-xs"},Y={class:"flex items-center space-x-2 text-xs mb-2"},Z={class:"text-gray-400"},$={class:"flex items-center space-x-2 text-xs"},tt={class:"text-gray-400"};function et(o,n,t,c,e,s){const w=d("CreditCard"),k=d("Loader"),v=d("CircleCheck"),C=d("Clock"),b=d("CircleAlert"),h=d("Button"),_=d("Popover");return i(),m("div",M,[a("div",W,[e.isLoadingTransaction||e.isVerifyingPayment?(i(),m("div",A,[a("h1",q,[p(w,{size:"24"}),n[0]||(n[0]=a("span",null,"Verifying Payment",-1))]),n[1]||(n[1]=a("p",{class:"w-96 text-sm text-gray-600 text-center mb-8"},"One moment, We are verifying your payment",-1)),p(k,{class:"mb-8"})])):r("",!0),n[5]||(n[5]=a("div",{class:"flex justify-center mb-8"},[a("img",{src:"/images/store-rooftop.png",class:"w-96"})],-1)),e.transaction?(i(),m("div",U,[a("div",{class:f([{"animated-border-green":s.isPaid},{"animated-border-red":s.isFailedPayment},{"animated-border-cyan":s.isPendingPayment},"w-96 bg-white py-4 px-4 shadow-sm rounded-xl"])},[a("div",G,[s.isPaid?(i(),y(v,{key:0,size:"28",class:"text-green-600"})):r("",!0),s.isPendingPayment?(i(),y(C,{key:1,size:"28",class:"text-yellow-600"})):r("",!0),s.isFailedPayment?(i(),y(b,{key:2,size:"28",class:"text-red-600"})):r("",!0),a("h1",{class:f([{"text-green-600":s.isPaid},{"text-red-600":s.isFailedPayment},{"text-yellow-600":s.isPendingPayment},"capitalize text-xl font-bold"])},l(e.transaction.payment_status),3)]),a("h2",{class:f([{"text-green-600":s.isPaid},{"text-red-600":s.isFailedPayment},{"text-yellow-600":s.isPendingPayment},"text-sm mb-4"])},l(e.transaction.description),3),a("h2",{class:f([{"text-green-600":s.isPaid},{"text-red-600":s.isFailedPayment},{"text-yellow-600":s.isPendingPayment},"text-3xl text-gray-700 font-bold space-x-1 mb-4"])},[a("span",null,l(e.transaction.amount.amount_with_currency),1)],2),s.isFailedPayment?(i(),m("div",O,[a("p",J,l(e.transaction.failure_type??"Failure Reason"),1),e.transaction.failure_reason?(i(),m("p",K,l(e.transaction.failure_reason),1)):r("",!0)])):r("",!0),e.transaction.owner.features.length?(i(),m("div",Q,[(i(!0),m(g,null,z(e.transaction.owner.features,(S,L)=>(i(),m("div",{key:L},[a("span",X,l(S),1)]))),128))])):r("",!0),e.isVerifyingPayment?r("",!0):(i(),m(g,{key:2},[s.isPendingPayment?(i(),y(h,{key:0,size:"sm",type:"primary",action:s.makePayment,leftIcon:e.CreditCard,buttonClass:"w-full mb-4",loading:e.isRenewTransactionPaymentLink},{default:u(()=>n[2]||(n[2]=[a("span",null,"Make Payment",-1)])),_:1,__:[2]},8,["action","leftIcon","loading"])):r("",!0),s.isFailedPayment?(i(),y(h,{key:1,size:"sm",type:"primary",action:s.makePayment,leftIcon:e.RefreshCcw,buttonClass:"w-full mb-4",loading:e.isRenewTransactionPaymentLink},{default:u(()=>n[3]||(n[3]=[a("span",null,"Retry Payment",-1)])),_:1,__:[3]},8,["action","leftIcon","loading"])):r("",!0),s.isPaid?(i(),m(g,{key:2},[a("div",Y,[a("span",Z,l(e.formattedDatetime(e.transaction.created_at)),1),p(_,{content:"This is the transaction date",placement:"top"})]),a("div",$,[a("span",tt,l(e.transaction.id),1),p(_,{content:"This is the transaction ID",placement:"top"})])],64)):r("",!0)],64))],2),s.store?(i(),y(h,{key:0,size:"md",buttonClass:"w-96",rightIconSize:"28",rightIcon:e.MoveRight,action:s.navigateToStoreHome,type:s.isPaid?"primary":"light"},{default:u(()=>n[4]||(n[4]=[a("span",{class:"mr-2"},"Go Home",-1)])),_:1,__:[4]},8,["rightIcon","action","type"])):r("",!0)])):r("",!0)]),n[6]||(n[6]=a("img",{src:"/images/clouds.png",class:"absolute top-32"},null,-1))])}const ht=V(H,[["render",et]]);export{ht as default};
