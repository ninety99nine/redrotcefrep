import{i as x}from"./isEqual-CS7N9nu5.js";import{I as M}from"./Input-BpvCbPzt.js";import{M as C}from"./Modal-Dpi9IkUQ.js";import{c}from"./cloneDeep-B2NiHz93.js";import{B as k}from"./Button-B6uWpkNJ.js";import{G as F}from"./GoogleMaps-DTSduw5A.js";import{S as O}from"./SelectCountry-DxnYo4Xq.js";import{d as g,g as u,r as y,o as d,b as r,n as A,c as m,e as h,t as _,a,F as S}from"./app-C9fKn4Wu.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as L}from"./createLucideIcon-aSWH95Ml.js";import{M as q}from"./move-left-Bl4v6ya3.js";import{P as I}from"./plus-B34lslhj.js";/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=L("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),E={inject:["formState","notificationState"],components:{Input:M,Modal:C,Button:k,GoogleMaps:F,SelectCountry:O},props:{address:{type:[Object,null],default:null},ownerId:{type:[String,null],default:null},ownerType:{type:[String,null],default:null},title:{type:String,default:"Address"},subtitle:{type:String,default:"Address used by customers to know your store location."},pinLocationOnMap:{type:Boolean,default:!0},onlyValidate:{type:Boolean,default:!1},triggerClass:{type:String,default:"space-y-4 p-4 border border-gray-300 rounded-lg shadow-lg bg-white"}},emits:["onValidated","onCreated","onUpdated","onDeleted"],data(){return{Plus:I,step:1,MoveLeft:q,SquarePen:B,form:{city:null,state:null,country:"BW",place_id:null,latitude:null,longitude:null,postal_code:null,address_line:null,address_line2:null,owner_id:this.ownerId,owner_type:this.ownerType},originalForm:null,localAddress:null,isSubmitting:!1,previewLatitude:null,previewLongitude:null,countryAddressOptions:[],isLoadingCountryAddressOptions:!1}},watch:{address(t){this.setFields(t),this.localAddress=t}},computed:{submitText(){return this.pinLocationOnMap&&this.step==1?"Next":this.localAddress?"Save Address":"Add Address"},cityWrapperClass(){const t=this.countryAddressOption.state.required,s=this.countryAddressOption.postal_code.required;return t&&s||!t&&!s?"col-span-1":"col-span-2"},countryWrapperClass(){const t=this.countryAddressOption.city.required,s=this.countryAddressOption.state.required,e=this.countryAddressOption.postal_code.required;return t||s||e?"col-span-1":"col-span-2"},hasCountryAddressOption(){return Object.keys(this.countryAddressOptions).length>0},countryAddressOption(){return this.hasCountryAddressOption?this.countryAddressOptions[this.form.country]:null},googleMapsAddress(){var t=this.form.address_line;return this.form.address_line2&&this.form.address_line2.trim()!==""&&(t+=", "+this.form.address_line2),this.form.city&&this.form.city.trim()!==""&&(t+=", "+this.form.city),this.form.state&&this.form.state.trim()!==""&&(t+=", "+this.form.state),this.form.postal_code&&this.form.postal_code.trim()!==""&&(t+=", "+this.form.postal_code),this.form.country&&this.form.country.trim()!==""&&(t+=", "+this.form.country),t},hasAddress(){var t;return((t=this.address)==null?void 0:t.id)!=null},formHasChanged(){var t=c(this.form),s=c(this.originalForm);return!x(t,s)},mustSaveChanges(){return this.formHasChanged&&!this.isSubmitting}},methods:{showModal(){this.step=1,this.copyOriginalForm(),this.$refs.modal.showModal()},hideModal(){this.$refs.modal.hideModal()},markerMoved(t){this.form.place_id=null,this.form.latitude=t.latitude,this.form.longitude=t.longitude},addedMarker(t){this.form.place_id=t.place_id,this.form.latitude=t.latitude,this.form.longitude=t.longitude},setFields(t){t?(this.form.city=t.city,this.form.state=t.state,this.form.country=t.country,this.form.place_id=t.place_id,this.form.owner_id=t.owner_id,this.form.owner_type=t.owner_type,this.form.postal_code=t.postal_code,this.form.address_line=t.address_line,this.form.address_line2=t.address_line2,this.form.latitude=t.latitude?parseFloat(t.latitude):null,this.form.longitude=t.longitude?parseFloat(t.longitude):null,this.previewLatitude=this.form.latitude,this.previewLongitude=this.form.longitude):(this.form.city=null,this.form.state=null,this.form.country="BW",this.form.place_id=null,this.form.latitude=null,this.form.longitude=null,this.form.postal_code=null,this.form.address_line=null,this.form.address_line2=null,this.previewLatitude=null,this.previewLongitude=null),this.originalForm=c(this.form)},copyOriginalForm(){this.form=c(this.originalForm)},submit(){this.pinLocationOnMap&&this.step==1?this.step=2:this.onlyValidate?this.validateAddress():this.hasAddress?this.updateAddress():this.createAddress()},async showCountryAddressOptions(){var t,s;try{this.isLoadingCountryAddressOptions=!0;const e=await axios.get("/api/addresses/country/options");this.countryAddressOptions=e.data}catch(e){const l=((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.message)||(e==null?void 0:e.message)||"Something went wrong while fetching country address options";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to fetch country address options:",e)}finally{this.isLoadingCountryAddressOptions=!1}},async validateAddress(){var t,s;try{this.isSubmitting=!0;const e={...this.form},l=await axios.post("/api/addresses/validate",e);this.localAddress=l.data,this.setFields(this.localAddress),this.$emit("onValidated",c(this.localAddress)),this.hideModal()}catch(e){const l=((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.message)||(e==null?void 0:e.message)||"Something went wrong while validating address";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to validate address:",e)}finally{this.isSubmitting=!1}},async createAddress(){var t,s;try{this.isSubmitting=!0;const e={return:"1",...this.form},l=await axios.post("/api/addresses",e);this.localAddress=l.data,this.setFields(this.localAddress),this.$emit("onCreated",c(this.localAddress)),this.notificationState.showSuccessNotification("Address created"),this.hideModal()}catch(e){const l=((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.message)||(e==null?void 0:e.message)||"Something went wrong while creating address";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to create address:",e)}finally{this.isSubmitting=!1}},async updateAddress(){var t,s;try{this.isSubmitting=!0;const e={return:"1",...this.form},l=await axios.put(`/api/addresses/${this.localAddress.id}`,e);this.localAddress=l.data,this.setFields(this.localAddress),this.$emit("onUpdated",c(this.localAddress)),this.notificationState.showSuccessNotification("Address updated"),this.hideModal()}catch(e){const l=((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.message)||(e==null?void 0:e.message)||"Something went wrong while updating address";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to update address:",e)}finally{this.isSubmitting=!1}},async deleteAddress(){var t,s;try{if(!this.hasAddress){this.$emit("onDeleted",this.localAddress),this.localAddress=null,this.setFields(null),this.hideModal();return}this.isSubmitting=!0;const e=await axios.delete(`/api/addresses/${this.localAddress.id}`);this.setFields(null),this.localAddress=null,this.$emit("onDeleted",null),this.notificationState.showSuccessNotification("Address deleted"),this.hideModal()}catch(e){const l=((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.message)||(e==null?void 0:e.message)||"Something went wrong while deleting address";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(e),console.error("Failed to delete address:",e)}finally{this.isSubmitting=!1}}},created(){this.setFields(this.address),this.showCountryAddressOptions(),this.localAddress=this.address}},T={class:"grid grid-cols-2 gap-2"},N={class:"font-lg font-bold my-2"},W={class:"col-span-2 space-y-2"},z={key:1,class:"col-span-1"},D={key:2,class:"col-span-1"},U={key:2,class:"col-span-2"},j={class:"col-span-2 flex space-x-2 mt-4"},P={class:"flex items-center font-lg font-bold"},R={class:"text-sm text-gray-500 mb-2 pb-4 border-b border-dashed border-gray-300"},G={key:0,class:"flex justify-between items-center space-x-20"},H={class:"text-sm"},Z={class:"flex justify-between items-center space-x-2"};function J(t,s,e,l,o,i){const f=y("Input"),v=y("SelectCountry"),w=y("GoogleMaps"),p=y("Button"),b=y("Modal");return d(),g(b,{ref:"modal",showFooter:!1,scrollOnContent:!1},{content:u(()=>[r("div",T,[r("h1",N,_(o.localAddress?"Edit Address":"Add Address"),1),o.isLoadingCountryAddressOptions?(d(),m(S,{key:0},[],64)):o.step==1?(d(),m(S,{key:1},[r("div",W,[a(f,{type:"text",modelValue:o.form.address_line,"onUpdate:modelValue":s[0]||(s[0]=n=>o.form.address_line=n),placeholder:"Street address",errorText:i.formState.getFormError("address_line")},null,8,["modelValue","errorText"]),a(f,{type:"text",modelValue:o.form.address_line2,"onUpdate:modelValue":s[1]||(s[1]=n=>o.form.address_line2=n),errorText:i.formState.getFormError("address_line2"),placeholder:"Apartment, unit number, suite, etc. (optional)"},null,8,["modelValue","errorText"])]),i.countryAddressOption.city.required?(d(),m("div",{key:0,class:A(i.cityWrapperClass)},[a(f,{type:"text",modelValue:o.form.city,"onUpdate:modelValue":s[2]||(s[2]=n=>o.form.city=n),errorText:i.formState.getFormError("city"),placeholder:i.countryAddressOption.city.label},null,8,["modelValue","errorText","placeholder"])],2)):h("",!0),i.countryAddressOption.state.required?(d(),m("div",z,[a(f,{type:"text",modelValue:o.form.state,"onUpdate:modelValue":s[3]||(s[3]=n=>o.form.state=n),errorText:i.formState.getFormError("state"),placeholder:i.countryAddressOption.state.label},null,8,["modelValue","errorText","placeholder"])])):h("",!0),i.countryAddressOption.postal_code.required?(d(),m("div",D,[a(f,{type:"text",modelValue:o.form.postal_code,"onUpdate:modelValue":s[4]||(s[4]=n=>o.form.postal_code=n),errorText:i.formState.getFormError("postal_code"),placeholder:i.countryAddressOption.postal_code.label},null,8,["modelValue","errorText","placeholder"])])):h("",!0),r("div",{class:A(i.countryWrapperClass)},[a(v,{width:"w-full",modelValue:o.form.country,"onUpdate:modelValue":s[5]||(s[5]=n=>o.form.country=n)},null,8,["modelValue"])],2)],64)):o.step==2?(d(),m("div",U,[a(w,{height:"350px",onMarkerMoved:i.markerMoved,onAddedMarker:i.addedMarker,address:i.googleMapsAddress,placeId:i.mustSaveChanges?null:o.form.place_id,latitude:i.mustSaveChanges?null:o.form.latitude,longitude:i.mustSaveChanges?null:o.form.longitude},null,8,["onMarkerMoved","onAddedMarker","address","placeId","latitude","longitude"])])):h("",!0),r("div",j,[o.step==1&&o.localAddress?(d(),g(p,{key:0,size:"sm",type:"danger",action:i.deleteAddress,disabled:o.isSubmitting},{default:u(()=>s[6]||(s[6]=[r("span",null,"Delete",-1)])),_:1,__:[6]},8,["action","disabled"])):h("",!0),o.step==2?(d(),g(p,{key:1,size:"sm",type:"light",class:"w-24",leftIcon:o.MoveLeft,action:()=>o.step=1},{default:u(()=>s[7]||(s[7]=[r("span",null,"Back",-1)])),_:1,__:[7]},8,["leftIcon","action"])):h("",!0),a(p,{size:"sm",type:"primary",action:i.submit,buttonClass:"w-full",wrapperClass:"w-full",disabled:!e.pinLocationOnMap&&!i.mustSaveChanges},{default:u(()=>[r("span",null,_(i.submitText),1)]),_:1},8,["action","disabled"])])])]),trigger:u(()=>[r("div",{class:A(e.triggerClass)},[r("h1",P,[s[8]||(s[8]=r("svg",{class:"w-6 h-6 mr-2 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})],-1)),r("span",null,_(e.title),1)]),r("p",R,_(e.subtitle),1),o.localAddress?(d(),m("div",G,[r("span",H,_(o.localAddress.complete_address),1),r("div",Z,[a(p,{size:"xs",type:"light",action:i.showModal,leftIcon:o.SquarePen},{default:u(()=>s[9]||(s[9]=[r("span",{class:"whitespace-nowrap ml-1"},"Edit Address",-1)])),_:1,__:[9]},8,["action","leftIcon"]),a(p,{size:"xs",type:"danger",action:i.deleteAddress,disabled:o.isSubmitting},{default:u(()=>s[10]||(s[10]=[r("span",null,"Delete",-1)])),_:1,__:[10]},8,["action","disabled"])])])):(d(),g(p,{key:1,size:"xs",type:"light",leftIcon:o.Plus,action:i.showModal,buttonClass:"w-full"},{default:u(()=>s[11]||(s[11]=[r("span",null,"Add Address",-1)])),_:1,__:[11]},8,["leftIcon","action"])),o.previewLatitude&&o.previewLongitude?(d(),g(w,{key:2,height:"350px",gmpDraggable:!1,latitude:o.previewLatitude,longitude:o.previewLongitude},null,8,["latitude","longitude"])):h("",!0)],2)]),_:1},512)}const de=V(E,[["render",J]]);export{de as A};
