import{c as n,a,b as o,g as c,d as F,e as f,F as g,f as _,t as L,h as k,r as l,o as m}from"./app-CfcRgAtV.js";import{I as R}from"./Input-5etQ1obE.js";import{B as E}from"./Button-C-mSVtjr.js";import{L as B}from"./Loader-DC71jh3F.js";import{S as V}from"./Skeleton-dcrsQT38.js";import{i as T}from"./stringUtils-Bvzw0-oW.js";import{M as C}from"./Menu-CQ2qa_Yj.js";import{B as I}from"./BackdropLoader-Csntr_1Q.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as v}from"./move-left-Dt2sjdDQ.js";import{S as h}from"./star-Cawu6TdB.js";import"./Copy-DthcHkWW.js";import"./ShineEffect-DuM8M3bS.js";import"./createLucideIcon-6Wi-O4Lc.js";import"./Popover-CErryWiK.js";import"./Tooltip-DXGv3bv0.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-BfzP-qh6.js";import"./circle-check-DJt4jgY5.js";import"./circle-alert-DtAPlORr.js";import"./x-0E_1Yt9j.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./house-BNjNDbxy.js";import"./video-BVjaHJ6X.js";import"./Drawer-DdW49D0C.js";import"./DesignCardManager-DoyHqzoa.js";import"./store-Dcez_PYt.js";import"./Pill-26NEKJFK.js";import"./image-CwB2s41O.js";import"./AddressInput-CHaednGC.js";import"./index-fkJHqJxv.js";import"./Modal-1KuVnYqp.js";import"./GoogleMaps-CgkuUTku.js";import"./SelectCountry-C_Upu5vt.js";import"./Select-mk4gS599.js";import"./trash-2-DH-tWKqJ.js";import"./plus-4iq4yqcZ.js";import"./StoreLogo-CNCxn3hW.js";import"./link-TzQ3PWP1.js";import"./at-sign-BTy7GNUo.js";import"./chevron-up-Cpv3OFuL.js";import"./Datepicker-kBZFTfit.js";import"./arrow-right-Be-RTAmm.js";import"./arrow-left-C1dKHe09.js";import"./Alert-bq35X3g6.js";import"./info-DEPUf9Rq.js";import"./Switch-CqEacRY-.js";import"./DeliveryTimePicker-Db9BqIHO.js";import"./circle-check-big-CmE57oPc.js";import"./menu-CPRknzSh.js";import"./user-DZJrVNY6.js";const N={inject:["formState","reviewState","storeState","notificationState"],components:{Input:R,Button:E,Loader:B,Skeleton:V,BackdropLoader:I,Menu:C,Star:h,MoveLeft:v},data(){return{Star:h,MoveLeft:v,isSubmitting:!1,isLoadingUser:!1}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},reviewForm(){return this.reviewState.reviewForm}},watch:{store(s,e){!e&&s&&this.setup()}},methods:{isEmpty:T,async setup(){this.store&&this.reviewState.setReviewForm(null,!0)},navigateToShowShopReviews(){this.$router.push({name:"show-shop-reviews",query:{alias:this.store.alias}})},setRating(s){this.reviewForm.rating=s},async createReview(){var s,e;try{if(this.isSubmitting||(this.formState.hideFormErrors(),this.isEmpty(this.reviewForm.rating)&&this.formState.setFormError("rating","The rating is required"),(this.reviewForm.rating<1||this.reviewForm.rating>5)&&this.formState.setFormError("rating","Rating must be between 1 and 5"),this.formState.hasErrors))return;this.isSubmitting=!0;const r={...this.reviewForm,store_id:this.store.id},d=await k.post("/api/reviews",r);this.notificationState.showSuccessNotification("Review submitted! It will be visible after approval."),await this.navigateToShowShopReviews(),this.reviewState.reset()}catch(r){const d=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Something went wrong while submitting your review";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(r),console.error("Failed to create review:",r)}finally{this.isSubmitting=!1}}},created(){this.setup()},beforeRouteLeave(s,e,r){if(this.reviewState.reviewForm&&(this.reviewForm.rating||this.reviewForm.comment||this.reviewForm.name||this.reviewForm.mobile_number)&&!window.confirm("You have unsaved changes. Are you sure you want to leave?"))return r(!1);this.reviewState.reset(),r()}},U={class:"max-w-4xl mx-auto pt-8 pb-40"},j={key:0,class:"pt-8 flex items-center justify-center"},z={key:1,class:"select-none relative bg-white rounded-lg space-y-4 p-4"},A={class:"flex items-center space-x-4"},q={class:"grid grid-cols-1 md:grid-cols-2 gap-4 border border-gray-300 shadow rounded-lg p-4 space-y-4"},W={class:"border border-gray-300 shadow rounded-lg p-4 space-y-4"},Y={class:"flex space-x-1 mt-2"},D={key:0,class:"mt-1 text-sm text-red-600"},G={class:"flex justify-end"};function H(s,e,r,d,p,t){const S=l("Menu"),b=l("Loader"),y=l("BackdropLoader"),w=l("Button"),u=l("Input"),x=l("Star");return m(),n("div",null,[a(S,{menuClass:"max-w-4xl mx-auto"}),o("div",U,[t.isLoadingStore||p.isLoadingUser?(m(),n("div",j,[a(b,null,{default:c(()=>[...e[3]||(e[3]=[o("span",{class:"text-sm ml-2"},"Loading...",-1)])]),_:1})])):(m(),n("div",z,[p.isSubmitting?(m(),F(y,{key:0,showSpinningLoader:!1,class:"rounded-lg"})):f("",!0),o("div",A,[a(w,{size:"xs",type:"light",action:t.navigateToShowShopReviews,leftIcon:p.MoveLeft},{default:c(()=>[...e[4]||(e[4]=[o("span",null,"Reviews",-1)])]),_:1},8,["action","leftIcon"]),e[5]||(e[5]=o("h1",{class:"text-2xl font-semibold"},"Write A Review",-1))]),t.reviewForm?(m(),n(g,{key:1},[o("div",q,[a(u,{type:"text",label:"Name",placeholder:"Your name",modelValue:t.reviewForm.name,"onUpdate:modelValue":e[0]||(e[0]=i=>t.reviewForm.name=i),secondaryLabel:"(optional)",errorText:t.formState.getFormError("name")},null,8,["modelValue","errorText"]),a(u,{type:"text",label:"Mobile Number",placeholder:"+26772000001",secondaryLabel:"(optional)",modelValue:t.reviewForm.mobile_number,"onUpdate:modelValue":e[1]||(e[1]=i=>t.reviewForm.mobile_number=i),errorText:t.formState.getFormError("mobile_number")},null,8,["modelValue","errorText"])]),o("div",W,[o("div",null,[e[6]||(e[6]=o("label",{class:"text-sm leading-6 font-medium text-gray-900"},"Rating",-1)),o("div",Y,[(m(),n(g,null,_(5,i=>a(x,{size:32,key:i,class:"cursor-pointer",onClick:J=>t.setRating(i),fill:i<=t.reviewForm.rating?"gold":"none",stroke:i<=t.reviewForm.rating?"gold":"gray"},null,8,["onClick","fill","stroke"])),64))]),t.formState.getFormError("rating")?(m(),n("p",D,L(t.formState.getFormError("rating")),1)):f("",!0)]),a(u,{rows:"2",type:"textarea",label:"Comment",modelValue:t.reviewForm.comment,"onUpdate:modelValue":e[2]||(e[2]=i=>t.reviewForm.comment=i),placeholder:"Share your experience...",errorText:t.formState.getFormError("comment"),tooltipContent:"A short description of your feedback"},null,8,["modelValue","errorText"]),o("div",G,[a(w,{size:"sm",type:"primary",leftIcon:p.Star,action:t.createReview,loading:p.isSubmitting},{default:c(()=>[...e[7]||(e[7]=[o("span",null,"Send Review",-1)])]),_:1},8,["leftIcon","action","loading"])])])],64)):f("",!0)]))])])}const Ge=M(N,[["render",H]]);export{Ge as default};
