import{c as d,b as r,a as n,t as l,F as k,g as h,w as S,e as _,h as g,r as p,o as c}from"./app-BFRszLDY.js";import{L as b}from"./Logo-DYfLnSeb.js";import{A as x}from"./Alert-CAFHaSk0.js";import{I as E}from"./Input-D2CpQCT5.js";import{B as v}from"./Button-DCQzWhi0.js";import{i as T}from"./stringUtils-Bvzw0-oW.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as I}from"./createLucideIcon-CSc6mW6X.js";import"./circle-check--aSqogot.js";import"./info-BmAppJiG.js";import"./Copy-BnPm0WTY.js";import"./ShineEffect-jVKnL5S-.js";import"./Popover-7t3v7uU0.js";import"./Tooltip-BCcWuuCA.js";import"./Skeleton-Cb_5uZP7.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-DHHZfB71.js";import"./circle-alert-C2w03bbG.js";import"./x-t57Ey7ol.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Loader-CVwI2N_w.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=I("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]),L={name:"SetupAccount",components:{Logo:b,Alert:x,Input:E,Button:v},inject:["authState","formState","notificationState"],data(){return{LogIn:V,form:{email:"",token:"",password:"",confirm_password:""},loading:!1,tokenError:null,currentYear:new Date().getFullYear(),appName:"Perfect Order"}},methods:{isEmpty:T,goHome(){this.$router.push({name:"login"})},async validateToken(){var m,t;try{await g.post("/api/auth/validate-token",{email:this.form.email,token:this.form.token}),this.tokenError=null}catch(o){const i=((t=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"Invalid or expired token.";this.tokenError=i,this.notificationState.showWarningNotification(i)}},async submit(){var m,t;if(!this.loading&&(this.formState.hideFormErrors(),this.isEmpty(this.form.email)&&this.formState.setFormError("email","Email is required"),this.isEmpty(this.form.password)&&this.formState.setFormError("password","Password is required"),this.isEmpty(this.form.confirm_password)&&this.formState.setFormError("confirm_password","Confirm password"),this.form.password!==this.form.confirm_password&&this.formState.setFormError("confirm_password","Passwords do not match"),!this.formState.hasErrors)){this.loading=!0;try{const i=(await g.post("/api/auth/setup-password",this.form)).data.token;this.authState.setTokenOnRequest(i),this.authState.setTokenOnLocalStorage(i),this.$router.push({name:"show-stores"}),this.notificationState.showSuccessNotification("Password set successfully!")}catch(o){const i=((t=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"Something went wrong while setting your password";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(o),console.error("Failed to set password:",o)}finally{this.loading=!1}}}},async mounted(){this.form.email=this.$route.query.email||"",this.form.token=this.$route.query.token||"",this.form.email&&this.form.token?await this.validateToken():(this.tokenError="Invalid or missing email/token.",this.notificationState.showWarningNotification("Invalid or missing email/token."))}},N={class:"min-h-screen grid grid-cols-1 lg:grid-cols-2 transition-opacity opacity-100 duration-750 lg:grow starting:opacity-0"},P={class:"flex items-center justify-center p-6 bg-linear-to-b from-blue-100 to-white-100"},A={class:"w-full max-w-md"},C={class:"bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6"},B={class:"text-2xl font-semibold leading-none tracking-tight mb-4"},j={class:"text-sm text-gray-500 mb-4"},q={key:0,class:"text-red-500 text-sm mb-3"},H={class:"ml-1"},U={class:"text-sm text-center text-gray-500"};function Y(m,t,o,i,e,s){const w=p("Logo"),y=p("Alert"),f=p("Button"),u=p("Input");return c(),d("div",N,[r("div",P,[r("div",A,[n(w,{height:"h-20 mx-auto mb-4"}),r("div",C,[r("h1",B,l(e.tokenError?e.tokenError.includes("expired")?"Setup Link Expired":"Setup Link Invalid":"Set Up Your Account"),1),r("h1",j,l(e.tokenError?e.tokenError.includes("expired")?"The link to set up your account has expired. Contact your administrator to assist.":"The link to set up your account is invalid. Contact your administrator to assist.":"Please set your password to activate your account."),1),e.tokenError?(c(),d(k,{key:0},[n(y,{title:e.tokenError,type:"danger",dismissable:!1,class:"mb-8"},null,8,["title"]),n(f,{type:"primary",size:"lg",action:s.goHome,buttonClass:"w-full"},{default:h(()=>[...t[4]||(t[4]=[r("span",null,"Go Home",-1)])]),_:1},8,["action"])],64)):(c(),d("form",{key:1,onSubmit:t[3]||(t[3]=S((...a)=>s.submit&&s.submit(...a),["prevent"])),class:"space-y-4"},[n(u,{disabled:"",type:"email",label:"Email",modelValue:e.form.email,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.email=a),errorText:s.formState.getFormError("email")},null,8,["modelValue","errorText"]),n(u,{type:"password",label:"Password",modelValue:e.form.password,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.password=a),errorText:s.formState.getFormError("password")},null,8,["modelValue","errorText"]),n(u,{type:"password",label:"Confirm Password",modelValue:e.form.confirm_password,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.confirm_password=a),errorText:s.formState.getFormError("confirm_password")},null,8,["modelValue","errorText"]),s.formState.generalErrorText?(c(),d("div",q,l(s.formState.generalErrorText),1)):_("",!0),n(f,{size:"md",type:"primary",class:"w-full",action:s.submit,leftIcon:e.LogIn,disabled:e.loading},{default:h(()=>[r("span",H,l(e.loading?"Setting Password...":"Set Password"),1)]),_:1},8,["action","leftIcon","disabled"])],32))]),r("p",U,"Â© "+l(e.currentYear)+" "+l(e.appName)+". All rights reserved.",1)])]),t[5]||(t[5]=r("div",{class:"hidden lg:block"},[r("img",{src:"/images/lady-with-laptop.jpg",class:"w-full h-full object-cover",alt:"Lady holding boxes"})],-1))])}const mt=F(L,[["render",Y]]);export{mt as default};
