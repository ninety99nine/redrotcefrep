import{h as N,c as d,d as _,a as c,r as m,o,e as h,b as s,t as l,F as y,f as T,k as I,w as M,g as S,i as v,p as K,q as V,s as J,u as W,D as X,ah as Y}from"./app-BdtgzR1l.js";import{I as A,r as $}from"./Input-BDUYKZ_s.js";import{S as z}from"./Select-DSAUUq8e.js";import{S as F}from"./Skeleton-BWgMm33A.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as ee}from"./Popover-CtdAzqVX.js";import{P as B}from"./Pill-DUwK16L9.js";import{B as D}from"./Button-HzXB0hWC.js";import{I as j}from"./image-CnuAbhek.js";import{M as te}from"./move-right-URf_R8JQ.js";import{a as re,O as se}from"./OrderPaymentStatusSelect-t-xCtbWH.js";import{M as G}from"./Modal-CiYKVfLx.js";import{i as q,c as oe,a as ne}from"./stringUtils-Bvzw0-oW.js";import{L as ae}from"./Loader-DFjvkDgo.js";import{U as ie}from"./user-round-knIdltpX.js";import{T as E}from"./trash-2-BsHN7UDw.js";import{A as de}from"./arrow-down-to-line-VAcjl9ad.js";import{A as Q}from"./Alert-DT95LbOz.js";import{G as le}from"./GoogleMaps-jsHHPwfk.js";import{C as ce}from"./CollectionStatus-DStCJNXk.js";import{c as me}from"./createLucideIcon-BOaOvfG7.js";import{E as Z}from"./external-link-BHeRK67C.js";import{A as he}from"./arrow-right-CLrlN-g9.js";import{B as H}from"./banknote-BaqN8xNI.js";import{C as ue}from"./circle-dollar-sign-DdjA6Czb.js";import{L as ge}from"./link-2-C1TZZmKY.js";import{P as pe}from"./plus-YSNtgxvu.js";import"./Copy-DcyQ5giz.js";import"./ShineEffect-Dr0WlC0V.js";import"./Tooltip-NkqcAVam.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-CCUHqYUk.js";import"./circle-check-D6VZimzV.js";import"./circle-alert-BWam5-Oa.js";import"./x-H5s2sCz3.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./info-Drvl9Kay.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=me("user-round-check",[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]),fe={inject:["formState","orderState","storeState","notificationState"],components:{Input:A,Select:z,Skeleton:F},data(){return{teamMembers:[],isLoadingTeamMembers:!1}},watch:{isLoadingOrder(a){!a&&this.hasOrder&&this.showTeamMembers()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},orderForm(){return this.orderState.orderForm},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},teamMemberOptions(){let a=[{label:"Unassigned",value:null}];return this.teamMembers.forEach(t=>{var r;a.push({label:t.name||t.email||((r=t.mobile_number)==null?void 0:r.international),value:t.id})}),a}},methods:{async showTeamMembers(){var a,t;try{this.isLoadingTeamMembers=!0;let r={params:{store_id:this.store.id}};const i=await N.get("/api/users",r);this.pagination=i.data,this.teamMembers=this.pagination.data}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching team members";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to fetch team members:",r)}finally{this.isLoadingTeamMembers=!1}},async updateOrder(a,t){var r,i;try{if(a={...a,store_id:this.store.id},await N.put(`/api/orders/${this.order.id}`,a),t=="team member")if(this.orderForm.assigned_to_user_id){const n=this.teamMembers.find(e=>e.id===this.orderForm.assigned_to_user_id);this.notificationState.showSuccessNotification(`Order assigned to ${n.first_name}`)}else this.notificationState.showSuccessNotification("No team member unassigned");else t=="internal note"&&(this.orderForm.internal_note?this.notificationState.showSuccessNotification("Internal note updated"):this.notificationState.showSuccessNotification("Internal note removed"),this.orderState.order.internal_note=this.orderForm.internal_note)}catch(n){const e=((i=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:i.message)||(n==null?void 0:n.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(n),console.error("Failed to update order changes:",n)}}}},ye={class:"bg-white rounded-lg p-4 mb-4"},we={key:1,class:"space-y-4"};function be(a,t,r,i,n,e){const g=m("Skeleton"),u=m("Select"),f=m("Input");return o(),d("div",ye,[e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),d("div",we,[c(u,{search:!0,label:"Assigned To",options:e.teamMemberOptions,modelValue:e.orderForm.assigned_to_user_id,"onUpdate:modelValue":t[0]||(t[0]=p=>e.orderForm.assigned_to_user_id=p),skeleton:e.isLoadingOrder||!e.hasOrder||n.isLoadingTeamMembers,onChange:t[1]||(t[1]=p=>e.updateOrder({assigned_to_user_id:p},"team member"))},null,8,["options","modelValue","skeleton"]),c(f,{rows:"2",type:"textarea",label:"Internal Note",modelValue:e.orderForm.internal_note,"onUpdate:modelValue":t[2]||(t[2]=p=>e.orderForm.internal_note=p),description:"Visible to team members",errorText:e.formState.getFormError("internal_note"),onBlur:t[3]||(t[3]=p=>e.updateOrder({internal_note:p},"internal note")),tooltipContent:"Internal information about this order only visible to you and other team members"},null,8,["modelValue","errorText"])]))])}const xe=P(fe,[["render",be]]),Se={inject:["orderState","storeState"],components:{Skeleton:F},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder},hasTaxTotal(){return this.isLoadingOrder?!1:this.order.vat_amount.amount>0},hasFeeTotal(){return this.isLoadingOrder?!1:this.order.fee_total.amount>0},deliveryFee(){return this.isLoadingOrder?this.order.delivery_fee.amount:null},hasDeliveryName(){return this.isLoadingOrder?!1:this.order.delivery_name!=null},hasDiscountTotal(){return this.isLoadingOrder?!1:this.order.discount_total.amount>0},orderFees(){return this.isLoadingOrder?[]:this.order.order_fees},orderDiscounts(){return this.isLoadingOrder?[]:this.order.order_discounts},hasAdjustmentTotal(){return this.isLoadingOrder?!1:this.order.adjustment_total.amount!=0},adjustmentTotalPositive(){return this.isLoadingOrder?!1:this.order.adjustment_total.amount>0}},methods:{removeDecimalTrailingZeros:$}},ve={class:"bg-blue-50 border border-blue-400 rounded-lg p-4"},Oe={key:0,class:"flex items-center justify-between text-sm border-b border-dashed border-gray-300 pb-2 mb-2"},ke={key:1},Ce={key:1,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Te={key:1},Pe={key:3},Le={key:2,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Ie={class:"flex items-center justify-between text-sm mb-1"},Fe={key:1,class:"w-full"},De={key:3},Me={key:1,class:"text-xs text-gray-400"},je={key:3,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Ne={key:1},Ae={key:3},Ee={key:4,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Ue={class:"flex items-center justify-between text-sm text-gray-500"},Ve={key:1},ze={key:3},Be={key:5,class:"border-b border-gray-300 border-dashed pb-2 mb-2"},Re={class:"flex items-center justify-between text-sm text-gray-500"},We={key:1},Ge={class:"flex items-center justify-between text-base pt-2"},qe={key:1,class:"font-bold"};function Qe(a,t,r,i,n,e){const g=m("Skeleton");return o(),d("div",ve,[e.isLoadingOrder||!e.hasOrder||e.hasTaxTotal||e.hasDiscountTotal||e.hasFeeTotal||e.hasDeliveryName?(o(),d("div",Oe,[t[0]||(t[0]=s("span",null,"Subtotal",-1)),e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",ke,l(e.order.subtotal.amount_with_currency),1))])):h("",!0),e.isLoadingOrder||!e.hasOrder||e.hasDiscountTotal?(o(),d("div",Ce,[(o(!0),d(y,null,T(e.isLoadingOrder||!e.hasOrder?[1]:e.orderDiscounts,(u,f)=>(o(),d("div",{key:f,class:"flex items-center justify-between text-sm text-gray-500"},[e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",Te,l(u.name),1)),e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:2,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Pe,l(u.amount.amount_with_currency),1))]))),128))])):h("",!0),e.isLoadingOrder||!e.hasOrder||e.hasTaxTotal?(o(),d("div",Le,[s("div",Ie,[e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("div",Fe,"Tax ("+l(e.removeDecimalTrailingZeros(e.order.vat_rate))+"% "+l(e.order.vat_method)+")",1)),e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",De,l(e.order.vat_amount.amount_with_currency),1))]),e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-1/3",color:"bg-blue-200",shine:!0})):e.order.vat_amount.amount>0?(o(),d("p",Me,"Tax calculated on the discounted subtotal of "+l(e.order.subtotal_after_discount.amount_with_currency),1)):h("",!0)])):h("",!0),e.isLoadingOrder||!e.hasOrder||e.hasFeeTotal?(o(),d("div",je,[(o(!0),d(y,null,T(e.isLoadingOrder||!e.hasOrder?[1]:e.orderFees,(u,f)=>(o(),d("div",{key:f,class:"flex items-center justify-between text-sm text-gray-500"},[e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Ne,l(u.name),1)),e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",Ae,l(u.amount.amount_with_currency),1))]))),128))])):h("",!0),e.isLoadingOrder||!e.hasOrder||e.hasDeliveryName?(o(),d("div",Ee,[s("div",Ue,[e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Ve,l(e.order.delivery_name),1)),e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",ze,l(e.order.delivery_fee.amount_with_currency),1))])])):h("",!0),e.isLoadingOrder||!e.hasOrder||e.hasAdjustmentTotal?(o(),d("div",Be,[s("div",Re,[e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",We,"Adjustment")),e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",{key:3,class:I([e.adjustmentTotalPositive?"text-green-500":"text-red-500"])},l(e.adjustmentTotalPositive?"+":"-")+" "+l(`${e.order.adjustment_total.amount_with_currency}`.replace("-","")),3))])])):h("",!0),s("div",Ge,[t[1]||(t[1]=s("div",{class:"w-full font-bold"},"Grand Total",-1)),e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",qe,l(e.order.grand_total.amount_with_currency),1))])])}const Ze=P(Se,[["render",Qe]]),He={inject:["orderState","storeState"],components:{Image:j,Pill:B,Button:D},props:{orderProduct:{type:Object}},data(){return{MoveRight:te,expanded:!1}},computed:{store(){return this.storeState.store},hasDetectedChanges(){return this.orderProduct.detected_changes.length>0},totalDetectedChanges(){return this.orderProduct.detected_changes.length},hasPhoto(){return this.photo!=null},photo(){return this.orderProduct.photo},canShowProduct(){return this.orderProduct.product_id!=null}},methods:{toggleExpansion(){this.expanded=!this.expanded},navigateToProduct(){console.log(this.orderProduct),this.$router.push({name:"edit-product",params:{product_id:this.orderProduct.product_id},query:{store_id:this.store.id}})}}},Ke={class:"w-full flex items-center space-x-4"},Je=["src"],Xe={class:"w-full flex items-center justify-between"},Ye={class:"font-semibold text-sm whitespace-nowrap"},$e={class:"text-sm font-semibold"},et={class:"text-xs text-gray-500"},tt={class:"flex items-center space-x-2 mr-4"},rt={class:"flex items-center space-x-2"},st={class:"text-sm"},ot={key:0,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},nt={key:1,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},at={key:0,class:"text-sm p-4 pb-8"},it={class:"flex items-end justify-between mb-4 ml-4"},dt={class:"w-full overflow-x-auto rounded-lg border border-gray-300 mb-4"},lt={class:"w-full text-sm text-left rtl:text-right text-gray-500"},ct={class:"whitespace-nowrap align-top text-left p-2 pl-4"},mt={class:"whitespace-nowrap align-top text-center py-2"},ht={class:"whitespace-nowrap align-top text-center py-2"},ut={class:"whitespace-nowrap align-top text-center py-2"},gt={class:"whitespace-nowrap align-top text-center py-2"},pt={class:"whitespace-nowrap align-top text-right p-2 pr-4"},_t={class:"w-full overflow-x-auto rounded-lg border border-gray-300 mb-4"},ft={class:"w-full text-sm text-left rtl:text-right text-gray-500"},yt={class:"whitespace-nowrap align-top text-left p-2 pl-4"},wt={class:"whitespace-nowrap align-top text-center p-2"},bt={class:"whitespace-nowrap align-top text-center p-2"},xt={class:"w-full overflow-x-auto rounded-lg border mb-4"},St={class:"w-full text-sm text-left rtl:text-right text-gray-500"},vt={key:0,class:"whitespace-nowrap align-top text-left p-2 pl-4"},Ot={key:1,class:"whitespace-nowrap align-top text-center p-2"},kt={class:"space-y-2"},Ct={class:"text-xs"};function Tt(a,t,r,i,n,e){const g=m("Image"),u=m("Pill"),f=m("Button");return o(),d("div",{class:I([{"shadow-md":n.expanded},"select-none rounded-lg overflow-hidden border border-gray-300"])},[s("div",{onClick:t[1]||(t[1]=(...p)=>e.toggleExpansion&&e.toggleExpansion(...p)),class:I([{"shadow-sm border-b border-gray-300":n.expanded},"flex justify-between items-center cursor-pointer p-2 bg-gray-50 hover:bg-gray-100"])},[s("div",Ke,[s("div",{class:I(["flex items-center justify-center w-10 h-10 rounded-lg",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),d("img",{key:0,class:"w-full max-h-full object-contain rounded-lg shrink-0",src:e.photo.path},null,8,Je)):(o(),_(g,{key:1,size:"20",class:"text-gray-400 shrink-0"}))],2),s("div",Xe,[s("div",null,[s("div",{onClick:t[0]||(t[0]=M((...p)=>e.navigateToProduct&&e.navigateToProduct(...p),["stop"])),class:"flex items-center space-x-2 hover:text-blue-500 hover:underline"},[s("span",Ye,l(r.orderProduct.quantity)+" x",1),s("span",$e,l(r.orderProduct.name),1)]),s("div",et,l(r.orderProduct.unit_price.amount_with_currency)+" each",1)]),s("div",tt,[e.hasDetectedChanges?(o(),_(u,{key:0,type:"warning",size:"xs",showDot:!1},{default:S(()=>[v(l(`${e.totalDetectedChanges} ${e.totalDetectedChanges==1?"change":"changes"} found`),1)]),_:1})):h("",!0),r.orderProduct.on_sale?(o(),_(u,{key:1,type:"success",size:"xs",showDot:!1},{default:S(()=>[...t[2]||(t[2]=[v("on sale",-1)])]),_:1})):h("",!0),r.orderProduct.is_free?(o(),_(u,{key:2,type:"success",size:"xs",showDot:!1},{default:S(()=>[...t[3]||(t[3]=[v("free",-1)])]),_:1})):h("",!0)])])]),s("div",rt,[s("span",st,l(r.orderProduct.grand_total.amount_with_currency),1),n.expanded?(o(),d("svg",ot,[...t[4]||(t[4]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"},null,-1)])])):(o(),d("svg",nt,[...t[5]||(t[5]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"},null,-1)])]))])],2),n.expanded?(o(),d("div",at,[s("div",it,[t[7]||(t[7]=s("h1",{class:"text-sm text-gray-500 font-semibold"},"Pricing",-1)),e.canShowProduct?(o(),_(f,{key:0,size:"xs",type:"light",rightIcon:n.MoveRight,action:e.navigateToProduct},{default:S(()=>[...t[6]||(t[6]=[s("span",null,"Show Product",-1)])]),_:1},8,["rightIcon","action"])):h("",!0)]),s("div",dt,[s("table",lt,[t[8]||(t[8]=s("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[s("tr",null,[s("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[s("span",null,"Regular Price")]),s("th",{class:"whitespace-nowrap align-top text-center py-2"},[s("span",null,"Sale Price")]),s("th",{class:"whitespace-nowrap align-top text-center py-2"},[s("span",null,"Quantity")]),s("th",{class:"whitespace-nowrap align-top text-center py-2"},[s("span",null,"Subtotal")]),s("th",{class:"whitespace-nowrap align-top text-center py-2"},[s("span",null,"Discount Total")]),s("th",{class:"whitespace-nowrap align-top text-right p-2 pr-4"},[s("span",null,"Grand Total")])])],-1)),s("tbody",null,[s("tr",null,[s("td",ct,[s("span",null,l(r.orderProduct.unit_regular_price.amount_with_currency),1)]),s("td",mt,[s("span",null,l(r.orderProduct.unit_sale_price.amount_with_currency),1)]),s("td",ht,[s("span",null,l(r.orderProduct.quantity),1)]),s("td",ut,[s("span",null,l(r.orderProduct.subtotal.amount_with_currency),1)]),s("td",gt,[s("span",null,l(r.orderProduct.sale_discount_total.amount_with_currency),1)]),s("td",pt,[s("span",null,l(r.orderProduct.grand_total.amount_with_currency),1)])])])])]),r.orderProduct.unit_weight>0?(o(),d(y,{key:0},[t[10]||(t[10]=s("h1",{class:"text-sm text-gray-500 font-semibold mb-4 ml-4"},"Weight",-1)),s("div",_t,[s("table",ft,[t[9]||(t[9]=s("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[s("tr",null,[s("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[s("span",null,"Unit Weight")]),s("th",{class:"whitespace-nowrap align-top text-center p-2"},[s("span",null,"Quantity")]),s("th",{class:"whitespace-nowrap align-top text-center p-2"},[s("span",null,"Total Weight")])])],-1)),s("tbody",null,[s("tr",null,[s("td",yt,[s("span",null,l(r.orderProduct.unit_weight),1)]),s("td",wt,[s("span",null,l(r.orderProduct.quantity),1)]),s("td",bt,[s("span",null,l(r.orderProduct.unit_weight),1)])])])])])],64)):h("",!0),r.orderProduct.sku||r.orderProduct.barcode?(o(),d(y,{key:1},[t[12]||(t[12]=s("h1",{class:"text-base text-gray-500 font-semibold mb-4 ml-4"},"Identification",-1)),s("div",xt,[s("table",St,[t[11]||(t[11]=s("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[s("tr",null,[s("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[s("span",null,"SKU")]),s("th",{class:"whitespace-nowrap align-top text-center p-2"},[s("span",null,"Barcode")])])],-1)),s("tbody",null,[s("tr",null,[r.orderProduct.sku?(o(),d("td",vt,[s("span",null,l(r.orderProduct.sku),1)])):h("",!0),r.orderProduct.barcode?(o(),d("td",Ot,[s("span",null,l(r.orderProduct.barcode),1)])):h("",!0)])])])])],64)):h("",!0),e.hasDetectedChanges?(o(),d(y,{key:2},[t[13]||(t[13]=s("h1",{class:"text-base text-gray-500 font-semibold mb-4 ml-4"},"Changes",-1)),s("div",kt,[(o(!0),d(y,null,T(r.orderProduct.detected_changes,(p,w)=>(o(),d("div",{key:w,class:"flex space-x-2 p-2 border-l-8 border-yellow-300 bg-gray-50"},[s("p",Ct,l(p.message),1)]))),128))])],64)):h("",!0)])):h("",!0)],2)}const Pt=P(He,[["render",Tt]]),Lt={inject:["storeState","orderState"],components:{Image:j,Skeleton:F,OrderProduct:Pt},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},orderProducts(){return this.order.order_products}}},It={key:0,class:"space-y-2"},Ft={class:"flex items-center justify-center w-10 h-10 border border-dashed border-gray-200 rounded-lg shrink-0"},Dt={class:"w-full flex justify-between"},Mt={class:"flex items-center space-x-2"};function jt(a,t,r,i,n,e){const g=m("Image"),u=m("Skeleton"),f=m("OrderProduct");return e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",It,[(o(),d(y,null,T([1,2],(p,w)=>s("div",{key:w,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50"},[s("div",Ft,[c(g,{size:"20",class:"text-gray-400"})]),s("div",Dt,[c(u,{width:"w-1/3",shine:!0}),s("div",Mt,[c(u,{width:"w-16",shine:!0}),c(u,{width:"w-4",shine:!0})])])])),64))])):(o(!0),d(y,{key:1},T(e.orderProducts,(p,w)=>(o(),_(f,{key:w,orderProduct:p},null,8,["orderProduct"]))),128))}const Nt=P(Lt,[["render",jt]]),At={inject:["formState","orderState","storeState","notificationState"],components:{Popover:ee,Skeleton:F,OrderTotals:Ze,OrderProducts:Nt,OrderStatusSelect:re},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderId(){return this.$route.params.order_id},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder}},methods:{formattedDatetime:V,formattedRelativeDate:K,async updateOrder(a){var t,r;try{a={...a,store_id:this.store.id},await axios.put(`/api/orders/${this.orderId}`,a),this.notificationState.showSuccessNotification(`Order ${this.orderForm.status}`),this.orderState.order.status=this.orderForm.status}catch(i){const n=((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||(i==null?void 0:i.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(i),console.error("Failed to update order changes:",i)}}}},Et={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},Ut={class:"flex justify-between items-center"},Vt={class:"text-gray-700 font-semibold mb-4"},zt={class:"flex space-x-4"},Bt={key:0,class:"flex items-center justify-end space-x-1"},Rt={class:"text-gray-500 text-xs"};function Wt(a,t,r,i,n,e){const g=m("Popover"),u=m("Skeleton"),f=m("OrderStatusSelect"),p=m("OrderProducts"),w=m("OrderTotals");return o(),d("div",Et,[s("div",Ut,[s("h1",Vt,[t[1]||(t[1]=v("Items ",-1)),!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d(y,{key:0},[v("("+l(e.order.total_uncancelled_product_quantities)+")",1)],64)):h("",!0)]),s("div",zt,[!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d("div",Bt,[s("span",Rt,l(e.formattedDatetime(e.order.created_at)),1),c(g,{content:`Created ${e.formattedRelativeDate(e.order.created_at)}`},null,8,["content"])])):h("",!0),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),_(u,{key:1,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),_(f,{key:2,class:"w-48",showLabel:!1,onChange:t[0]||(t[0]=C=>e.updateOrder({status:C}))}))])]),c(p),c(w)])}const Gt=P(At,[["render",Wt]]),qt={components:{UserRound:ie,Pill:B,Loader:ae,Button:D},props:{index:{type:Number},orderComment:{type:Object},onViewPhoto:{type:Function},deleteOrderComment:{type:Function},isDeletingOrderCommentIds:{type:Array}},data(){return{Trash2:E,expanded:!1}},computed:{user(){return this.orderComment.user},hasPhotos(){return this.photos.length>0},photos(){return this.orderComment.photos},isDeletingOrderComment(){return this.isDeletingOrderCommentIds.findIndex(a=>a==this.orderComment.id)!=-1}},methods:{formattedDatetime:V}},Qt={class:"bg-gray-100 p-2 rounded-lg leading-0"},Zt={key:0,class:"font-bold text-sm"},Ht={class:"text-sm"},Kt={key:1,class:"flex flex-wrap space-x-2 space-y-2 my-2"},Jt=["src","onClick"],Xt={class:"flex justify-between"},Yt={class:"text-gray-400 text-xs"};function $t(a,t,r,i,n,e){const g=m("Loader"),u=m("Button");return o(),d("div",Qt,[e.user?(o(),d("p",Zt,l(e.user.name),1)):h("",!0),s("p",Ht,l(r.orderComment.comment),1),e.hasPhotos?(o(),d("div",Kt,[(o(!0),d(y,null,T(e.photos,f=>(o(),d("img",{key:f.id,src:f.path,onClick:()=>r.onViewPhoto(f),class:"max-h-20 object-contain rounded-lg shrink-0 hover:scale-105 transition-all cursor-pointer"},null,8,Jt))),128))])):h("",!0),s("div",Xt,[s("p",Yt,l(e.formattedDatetime(r.orderComment.created_at)),1),e.user?(o(),d(y,{key:0},[e.isDeletingOrderComment?(o(),_(g,{key:0,type:"danger"})):(o(),_(u,{key:1,size:"xs",leftIconSize:"14",leftIcon:n.Trash2,type:"bareDanger",action:()=>r.deleteOrderComment(r.orderComment)},null,8,["leftIcon","action"]))],64)):h("",!0)])])}const er=P(qt,[["render",$t]]),tr={inject:["authState","formState","storeState","orderState","notificationState"],components:{Image:j,Modal:G,Input:A,Button:D,Skeleton:F,OrderComment:er},data(){return{Trash2:E,ArrowDownToLine:de,form:{photos:[],comment:""},pagination:null,orderComments:[],isUploading:!1,orderCommentPhoto:null,createdOrderComment:null,isCreatingOrderComment:!1,isLoadingOrderComments:!1,isDeletingOrderCommentIds:[],isDeletingOrderCommentPhotoIds:[],isDownloadingOrderCommentPhotoIds:[],isDownloadingOrderCommentPhoto:!1}},watch:{store(a,t){!t&&a&&this.showOrderComments()},order(a,t){if(console.log("stage 1"),a&&t){console.log("stage 2");const r=a.paid_total!=t.paid_total,i=a.outstanding_total!=t.outstanding_total;(r||i)&&(console.log("stage 3"),this.showOrderComments())}},isUploading(a){a==!1&&this.orderCommentCreationCompleted()}},computed:{order(){return this.orderState.store},store(){return this.storeState.store},orderId(){return this.$route.params.order_id},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasOrderComments(){return this.orderComments.length>0}},methods:{isEmpty:q,reset(){this.form.photos=[],this.form.comment=""},async showOrderComments(){var a,t;try{this.isLoadingOrderComments=!0;let r={params:{order_id:this.orderId,store_id:this.store.id,_relationships:["photos","user"].join(",")}};const i=await axios.get("/api/order-comments",r);this.pagination=i.data,this.orderComments=this.pagination.data}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching order comments";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to fetch order comments:",r)}finally{this.isLoadingOrderComments=!1}},onEnterCreateOrderComment(a){a.preventDefault(),this.createOrderComment()},async createOrderComment(){var a,t;try{if(this.isCreatingOrderComment||this.isUploading||(this.formState.hideFormErrors(),this.isEmpty(this.form.comment)&&this.formState.setFormError("comment","The comment is required"),this.formState.hasErrors))return;this.isCreatingOrderComment=!0;const r={order_id:this.orderId,store_id:this.store.id,comment:this.form.comment},i=await axios.post("/api/order-comments",r);this.createdOrderComment=i.data.order_comment,this.form.photos.length?this.uploadImages():this.orderCommentCreationCompleted()}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while creating order comment";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to create order comment:",r),this.isCreatingOrderComment=!1}},orderCommentCreationCompleted(){this.orderComments.push({user:this.authState.user,...this.createdOrderComment,photos:this.form.photos.map(function(a){return{id:J(),temporary:!0,path:a.path}})}),this.notificationState.showSuccessNotification("Comment created!"),this.isCreatingOrderComment=!1,this.showOrderComments(),this.reset()},async uploadImages(a=null){let t=[];for(let r=0;r<this.form.photos.length;r++){const i=this.form.photos[r];(i.uploaded===null||i.uploaded===!1)&&i.uploading==!1&&(a==null||a==r)&&t.push(this.uploadSingleImage(i,r))}return this.isUploading=!0,Promise.allSettled(t).then(r=>{let i=r.filter(n=>n.status==="rejected").length;i>0&&this.notificationState.showWarningNotification(`⚠️ ${i} image(s) failed to upload. Try again or change the image.`),this.isUploading=!1})},async uploadSingleImage(a,t,r=0,i=null){var n,e,g;try{if(r>2)return console.log(`❌ Image ${t+1} permanently failed after 3 attempts.`),a.uploaded=!1,a.uploading=!1,a.error_message=((e=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:e.message)||(i==null?void 0:i.message)||"Upload failed",Promise.reject("Failed after 3 attempts");let u=new FormData;u.append("file",a.file_ref),u.append("store_id",this.store.id),u.append("mediable_type","order comment"),u.append("mediable_id",this.createdOrderComment.id),u.append("upload_folder_name","order_comment_photo"),a.uploading=!0,a.error_message=null;const f={headers:{"Content-Type":"multipart/form-data"}},p=await axios.post("/api/media-files",u,f);return a.uploaded=!0,a.uploading=!1,console.log(`✅ Image ${t+1} uploaded successfully.`),p}catch(u){return console.error(`⚠️ Image ${t+1} upload attempt ${r+1} failed.`,u),u.code==="ECONNABORTED"||((g=u.response)==null?void 0:g.status)===504?void 0:this.uploadSingleImage(a,t,r+1,u)}},onViewPhoto(a){this.orderCommentPhoto=a,this.$refs.showPhotoModal.showModal()},async downloadOrderCommentPhoto(){try{if(this.isDownloadingOrderCommentPhotoIds.includes(this.orderCommentPhoto.id))return;this.isDownloadingOrderCommentPhotoIds.push(this.orderCommentPhoto.id);let a={responseType:"blob",params:{store_id:this.store.id}};const r=(await axios.get(`/api/media-files/${this.orderCommentPhoto.id}/download`,a)).data,i=URL.createObjectURL(r),n=document.createElement("a");n.href=i,n.download=this.orderCommentPhoto.name,n.click(),URL.revokeObjectURL(i)}catch(a){console.error("Error downloading the store QR code image:",a)}finally{this.isDownloadingOrderCommentPhotoIds.splice(this.isDownloadingOrderCommentPhotoIds.findIndex(a=>a==this.orderCommentPhoto.id),1)}},async deleteOrderCommentPhoto(){var a,t;try{if(this.isDeletingOrderCommentPhotoIds.includes(this.orderCommentPhoto.id))return;this.isDeletingOrderCommentPhotoIds.push(this.orderCommentPhoto.id);const r={data:{store_id:this.store.id}};await axios.delete(`/api/media-files/${this.orderCommentPhoto.id}`,r),this.orderComments=this.orderComments.map(i=>({...i,photos:i.photos.filter(n=>n.id!==this.orderCommentPhoto.id)})),this.notificationState.showSuccessNotification("Photo deleted"),this.$refs.showPhotoModal.hideModal()}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while deleting comment photo";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to delete comment photo:",r)}finally{this.isDeletingOrderCommentPhotoIds.splice(this.isDeletingOrderCommentPhotoIds.findIndex(r=>r==this.orderCommentPhoto.id),1)}},async deleteOrderComment(a){var t,r;try{if(this.isDeletingOrderCommentIds.includes(a.id))return;this.isDeletingOrderCommentIds.push(a.id);const i={data:{store_id:this.store.id}};await axios.delete(`/api/order-comments/${a.id}`,i),this.notificationState.showSuccessNotification("Comment deleted"),this.orderComments=this.orderComments.filter(n=>n.id!=a.id)}catch(i){const n=((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||(i==null?void 0:i.message)||"Something went wrong while deleting order comment";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(i),console.error("Failed to delete order comment:",i)}finally{this.isDeletingOrderCommentIds.splice(this.isDeletingOrderCommentIds.findIndex(i=>i==a.id),1)}}},created(){this.store&&this.showOrderComments()}},rr={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},sr={class:"flex justify-between items-center space-x-4"},or={key:0,class:"w-full flex space-x-2"},nr=["onClick"],ar={key:0,class:"space-y-2"},ir={class:"space-y-2 p-2 px-4 bg-gray-50"},dr={class:"flex justify-between items-center space-x-8"},lr={class:"flex items-center space-x-2 whitespace-nowrap"},cr={class:"flex justify-end items-end space-x-2"},mr={class:"flex items-center justify-center w-10 h-10 rounded-lg border border-dashed border-gray-200"},hr={key:0,class:"max-h-96 overflow-y-auto space-y-2 pr-2"},ur={class:"flex justify-center"},gr=["src"],pr={key:0,class:"flex justify-end space-x-2 mt-4"};function _r(a,t,r,i,n,e){const g=m("Input"),u=m("Image"),f=m("Button"),p=m("Skeleton"),w=m("OrderComment"),C=m("Modal");return o(),d(y,null,[s("div",rr,[t[8]||(t[8]=s("h1",{class:"text-gray-700 font-semibold mb-4"},"Comments",-1)),s("div",sr,[!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d("div",or,[s("div",{onClick:t[6]||(t[6]=M(b=>a.$refs.comment.focusInput(),["stop"])),class:"w-full border border-gray-300 p-2 rounded-lg"},[c(g,{type:"file",maxFiles:5,class:"w-full",wrapperClass:{},modelValue:n.form.photos,"onUpdate:modelValue":t[3]||(t[3]=b=>n.form.photos=b),onRetryUploads:t[4]||(t[4]=b=>e.uploadImages()),onRetryUpload:t[5]||(t[5]=(b,k)=>e.uploadImages(k))},{fileTrigger:S(b=>[s("div",{class:"w-full flex space-x-2",onClick:t[2]||(t[2]=M(k=>a.$refs.comment.focusInput(),["stop"]))},[c(g,{rows:"1",onClick:t[0]||(t[0]=M(()=>{},["stop"])),ref:"comment",class:"w-full",type:"textarea",wrapperClass:{},modelValue:n.form.comment,"onUpdate:modelValue":t[1]||(t[1]=k=>n.form.comment=k),placeholder:"Say something",onOnEnter:e.onEnterCreateOrderComment,errorText:e.formState.getFormError("comment")},null,8,["modelValue","onOnEnter","errorText"]),s("div",{onClick:M(b.handleClick,["stop"]),class:"z-10 w-10 h-10 flex shrink-0 items-center justify-center bg-gray-50 border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer"},[c(u,{size:"20",class:I([{"text-gray-400":!b.filesLeftToUpload}])},null,8,["class"])],8,nr)])]),_:1},8,["modelValue"])]),c(f,{size:"sm",type:"primary",buttonClass:"shrink-0",action:e.createOrderComment,disabled:n.isCreatingOrderComment||n.isUploading},{default:S(()=>[...t[7]||(t[7]=[s("span",null,"Post",-1)])]),_:1},8,["action","disabled"])])):h("",!0)]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",ar,[(o(),d(y,null,T([1,2],(b,k)=>s("div",{key:k,class:"rounded-lg overflow-hidden border border-gray-300"},[s("div",ir,[s("div",dr,[c(p,{width:"w-1/3",shine:!0}),s("div",lr,[c(p,{width:"w-20",shine:!0}),c(p,{width:"w-10",shine:!0}),c(p,{width:"w-10",shine:!0})])]),s("div",cr,[c(p,{width:"w-10",shine:!0}),s("div",mr,[c(u,{size:"16",class:"text-gray-400 shrink-0"})])])])])),64))])):(o(),d(y,{key:1},[e.hasOrderComments?(o(),d("div",hr,[(o(!0),d(y,null,T(n.orderComments,(b,k)=>(o(),_(w,{index:k,key:b.id,onViewPhoto:e.onViewPhoto,orderComment:b,deleteOrderComment:e.deleteOrderComment,isDeletingOrderCommentIds:n.isDeletingOrderCommentIds},null,8,["index","onViewPhoto","orderComment","deleteOrderComment","isDeletingOrderCommentIds"]))),128))])):h("",!0)],64))]),c(C,{showFooter:!1,ref:"showPhotoModal",scrollOnContent:!1},W({_:2},[n.orderCommentPhoto?{name:"content",fn:S(()=>[t[11]||(t[11]=s("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Image Preview",-1)),s("div",ur,[s("img",{src:n.orderCommentPhoto.path},null,8,gr)]),n.orderCommentPhoto.hasOwnProperty("temporary")?h("",!0):(o(),d("div",pr,[c(f,{size:"sm",type:"primary",leftIcon:n.ArrowDownToLine,action:e.downloadOrderCommentPhoto,loading:this.isDownloadingOrderCommentPhotoIds.findIndex(b=>b==this.orderCommentPhoto.id)!=-1},{default:S(()=>[...t[9]||(t[9]=[s("span",null,"Download",-1)])]),_:1},8,["leftIcon","action","loading"]),c(f,{size:"sm",type:"danger",leftIcon:n.Trash2,action:e.deleteOrderCommentPhoto,loading:this.isDeletingOrderCommentPhotoIds.findIndex(b=>b==this.orderCommentPhoto.id)!=-1},{default:S(()=>[...t[10]||(t[10]=[s("span",null,"Delete",-1)])]),_:1},8,["leftIcon","action","loading"])]))]),key:"0"}:void 0]),1536)],64)}const fr=P(tr,[["render",_r]]),yr={inject:["formState","storeState","orderState","notificationState"],components:{UserRoundCheck:_e,Alert:Q,Input:A,Select:z,Button:D,Skeleton:F,GoogleMaps:le,CollectionStatus:ce},data(){return{ArrowRight:he,couriers:[],ExternalLink:Z,courierOptions:[],isLoadingCouriers:!1}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},customer(){return this.order.customer},deliveryMethod(){return this.order.delivery_method},deliveryAddress(){return this.order.delivery_address},selectedCourierLink(){if(!this.orderForm.courier_id||!this.couriers.length)return null;const a=this.couriers.find(n=>n.id===this.orderForm.courier_id);if(!a)return null;const t=this.orderForm.tracking_number,r=a.tracking_page;if(!t)return r;const i=r.includes("?")?"&":"?";return a.name=="DHL Express"?`${r}${i}tracking-id=${encodeURIComponent(t)}`:r},googleMapsUrl(){return!this.isLoadingOrder&&this.deliveryAddress.latitude&&this.deliveryAddress.longitude?`https://www.google.com/maps?q=${this.deliveryAddress.latitude},${this.deliveryAddress.longitude}`:null}},methods:{formattedDate:Y,formattedShortWeekday:X,openGoogleMapsLink(){window.open(this.googleMapsUrl,"_blank")},navigateToCustomer(){this.$router.push({name:"edit-customer",params:{customer_id:this.customer.id},query:{store_id:this.store.id}})},async showCouriers(){var a,t;try{if(this.couriers.length)return;this.isLoadingCouriers=!0;let r={params:{per_page:100}};const i=await N.get("/api/couriers",r);this.couriers=i.data.data,this.courierOptions=this.couriers.map(n=>({label:oe(n.name),value:n.id})),this.courierOptions.unshift({label:"None",value:null})}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching stores";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to fetch stores:",r)}finally{this.isLoadingCouriers=!1}},async updateOrder(a,t){var r,i;try{if(a={...a,store_id:this.store.id},await N.put(`/api/orders/${this.order.id}`,a),t=="courier"){if(this.orderForm.courier_id){const n=this.courierOptions.find(e=>e.value===this.orderForm.courier_id);this.notificationState.showSuccessNotification(`Courier updated to ${n.label}`)}else this.notificationState.showSuccessNotification("Courier removed");this.orderState.order.courier_id=this.orderForm.courier_id}else t=="tracking number"?(this.orderForm.tracking_number?this.notificationState.showSuccessNotification(`Tracking number updated to ${this.orderForm.tracking_number}`):this.notificationState.showSuccessNotification("Tracking number removed"),this.orderState.order.tracking_number=this.orderForm.tracking_number):t=="remark"&&(this.orderForm.remark?this.notificationState.showSuccessNotification("Remark updated"):this.notificationState.showSuccessNotification("Remark removed"),this.orderState.order.remark=this.orderForm.remark)}catch(n){const e=((i=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:i.message)||(n==null?void 0:n.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(n),console.error("Failed to update order changes:",n)}}},created(){this.showCouriers()}},wr={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},br={class:"flex justify-between items-center mb-4"},xr={key:0,class:"space-y-2"},Sr={class:"space-y-2 p-2 px-4 bg-gray-50"},vr={class:"flex justify-between items-center space-x-8"},Or={class:"flex items-center space-x-2 whitespace-nowrap"},kr={class:"grid grid-cols-2 gap-4"},Cr={class:"col-span-1"},Tr={class:"col-span-1"},Pr={key:0,class:"col-span-2 text-sm"},Lr=["href"],Ir={class:"col-span-2"},Fr={key:0,class:"bg-gray-50 p-4 border border-gray-200 rounded-lg space-y-2 text-sm"},Dr={key:0,class:"grid grid-cols-3 items-center"},Mr={class:"col-span-2 flex items-center space-x-2"},jr={key:1,class:"grid grid-cols-3"},Nr={class:"col-span-2"},Ar=["href"],Er={key:2,class:"grid grid-cols-3"},Ur={class:"col-span-2"},Vr=["href"],zr={key:3,class:"grid grid-cols-3"},Br={class:"col-span-2"},Rr={key:4,class:"grid grid-cols-3"},Wr={class:"col-span-2"},Gr=["href"],qr={key:5,class:"grid grid-cols-3"},Qr={class:"space-x-2"},Zr={class:"list-disc text-xs space-y-2 border-t border-blue-300 border-dashed pt-2 mt-2 pl-2"},Hr={key:0},Kr={class:"font-bold"},Jr={class:"font-bold"},Xr={key:1},Yr={class:"font-bold"},$r={class:"font-bold"},es={key:2},ts={class:"font-bold"},rs={class:"font-bold"},ss={class:"rounded-lg overflow-hidden"},os={key:0,class:"flex justify-end mt-4"};function ns(a,t,r,i,n,e){const g=m("Skeleton"),u=m("CollectionStatus"),f=m("Select"),p=m("Input"),w=m("UserRoundCheck"),C=m("Button"),b=m("Alert"),k=m("GoogleMaps");return o(),d("div",wr,[s("div",br,[t[7]||(t[7]=s("h1",{class:"text-gray-700 font-semibold"},"Fulfillment",-1)),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),_(g,{key:0,width:"w-20",shine:!0})):(o(),_(u,{key:1}))]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",xr,[(o(),d(y,null,T([1,2],(O,U)=>s("div",{key:U,class:"rounded-lg overflow-hidden border border-gray-300"},[s("div",Sr,[s("div",vr,[c(g,{width:"w-1/3",shine:!0}),s("div",Or,[c(g,{width:"w-20",shine:!0}),c(g,{width:"w-10",shine:!0}),c(g,{width:"w-10",shine:!0})])])])])),64))])):(o(),d(y,{key:1},[s("div",kr,[s("div",Cr,[c(f,{search:!0,label:"Courier",options:n.courierOptions,modelValue:e.orderForm.courier_id,"onUpdate:modelValue":t[0]||(t[0]=O=>e.orderForm.courier_id=O),errorText:e.formState.getFormError("courier_id"),onChange:t[1]||(t[1]=O=>e.updateOrder({courier_id:O},"courier"))},null,8,["options","modelValue","errorText"])]),s("div",Tr,[c(p,{type:"text",label:"Tracking Number",modelValue:e.orderForm.tracking_number,"onUpdate:modelValue":t[2]||(t[2]=O=>e.orderForm.tracking_number=O),errorText:e.formState.getFormError("tracking_number"),onBlur:t[3]||(t[3]=O=>e.updateOrder({tracking_number:O},"tracking number"))},null,8,["modelValue","errorText"])]),e.selectedCourierLink?(o(),d("div",Pr,[t[8]||(t[8]=s("span",null,"Tracking Page: ",-1)),s("a",{href:e.selectedCourierLink,target:"_blank",class:"text-blue-500 hover:underline"},l(e.selectedCourierLink),9,Lr)])):h("",!0),s("div",Ir,[c(p,{rows:"2",label:"Remark",type:"textarea",placeholder:"Optional",modelValue:e.orderForm.remark,"onUpdate:modelValue":t[4]||(t[4]=O=>e.orderForm.remark=O),description:"Visible to customer",errorText:e.formState.getFormError("remark"),onBlur:t[5]||(t[5]=O=>e.updateOrder({remark:O},"remark")),tooltipContent:"Use the Remark field to add a note that will be visible to the customer, such as special instructions, order details, or personalized messages."},null,8,["modelValue","errorText"])])]),e.order.customer_name||e.order.customer_email||e.order.customer_mobile_number||e.deliveryMethod||e.deliveryAddress||e.order.delivery_date?(o(),d("div",Fr,[e.order.customer_name?(o(),d("div",Dr,[t[10]||(t[10]=s("span",null,"Name",-1)),s("div",Mr,[e.customer?(o(),_(w,{key:0,size:"16"})):h("",!0),s("span",{class:I({"text-blue-500 hover:underline cursor-pointer":e.customer}),onClick:t[6]||(t[6]=()=>e.customer?e.navigateToCustomer():null)},l(e.order.customer_name),3),c(C,{size:"xs",type:"light",class:"hidden lg:block",rightIcon:n.ArrowRight,action:e.navigateToCustomer},{default:S(()=>[...t[9]||(t[9]=[s("span",null,"Show Profile",-1)])]),_:1},8,["rightIcon","action"])])])):h("",!0),e.order.customer_email?(o(),d("div",jr,[t[11]||(t[11]=s("span",null,"Email",-1)),s("span",Nr,[s("a",{href:`mailto:${e.order.customer_email}`,target:"_blank",class:"text-blue-500 hover:underline"},l(e.order.customer_email),9,Ar)])])):h("",!0),e.order.customer_mobile_number?(o(),d("div",Er,[t[12]||(t[12]=s("span",null,"Mobile",-1)),s("span",Ur,[s("a",{href:`tel:${e.order.customer_mobile_number.international}`,target:"_blank",class:"text-blue-500 hover:underline"},l(e.order.customer_mobile_number.international),9,Vr)])])):h("",!0),e.deliveryMethod?(o(),d("div",zr,[t[13]||(t[13]=s("span",null,"Delivery",-1)),s("span",Br,l(e.deliveryMethod.name),1)])):h("",!0),e.deliveryAddress?(o(),d("div",Rr,[t[14]||(t[14]=s("span",null,"Address",-1)),s("span",Wr,[s("a",{href:e.googleMapsUrl,target:"_blank",class:"text-blue-500 hover:underline"},l(e.deliveryAddress.complete_address),9,Gr)])])):h("",!0),e.order.delivery_date?(o(),d("div",qr,[t[15]||(t[15]=s("span",null,"Schedule",-1)),s("div",Qr,[s("span",null,l(e.formattedDate(e.order.delivery_date))+" ("+l(e.formattedShortWeekday(e.order.delivery_date))+")",1),s("span",null,l(e.order.delivery_timeslot),1)])])):h("",!0),e.customer&&(e.customer.name&&e.order.customer_name&&e.customer.name!=e.order.customer_name||e.customer.email&&e.order.customer_email&&e.customer.email!=e.order.customer_email||e.customer.mobile_number&&e.order.customer_mobile_number&&e.customer.mobile_number.international!=e.order.customer_mobile_number.international)?(o(),_(b,{key:6,type:"primary",dismissable:!0,title:"Profile changes"},{description:S(()=>[s("ul",Zr,[e.customer.name&&e.order.customer_name&&e.customer.name!=e.order.customer_name?(o(),d("li",Hr,[t[16]||(t[16]=v("Order name (",-1)),s("span",Kr,l(e.order.customer_name),1),t[17]||(t[17]=v(") is different from customer profile name (",-1)),s("span",Jr,l(e.customer.name),1),t[18]||(t[18]=v(").",-1))])):h("",!0),e.customer.email&&e.order.customer_email&&e.customer.email!=e.order.customer_email?(o(),d("li",Xr,[t[19]||(t[19]=v("Order email (",-1)),s("span",Yr,l(e.order.customer_email),1),t[20]||(t[20]=v(") is different from customer profile email (",-1)),s("span",$r,l(e.customer.email),1),t[21]||(t[21]=v(").",-1))])):h("",!0),e.customer.mobile_number&&e.order.customer_mobile_number&&e.customer.mobile_number.international!=e.order.customer_mobile_number.international?(o(),d("li",es,[t[22]||(t[22]=v("Order mobile number (",-1)),s("span",ts,l(e.order.customer_mobile_number.international),1),t[23]||(t[23]=v(") is different from customer profile mobile number (",-1)),s("span",rs,l(e.customer.mobile_number.international),1),t[24]||(t[24]=v(").",-1))])):h("",!0)])]),_:1})):h("",!0)])):h("",!0),e.deliveryAddress?(o(),d(y,{key:1},[s("div",ss,[c(k,{height:"350px",gmpDraggable:!1,latitude:e.deliveryAddress.latitude,longitude:e.deliveryAddress.longitude},null,8,["latitude","longitude"])]),e.googleMapsUrl?(o(),d("div",os,[c(C,{size:"xs",type:"light",buttonClass:"h-full",rightIcon:n.ExternalLink,action:e.openGoogleMapsLink},{default:S(()=>[...t[25]||(t[25]=[s("span",null,"Google Maps",-1)])]),_:1},8,["rightIcon","action"])])):h("",!0)],64)):h("",!0)],64))])}const as=P(yr,[["render",ns]]),is={components:{Image:j,Pill:B,Button:D,Banknote:H},props:{index:{type:Number},transaction:{type:Object},approveTransaction:{type:Function},onDeleteTransaction:{type:Function},isApprovingTransactionId:{type:[null,String]},isDeletingTransactionId:{type:[null,String]}},data(){return{Trash2:E,expanded:!1,isDeletingTransaction:!1}},computed:{hasPhoto(){return this.photo!=null},photo(){return this.transaction.photo},paymentMethod(){return this.transaction.payment_method},storePaymentMethod(){return this.transaction.store_payment_method},isWaitingConfirmation(){return this.transaction.payment_status=="waiting confirmation"}},methods:{formattedDatetime:V}},ds={class:"rounded-lg overflow-hidden border border-gray-300"},ls={class:"space-y-2 p-2 px-4 bg-gray-50 hover:bg-gray-100"},cs={class:"flex justify-between items-center space-x-8"},ms={class:"flex items-center space-x-2"},hs=["src"],us={key:0,class:"font-semibold text-sm"},gs={key:1,class:"text-sm"},ps={class:"flex items-center space-x-2 whitespace-nowrap"},_s={class:"text-gray-500 text-xs mr-4"},fs={class:"text-sm"},ys=["src"],ws={key:0,class:"flex justify-end space-x-1"};function bs(a,t,r,i,n,e){var w,C,b;const g=m("Banknote"),u=m("Pill"),f=m("Image"),p=m("Button");return o(),d("div",ds,[s("div",ls,[s("div",cs,[s("div",ms,[e.storePaymentMethod||e.paymentMethod?(o(),d("img",{key:0,alt:"Payment Method Logo",class:"w-8 h-8 rounded-full",src:((C=(w=e.storePaymentMethod)==null?void 0:w.logo)==null?void 0:C.path)??e.paymentMethod.image_url},null,8,hs)):(o(),_(g,{key:1,size:"20",class:"text-gray-400 shrink-0"})),s("div",null,[e.storePaymentMethod||e.paymentMethod?(o(),d("p",us,l(((b=e.storePaymentMethod)==null?void 0:b.custom_name)??e.paymentMethod.name),1)):h("",!0),r.transaction.description?(o(),d("p",gs,l(r.transaction.description),1)):h("",!0)])]),s("div",ps,[s("span",_s,l(e.formattedDatetime(r.transaction.created_at)),1),c(u,{type:r.transaction.payment_status=="paid"?"success":"warning",size:"xs",showDot:!1},{default:S(()=>[v(l(r.transaction.payment_status),1)]),_:1},8,["type"]),s("span",fs,l(r.transaction.amount.amount_with_currency),1),s("div",{class:I(["flex items-center justify-center w-10 h-10 hover:bg-white rounded-lg cursor-pointer",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),d("img",{key:0,class:"w-full max-h-10 object-contain rounded-lg shrink-0",src:e.photo.path},null,8,ys)):(o(),_(f,{key:1,size:"16",class:"text-gray-400 shrink-0"}))],2),e.isWaitingConfirmation?h("",!0):(o(),_(p,{key:0,size:"xs",leftIconSize:"14",leftIcon:n.Trash2,type:"bareDanger",action:()=>r.onDeleteTransaction(r.transaction)},null,8,["leftIcon","action"]))])]),e.isWaitingConfirmation?(o(),d("div",ws,[c(p,{size:"sm",type:"danger",leftIconSize:"14",action:()=>r.onDeleteTransaction(r.transaction,!0),isLoading:r.isDeletingTransactionId==r.transaction.id},{default:S(()=>[...t[0]||(t[0]=[s("span",null,"Reject",-1)])]),_:1},8,["action","isLoading"]),c(p,{size:"sm",type:"success",leftIconSize:"14",action:()=>r.approveTransaction(r.transaction),isLoading:r.isApprovingTransactionId==r.transaction.id},{default:S(()=>[...t[1]||(t[1]=[s("span",null,"Approve",-1)])]),_:1},8,["action","isLoading"])])):h("",!0)])])}const xs=P(is,[["render",bs]]),Ss={inject:["formState","storeState","orderState","notificationState"],components:{Image:j,Banknote:H,Alert:Q,Input:A,Modal:G,Select:z,Button:D,Skeleton:F,OrderTransaction:xs,OrderPaymentStatusSelect:se},data(){return{Plus:pe,Link2:ge,Trash2:E,ExternalLink:Z,CircleDollarSign:ue,form:{photo:[],amount:"0.00",description:"",payment_method_id:null},pagination:null,transactions:[],isRejecting:!1,deletableTransaction:null,isLoadingTransactions:!1,isCreatingTransaction:!1,isApprovingTransactionId:null,isDeletingTransactionId:null,searchTerm:null,paymentMethods:[],lastSearchTerm:null,isLoadingPaymentMethods:!1,hasLoadedInitialPaymentMethods:!1}},watch:{store(){this.setup()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderId(){return this.$route.params.order_id},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasTransactions(){return this.transactions.length>0},paymentMethodOptions(){return this.paymentMethods.map(a=>({value:a.id,label:a.name,image_url:a.image_url}))}},methods:{isEmpty:q,isNotEmpty:ne,setup(){this.store&&this.showTransactions()},onShowAddPaymentModal(){this.form.photo=[],this.form.description="",this.form.amount=this.order.outstanding_total.amount_without_currency,this.searchTerm=null,this.lastSearchTerm=null,!this.hasLoadedInitialPaymentMethods&&this.paymentMethods.length==0&&this.showPaymentMethods()},navigateToShopPaymentMethods(){const a=this.$router.resolve({name:"show-shop-payment-methods",params:{order_id:this.order.id,alias:this.store.alias}});window.open(a.href,"_blank","noopener,noreferrer")},async copyPaymentLink(){try{await navigator.clipboard.writeText(window.location.origin+this.$router.resolve({name:"show-shop-payment-methods",params:{order_id:this.order.id,alias:this.store.alias}}).href),this.notificationState.showSuccessNotification("Payment link copied!")}catch(a){console.error("Failed to copy:",a),this.notificationState.showWarningNotification("Payment link failed to copy")}},async showPaymentMethods(){var a,t;try{this.isLoadingPaymentMethods=!0;let r={params:{per_page:100,store_id:this.store.id,association:"team member"}};this.hasSearchTerm&&(r.params.search=this.searchTerm),this.lastSearchTerm=this.searchTerm;const i=await axios.get("/api/payment-methods",r);if(this.searchTerm===this.lastSearchTerm){const n=i.data;this.paymentMethods=n.data,this.hasLoadedInitialPaymentMethods=!0,this.paymentMethods.length&&(this.form.payment_method_id=this.paymentMethods[0].id)}}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching payment methods";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to fetch payment methods:",r)}finally{this.isLoadingPaymentMethods=!1}},async showTransactions(){var a,t;try{this.isLoadingTransactions=!0;let r={params:{order_id:this.orderId,store_id:this.store.id,_relationships:["photo","paymentMethod","storePaymentMethod.logo"].join(",")}};const i=await axios.get("/api/transactions",r);this.pagination=i.data,this.transactions=this.pagination.data}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching transactions";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to fetch transactions:",r)}finally{this.isLoadingTransactions=!1}},async createTransaction(){var a,t;try{if(this.isCreatingTransaction||(this.formState.hideFormErrors(),this.formState.hasErrors))return;this.isCreatingTransaction=!0;let r=new FormData;r.append("return",1),r.append("owner_type","order"),r.append("owner_id",this.orderId),r.append("store_id",this.store.id),r.append("amount",this.form.amount),r.append("currency",this.store.currency),r.append("payment_method_id",this.form.payment_method_id),this.isNotEmpty(this.form.description)&&r.append("description",this.form.description),this.form.photo.length&&r.append("photo",this.form.photo[0].file_ref);const i={headers:{"Content-Type":"multipart/form-data"}};await axios.post("/api/transactions",r,i),this.$refs.addPaymentModal.hideModal(),this.showTransactions(),await this.showOrder(),this.notificationState.showSuccessNotification("Payment created!")}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while creating payment";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to create payment:",r)}finally{this.isCreatingTransaction=!1}},onDeleteTransaction(a,t=!1){this.isRejecting=t,this.deletableTransaction=a,this.$refs.deletePaymentModal.showModal()},async approveTransaction(a){var t,r;try{this.isApprovingTransactionId=a.id;const i={payment_status:"paid",store_id:this.store.id};await axios.put(`/api/transactions/${a.id}`,i),this.showTransactions(),await this.showOrder(),this.notificationState.showSuccessNotification("Payment approved")}catch(i){const n=((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||(i==null?void 0:i.message)||"Something went wrong while approving payment";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(i),console.error("Failed to approve payment:",i)}finally{this.isApprovingTransactionId=null}},async deleteTransaction(){var a,t;try{this.isDeletingTransactionId=this.deletableTransaction.id;const r=this.transactions.findIndex(n=>n.id==this.deletableTransaction.id),i={data:{store_id:this.store.id}};await axios.delete(`/api/transactions/${this.deletableTransaction.id}`,i),await this.showOrder(),this.notificationState.showSuccessNotification("Payment deleted"),this.$refs.deletePaymentModal.hideModal(),this.transactions.splice(r,1)}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while deleting transaction";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to delete transaction:",r)}finally{this.isDeletingTransactionId=null}},async showOrder(){var a,t;try{let r={params:{store_id:this.store.id}};const n=(await axios.get(`/api/orders/${this.order.id}`,r)).data;this.orderState.order.paid_total=n.paid_total,this.orderState.order.payment_status=n.payment_status,this.orderState.orderForm.payment_status=n.payment_status,this.orderState.order.outstanding_total=n.outstanding_total}catch(r){const i=((t=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while fetching order";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(r),console.error("Failed to fetch order:",r)}},async updateOrder(a){var t,r;try{a={...a,store_id:this.store.id},await axios.put(`/api/orders/${this.orderId}`,a),this.notificationState.showSuccessNotification(`Order ${this.orderForm.payment_status}`),this.orderState.order.payment_status=this.orderForm.payment_status}catch(i){const n=((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||(i==null?void 0:i.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(i),console.error("Failed to update order changes:",i)}}},created(){this.setup()}},vs={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},Os={class:"flex justify-between items-center mb-4"},ks={key:1,class:"text-base text-gray-700 font-semibold mr-2"},Cs={class:"flex justify-between items-center space-x-4"},Ts={class:"space-y-4 mb-8"},Ps={class:"flex items-center space-x-2"},Ls=["src"],Is={class:"text-gray-700 text-sm truncate"},Fs={class:"flex items-center space-x-2"},Ds=["src"],Ms={class:"truncate"},js={class:"space-y-3"},Ns={class:"space-y-2 p-2 px-4 bg-gray-50"},As={class:"flex justify-between items-center space-x-8"},Es={class:"flex items-center space-x-2 whitespace-nowrap"},Us={class:"flex justify-end items-end space-x-2"},Vs={class:"flex items-center justify-center w-10 h-10 rounded-lg border border-dashed border-gray-200"},zs={class:"bg-blue-50 border border-blue-400 rounded-lg p-4 space-y-4"},Bs={class:"flex justify-between text-sm"},Rs={class:"flex justify-between text-sm font-bold"},Ws={class:"mb-8"},Gs={class:"flex items-center space-x-4 p-4 text-sm bg-gray-100 rounded-lg"},qs=["src"],Qs={class:"w-full"},Zs={class:"space-x-2"},Hs={class:"font-bold"},Ks={class:"space-x-2"},Js={class:"font-bold"};function Xs(a,t,r,i,n,e){const g=m("Button"),u=m("Input"),f=m("Select"),p=m("Modal"),w=m("Skeleton"),C=m("OrderPaymentStatusSelect"),b=m("Image"),k=m("OrderTransaction"),O=m("Alert"),U=m("Banknote");return o(),d("div",vs,[s("div",Os,[!e.isLoadingStore&&!e.isLoadingOrder&&e.order.outstanding_total.amount>0?(o(),_(g,{key:0,size:"xs",type:"bare",rightIcon:n.ExternalLink,action:e.navigateToShopPaymentMethods},{default:S(()=>[...t[5]||(t[5]=[s("span",{class:"text-base text-gray-700 font-semibold mr-2"},"Payments",-1)])]),_:1},8,["rightIcon","action"])):(o(),d("span",ks,"Payments")),s("div",Cs,[!e.isLoadingStore&&!e.isLoadingOrder&&e.order.outstanding_total.amount>0?(o(),d(y,{key:0},[c(g,{size:"xs",type:"bare",leftIcon:n.Link2,action:e.copyPaymentLink},{default:S(()=>[...t[6]||(t[6]=[s("span",null,"Copy Payment Link",-1)])]),_:1},8,["leftIcon","action"]),c(p,{triggerSize:"xs",triggerType:"light",approveType:"primary",ref:"addPaymentModal",leftApproveIcon:n.Plus,leftTriggerIcon:n.Plus,scrollOnContent:!1,leftTriggerIconSize:"14",triggerText:"Add Payment",approveText:"Add Payment",onShow:e.onShowAddPaymentModal,approveAction:e.createTransaction,approveLoading:n.isCreatingTransaction},{content:S(()=>[t[7]||(t[7]=s("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Add Payment",-1)),s("div",Ts,[c(u,{type:"money",label:"Amount",modelValue:n.form.amount,"onUpdate:modelValue":t[0]||(t[0]=x=>n.form.amount=x),currency:e.store.currency.code,errorText:e.formState.getFormError("amount")},null,8,["modelValue","currency","errorText"]),c(f,{search:!0,label:"Method",options:e.paymentMethodOptions,modelValue:n.form.payment_method_id,"onUpdate:modelValue":t[1]||(t[1]=x=>n.form.payment_method_id=x),errorText:e.formState.getFormError("payment_method_id")},{selectedOption:S(x=>{var L;return[s("div",Ps,[x.selectedOption?(o(),d("img",{key:0,alt:"Payment Method Logo",class:"w-6 h-6 rounded-full",src:x.selectedOption.image_url},null,8,Ls)):h("",!0),s("span",Is,l(((L=x.selectedOption)==null?void 0:L.label)??"Select payment method"),1)])]}),option:S(x=>[s("div",Fs,[s("img",{alt:"Payment Method Logo",class:"w-6 h-6 rounded-full",src:x.option.image_url},null,8,Ds),s("span",Ms,l(x.option.label),1)])]),_:1},8,["options","modelValue","errorText"]),c(u,{type:"text",label:"Description",secondaryLabel:"(Optional)",modelValue:n.form.description,"onUpdate:modelValue":t[2]||(t[2]=x=>n.form.description=x),placeholder:"Deposit payment",errorText:e.formState.getFormError("description")},null,8,["modelValue","errorText"]),c(u,{type:"file",maxFiles:1,modelValue:n.form.photo,"onUpdate:modelValue":t[3]||(t[3]=x=>n.form.photo=x),label:"Proof Of Payment",imagePreviewGridCols:1,secondaryLabel:"(Optional)",singleFileUploadMessage:"proof of payment attached"},null,8,["modelValue"])])]),_:1},8,["leftApproveIcon","leftTriggerIcon","onShow","approveAction","approveLoading"])],64)):h("",!0),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),_(w,{key:1,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),_(C,{key:2,class:"w-52",showLabel:!1,onChange:t[4]||(t[4]=x=>e.updateOrder({payment_status:x}))}))])]),s("div",js,[e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d(y,{key:0},T([1,2],(x,L)=>s("div",{key:L,class:"rounded-lg overflow-hidden border border-gray-300"},[s("div",Ns,[s("div",As,[c(w,{width:"w-1/3",shine:!0}),s("div",Es,[c(w,{width:"w-20",shine:!0}),c(w,{width:"w-10",shine:!0}),c(w,{width:"w-10",shine:!0})])]),s("div",Us,[c(g,{size:"xs",skeleton:!0,leftIconSize:"14",leftIcon:n.Trash2,type:"outlineDanger"},null,8,["leftIcon"]),s("div",Vs,[c(b,{size:"16",class:"text-gray-400 shrink-0"})])])])])),64)):(o(),d(y,{key:1},[e.hasTransactions?(o(),d(y,{key:0},[(o(!0),d(y,null,T(n.transactions,(x,L)=>(o(),_(k,{key:L,index:L,transaction:x,approveTransaction:e.approveTransaction,onDeleteTransaction:e.onDeleteTransaction,isApprovingTransactionId:n.isApprovingTransactionId,isDeletingTransactionId:n.isDeletingTransactionId},null,8,["index","transaction","approveTransaction","onDeleteTransaction","isApprovingTransactionId","isDeletingTransactionId"]))),128)),s("div",zs,[s("div",Bs,[s("span",{class:I({"font-bold text-red-500":e.order.outstanding_total.amount>0})},"Amount Due",2),s("span",{class:I({"font-bold text-red-500":e.order.outstanding_total.amount>0})},l(e.order.outstanding_total.amount_with_currency),3)]),s("div",Rs,[t[8]||(t[8]=s("span",null,"Amount Paid",-1)),s("span",null,l(e.order.paid_total.amount_with_currency),1)])])],64)):(o(),_(O,{key:1,type:"light",dismissable:!1,icon:n.CircleDollarSign,title:"No transctions yet"},null,8,["icon"])),c(p,{approveType:"danger",ref:"deletePaymentModal",scrollOnContent:!1,approveAction:e.deleteTransaction,leftApproveIcon:n.isRejecting?null:n.Trash2,approveText:n.isRejecting?"Reject":"Delete",approveLoading:n.deletableTransaction&&n.isDeletingTransactionId==n.deletableTransaction.id},W({_:2},[n.deletableTransaction?{name:"content",fn:S(()=>{var x,L,R;return[t[11]||(t[11]=s("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Confirm Delete",-1)),s("p",Ws,"Are you sure you want to permanently "+l(n.isRejecting?"reject":"delete")+" this payment?",1),s("div",Gs,[n.deletableTransaction.store_payment_method||n.deletableTransaction.payment_method?(o(),d("img",{key:0,alt:"Payment Method Logo",class:"w-8 h-8 rounded-full",src:((L=(x=n.deletableTransaction.store_payment_method)==null?void 0:x.logo)==null?void 0:L.path)??n.deletableTransaction.payment_method.image_url},null,8,qs)):(o(),_(U,{key:1,size:"20",class:"text-gray-400 shrink-0"})),s("div",Qs,[s("div",Zs,[t[9]||(t[9]=s("span",null,"Name:",-1)),s("span",Hs,l(((R=n.deletableTransaction.store_payment_method)==null?void 0:R.custom_name)??n.deletableTransaction.payment_method.name),1)]),s("div",Ks,[t[10]||(t[10]=s("span",null,"Amount:",-1)),s("span",Js,l(n.deletableTransaction.amount.amount_with_currency),1)])])])]}),key:"0"}:void 0]),1032,["approveAction","leftApproveIcon","approveText","approveLoading"])],64))])])}const Ys=P(Ss,[["render",Xs]]),$s={inject:["orderState","storeState"],components:{TeamMember:xe,OrderItems:Gt,OrderComments:fr,OrderFulfilment:as,OrderTransactions:Ys},computed:{store(){return this.storeState.store},order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder}}},eo={class:"grid grid-cols-12 gap-8 mb-4"},to={class:"col-span-8"},ro={class:"col-span-4"};function so(a,t,r,i,n,e){const g=m("OrderItems"),u=m("OrderTransactions"),f=m("OrderFulfilment"),p=m("TeamMember"),w=m("OrderComments");return o(),d("div",eo,[s("div",to,[c(g),c(u),c(f)]),s("div",ro,[c(p),c(w)])])}const Ro=P($s,[["render",so]]);export{Ro as default};
