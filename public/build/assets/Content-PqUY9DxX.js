import{h as M,c as d,d as p,a as c,r as m,o,e as f,b as r,t as l,F as w,f as k,n as I,w as D,g as x,i as v,l as G,y as A,C as Q,D as z,A as H,z as Z}from"./app-DzEmJHii.js";import{I as N,r as K}from"./Input-CE4RPfme.js";import{S as B}from"./Select-DevKOWun.js";import{S as T}from"./Skeleton-caFmp0IF.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as J}from"./Popover-DanCA_pE.js";import{P as V}from"./Pill-DvJ1xfHb.js";import{B as F}from"./Button-gD2nuYEJ.js";import{I as j}from"./image-CW-Fplfx.js";import{M as X}from"./move-right-dsRLGEJ0.js";import{a as Y,c as $,O as ee}from"./OrderPaymentStatusSelect-DigW6itU.js";import{M as R}from"./Modal-onlEinK3.js";import{L as te}from"./Loader-BbY_PjoY.js";import{U as re}from"./user-round-DBk4yToF.js";import{T as E}from"./trash-2-O_xX6E8Z.js";import{A as se}from"./arrow-down-to-line-DjELqrMO.js";import{A as W}from"./Alert-DLv8D8f2.js";import{G as oe}from"./GoogleMaps-BS8PNI7v.js";import{C as ne}from"./CollectionStatus-C8HuLziM.js";import{c as U}from"./createLucideIcon-B1C9m8SV.js";import{E as q}from"./external-link-Dd0p5gum.js";import{A as ie}from"./arrow-right-B_QTjZgb.js";import{B as ae}from"./banknote-hAbsxx7X.js";import{P as de}from"./plus-9ZeBx_gh.js";import"./Copy-BxvDy_-Q.js";import"./ShineEffect-7ISWLx82.js";import"./info-P1D1b4JP.js";/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=U("circle-dollar-sign",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]);/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=U("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=U("user-round-check",[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]),ue={inject:["formState","orderState","storeState","notificationState"],components:{Input:N,Select:B,Skeleton:T},data(){return{teamMembers:[],isLoadingTeamMembers:!1}},watch:{isLoadingOrder(i){!i&&this.hasOrder&&this.showTeamMembers()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},orderForm(){return this.orderState.orderForm},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},teamMemberOptions(){let i=[{label:"Unassigned",value:null}];return this.teamMembers.forEach(t=>{i.push({label:t.name,value:t.id})}),i}},methods:{async showTeamMembers(){var i,t;try{this.isLoadingTeamMembers=!0;let s={params:{store_id:this.store.id}};const a=await M.get("/api/users",s);this.pagination=a.data,this.teamMembers=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching team members";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch team members:",s)}finally{this.isLoadingTeamMembers=!1}},async updateOrder(i,t){var s,a;try{if(i={...i,store_id:this.store.id},await M.put(`/api/orders/${this.order.id}`,i),t=="team member")if(this.orderForm.assigned_to_user_id){const n=this.teamMembers.find(e=>e.id===this.orderForm.assigned_to_user_id);this.notificationState.showSuccessNotification(`Order assigned to ${n.first_name}`)}else this.notificationState.showSuccessNotification("No team member unassigned");else t=="internal note"&&(this.orderForm.internal_note?this.notificationState.showSuccessNotification("Internal note updated"):this.notificationState.showSuccessNotification("Internal note removed"),this.orderState.order.internal_note=this.orderForm.internal_note)}catch(n){const e=((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(n),console.error("Failed to update order changes:",n)}}}},he={class:"bg-white rounded-lg p-4 mb-4"},ge={key:1,class:"space-y-4"};function fe(i,t,s,a,n,e){const h=m("Skeleton"),u=m("Select"),_=m("Input");return o(),d("div",he,[e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),d("div",ge,[c(u,{search:!0,label:"Assigned To",options:e.teamMemberOptions,modelValue:e.orderForm.assigned_to_user_id,"onUpdate:modelValue":t[0]||(t[0]=g=>e.orderForm.assigned_to_user_id=g),skeleton:e.isLoadingOrder||!e.hasOrder||n.isLoadingTeamMembers,onChange:t[1]||(t[1]=g=>e.updateOrder({assigned_to_user_id:g},"team member"))},null,8,["options","modelValue","skeleton"]),c(_,{rows:"2",type:"textarea",label:"Internal Note",modelValue:e.orderForm.internal_note,"onUpdate:modelValue":t[2]||(t[2]=g=>e.orderForm.internal_note=g),description:"Visible to team members",errorText:e.formState.getFormError("internal_note"),onBlur:t[3]||(t[3]=g=>e.updateOrder({internal_note:g},"internal note")),tooltipContent:"Internal information about this order only visible to you and other team members"},null,8,["modelValue","errorText"])]))])}const pe=C(ue,[["render",fe]]),_e={inject:["orderState","storeState"],components:{Skeleton:T},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder},hasTaxTotal(){return this.isLoadingOrder?!1:this.order.vat_amount.amount>0},hasFeeTotal(){return this.isLoadingOrder?!1:this.order.fee_total.amount>0},hasDiscountTotal(){return this.isLoadingOrder?!1:this.order.discount_total.amount>0},orderFees(){return this.isLoadingOrder?[]:this.order.order_fees},orderDiscounts(){return this.isLoadingOrder?[]:this.order.order_discounts}},methods:{removeDecimalTrailingZeros:K}},ye={class:"bg-blue-50 border border-blue-400 rounded-lg p-4"},we={key:0,class:"flex items-center justify-between text-sm border-b border-dashed border-gray-300 pb-2 mb-2"},be={key:1},xe={key:1,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Se={key:1},ve={key:3},Oe={key:2,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},ke={class:"flex items-center justify-between text-sm mb-1"},Ce={key:1,class:"w-full"},Pe={key:3},Te={key:1,class:"text-xs text-gray-400"},Le={key:3,class:"border-b border-dashed border-gray-300 pb-2 mb-2"},Ie={key:1},Fe={key:3},De={class:"flex items-center justify-between text-base pt-2"},je={key:1,class:"font-bold"};function Me(i,t,s,a,n,e){const h=m("Skeleton");return o(),d("div",ye,[e.isLoadingOrder||!e.hasOrder||e.hasTaxTotal||e.hasDiscountTotal||e.hasFeeTotal?(o(),d("div",we,[t[0]||(t[0]=r("span",null,"Subtotal",-1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",be,l(e.order.subtotal.amount_with_currency),1))])):f("",!0),e.isLoadingOrder||!e.hasOrder||e.hasDiscountTotal?(o(),d("div",xe,[(o(!0),d(w,null,k(e.isLoadingOrder||!e.hasOrder?[1]:e.orderDiscounts,(u,_)=>(o(),d("div",{key:_,class:"flex items-center justify-between text-sm text-gray-500"},[e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",Se,l(u.name),1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:2,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",ve,l(u.amount.amount_with_currency),1))]))),128))])):f("",!0),e.isLoadingOrder||!e.hasOrder||e.hasTaxTotal?(o(),d("div",Oe,[r("div",ke,[e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("div",Ce,"Tax ("+l(e.removeDecimalTrailingZeros(e.order.vat_rate))+"% "+l(e.order.vat_method)+")",1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",Pe,l(e.order.vat_amount.amount_with_currency),1))]),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-1/3",color:"bg-blue-200",shine:!0})):e.order.vat_amount.amount>0?(o(),d("p",Te,"Tax calculated on the discounted subtotal of "+l(e.order.subtotal_after_discount.amount_with_currency),1)):f("",!0)])):f("",!0),e.isLoadingOrder||!e.hasOrder||e.hasFeeTotal?(o(),d("div",Le,[(o(!0),d(w,null,k(e.isLoadingOrder||!e.hasOrder?[1]:e.orderFees,(u,_)=>(o(),d("div",{key:_,class:"flex items-center justify-between text-sm text-gray-500"},[e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-20",color:"bg-blue-200",shine:!0})):(o(),d("span",Ie,l(u.name),1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:2,width:"w-16",color:"bg-blue-200",shine:!0})):(o(),d("span",Fe,l(u.amount.amount_with_currency),1))]))),128))])):f("",!0),r("div",De,[t[1]||(t[1]=r("div",{class:"w-full font-bold"},"Grand Total",-1)),e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-24",color:"bg-blue-200",shine:!0})):(o(),d("span",je,l(e.order.grand_total.amount_with_currency),1))])])}const Ne=C(_e,[["render",Me]]),Ee={inject:["orderState","storeState"],components:{Image:j,Pill:V,Button:F},props:{orderProduct:{type:Object}},data(){return{MoveRight:X,expanded:!1}},computed:{store(){return this.storeState.store},hasDetectedChanges(){return this.orderProduct.detected_changes.length>0},totalDetectedChanges(){return this.orderProduct.detected_changes.length},hasPhoto(){return this.photo!=null},photo(){return this.orderProduct.photo},canShowProduct(){return this.orderProduct.product_id!=null}},methods:{toggleExpansion(){this.expanded=!this.expanded},navigateToProduct(){this.$router.push({name:"show-product",params:{product_id:this.orderProduct._links.showProduct},query:{store_id:this.store._links.showStore}})}}},Ae={class:"w-full flex items-center space-x-4"},Ve=["src"],Ue={class:"w-full flex items-center justify-between"},ze={class:"font-semibold text-sm whitespace-nowrap"},Be={class:"text-sm font-semibold"},Re={class:"text-xs text-gray-500"},We={class:"flex items-center space-x-2 mr-4"},qe={class:"flex items-center space-x-2"},Ge={class:"text-sm"},Qe={key:0,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},He={key:1,class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},Ze={key:0,class:"text-sm p-4 pb-8"},Ke={class:"flex items-end justify-between mb-4 ml-4"},Je={class:"w-full overflow-x-auto rounded-lg border border-gray-300 mb-4"},Xe={class:"w-full text-sm text-left rtl:text-right text-gray-500"},Ye={class:"whitespace-nowrap align-top text-left p-2 pl-4"},$e={class:"whitespace-nowrap align-top text-center py-2"},et={class:"whitespace-nowrap align-top text-center py-2"},tt={class:"whitespace-nowrap align-top text-center py-2"},rt={class:"whitespace-nowrap align-top text-center py-2"},st={class:"whitespace-nowrap align-top text-right p-2 pr-4"},ot={class:"w-full overflow-x-auto rounded-lg border border-gray-300 mb-4"},nt={class:"w-full text-sm text-left rtl:text-right text-gray-500"},it={class:"whitespace-nowrap align-top text-left p-2 pl-4"},at={class:"whitespace-nowrap align-top text-center p-2"},dt={class:"whitespace-nowrap align-top text-center p-2"},lt={class:"w-full overflow-x-auto rounded-lg border mb-4"},ct={class:"w-full text-sm text-left rtl:text-right text-gray-500"},mt={key:0,class:"whitespace-nowrap align-top text-left p-2 pl-4"},ut={key:1,class:"whitespace-nowrap align-top text-center p-2"},ht={class:"space-y-2"},gt={class:"text-xs"};function ft(i,t,s,a,n,e){const h=m("Image"),u=m("Pill"),_=m("Button");return o(),d("div",{class:I([{"shadow-md":n.expanded},"select-none rounded-lg overflow-hidden border border-gray-300"])},[r("div",{onClick:t[1]||(t[1]=(...g)=>e.toggleExpansion&&e.toggleExpansion(...g)),class:I([{"shadow-sm border-b border-gray-300":n.expanded},"flex justify-between items-center cursor-pointer p-2 bg-gray-50 hover:bg-gray-100"])},[r("div",Ae,[r("div",{class:I(["flex items-center justify-center w-10 h-10 rounded-lg",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),d("img",{key:0,class:"w-full max-h-full object-contain rounded-lg flex-shrink-0",src:e.photo.path},null,8,Ve)):(o(),p(h,{key:1,size:"20",class:"text-gray-400 flex-shrink-0"}))],2),r("div",Ue,[r("div",null,[r("div",{onClick:t[0]||(t[0]=D((...g)=>e.navigateToProduct&&e.navigateToProduct(...g),["stop"])),class:"flex items-center space-x-2 hover:text-blue-500 hover:underline"},[r("span",ze,l(s.orderProduct.quantity)+" x",1),r("span",Be,l(s.orderProduct.name),1)]),r("div",Re,l(s.orderProduct.unit_price.amount_with_currency)+" each",1)]),r("div",We,[e.hasDetectedChanges?(o(),p(u,{key:0,type:"warning",size:"xs",showDot:!1},{default:x(()=>[v(l(`${e.totalDetectedChanges} ${e.totalDetectedChanges==1?"change":"changes"} found`),1)]),_:1})):f("",!0),s.orderProduct.on_sale?(o(),p(u,{key:1,type:"success",size:"xs",showDot:!1},{default:x(()=>t[2]||(t[2]=[v("on sale")])),_:1,__:[2]})):f("",!0),s.orderProduct.is_free?(o(),p(u,{key:2,type:"success",size:"xs",showDot:!1},{default:x(()=>t[3]||(t[3]=[v("free")])),_:1,__:[3]})):f("",!0)])])]),r("div",qe,[r("span",Ge,l(s.orderProduct.grand_total.amount_with_currency),1),n.expanded?(o(),d("svg",Qe,t[4]||(t[4]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"},null,-1)]))):(o(),d("svg",He,t[5]||(t[5]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"},null,-1)])))])],2),n.expanded?(o(),d("div",Ze,[r("div",Ke,[t[7]||(t[7]=r("h1",{class:"text-sm text-gray-500 font-semibold"},"Pricing",-1)),e.canShowProduct?(o(),p(_,{key:0,size:"xs",type:"light",rightIcon:n.MoveRight,action:e.navigateToProduct},{default:x(()=>t[6]||(t[6]=[r("span",null,"Show Product",-1)])),_:1,__:[6]},8,["rightIcon","action"])):f("",!0)]),r("div",Je,[r("table",Xe,[t[8]||(t[8]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"Regular Price")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Sale Price")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Quantity")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Subtotal")]),r("th",{class:"whitespace-nowrap align-top text-center py-2"},[r("span",null,"Discount Total")]),r("th",{class:"whitespace-nowrap align-top text-right p-2 pr-4"},[r("span",null,"Grand Total")])])],-1)),r("tbody",null,[r("tr",null,[r("td",Ye,[r("span",null,l(s.orderProduct.unit_regular_price.amount_with_currency),1)]),r("td",$e,[r("span",null,l(s.orderProduct.unit_sale_price.amount_with_currency),1)]),r("td",et,[r("span",null,l(s.orderProduct.quantity),1)]),r("td",tt,[r("span",null,l(s.orderProduct.subtotal.amount_with_currency),1)]),r("td",rt,[r("span",null,l(s.orderProduct.sale_discount_total.amount_with_currency),1)]),r("td",st,[r("span",null,l(s.orderProduct.grand_total.amount_with_currency),1)])])])])]),s.orderProduct.unit_weight>0?(o(),d(w,{key:0},[t[10]||(t[10]=r("h1",{class:"text-sm text-gray-500 font-semibold mb-4 ml-4"},"Weight",-1)),r("div",ot,[r("table",nt,[t[9]||(t[9]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"Unit Weight")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Quantity")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Total Weight")])])],-1)),r("tbody",null,[r("tr",null,[r("td",it,[r("span",null,l(s.orderProduct.unit_weight),1)]),r("td",at,[r("span",null,l(s.orderProduct.quantity),1)]),r("td",dt,[r("span",null,l(s.orderProduct.unit_weight),1)])])])])])],64)):f("",!0),s.orderProduct.sku||s.orderProduct.barcode?(o(),d(w,{key:1},[t[12]||(t[12]=r("h1",{class:"text-base text-gray-500 font-semibold mb-4 ml-4"},"Identification",-1)),r("div",lt,[r("table",ct,[t[11]||(t[11]=r("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-100"},[r("tr",null,[r("th",{class:"whitespace-nowrap align-top text-left p-2 pl-4"},[r("span",null,"SKU")]),r("th",{class:"whitespace-nowrap align-top text-center p-2"},[r("span",null,"Barcode")])])],-1)),r("tbody",null,[r("tr",null,[s.orderProduct.sku?(o(),d("td",mt,[r("span",null,l(s.orderProduct.sku),1)])):f("",!0),s.orderProduct.barcode?(o(),d("td",ut,[r("span",null,l(s.orderProduct.barcode),1)])):f("",!0)])])])])],64)):f("",!0),e.hasDetectedChanges?(o(),d(w,{key:2},[t[13]||(t[13]=r("h1",{class:"text-base text-gray-500 font-semibold mb-4 ml-4"},"Changes",-1)),r("div",ht,[(o(!0),d(w,null,k(s.orderProduct.detected_changes,(g,S)=>(o(),d("div",{key:S,class:"flex space-x-2 p-2 border-l-8 border-yellow-300 bg-gray-50"},[r("p",gt,l(g.message),1)]))),128))])],64)):f("",!0)])):f("",!0)],2)}const pt=C(Ee,[["render",ft]]),_t={inject:["storeState","orderState"],components:{Image:j,Skeleton:T,OrderProduct:pt},computed:{order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},orderProducts(){return this.order.order_products}}},yt={key:0,class:"space-y-2"},wt={class:"flex items-center justify-center w-10 h-10 border border-dashed border-gray-200 rounded-lg flex-shrink-0"},bt={class:"w-full flex justify-between"},xt={class:"flex items-center space-x-2"};function St(i,t,s,a,n,e){const h=m("Image"),u=m("Skeleton"),_=m("OrderProduct");return e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",yt,[(o(),d(w,null,k([1,2],(g,S)=>r("div",{key:S,class:"flex items-center space-x-4 border-b border-gray-300 shadow-sm rounded-lg p-2 bg-gray-50"},[r("div",wt,[c(h,{size:"20",class:"text-gray-400"})]),r("div",bt,[c(u,{width:"w-1/3",shine:!0}),r("div",xt,[c(u,{width:"w-16",shine:!0}),c(u,{width:"w-4",shine:!0})])])])),64))])):(o(!0),d(w,{key:1},k(e.orderProducts,(g,S)=>(o(),p(_,{key:S,orderProduct:g},null,8,["orderProduct"]))),128))}const vt=C(_t,[["render",St]]),Ot={inject:["formState","orderState","storeState","notificationState"],components:{Popover:J,Skeleton:T,OrderTotals:Ne,OrderProducts:vt,OrderStatusSelect:Y},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderId(){return this.$route.params.order_id},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder}},methods:{formattedDatetime:A,formattedRelativeDate:G,async updateOrder(i){var t,s;try{i={...i,store_id:this.store.id},await axios.put(`/api/orders/${this.orderId}`,i),this.notificationState.showSuccessNotification(`Order ${this.orderForm.status}`),this.orderState.order.status=this.orderForm.status}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}}},kt={class:"bg-white overflow-hidden rounded-lg space-y-4 p-4 mb-4"},Ct={class:"flex justify-between items-center"},Pt={class:"text-gray-700 font-semibold mb-4"},Tt={class:"flex space-x-4"},Lt={key:0,class:"flex items-center justify-end space-x-1"},It={class:"text-gray-500 text-xs"};function Ft(i,t,s,a,n,e){const h=m("Popover"),u=m("Skeleton"),_=m("OrderStatusSelect"),g=m("OrderProducts"),S=m("OrderTotals");return o(),d("div",kt,[r("div",Ct,[r("h1",Pt,[t[1]||(t[1]=v("Items ")),!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d(w,{key:0},[v("("+l(e.order.total_uncancelled_product_quantities)+")",1)],64)):f("",!0)]),r("div",Tt,[!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d("div",Lt,[r("span",It,l(e.formattedDatetime(e.order.created_at)),1),c(h,{content:`Created ${e.formattedRelativeDate(e.order.created_at)}`},null,8,["content"])])):f("",!0),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(u,{key:1,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),p(_,{key:2,class:"w-48",showLabel:!1,onChange:t[0]||(t[0]=P=>e.updateOrder({status:P}))}))])]),c(g),c(S)])}const Dt=C(Ot,[["render",Ft]]),jt={components:{UserRound:re,Pill:V,Loader:te,Button:F},props:{index:{type:Number},orderComment:{type:Object},onViewPhoto:{type:Function},deleteOrderComment:{type:Function},isDeletingOrderCommentIds:{type:Array}},data(){return{Trash2:E,expanded:!1}},computed:{user(){return this.orderComment.user},hasPhotos(){return this.photos.length>0},photos(){return this.orderComment.photos},isDeletingOrderComment(){return this.isDeletingOrderCommentIds.findIndex(i=>i==this.orderComment.id)!=-1}},methods:{formattedDatetime:A}},Mt={class:"bg-gray-100 p-2 rounded-lg leading-0"},Nt={key:0,class:"font-bold text-sm"},Et={class:"text-sm"},At={key:1,class:"flex flex-wrap space-x-2 space-y-2 my-2"},Vt=["src","onClick"],Ut={class:"flex justify-between"},zt={class:"text-gray-400 text-xs"};function Bt(i,t,s,a,n,e){const h=m("Loader"),u=m("Button");return o(),d("div",Mt,[e.user?(o(),d("p",Nt,l(e.user.name),1)):f("",!0),r("p",Et,l(s.orderComment.comment),1),e.hasPhotos?(o(),d("div",At,[(o(!0),d(w,null,k(e.photos,_=>(o(),d("img",{key:_.id,src:_.path,onClick:()=>s.onViewPhoto(_),class:"max-h-20 object-contain rounded-lg flex-shrink-0 hover:scale-105 transition-all cursor-pointer"},null,8,Vt))),128))])):f("",!0),r("div",Ut,[r("p",zt,l(e.formattedDatetime(s.orderComment.created_at)),1),e.user?(o(),d(w,{key:0},[e.isDeletingOrderComment?(o(),p(h,{key:0,type:"danger"})):(o(),p(u,{key:1,size:"xs",leftIconSize:"14",leftIcon:n.Trash2,type:"bareDanger",action:()=>s.deleteOrderComment(s.orderComment)},null,8,["leftIcon","action"]))],64)):f("",!0)])])}const Rt=C(jt,[["render",Bt]]),Wt={inject:["authState","formState","storeState","orderState","notificationState"],components:{Image:j,Modal:R,Input:N,Button:F,Skeleton:T,OrderComment:Rt},data(){return{Trash2:E,ArrowDownToLine:se,form:{photos:[],comment:""},pagination:null,orderComments:[],isUploading:!1,orderCommentPhoto:null,createdOrderComment:null,isCreatingOrderComment:!1,isLoadingOrderComments:!1,isDeletingOrderCommentIds:[],isDeletingOrderCommentPhotoIds:[],isDownloadingOrderCommentPhotoIds:[],isDownloadingOrderCommentPhoto:!1}},watch:{store(i,t){!t&&i&&this.showOrderComments()},isUploading(i){i==!1&&this.orderCommentCreationCompleted()}},computed:{store(){return this.storeState.store},orderId(){return this.$route.params.order_id},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasOrderComments(){return this.orderComments.length>0}},methods:{reset(){this.form.photos=[],this.form.comment=""},async showOrderComments(){var i,t;try{this.isLoadingOrderComments=!0;let s={params:{order_id:this.orderId,store_id:this.store.id,_relationships:["photos","user"].join(",")}};const a=await axios.get("/api/order-comments",s);this.pagination=a.data,this.orderComments=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching order comments";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch order comments:",s)}finally{this.isLoadingOrderComments=!1}},onEnterCreateOrderComment(i){i.preventDefault(),this.createOrderComment()},async createOrderComment(){var i,t;try{if(this.isCreatingOrderComment||this.isUploading||(this.formState.hideFormErrors(),(this.form.comment==null||this.form.comment.trim()==="")&&this.formState.setFormError("comment","The comment is required"),this.formState.hasErrors))return;this.isCreatingOrderComment=!0;const s={order_id:this.orderId,store_id:this.store.id,comment:this.form.comment},a=await axios.post("/api/order-comments",s);this.createdOrderComment=a.data.order_comment,this.form.photos.length?this.uploadImages():this.orderCommentCreationCompleted()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while creating order comment";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to create order comment:",s),this.isCreatingOrderComment=!1}},orderCommentCreationCompleted(){this.orderComments.push({user:this.authState.user,...this.createdOrderComment,photos:this.form.photos.map(function(i){return{id:Q(),temporary:!0,path:i.path}})}),this.notificationState.showSuccessNotification("Comment created!"),this.isCreatingOrderComment=!1,this.showOrderComments(),this.reset()},async uploadImages(i=null){let t=[];for(let s=0;s<this.form.photos.length;s++){const a=this.form.photos[s];(a.uploaded===null||a.uploaded===!1)&&a.uploading==!1&&(i==null||i==s)&&t.push(this.uploadSingleImage(a,s))}return this.isUploading=!0,Promise.allSettled(t).then(s=>{let a=s.filter(n=>n.status==="rejected").length;a>0&&this.notificationState.showWarningNotification(`⚠️ ${a} image(s) failed to upload. Try again or change the image.`),this.isUploading=!1})},async uploadSingleImage(i,t,s=0,a=null){var n,e,h;try{if(s>2)return console.log(`❌ Image ${t+1} permanently failed after 3 attempts.`),i.uploaded=!1,i.uploading=!1,i.error_message=((e=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Upload failed",Promise.reject("Failed after 3 attempts");let u=new FormData;u.append("file",i.file_ref),u.append("store_id",this.store.id),u.append("mediable_type","order comment"),u.append("mediable_id",this.createdOrderComment.id),u.append("upload_folder_name","order_comment_photo"),i.uploading=!0,i.error_message=null;const _={headers:{"Content-Type":"multipart/form-data"}},g=await axios.post("/api/media-files",u,_);return i.uploaded=!0,i.uploading=!1,console.log(`✅ Image ${t+1} uploaded successfully.`),g}catch(u){return console.error(`⚠️ Image ${t+1} upload attempt ${s+1} failed.`,u),u.code==="ECONNABORTED"||((h=u.response)==null?void 0:h.status)===504?void 0:this.uploadSingleImage(i,t,s+1,u)}},onViewPhoto(i){this.orderCommentPhoto=i,this.$refs.showPhotoModal.showModal()},async downloadOrderCommentPhoto(){try{if(this.isDownloadingOrderCommentPhotoIds.includes(this.orderCommentPhoto.id))return;this.isDownloadingOrderCommentPhotoIds.push(this.orderCommentPhoto.id);let i={responseType:"blob",params:{store_id:this.store.id}};const s=(await axios.get(`/api/media-files/${this.orderCommentPhoto.id}/download`,i)).data,a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=this.orderCommentPhoto.name,n.click(),URL.revokeObjectURL(a)}catch(i){console.error("Error downloading the store QR code image:",i)}finally{this.isDownloadingOrderCommentPhotoIds.splice(this.isDownloadingOrderCommentPhotoIds.findIndex(i=>i==this.orderCommentPhoto.id),1)}},async deleteOrderCommentPhoto(){var i,t;try{if(this.isDeletingOrderCommentPhotoIds.includes(this.orderCommentPhoto.id))return;this.isDeletingOrderCommentPhotoIds.push(this.orderCommentPhoto.id);const s={data:{store_id:this.store.id}};await axios.delete(`/api/media-files/${this.orderCommentPhoto.id}`,s),this.orderComments=this.orderComments.map(a=>({...a,photos:a.photos.filter(n=>n.id!==this.orderCommentPhoto.id)})),this.notificationState.showSuccessNotification("Photo deleted"),this.$refs.showPhotoModal.hideModal()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while deleting comment photo";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to delete comment photo:",s)}finally{this.isDeletingOrderCommentPhotoIds.splice(this.isDeletingOrderCommentPhotoIds.findIndex(s=>s==this.orderCommentPhoto.id),1)}},async deleteOrderComment(i){var t,s;try{if(this.isDeletingOrderCommentIds.includes(i.id))return;this.isDeletingOrderCommentIds.push(i.id);const a={data:{store_id:this.store.id}};await axios.delete(`/api/order-comments/${i.id}`,a),this.notificationState.showSuccessNotification("Comment deleted"),this.orderComments=this.orderComments.filter(n=>n.id!=i.id)}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while deleting order comment";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to delete order comment:",a)}finally{this.isDeletingOrderCommentIds.splice(this.isDeletingOrderCommentIds.findIndex(a=>a==i.id),1)}}}},qt={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},Gt={class:"flex justify-between items-center space-x-4"},Qt={key:0,class:"w-full flex space-x-2"},Ht=["onClick"],Zt={key:0,class:"space-y-2"},Kt={class:"space-y-2 p-2 px-4 bg-gray-50"},Jt={class:"flex justify-between items-center space-x-8"},Xt={class:"flex items-center space-x-2 whitespace-nowrap"},Yt={class:"flex justify-end items-end space-x-2"},$t={class:"flex items-center justify-center w-10 h-10 rounded-lg border border-dashed border-gray-200"},er={class:"flex justify-center"},tr=["src"],rr={key:0,class:"flex justify-end space-x-2 mt-4"};function sr(i,t,s,a,n,e){const h=m("Input"),u=m("Image"),_=m("Button"),g=m("Skeleton"),S=m("OrderComment"),P=m("Modal");return o(),d(w,null,[r("div",qt,[t[8]||(t[8]=r("h1",{class:"text-gray-700 font-semibold mb-4"},"Comments",-1)),r("div",Gt,[!e.isLoadingStore&&!e.isLoadingOrder&&e.hasOrder?(o(),d("div",Qt,[r("div",{onClick:t[6]||(t[6]=D(b=>i.$refs.comment.focusInput(),["stop"])),class:"w-full border border-gray-300 p-2 rounded-lg"},[c(h,{type:"file",maxFiles:6,class:"w-full",wrapperClass:{},modelValue:n.form.photos,"onUpdate:modelValue":t[3]||(t[3]=b=>n.form.photos=b),onRetryUploads:t[4]||(t[4]=b=>e.uploadImages()),onRetryUpload:t[5]||(t[5]=(b,O)=>e.uploadImages(O))},{fileTrigger:x(b=>[r("div",{class:"w-full flex space-x-2",onClick:t[2]||(t[2]=D(O=>i.$refs.comment.focusInput(),["stop"]))},[c(h,{rows:"1",onClick:t[0]||(t[0]=D(()=>{},["stop"])),ref:"comment",class:"w-full",type:"textarea",wrapperClass:{},modelValue:n.form.comment,"onUpdate:modelValue":t[1]||(t[1]=O=>n.form.comment=O),placeholder:"Say something",onOnEnter:e.onEnterCreateOrderComment,errorText:e.formState.getFormError("comment")},null,8,["modelValue","onOnEnter","errorText"]),r("div",{onClick:D(b.handleClick,["stop"]),class:"z-10 w-10 h-10 flex flex-shrink-0 items-center justify-center bg-gray-50 border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer"},[c(u,{size:"20",class:I([{"text-gray-400":!b.filesLeftToUpload}])},null,8,["class"])],8,Ht)])]),_:1},8,["modelValue"])]),c(_,{size:"sm",type:"primary",buttonClass:"flex-shrink-0",action:e.createOrderComment,disabled:n.isCreatingOrderComment||n.isUploading},{default:x(()=>t[7]||(t[7]=[r("span",null,"Post",-1)])),_:1,__:[7]},8,["action","disabled"])])):f("",!0)]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",Zt,[(o(),d(w,null,k([1,2],(b,O)=>r("div",{key:O,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",Kt,[r("div",Jt,[c(g,{width:"w-1/3",shine:!0}),r("div",Xt,[c(g,{width:"w-20",shine:!0}),c(g,{width:"w-10",shine:!0}),c(g,{width:"w-10",shine:!0})])]),r("div",Yt,[c(g,{width:"w-10",shine:!0}),r("div",$t,[c(u,{size:"16",class:"text-gray-400 flex-shrink-0"})])])])])),64))])):(o(),d(w,{key:1},[e.hasOrderComments?(o(!0),d(w,{key:0},k(n.orderComments,(b,O)=>(o(),p(S,{index:O,key:b.id,onViewPhoto:e.onViewPhoto,orderComment:b,deleteOrderComment:e.deleteOrderComment,isDeletingOrderCommentIds:n.isDeletingOrderCommentIds},null,8,["index","onViewPhoto","orderComment","deleteOrderComment","isDeletingOrderCommentIds"]))),128)):f("",!0)],64))]),c(P,{showFooter:!1,ref:"showPhotoModal",scrollOnContent:!1},z({_:2},[n.orderCommentPhoto?{name:"content",fn:x(()=>[t[11]||(t[11]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Image Preview",-1)),r("div",er,[r("img",{src:n.orderCommentPhoto.path},null,8,tr)]),n.orderCommentPhoto.hasOwnProperty("temporary")?f("",!0):(o(),d("div",rr,[c(_,{size:"sm",type:"primary",leftIcon:n.ArrowDownToLine,action:e.downloadOrderCommentPhoto,loading:this.isDownloadingOrderCommentPhotoIds.findIndex(b=>b==this.orderCommentPhoto.id)!=-1},{default:x(()=>t[9]||(t[9]=[r("span",null,"Download",-1)])),_:1,__:[9]},8,["leftIcon","action","loading"]),c(_,{size:"sm",type:"danger",leftIcon:n.Trash2,action:e.deleteOrderCommentPhoto,loading:this.isDeletingOrderCommentPhotoIds.findIndex(b=>b==this.orderCommentPhoto.id)!=-1},{default:x(()=>t[10]||(t[10]=[r("span",null,"Delete",-1)])),_:1,__:[10]},8,["leftIcon","action","loading"])]))]),key:"0"}:void 0]),1536)],64)}const or=C(Wt,[["render",sr]]),nr={inject:["formState","storeState","orderState","notificationState"],components:{UserRoundCheck:me,Alert:W,Input:N,Select:B,Button:F,Skeleton:T,GoogleMaps:oe,CollectionStatus:ne},data(){return{ArrowRight:ie,couriers:[],ExternalLink:q,isLoadingCouriers:!1}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},customer(){return this.order.customer},deliveryMethod(){return this.order.delivery_method},deliveryAddress(){return this.order.delivery_address},googleMapsUrl(){return!this.isLoadingOrder&&this.deliveryAddress.latitude&&this.deliveryAddress.longitude?`https://www.google.com/maps?q=${this.deliveryAddress.latitude},${this.deliveryAddress.longitude}`:null}},methods:{formattedDate:Z,formattedShortWeekday:H,openGoogleMapsLink(){window.open(this.googleMapsUrl,"_blank")},navigateToCustomer(){this.$router.push({name:"show-customer",params:{customer_id:this.customer.id},query:{store_id:this.store.id}})},async showCouriers(){var i,t;try{if(this.couriers.length)return;this.isLoadingCouriers=!0;let s={params:{per_page:100}};const a=await M.get("/api/couriers",s);this.couriers=a.data.data.map(n=>({label:$(n.name),value:n.id})),this.couriers.unshift({label:"None",value:null})}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching stores";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch stores:",s)}finally{this.isLoadingCouriers=!1}},async updateOrder(i,t){var s,a;try{if(i={...i,store_id:this.store.id},await M.put(`/api/orders/${this.order.id}`,i),t=="courier"){if(this.orderForm.courier_id){const n=this.couriers.find(e=>e.value===this.orderForm.courier_id);this.notificationState.showSuccessNotification(`Courier updated to ${n.label}`)}else this.notificationState.showSuccessNotification("Courier removed");this.orderState.order.courier_id=this.orderForm.courier_id}else t=="tracking number"?(this.orderForm.tracking_number?this.notificationState.showSuccessNotification(`Tracking number updated to ${this.orderForm.tracking_number}`):this.notificationState.showSuccessNotification("Tracking number removed"),this.orderState.order.tracking_number=this.orderForm.tracking_number):t=="remark"&&(this.orderForm.remark?this.notificationState.showSuccessNotification("Remark updated"):this.notificationState.showSuccessNotification("Remark removed"),this.orderState.order.remark=this.orderForm.remark)}catch(n){const e=((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(n),console.error("Failed to update order changes:",n)}}},created(){this.showCouriers()}},ir={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},ar={class:"flex justify-between items-center mb-4"},dr={key:0,class:"space-y-2"},lr={class:"space-y-2 p-2 px-4 bg-gray-50"},cr={class:"flex justify-between items-center space-x-8"},mr={class:"flex items-center space-x-2 whitespace-nowrap"},ur={class:"grid grid-cols-2 gap-4"},hr={class:"col-span-1"},gr={class:"col-span-1"},fr={class:"col-span-2"},pr={class:"bg-gray-50 p-4 border border-gray-200 rounded-lg space-y-2 text-sm"},_r={key:0,class:"grid grid-cols-3 items-center"},yr={class:"col-span-2 flex items-center space-x-2"},wr={key:1,class:"grid grid-cols-3"},br={class:"col-span-2"},xr=["href"],Sr={key:2,class:"grid grid-cols-3"},vr={class:"col-span-2"},Or=["href"],kr={key:3,class:"grid grid-cols-3"},Cr={class:"col-span-2"},Pr={key:4,class:"grid grid-cols-3"},Tr={class:"col-span-2"},Lr=["href"],Ir={key:5,class:"grid grid-cols-3"},Fr={class:"space-x-2"},Dr={class:"list-disc text-xs space-y-2 border-t border-blue-300 border-dashed pt-2 mt-2 pl-2"},jr={key:0},Mr={class:"font-bold"},Nr={class:"font-bold"},Er={key:1},Ar={class:"font-bold"},Vr={class:"font-bold"},Ur={key:2},zr={class:"font-bold"},Br={class:"font-bold"},Rr={class:"rounded-lg overflow-hidden"},Wr={key:0,class:"flex justify-end mt-4"};function qr(i,t,s,a,n,e){const h=m("Skeleton"),u=m("CollectionStatus"),_=m("Select"),g=m("Input"),S=m("UserRoundCheck"),P=m("Button"),b=m("Alert"),O=m("GoogleMaps");return o(),d("div",ir,[r("div",ar,[t[7]||(t[7]=r("h1",{class:"text-gray-700 font-semibold"},"Fulfillment",-1)),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(h,{key:0,width:"w-20",shine:!0})):(o(),p(u,{key:1}))]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",dr,[(o(),d(w,null,k([1,2],(y,L)=>r("div",{key:L,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",lr,[r("div",cr,[c(h,{width:"w-1/3",shine:!0}),r("div",mr,[c(h,{width:"w-20",shine:!0}),c(h,{width:"w-10",shine:!0}),c(h,{width:"w-10",shine:!0})])])])])),64))])):(o(),d(w,{key:1},[r("div",ur,[r("div",hr,[c(_,{search:!0,label:"Courier",options:n.couriers,modelValue:e.orderForm.courier_id,"onUpdate:modelValue":t[0]||(t[0]=y=>e.orderForm.courier_id=y),errorText:e.formState.getFormError("courier_id"),onChange:t[1]||(t[1]=y=>e.updateOrder({courier_id:y},"courier"))},null,8,["options","modelValue","errorText"])]),r("div",gr,[c(g,{type:"text",label:"Tracking Number",modelValue:e.orderForm.tracking_number,"onUpdate:modelValue":t[2]||(t[2]=y=>e.orderForm.tracking_number=y),errorText:e.formState.getFormError("tracking_number"),onBlur:t[3]||(t[3]=y=>e.updateOrder({tracking_number:y},"tracking number"))},null,8,["modelValue","errorText"])]),r("div",fr,[c(g,{rows:"2",label:"Remark",type:"textarea",placeholder:"Optional",modelValue:e.orderForm.remark,"onUpdate:modelValue":t[4]||(t[4]=y=>e.orderForm.remark=y),description:"Visible to customer",errorText:e.formState.getFormError("remark"),onBlur:t[5]||(t[5]=y=>e.updateOrder({remark:y},"remark")),tooltipContent:"Use the Remark field to add a note that will be visible to the customer, such as special instructions, order details, or personalized messages."},null,8,["modelValue","errorText"])])]),r("div",pr,[e.order.customer_name?(o(),d("div",_r,[t[9]||(t[9]=r("span",null,"Name",-1)),r("div",yr,[e.customer?(o(),p(S,{key:0,size:"16"})):f("",!0),r("span",{class:I({"text-blue-500 hover:underline cursor-pointer":e.customer}),onClick:t[6]||(t[6]=y=>e.customer?e.navigateToCustomer:null)},l(e.order.customer_name),3),c(P,{size:"xs",type:"light",class:"hidden lg:block",rightIcon:n.ArrowRight,action:e.navigateToCustomer},{default:x(()=>t[8]||(t[8]=[r("span",null,"Show Profile",-1)])),_:1,__:[8]},8,["rightIcon","action"])])])):f("",!0),e.order.customer_email?(o(),d("div",wr,[t[10]||(t[10]=r("span",null,"Email",-1)),r("span",br,[r("a",{href:`mailto:${e.order.customer_email}`,target:"_blank",class:"text-blue-500 hover:underline"},l(e.order.customer_email),9,xr)])])):f("",!0),e.order.customer_mobile_number?(o(),d("div",Sr,[t[11]||(t[11]=r("span",null,"Mobile",-1)),r("span",vr,[r("a",{href:`tel:${e.order.customer_mobile_number.international}`,target:"_blank",class:"text-blue-500 hover:underline"},l(e.order.customer_mobile_number.international),9,Or)])])):f("",!0),e.deliveryMethod?(o(),d("div",kr,[t[12]||(t[12]=r("span",null,"Delivery",-1)),r("span",Cr,l(e.deliveryMethod.name),1)])):f("",!0),e.deliveryAddress?(o(),d("div",Pr,[t[13]||(t[13]=r("span",null,"Address",-1)),r("span",Tr,[r("a",{href:e.googleMapsUrl,target:"_blank",class:"text-blue-500 hover:underline"},l(e.deliveryAddress.complete_address),9,Lr)])])):f("",!0),e.order.delivery_date?(o(),d("div",Ir,[t[14]||(t[14]=r("span",null,"Schedule",-1)),r("div",Fr,[r("span",null,l(e.formattedDate(e.order.delivery_date))+" ("+l(e.formattedShortWeekday(e.order.delivery_date))+")",1),r("span",null,l(e.order.delivery_timeslot),1)])])):f("",!0),e.customer&&(e.customer.name&&e.order.customer_name&&e.customer.name!=e.order.customer_name||e.customer.email&&e.order.customer_email&&e.customer.email!=e.order.customer_email||e.customer.mobile_number&&e.order.customer_mobile_number&&e.customer.mobile_number.international!=e.order.customer_mobile_number.international)?(o(),p(b,{key:6,type:"primary",dismissable:!0,title:"Profile changes"},{description:x(()=>[r("ul",Dr,[e.customer.name&&e.order.customer_name&&e.customer.name!=e.order.customer_name?(o(),d("li",jr,[t[15]||(t[15]=v("Order name (")),r("span",Mr,l(e.order.customer_name),1),t[16]||(t[16]=v(") is different from customer profile name (")),r("span",Nr,l(e.customer.name),1),t[17]||(t[17]=v(")."))])):f("",!0),e.customer.email&&e.order.customer_email&&e.customer.email!=e.order.customer_email?(o(),d("li",Er,[t[18]||(t[18]=v("Order email (")),r("span",Ar,l(e.order.customer_email),1),t[19]||(t[19]=v(") is different from customer profile email (")),r("span",Vr,l(e.customer.email),1),t[20]||(t[20]=v(")."))])):f("",!0),e.customer.mobile_number&&e.order.customer_mobile_number&&e.customer.mobile_number.international!=e.order.customer_mobile_number.international?(o(),d("li",Ur,[t[21]||(t[21]=v("Order mobile number (")),r("span",zr,l(e.order.customer_mobile_number.international),1),t[22]||(t[22]=v(") is different from customer profile mobile number (")),r("span",Br,l(e.customer.mobile_number.international),1),t[23]||(t[23]=v(")."))])):f("",!0)])]),_:1})):f("",!0)]),e.deliveryAddress?(o(),d(w,{key:0},[r("div",Rr,[c(O,{height:"350px",gmpDraggable:!1,latitude:e.deliveryAddress.latitude,longitude:e.deliveryAddress.longitude},null,8,["latitude","longitude"])]),e.googleMapsUrl?(o(),d("div",Wr,[c(P,{size:"xs",type:"light",buttonClass:"h-full",rightIcon:n.ExternalLink,action:e.openGoogleMapsLink},{default:x(()=>t[24]||(t[24]=[r("span",null,"Google Maps",-1)])),_:1,__:[24]},8,["rightIcon","action"])])):f("",!0)],64)):f("",!0)],64))])}const Gr=C(nr,[["render",qr]]),Qr={components:{Image:j,Pill:V,Button:F,Banknote:ae},props:{index:{type:Number},transaction:{type:Object},onDeleteTransaction:{type:Function}},data(){return{Trash2:E,expanded:!1}},computed:{hasPhoto(){return this.photo!=null},photo(){return this.transaction.photo}},methods:{formattedDatetime:A}},Hr={class:"rounded-lg overflow-hidden border border-gray-300"},Zr={class:"space-y-2 p-2 px-4 bg-gray-50 hover:bg-gray-100"},Kr={class:"flex justify-between items-center space-x-8"},Jr={class:"flex items-center space-x-2"},Xr={class:"font-semibold text-sm"},Yr={class:"flex items-center space-x-2 whitespace-nowrap"},$r={class:"text-gray-500 text-xs mr-4"},es={class:"text-sm"},ts=["src"];function rs(i,t,s,a,n,e){const h=m("Banknote"),u=m("Pill"),_=m("Image"),g=m("Button");return o(),d("div",Hr,[r("div",Zr,[r("div",Kr,[r("div",Jr,[c(h,{size:"20",class:"text-gray-400 flex-shrink-0"}),r("p",Xr,l(s.transaction.description),1)]),r("div",Yr,[r("span",$r,l(e.formattedDatetime(s.transaction.created_at)),1),c(u,{type:"success",size:"xs",showDot:!1},{default:x(()=>[v(l(s.transaction.payment_status),1)]),_:1}),r("span",es,l(s.transaction.amount.amount_with_currency),1),r("div",{class:I(["flex items-center justify-center w-10 h-10 hover:bg-white rounded-lg cursor-pointer",{"border border-dashed border-gray-200":!e.hasPhoto}])},[e.hasPhoto?(o(),d("img",{key:0,class:"w-full max-h-10 object-contain rounded-lg flex-shrink-0",src:e.photo.path},null,8,ts)):(o(),p(_,{key:1,size:"16",class:"text-gray-400 flex-shrink-0"}))],2),c(g,{size:"xs",leftIconSize:"14",leftIcon:n.Trash2,type:"bareDanger",action:()=>s.onDeleteTransaction(s.transaction)},null,8,["leftIcon","action"])])])])])}const ss=C(Qr,[["render",rs]]),os={inject:["formState","storeState","orderState","notificationState"],components:{Image:j,Alert:W,Input:N,Modal:R,Button:F,Skeleton:T,OrderTransaction:ss,OrderPaymentStatusSelect:ee},data(){return{Plus:de,Link2:ce,Trash2:E,ExternalLink:q,CircleDollarSign:le,form:{photo:[],amount:"0.00",description:""},pagination:null,transactions:[],isLoadingTransactions:!1,deletableTransaction:null,isCreatingTransaction:!1,isDeletingTransactionId:null}},watch:{store(i,t){!t&&i&&this.showTransactions()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},orderId(){return this.$route.params.order_id},orderForm(){return this.orderState.orderForm},hasOrder(){return this.orderState.hasOrder},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},hasTransactions(){return this.transactions.length>0}},methods:{reset(){this.form.photo=[],this.form.amount="0.00",this.form.description=""},async copyPaymentLink(){try{await navigator.clipboard.writeText("the payment link"),this.notificationState.showSuccessNotification("Payment link copied!")}catch(i){console.error("Failed to copy:",i),this.notificationState.showWarningNotification("Payment link failed to copy")}},async showTransactions(){var i,t;try{this.isLoadingTransactions=!0;let s={params:{order_id:this.orderId,store_id:this.store.id,_relationships:["photo"].join(",")}};const a=await axios.get("/api/transactions",s);this.pagination=a.data,this.transactions=this.pagination.data}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while fetching transactions";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to fetch transactions:",s)}finally{this.isLoadingTransactions=!1}},async createTransaction(){var i,t;try{if(this.isCreatingTransaction||(this.formState.hideFormErrors(),(this.form.description==null||this.form.description.trim()==="")&&this.formState.setFormError("description","Enter payment name"),this.formState.hasErrors))return;this.isCreatingTransaction=!0;let s=new FormData;s.append("return",1),s.append("owner_type","order"),s.append("owner_id",this.orderId),s.append("store_id",this.store.id),s.append("amount",this.form.amount),s.append("currency",this.store.currency),s.append("description",this.form.description),this.form.photo.length&&s.append("photo",this.form.photo[0].file_ref);const a={headers:{"Content-Type":"multipart/form-data"}},n=await axios.post("/api/transactions",s,a);this.notificationState.showSuccessNotification("Payment created!"),this.$refs.addPaymentModal.hideModal(),this.showTransactions(),this.reset()}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while creating payment";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to create payment:",s)}finally{this.isCreatingTransaction=!1}},onDeleteTransaction(i){this.deletableTransaction=i,this.$refs.deletePaymentModal.showModal()},async deleteTransaction(){var i,t;try{this.isDeletingTransactionId=this.deletableTransaction.id;const s=this.transactions.findIndex(n=>n.id==this.deletableTransaction.id),a={data:{store_id:this.store.id}};await axios.delete(`/api/transactions/${this.deletableTransaction.id}`,a),this.notificationState.showSuccessNotification("Payment deleted"),this.$refs.deletePaymentModal.hideModal(),this.transactions.splice(s,1)}catch(s){const a=((t=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Something went wrong while deleting transaction";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error("Failed to delete transaction:",s)}finally{this.isDeletingTransactionId=null}},async updateOrder(i){var t,s;try{i={...i,store_id:this.store.id},await axios.put(`/api/orders/${this.orderId}`,i),this.notificationState.showSuccessNotification(`Order ${this.orderForm.payment_status}`),this.orderState.order.payment_status=this.orderForm.payment_status}catch(a){const n=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}}},ns={class:"bg-white rounded-lg space-y-4 p-4 mb-4"},is={class:"flex justify-between items-center mb-4"},as={class:"flex items-center space-x-2"},ds={class:"flex justify-between items-center space-x-4"},ls={class:"space-y-4 mb-8"},cs={key:0,class:"space-y-2"},ms={class:"space-y-2 p-2 px-4 bg-gray-50"},us={class:"flex justify-between items-center space-x-8"},hs={class:"flex items-center space-x-2 whitespace-nowrap"},gs={class:"flex justify-end items-end space-x-2"},fs={class:"flex items-center justify-center w-10 h-10 rounded-lg border border-dashed border-gray-200"},ps={class:"bg-blue-50 border border-blue-400 rounded-lg p-4 space-y-4"},_s={class:"flex justify-between text-sm font-bold"},ys={key:0,class:"flex justify-between text-sm font-bold"},ws={class:"text-red-500"},bs={class:"p-4 text-sm bg-gray-100 rounded-lg"},xs={class:"space-x-2"},Ss={class:"space-x-2"};function vs(i,t,s,a,n,e){const h=m("Button"),u=m("Input"),_=m("Modal"),g=m("Skeleton"),S=m("OrderPaymentStatusSelect"),P=m("Image"),b=m("OrderTransaction"),O=m("Alert");return o(),d("div",ns,[r("div",is,[r("div",as,[t[4]||(t[4]=r("h1",{class:"text-gray-700 font-semibold"},"Payments",-1)),c(h,{size:"xs",type:"bare",leftIcon:n.ExternalLink},null,8,["leftIcon"])]),r("div",ds,[c(h,{size:"xs",type:"bare",leftIcon:n.Link2,action:e.copyPaymentLink},{default:x(()=>t[5]||(t[5]=[r("span",null,"Copy Payment Link",-1)])),_:1,__:[5]},8,["leftIcon","action"]),!e.isLoadingStore&&!e.isLoadingOrder?(o(),p(_,{key:0,triggerSize:"xs",triggerType:"light",approveType:"primary",ref:"addPaymentModal",leftApproveIcon:n.Plus,leftTriggerIcon:n.Plus,scrollOnContent:!1,leftTriggerIconSize:"14",triggerText:"Add Payment",approveText:"Add Payment",approveAction:e.createTransaction,approveLoading:n.isCreatingTransaction},{content:x(()=>[t[6]||(t[6]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Add Payment",-1)),r("div",ls,[c(u,{type:"text",label:"Payment Name",modelValue:n.form.description,"onUpdate:modelValue":t[0]||(t[0]=y=>n.form.description=y),placeholder:"Bank Transfer",errorText:e.formState.getFormError("description")},null,8,["modelValue","errorText"]),c(u,{type:"money",modelValue:n.form.amount,"onUpdate:modelValue":t[1]||(t[1]=y=>n.form.amount=y),label:"Payment Amount",currency:e.store.currency.code,errorText:e.formState.getFormError("amount")},null,8,["modelValue","currency","errorText"]),c(u,{type:"file",maxFiles:1,modelValue:n.form.photo,"onUpdate:modelValue":t[2]||(t[2]=y=>n.form.photo=y),label:"Proof Of Payment",singleFileUploadMessage:"proof of payment attached"},null,8,["modelValue"])])]),_:1},8,["leftApproveIcon","leftTriggerIcon","approveAction","approveLoading"])):f("",!0),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),p(g,{key:1,width:"w-full",height:"h-8",rounded:"rounded-md",shine:!0})):(o(),p(S,{key:2,class:"w-48",showLabel:!1,onChange:t[3]||(t[3]=y=>e.updateOrder({payment_status:y}))}))])]),e.isLoadingStore||e.isLoadingOrder||!e.hasOrder?(o(),d("div",cs,[(o(),d(w,null,k([1,2],(y,L)=>r("div",{key:L,class:"rounded-lg overflow-hidden border border-gray-300"},[r("div",ms,[r("div",us,[c(g,{width:"w-1/3",shine:!0}),r("div",hs,[c(g,{width:"w-20",shine:!0}),c(g,{width:"w-10",shine:!0}),c(g,{width:"w-10",shine:!0})])]),r("div",gs,[c(h,{size:"xs",skeleton:!0,leftIconSize:"14",leftIcon:n.Trash2,type:"outlineDanger"},null,8,["leftIcon"]),r("div",fs,[c(P,{size:"16",class:"text-gray-400 flex-shrink-0"})])])])])),64))])):(o(),d(w,{key:1},[e.hasTransactions?(o(),d(w,{key:0},[(o(!0),d(w,null,k(n.transactions,(y,L)=>(o(),p(b,{key:L,index:L,transaction:y,onDeleteTransaction:e.onDeleteTransaction},null,8,["index","transaction","onDeleteTransaction"]))),128)),r("div",ps,[r("div",_s,[t[7]||(t[7]=r("span",null,"Amount Paid",-1)),r("span",null,l(e.order.paid_total.amount_with_currency),1)]),e.order.outstanding_total.amount>0?(o(),d("div",ys,[t[8]||(t[8]=r("span",null,"Amount Due",-1)),r("span",ws,l(e.order.outstanding_total.amount_with_currency),1)])):f("",!0)])],64)):(o(),p(O,{key:1,type:"light",dismissable:!1,icon:n.CircleDollarSign,title:"No transctions yet"},null,8,["icon"])),c(_,{approveText:"Delete",approveType:"danger",ref:"deletePaymentModal",scrollOnContent:!1,leftApproveIcon:n.Trash2,approveAction:e.deleteTransaction,approveLoading:n.deletableTransaction&&n.isDeletingTransactionId==n.deletableTransaction.id},z({_:2},[n.deletableTransaction?{name:"content",fn:x(()=>[t[11]||(t[11]=r("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Confirm Delete",-1)),t[12]||(t[12]=r("p",{class:"mb-8"},"Are you sure you want to permanently delete this payment?",-1)),r("div",bs,[r("div",xs,[t[9]||(t[9]=r("span",{class:"font-bold"},"Name:",-1)),r("span",null,l(n.deletableTransaction.description),1)]),r("div",Ss,[t[10]||(t[10]=r("span",{class:"font-bold"},"Amount:",-1)),r("span",null,l(n.deletableTransaction.amount.amount_with_currency),1)])])]),key:"0"}:void 0]),1032,["leftApproveIcon","approveAction","approveLoading"])],64))])}const Os=C(os,[["render",vs]]),ks={inject:["orderState","storeState"],components:{TeamMember:pe,OrderItems:Dt,OrderComments:or,OrderFulfilment:Gr,OrderTransactions:Os},computed:{store(){return this.storeState.store},order(){return this.orderState.order},hasOrder(){return this.orderState.hasOrder},isLoadingOrder(){return this.orderState.isLoadingOrder}}},Cs={class:"grid grid-cols-12 gap-8 mb-4"},Ps={class:"col-span-8"},Ts={class:"col-span-4"};function Ls(i,t,s,a,n,e){const h=m("OrderItems"),u=m("OrderTransactions"),_=m("OrderFulfilment"),g=m("TeamMember"),S=m("OrderComments");return o(),d("div",Cs,[r("div",Ps,[c(h),c(u),c(_)]),r("div",Ts,[c(g),c(S)])])}const so=C(ks,[["render",Ls]]);export{so as default};
