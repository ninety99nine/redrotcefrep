import{M as Fn}from"./Modal-2gfRC5Dc.js";import{I as te}from"./Input-l_fu_pN6.js";import{S as Ln}from"./Switch-Bmx5hHU3.js";import{B as Tn}from"./Button-D7saANb7.js";import{S as In}from"./Skeleton-DAfv9Rr0.js";import{c as kn,i as Un}from"./stringUtils-Bvzw0-oW.js";import{d as S,r as p,o as h,g as ve,b as M,t as G,c as V,F as ee,f as ot,e as q,i as Q,a as E,au as ue,n as jn}from"./app-DF0QnPU4.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as An}from"./Select-dH13kFO1.js";import{E as On}from"./external-link-DSJddmew.js";import{S as Nn}from"./SelectCurrency-BriyL9dm.js";import{I as Dn}from"./info-BrToMAYh.js";import{M as Bn}from"./move-left-BoEc8pc2.js";import{T as Hn}from"./trash-2-WYhYg-cK.js";import"./x-DdzUJel4.js";import"./createLucideIcon-eN94IJz_.js";import"./Copy-DudZ5Uvs.js";import"./ShineEffect-BVNWGq73.js";import"./Popover-DmuV9HMk.js";import"./refresh-ccw-BWvWNHcU.js";import"./circle-check-B1WpMwJ7.js";import"./circle-alert-ByShgotJ.js";import"./parsePhoneNumber-DR0S47Bc.js";import"./Loader-CNeQD6e9.js";const Rn={components:{Input:te},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},emits:["change","update:modelValue"],data(){return{localModelValue:this.modelValue}},watch:{modelValue(i){this.localModelValue=i},localModelValue(i,o){i!=this.modelValue&&(this.$emit("change",i),this.$emit("update:modelValue",i))}}};function zn(i,o,n,d,s,a){const u=p("Input");return h(),S(u,{modelValue:s.localModelValue,"onUpdate:modelValue":o[0]||(o[0]=m=>s.localModelValue=m),label:n.configSchemaEntity.label,description:n.configSchemaEntity.description,popoverContent:n.configSchemaEntity.description_info,secondaryLabel:n.configSchemaEntity.optional?"(optional)":null,externalLinkUrl:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.href:null,externalLinkName:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.label:null},null,8,["modelValue","label","description","popoverContent","secondaryLabel","externalLinkUrl","externalLinkName"])}const qn=T(Rn,[["render",zn]]),Gn={components:{Input:te},props:{modelValue:{type:[Object,null]},configSchemaEntity:{type:Object},uploadImages:{type:Function}},emits:["change","update:modelValue"],data(){return{localModelValue:this.modelValue}},watch:{modelValue(i){this.localModelValue=i},localModelValue(i,o){i!=this.modelValue&&(this.$emit("change",i),this.$emit("update:modelValue",i))}}};function Wn(i,o,n,d,s,a){const u=p("Input");return h(),S(u,{type:"file",maxFiles:1,imagePreviewGridCols:1,modelValue:s.localModelValue,"onUpdate:modelValue":o[0]||(o[0]=m=>s.localModelValue=m),label:n.configSchemaEntity.label,onRetryUploads:o[1]||(o[1]=m=>n.uploadImages),onRetryUpload:o[2]||(o[2]=(m,y)=>n.uploadImages(y)),secondaryLabel:n.configSchemaEntity.optional?"(optional)":null,mimeTypes:n.configSchemaEntity.validation_rules.mime_types[0]??["image/*"]},null,8,["modelValue","label","secondaryLabel","mimeTypes"])}const Kn=T(Gn,[["render",Wn]]),Jn={components:{Select:An},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},emits:["change","update:modelValue"],data(){return{localModelValue:this.modelValue}},watch:{modelValue(i){this.localModelValue=i},localModelValue(i,o){i!=this.modelValue&&(this.$emit("change",i),this.$emit("update:modelValue",i))}}};function Xn(i,o,n,d,s,a){const u=p("Select");return h(),S(u,{class:"w-full",modelValue:s.localModelValue,"onUpdate:modelValue":o[0]||(o[0]=m=>s.localModelValue=m),label:n.configSchemaEntity.label,options:n.configSchemaEntity.options,placeholder:n.configSchemaEntity.placeholder,description:n.configSchemaEntity.description,popoverContent:n.configSchemaEntity.description_info,secondaryLabel:n.configSchemaEntity.optional?"(optional)":null,externalLinkUrl:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.href:null,externalLinkName:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.label:null},null,8,["modelValue","label","options","placeholder","description","popoverContent","secondaryLabel","externalLinkUrl","externalLinkName"])}const Yn=T(Jn,[["render",Xn]]),Zn={components:{Input:te},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},emits:["change","update:modelValue"],data(){return{localModelValue:this.modelValue}},watch:{modelValue(i){this.localModelValue=i},localModelValue(i,o){i!=this.modelValue&&(this.$emit("change",i),this.$emit("update:modelValue",i))}}},Qn={class:"leading-4 text-gray-400 text-sm"};function $n(i,o,n,d,s,a){const u=p("Input");return h(),S(u,{type:"text",modelValue:s.localModelValue,"onUpdate:modelValue":o[0]||(o[0]=m=>s.localModelValue=m),label:n.configSchemaEntity.label,placeholder:n.configSchemaEntity.placeholder,description:n.configSchemaEntity.description,popoverContent:n.configSchemaEntity.description_info,secondaryLabel:n.configSchemaEntity.optional?"(optional)":null,externalLinkUrl:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.href:null,externalLinkName:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.label:null},{prefix:ve(()=>[M("span",Qn,G(n.configSchemaEntity.prefix),1)]),_:1},8,["modelValue","label","placeholder","description","popoverContent","secondaryLabel","externalLinkUrl","externalLinkName"])}const eo=T(Zn,[["render",$n]]),to={components:{ExternalLink:On},props:{configSchemaEntity:{type:Object}}},no={class:"space-x-1"},oo=["href"],ao={key:1,class:"text-xs"};function ro(i,o,n,d,s,a){const u=p("ExternalLink");return h(),V("div",no,[(h(!0),V(ee,null,ot(n.configSchemaEntity.content,(m,y)=>(h(),V(ee,{key:y},[m.text&&m.href?(h(),V("a",{key:0,target:"_blank",href:m.href,class:"text-xs text-blue-700 hover:underline hover:text-blue-90"},[Q(G(m.text)+" ",1),E(u,{size:"12",class:"inline-block ml-0.5 -mt-0.5"})],8,oo)):m.text?(h(),V("span",ao,G(m.text),1)):q("",!0)],64))),128))])}const io=T(to,[["render",ro]]),so={components:{SelectCurrency:Nn},props:{modelValue:{type:String},paymentMethod:{type:Object},configSchemaEntity:{type:Object}},emits:["change","update:modelValue"],data(){return{localModelValue:this.modelValue}},watch:{modelValue(i){this.localModelValue=i},localModelValue(i,o){i!=this.modelValue&&(this.$emit("change",i),this.$emit("update:modelValue",i))}}};function lo(i,o,n,d,s,a){const u=p("SelectCurrency");return h(),S(u,{clearable:!0,modelValue:s.localModelValue,"onUpdate:modelValue":o[0]||(o[0]=m=>s.localModelValue=m),label:n.configSchemaEntity.label,allowedCurrencies:n.paymentMethod.currencies,description:n.configSchemaEntity.description,popoverContent:n.configSchemaEntity.description_info,secondaryLabel:n.configSchemaEntity.optional?"(optional)":null,externalLinkUrl:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.href:null,externalLinkName:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.label:null},null,8,["modelValue","label","allowedCurrencies","description","popoverContent","secondaryLabel","externalLinkUrl","externalLinkName"])}const co=T(so,[["render",lo]]),mo={components:{Input:te},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},emits:["change","update:modelValue"],data(){return{localModelValue:this.modelValue}},watch:{modelValue(i){this.localModelValue=i},localModelValue(i,o){i!=this.modelValue&&(this.$emit("change",i),this.$emit("update:modelValue",i))}}};function ho(i,o,n,d,s,a){const u=p("Input");return h(),S(u,{type:"text",modelValue:s.localModelValue,"onUpdate:modelValue":o[0]||(o[0]=m=>s.localModelValue=m),label:n.configSchemaEntity.label,description:n.configSchemaEntity.description,popoverContent:n.configSchemaEntity.description_info,secondaryLabel:n.configSchemaEntity.optional?"(optional)":null,learn_moreLink:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.href:null,learn_moreLabel:n.configSchemaEntity.learn_more?n.configSchemaEntity.learn_more.label:null},null,8,["modelValue","label","description","popoverContent","secondaryLabel","learn_moreLink","learn_moreLabel"])}const uo=T(mo,[["render",ho]]);var $={exports:{}};$.exports;var nt;function fo(){return nt||(nt=1,function(i,o){var n=200,d="__lodash_hash_undefined__",s=9007199254740991,a="[object Arguments]",u="[object Array]",m="[object Boolean]",y="[object Date]",x="[object Error]",F="[object Function]",I="[object GeneratorFunction]",O="[object Map]",ne="[object Number]",W="[object Object]",oe="[object Promise]",ae="[object RegExp]",N="[object Set]",re="[object String]",K="[object Symbol]",D="[object WeakMap]",J="[object ArrayBuffer]",k="[object DataView]",X="[object Float32Array]",c="[object Float64Array]",ie="[object Int8Array]",g="[object Int16Array]",we="[object Int32Array]",Ce="[object Uint8Array]",Ee="[object Uint8ClampedArray]",Fe="[object Uint16Array]",Le="[object Uint32Array]",at=/[\\^$.*+?()[\]{}|]/g,rt=/\w*$/,it=/^\[object .+?Constructor\]$/,st=/^(?:0|[1-9]\d*)$/,f={};f[a]=f[u]=f[J]=f[k]=f[m]=f[y]=f[X]=f[c]=f[ie]=f[g]=f[we]=f[O]=f[ne]=f[W]=f[ae]=f[N]=f[re]=f[K]=f[Ce]=f[Ee]=f[Fe]=f[Le]=!0,f[x]=f[F]=f[D]=!1;var lt=typeof ue=="object"&&ue&&ue.Object===Object&&ue,dt=typeof self=="object"&&self&&self.Object===Object&&self,v=lt||dt||Function("return this")(),Te=o&&!o.nodeType&&o,Ie=Te&&!0&&i&&!i.nodeType&&i,ct=Ie&&Ie.exports===Te;function mt(e,t){return e.set(t[0],t[1]),e}function ht(e,t){return e.add(t),e}function ut(e,t){for(var r=-1,l=e?e.length:0;++r<l&&t(e[r],r,e)!==!1;);return e}function ft(e,t){for(var r=-1,l=t.length,_=e.length;++r<l;)e[_+r]=t[r];return e}function ke(e,t,r,l){for(var _=-1,b=e?e.length:0;++_<b;)r=t(r,e[_],_,e);return r}function yt(e,t){for(var r=-1,l=Array(e);++r<e;)l[r]=t(r);return l}function gt(e,t){return e==null?void 0:e[t]}function Ue(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function je(e){var t=-1,r=Array(e.size);return e.forEach(function(l,_){r[++t]=[_,l]}),r}function fe(e,t){return function(r){return e(t(r))}}function Ae(e){var t=-1,r=Array(e.size);return e.forEach(function(l){r[++t]=l}),r}var pt=Array.prototype,_t=Function.prototype,se=Object.prototype,ye=v["__core-js_shared__"],Oe=function(){var e=/[^.]+$/.exec(ye&&ye.keys&&ye.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ne=_t.toString,L=se.hasOwnProperty,le=se.toString,St=RegExp("^"+Ne.call(L).replace(at,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=ct?v.Buffer:void 0,Be=v.Symbol,He=v.Uint8Array,Mt=fe(Object.getPrototypeOf,Object),bt=Object.create,Pt=se.propertyIsEnumerable,Vt=pt.splice,Re=Object.getOwnPropertySymbols,xt=De?De.isBuffer:void 0,vt=fe(Object.keys,Object),ge=R(v,"DataView"),Y=R(v,"Map"),pe=R(v,"Promise"),_e=R(v,"Set"),Se=R(v,"WeakMap"),Z=R(Object,"create"),wt=A(ge),Ct=A(Y),Et=A(pe),Ft=A(_e),Lt=A(Se),ze=Be?Be.prototype:void 0,qe=ze?ze.valueOf:void 0;function U(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var l=e[t];this.set(l[0],l[1])}}function Tt(){this.__data__=Z?Z(null):{}}function It(e){return this.has(e)&&delete this.__data__[e]}function kt(e){var t=this.__data__;if(Z){var r=t[e];return r===d?void 0:r}return L.call(t,e)?t[e]:void 0}function Ut(e){var t=this.__data__;return Z?t[e]!==void 0:L.call(t,e)}function jt(e,t){var r=this.__data__;return r[e]=Z&&t===void 0?d:t,this}U.prototype.clear=Tt,U.prototype.delete=It,U.prototype.get=kt,U.prototype.has=Ut,U.prototype.set=jt;function w(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var l=e[t];this.set(l[0],l[1])}}function At(){this.__data__=[]}function Ot(e){var t=this.__data__,r=de(t,e);if(r<0)return!1;var l=t.length-1;return r==l?t.pop():Vt.call(t,r,1),!0}function Nt(e){var t=this.__data__,r=de(t,e);return r<0?void 0:t[r][1]}function Dt(e){return de(this.__data__,e)>-1}function Bt(e,t){var r=this.__data__,l=de(r,e);return l<0?r.push([e,t]):r[l][1]=t,this}w.prototype.clear=At,w.prototype.delete=Ot,w.prototype.get=Nt,w.prototype.has=Dt,w.prototype.set=Bt;function B(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var l=e[t];this.set(l[0],l[1])}}function Ht(){this.__data__={hash:new U,map:new(Y||w),string:new U}}function Rt(e){return ce(this,e).delete(e)}function zt(e){return ce(this,e).get(e)}function qt(e){return ce(this,e).has(e)}function Gt(e,t){return ce(this,e).set(e,t),this}B.prototype.clear=Ht,B.prototype.delete=Rt,B.prototype.get=zt,B.prototype.has=qt,B.prototype.set=Gt;function H(e){this.__data__=new w(e)}function Wt(){this.__data__=new w}function Kt(e){return this.__data__.delete(e)}function Jt(e){return this.__data__.get(e)}function Xt(e){return this.__data__.has(e)}function Yt(e,t){var r=this.__data__;if(r instanceof w){var l=r.__data__;if(!Y||l.length<n-1)return l.push([e,t]),this;r=this.__data__=new B(l)}return r.set(e,t),this}H.prototype.clear=Wt,H.prototype.delete=Kt,H.prototype.get=Jt,H.prototype.has=Xt,H.prototype.set=Yt;function Zt(e,t){var r=Pe(e)||Pn(e)?yt(e.length,String):[],l=r.length,_=!!l;for(var b in e)L.call(e,b)&&!(_&&(b=="length"||_n(b,l)))&&r.push(b);return r}function Ge(e,t,r){var l=e[t];(!(L.call(e,t)&&Xe(l,r))||r===void 0&&!(t in e))&&(e[t]=r)}function de(e,t){for(var r=e.length;r--;)if(Xe(e[r][0],t))return r;return-1}function Qt(e,t){return e&&We(t,Ve(t),e)}function Me(e,t,r,l,_,b,C){var P;if(l&&(P=b?l(e,_,b,C):l(e)),P!==void 0)return P;if(!me(e))return e;var Qe=Pe(e);if(Qe){if(P=yn(e),!t)return hn(e,P)}else{var z=j(e),$e=z==F||z==I;if(xn(e))return an(e,t);if(z==W||z==a||$e&&!b){if(Ue(e))return b?e:{};if(P=gn($e?{}:e),!t)return un(e,Qt(P,e))}else{if(!f[z])return b?e:{};P=pn(e,z,Me,t)}}C||(C=new H);var et=C.get(e);if(et)return et;if(C.set(e,P),!Qe)var tt=r?fn(e):Ve(e);return ut(tt||e,function(xe,he){tt&&(he=xe,xe=e[he]),Ge(P,he,Me(xe,t,r,l,he,e,C))}),P}function $t(e){return me(e)?bt(e):{}}function en(e,t,r){var l=t(e);return Pe(e)?l:ft(l,r(e))}function tn(e){return le.call(e)}function nn(e){if(!me(e)||Mn(e))return!1;var t=Ze(e)||Ue(e)?St:it;return t.test(A(e))}function on(e){if(!Je(e))return vt(e);var t=[];for(var r in Object(e))L.call(e,r)&&r!="constructor"&&t.push(r);return t}function an(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}function be(e){var t=new e.constructor(e.byteLength);return new He(t).set(new He(e)),t}function rn(e,t){var r=t?be(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}function sn(e,t,r){var l=t?r(je(e),!0):je(e);return ke(l,mt,new e.constructor)}function ln(e){var t=new e.constructor(e.source,rt.exec(e));return t.lastIndex=e.lastIndex,t}function dn(e,t,r){var l=t?r(Ae(e),!0):Ae(e);return ke(l,ht,new e.constructor)}function cn(e){return qe?Object(qe.call(e)):{}}function mn(e,t){var r=t?be(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function hn(e,t){var r=-1,l=e.length;for(t||(t=Array(l));++r<l;)t[r]=e[r];return t}function We(e,t,r,l){r||(r={});for(var _=-1,b=t.length;++_<b;){var C=t[_],P=void 0;Ge(r,C,P===void 0?e[C]:P)}return r}function un(e,t){return We(e,Ke(e),t)}function fn(e){return en(e,Ve,Ke)}function ce(e,t){var r=e.__data__;return Sn(t)?r[typeof t=="string"?"string":"hash"]:r.map}function R(e,t){var r=gt(e,t);return nn(r)?r:void 0}var Ke=Re?fe(Re,Object):Cn,j=tn;(ge&&j(new ge(new ArrayBuffer(1)))!=k||Y&&j(new Y)!=O||pe&&j(pe.resolve())!=oe||_e&&j(new _e)!=N||Se&&j(new Se)!=D)&&(j=function(e){var t=le.call(e),r=t==W?e.constructor:void 0,l=r?A(r):void 0;if(l)switch(l){case wt:return k;case Ct:return O;case Et:return oe;case Ft:return N;case Lt:return D}return t});function yn(e){var t=e.length,r=e.constructor(t);return t&&typeof e[0]=="string"&&L.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function gn(e){return typeof e.constructor=="function"&&!Je(e)?$t(Mt(e)):{}}function pn(e,t,r,l){var _=e.constructor;switch(t){case J:return be(e);case m:case y:return new _(+e);case k:return rn(e,l);case X:case c:case ie:case g:case we:case Ce:case Ee:case Fe:case Le:return mn(e,l);case O:return sn(e,l,r);case ne:case re:return new _(e);case ae:return ln(e);case N:return dn(e,l,r);case K:return cn(e)}}function _n(e,t){return t=t??s,!!t&&(typeof e=="number"||st.test(e))&&e>-1&&e%1==0&&e<t}function Sn(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Mn(e){return!!Oe&&Oe in e}function Je(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||se;return e===r}function A(e){if(e!=null){try{return Ne.call(e)}catch{}try{return e+""}catch{}}return""}function bn(e){return Me(e,!0,!0)}function Xe(e,t){return e===t||e!==e&&t!==t}function Pn(e){return Vn(e)&&L.call(e,"callee")&&(!Pt.call(e,"callee")||le.call(e)==a)}var Pe=Array.isArray;function Ye(e){return e!=null&&vn(e.length)&&!Ze(e)}function Vn(e){return wn(e)&&Ye(e)}var xn=xt||En;function Ze(e){var t=me(e)?le.call(e):"";return t==F||t==I}function vn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=s}function me(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function wn(e){return!!e&&typeof e=="object"}function Ve(e){return Ye(e)?Zt(e):on(e)}function Cn(){return[]}function En(){return!1}i.exports=bn}($,$.exports)),$.exports}fo();const yo={inject:["formState","storeState","storePaymentMethodState","changeHistoryState","notificationState"],components:{Info:Dn,Modal:Fn,Input:te,Switch:Ln,Button:Tn,Skeleton:In,EmailConfig:qn,ImageConfig:Kn,SelectConfig:Yn,StringConfig:eo,ContentConfig:io,CurrencyConfig:co,MobileNumberConfig:uo},data(){return{Trash2:Hn,MoveLeft:Bn,isLoadingPaymentMethod:!1}},watch:{store(i,o){!o&&i&&this.setup()}},computed:{store(){return this.storeState.store},isEditing(){return this.storePaymentMethodId!=null},isLoadingStore(){return this.storeState.isLoadingStore},paymentMethodId(){return this.$route.query.payment_method_id},storePaymentMethodId(){return this.$route.params.store_payment_method_id},paymentMethod(){return this.storePaymentMethodState.paymentMethod},storePaymentMethod(){return this.storePaymentMethodState.storePaymentMethod},storePaymentMethodForm(){return this.storePaymentMethodState.storePaymentMethodForm},isLoadingStorePaymentMethod(){return this.storePaymentMethodState.isLoadingStorePaymentMethod},isDeletingStorePaymentMethod(){return this.storePaymentMethodState.isDeletingStorePaymentMethod},getPaymentMethodFirstValidationError(){return this.storePaymentMethodState.getPaymentMethodFirstValidationError},checkIfPaymentMethodConfigSchemaEntityPassesCondition(){return this.storePaymentMethodState.checkIfPaymentMethodConfigSchemaEntityPassesCondition}},methods:{isEmpty:Un,capitalize:kn,setup(){this.storePaymentMethodState.setStorePaymentMethodForm(null,null,!0),this.store&&this.paymentMethodId&&this.showPaymentMethod(),this.store&&this.storePaymentMethodId&&this.showStorePaymentMethod()},setActionButtons(){this.changeHistoryState.removeButtons(),this.changeHistoryState.addDiscardButton(),this.changeHistoryState.addActionButton(this.isEditing?"Save Changes":"Add Payment Method",this.isEditing?this.updateStorePaymentMethod:this.createStorePaymentMethod,"primary",null)},async navigateToShowPaymentMethods(){await this.$router.push({name:"show-payment-methods",query:{store_id:this.store.id}})},async showPaymentMethod(){var i,o;try{this.isLoadingPaymentMethod=!0;let n={params:{store_id:this.store.id}};const s=(await axios.get(`/api/payment-methods/${this.paymentMethodId}`,n)).data;this.storePaymentMethodState.setPaymentMethod(s),this.storePaymentMethodState.setStorePaymentMethodForm(null,s,!0)}catch(n){const d=((o=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:o.message)||(n==null?void 0:n.message)||"Something went wrong while fetching payment method";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(n),console.error("Failed to fetch payment method:",n)}finally{this.isLoadingPaymentMethod=!1}},async showStorePaymentMethod(){var i,o;try{this.storePaymentMethodState.isLoadingStorePaymentMethod=!0;let n={params:{store_id:this.store.id,_relationships:["logo","photo","paymentMethod"].join(",")}};const s=(await axios.get(`/api/store-payment-methods/${this.storePaymentMethodId}`,n)).data,a=s.payment_method;this.storePaymentMethodState.setPaymentMethod(a),this.storePaymentMethodState.setStorePaymentMethod(s),this.storePaymentMethodState.setStorePaymentMethodForm(s,a,!0)}catch(n){const d=((o=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:o.message)||(n==null?void 0:n.message)||"Something went wrong while fetching store payment method";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(n),console.error("Failed to fetch store payment method:",n)}finally{this.storePaymentMethodState.isLoadingStorePaymentMethod=!1}},async createStorePaymentMethod(){var i,o;try{if(this.storePaymentMethodState.isCreatingStorePaymentMethod||(this.formState.hideFormErrors(),this.paymentMethod.type=="other"&&this.isEmpty(this.storePaymentMethodForm.custom_name)&&this.formState.setFormError("custom_name","The name is required"),this.formState.hasErrors))return;for(let a=0;a<this.paymentMethod.config_schema.length;a++){const u=this.paymentMethod.config_schema[a];if(this.checkIfPaymentMethodConfigSchemaEntityPassesCondition(u,this.storePaymentMethodForm.configs)){const m=this.getPaymentMethodFirstValidationError(u,this.storePaymentMethodForm.configs);if(m){this.notificationState.showWarningNotification(m);return}}}this.storePaymentMethodState.isCreatingStorePaymentMethod=!0,this.changeHistoryState.actionButtons[1].loading=!0;const n={payment_method_id:this.paymentMethod.id,...this.storePaymentMethodForm,store_id:this.store.id},s=(await axios.post("/api/store-payment-methods",n)).data.store_payment_method;this.storePaymentMethodState.setStorePaymentMethod(s),await this.uploadImages(),this.notificationState.showSuccessNotification("Payment method created"),this.storePaymentMethodState.saveOriginalState("Original payment method"),this.navigateToShowPaymentMethods()}catch(n){const d=((o=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:o.message)||(n==null?void 0:n.message)||"Something went wrong while creating payment method";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(n),console.error("Failed to create payment method:",n)}finally{this.storePaymentMethodState.isCreatingStorePaymentMethod=!1,this.changeHistoryState.actionButtons[1].loading=!1}},async updateStorePaymentMethod(){var i,o;try{if(this.storePaymentMethodState.isUpdatingStorePaymentMethod||(this.formState.hideFormErrors(),this.isEmpty(this.storePaymentMethodForm.custom_name)&&this.formState.setFormError("custom_name","The name is required"),this.formState.hasErrors))return;for(let a=0;a<this.paymentMethod.config_schema.length;a++){const u=this.paymentMethod.config_schema[a];if(this.checkIfPaymentMethodConfigSchemaEntityPassesCondition(u,this.storePaymentMethodForm.configs)){const m=this.getPaymentMethodFirstValidationError(u,this.storePaymentMethodForm.configs);if(m){this.notificationState.showWarningNotification(m);return}}}this.storePaymentMethodState.isUpdatingStorePaymentMethod=!0,this.changeHistoryState.actionButtons[1].loading=!0;const n={...this.storePaymentMethodForm,store_id:this.store.id},s=(await axios.put(`/api/store-payment-methods/${this.storePaymentMethodId}`,n)).data.store_payment_method;this.storePaymentMethodState.setStorePaymentMethod(s),await this.uploadImages(),this.notificationState.showSuccessNotification("Payment method updated"),this.storePaymentMethodState.saveOriginalState("Original payment method")}catch(n){const d=((o=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:o.message)||(n==null?void 0:n.message)||"Something went wrong while updating payment method";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(n),console.error("Failed to update payment method:",n)}finally{this.storePaymentMethodState.isUpdatingStorePaymentMethod=!1,this.changeHistoryState.actionButtons[1].loading=!1}},async deleteStorePaymentMethod(i){var o,n;try{if(this.storePaymentMethodState.isDeletingStorePaymentMethod)return;this.storePaymentMethodState.isDeletingStorePaymentMethod=!0;const d={data:{store_id:this.store.id}};await axios.delete(`/api/store-payment-methods/${this.storePaymentMethodId}`,d),i(),await new Promise(s=>setTimeout(s,500)),this.notificationState.showSuccessNotification("Payment method deleted"),await this.navigateToShowPaymentMethods()}catch(d){const s=((n=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:n.message)||(d==null?void 0:d.message)||"Something went wrong while deleting payment method";this.notificationState.showWarningNotification(s),this.formState.setServerFormErrors(d),console.error("Failed to delete payment method:",d),i()}finally{this.storePaymentMethodState.isDeletingStorePaymentMethod=!1}},async uploadImages(i=null){let o=this.paymentMethod.config_schema.filter(d=>d.type==="image").map(d=>this.storePaymentMethodForm.configs[d.attribute].length?[d.attribute,this.storePaymentMethodForm.configs[d.attribute][0]]:null).filter(d=>d!=null),n=[];for(let d=0;d<o.length;d++){let s=o[d][0],a=o[d][1];a.id==null&&a.uploading==!1&&(a.uploaded===null||a.uploaded===!1)&&(i==null||i==d)&&n.push(this.uploadSingleImage(s,a,d))}if(n.length===0){this.storePaymentMethodState.isUploading=!1;return}return this.storePaymentMethodState.isUploading=!0,Promise.allSettled(n).then(d=>{let s=d.filter(a=>a.status==="rejected").length;s>0&&this.notificationState.showWarningNotification(`⚠️ ${s} image(s) failed to upload. Try again or change the image.`),this.storePaymentMethodState.isUploading=!1})},async uploadSingleImage(i,o,n,d=0,s=null){var a,u,m;try{if(d>2)return console.log(`❌ Image ${n+1} permanently failed after 3 attempts.`),o.uploaded=!1,o.uploading=!1,o.error_message=((u=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:u.message)||(s==null?void 0:s.message)||"Upload failed",Promise.reject("Failed after 3 attempts");let y=new FormData;y.append("file",o.file_ref),y.append("store_id",this.store.id),y.append("mediable_type","store payment method"),y.append("mediable_id",this.storePaymentMethod.id),y.append("upload_folder_name",`store_payment_method_${i}`),o.uploading=!0,o.error_message=null;const x={headers:{"Content-Type":"multipart/form-data"}},F=await axios.post("/api/media-files",y,x),I=F.data.media_file;return o.uploaded=!0,o.uploading=!1,o.id=I.id,o.path=I.path,console.log(`✅ Image ${n+1} uploaded successfully.`),F}catch(y){return console.error(`⚠️ Image ${n+1} upload attempt ${d+1} failed.`,y),y.code==="ECONNABORTED"||((m=y.response)==null?void 0:m.status)===504?void 0:this.uploadSingleImage(i,o,n,d+1,y)}},async deletePaymentMethodImage(i,o){var n,d;try{if(i.configs[o].deleting)return;i.configs[o].deleting=!0;let s={data:{store_id:this.store.id}};await axios.delete(`/api/media-files/${i.configs[o].id}`,s),i.configs[o].path=null,i.configs[o].uploaded=!1,console.log(`✅ Successfully deleted ${o} for '${i.name}'`)}catch(s){const a=((d=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:d.message)||(s==null?void 0:s.message)||`Something went wrong while deleting ${i.name} ${o}`;this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(s),console.error(`Failed to delete ${o} for '${i.name}':`,s)}finally{i.configs[o].deleting=!1}},setStorePaymentMethodForm(i){this.storePaymentMethodState.storePaymentMethodForm=i}},beforeUnmount(){this.storePaymentMethodState.reset()},created(){this.setup(),this.setActionButtons();const i=["undo","redo","jumpToHistory","resetHistoryToCurrent","resetHistoryToOriginal"];for(let o=0;o<i.length;o++){let n=i[o];this.changeHistoryState.listeners[n]=this.setStorePaymentMethodForm}}},go={class:"max-w-2xl mx-auto pt-24 pb-40"},po={class:"bg-gray-50 border border-gray-300 rounded-lg p-4"},_o={class:"flex items-center justify-between border-b border-gray-200 border-dashed pb-4 mb-4"},So={key:1,class:"w-16 h-16 rounded-full overflow-hidden shadow"},Mo=["src"],bo={class:"space-y-2"},Po={key:7,class:"flex space-x-1 text-xs text-yellow-600 font-semibold bg-yellow-100 border border-yellow-300 p-3 rounded-lg shadow-md"},Vo={class:"border-t border-gray-200 border-dashed space-y-4 mt-4 pt-4"},xo={class:"space-y-2"},vo={class:"font-bold text-black"},wo={class:"flex justify-end"},Co={class:"mb-8"},Eo={class:"font-bold text-black"};function Fo(i,o,n,d,s,a){var K,D,J,k,X;const u=p("Button"),m=p("Skeleton"),y=p("Switch"),x=p("Input"),F=p("StringConfig"),I=p("MobileNumberConfig"),O=p("EmailConfig"),ne=p("SelectConfig"),W=p("CurrencyConfig"),oe=p("ImageConfig"),ae=p("ContentConfig"),N=p("Info"),re=p("Modal");return h(),V("div",go,[E(u,{size:"xs",type:"light",class:"mb-4",leftIcon:s.MoveLeft,action:a.navigateToShowPaymentMethods},{default:ve(()=>o[12]||(o[12]=[M("span",null,"Back",-1)])),_:1,__:[12]},8,["leftIcon","action"]),M("div",po,[M("div",_o,[a.isLoadingStore||a.isLoadingStorePaymentMethod||s.isLoadingPaymentMethod?(h(),S(m,{key:0,width:"w-16",height:"h-16",rounded:"rounded-full",shine:!0,class:"flex-shrink-0"})):(h(),V("div",So,[M("img",{alt:"Payment Method Logo",class:"h-full object-contain",src:((k=(J=(D=(K=a.storePaymentMethodForm)==null?void 0:K.configs)==null?void 0:D.logo)==null?void 0:J[0])==null?void 0:k.path)??a.paymentMethod.image_url},null,8,Mo)])),a.isLoadingStore||a.isLoadingStorePaymentMethod||s.isLoadingPaymentMethod?(h(),S(m,{key:2,width:"w-16",height:"h-4",rounded:"rounded-full",shine:!0,class:"flex-shrink-0"})):(h(),S(y,{key:3,size:"xs",prefixText:"Active",modelValue:a.storePaymentMethodForm.active,"onUpdate:modelValue":o[0]||(o[0]=c=>a.storePaymentMethodForm.active=c),errorText:a.formState.getFormError("active"),onChange:o[1]||(o[1]=c=>a.storePaymentMethodState.saveStateDebounced("Active status changed"))},null,8,["modelValue","errorText"]))]),M("div",bo,[E(x,{max:"40",type:"text",label:"Name",placeholder:((X=a.paymentMethod)==null?void 0:X.name)??"Name",modelValue:a.storePaymentMethodForm.custom_name,"onUpdate:modelValue":o[2]||(o[2]=c=>a.storePaymentMethodForm.custom_name=c),errorText:a.formState.getFormError("custom_name"),onInput:o[3]||(o[3]=c=>a.storePaymentMethodState.saveStateDebounced("Name changed")),skeleton:a.isLoadingStore||a.isLoadingStorePaymentMethod||s.isLoadingPaymentMethod},null,8,["placeholder","modelValue","errorText","skeleton"]),a.paymentMethod?(h(!0),V(ee,{key:0},ot(a.paymentMethod.config_schema,(c,ie)=>(h(),V(ee,{key:ie},[a.checkIfPaymentMethodConfigSchemaEntityPassesCondition(c,a.storePaymentMethodForm.configs)?(h(),V(ee,{key:0},[c.type=="string"?(h(),S(F,{key:0,configSchemaEntity:c,modelValue:a.storePaymentMethodForm.configs[c.attribute],"onUpdate:modelValue":g=>a.storePaymentMethodForm.configs[c.attribute]=g,onChange:g=>a.storePaymentMethodState.saveStateDebounced(`${a.capitalize(c.attribute)} changed`)},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue","onChange"])):c.type=="mobile_number"?(h(),S(I,{key:1,configSchemaEntity:c,modelValue:a.storePaymentMethodForm.configs[c.attribute],"onUpdate:modelValue":g=>a.storePaymentMethodForm.configs[c.attribute]=g,onChange:g=>a.storePaymentMethodState.saveStateDebounced(`${a.capitalize(c.attribute)} changed`)},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue","onChange"])):c.type=="email"?(h(),S(O,{key:2,configSchemaEntity:c,modelValue:a.storePaymentMethodForm.configs[c.attribute],"onUpdate:modelValue":g=>a.storePaymentMethodForm.configs[c.attribute]=g,onChange:g=>a.storePaymentMethodState.saveStateDebounced(`${a.capitalize(c.attribute)} changed`)},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue","onChange"])):c.type=="select"?(h(),S(ne,{key:3,configSchemaEntity:c,modelValue:a.storePaymentMethodForm.configs[c.attribute],"onUpdate:modelValue":g=>a.storePaymentMethodForm.configs[c.attribute]=g,onChange:g=>a.storePaymentMethodState.saveStateDebounced(`${a.capitalize(c.attribute)} changed`)},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue","onChange"])):c.type=="currency"?(h(),S(W,{key:4,paymentMethod:a.paymentMethod,configSchemaEntity:c,modelValue:a.storePaymentMethodForm.configs[c.attribute],"onUpdate:modelValue":g=>a.storePaymentMethodForm.configs[c.attribute]=g,onChange:g=>a.storePaymentMethodState.saveStateDebounced(`${a.capitalize(c.attribute)} changed`)},null,8,["paymentMethod","configSchemaEntity","modelValue","onUpdate:modelValue","onChange"])):c.type=="image"?(h(),S(oe,{key:5,uploadImages:a.uploadImages,configSchemaEntity:c,modelValue:a.storePaymentMethodForm.configs[c.attribute],"onUpdate:modelValue":g=>a.storePaymentMethodForm.configs[c.attribute]=g,onChange:g=>a.storePaymentMethodState.saveStateDebounced(`${a.capitalize(c.attribute)} changed`)},null,8,["uploadImages","configSchemaEntity","modelValue","onUpdate:modelValue","onChange"])):c.type=="content"?(h(),S(ae,{key:6,configSchemaEntity:c},null,8,["configSchemaEntity"])):q("",!0),a.getPaymentMethodFirstValidationError(c,a.storePaymentMethodForm.configs)?(h(),V("p",Po,[E(N,{size:"14",class:"shrink-0"}),M("span",null,G(a.getPaymentMethodFirstValidationError(c,a.storePaymentMethodForm.configs)),1)])):q("",!0)],64)):q("",!0)],64))),128)):q("",!0),M("div",Vo,[E(x,{rows:"2",type:"textarea",label:"Instruction",secondaryLabel:"(optional)",modelValue:a.storePaymentMethodForm.instruction,"onUpdate:modelValue":o[4]||(o[4]=c=>a.storePaymentMethodForm.instruction=c),errorText:a.formState.getFormError("instruction"),placeholder:"Provide your own instruction about how the customer must pay",onInput:o[5]||(o[5]=c=>a.storePaymentMethodState.saveStateDebounced("Instruction changed")),skeleton:a.isLoadingStore||a.isLoadingStorePaymentMethod||s.isLoadingPaymentMethod},null,8,["modelValue","errorText","skeleton"]),E(x,{type:"checkbox",inputLabel:"Require payment proof",modelValue:a.storePaymentMethodForm.require_proof_of_payment,"onUpdate:modelValue":o[6]||(o[6]=c=>a.storePaymentMethodForm.require_proof_of_payment=c),errorText:a.formState.getFormError("require_proof_of_payment"),onChange:o[7]||(o[7]=c=>a.storePaymentMethodState.saveStateDebounced("Require payment proof changed")),inputDescription:"To finalize the checkout, customers must upload a screenshot. This could be a receipt, bank transfer confirmation, or any other proof of payment."},null,8,["modelValue","errorText"]),E(x,{type:"checkbox",inputLabel:"Enable contact seller before payment",modelValue:a.storePaymentMethodForm.enable_contact_seller_before_payment,"onUpdate:modelValue":o[8]||(o[8]=c=>a.storePaymentMethodForm.enable_contact_seller_before_payment=c),errorText:a.formState.getFormError("enable_contact_seller_before_payment"),onChange:o[9]||(o[9]=c=>a.storePaymentMethodState.saveStateDebounced("Enable contact seller before payment changed")),inputDescription:"Enables skipping payment to message the seller, increasing inquiries but building trust and reducing cancellations."},null,8,["modelValue","errorText"]),E(x,{type:"checkbox",inputLabel:"Mark as paid upon customer confirmation",modelValue:a.storePaymentMethodForm.mark_as_paid_on_customer_confirmation,"onUpdate:modelValue":o[10]||(o[10]=c=>a.storePaymentMethodForm.mark_as_paid_on_customer_confirmation=c),errorText:a.formState.getFormError("mark_as_paid_on_customer_confirmation"),onChange:o[11]||(o[11]=c=>a.storePaymentMethodState.saveStateDebounced("Mark as paid upon customer confirmation changed")),inputDescription:"This will automatically update the payment status to 'Paid' once the customer confirms their payment. This feature is ideal if you trust your customers and wish to streamline the payment process."},null,8,["modelValue","errorText"])])])]),a.storePaymentMethod?(h(),V("div",{key:0,class:jn(["flex items-center justify-between space-x-4 overflow-hidden rounded-lg p-4 border mt-4",a.isLoadingStore||a.isLoadingStorePaymentMethod?"border-gray-300 bg-gray-50":"border-red-300 bg-red-50"])},[M("div",xo,[M("p",null,[o[13]||(o[13]=Q("Delete ")),M("span",vo,G(a.storePaymentMethod.custom_name),1),o[14]||(o[14]=Q("?"))])]),M("div",wo,[E(re,{triggerType:"danger",approveType:"danger",approveLeftIcon:s.Trash2,triggerText:"Delete Payment Method",approveText:"Delete Payment Method",approveAction:a.deleteStorePaymentMethod,triggerLoading:a.isDeletingStorePaymentMethod,approveLoading:a.isDeletingStorePaymentMethod},{content:ve(()=>[o[17]||(o[17]=M("p",{class:"text-lg font-bold border-b border-gray-300 border-dashed pb-4 mb-4"},"Confirm Delete",-1)),M("p",Co,[o[15]||(o[15]=Q("Are you sure you want to delete ")),M("span",Eo,G(a.storePaymentMethod.custom_name),1),o[16]||(o[16]=Q("?"))])]),_:1},8,["approveLeftIcon","approveAction","triggerLoading","approveLoading"])])],2)):q("",!0)])}const ea=T(yo,[["render",Fo]]);export{ea as default};
