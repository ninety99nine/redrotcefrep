import{P as V}from"./Pill-CKWNekmo.js";import{I as P}from"./Input-Ky0M0gBr.js";import{B as N}from"./Button-H5-4pReg.js";import{S as C}from"./Skeleton-BmfWv9Ad.js";import{S as z}from"./SelectCountry-CPsfeWcZ.js";import{a as q,i as B}from"./stringUtils-Bvzw0-oW.js";import{c,a as f,e as d,g as b,r as D,F as w,f as R,b as o,t as _,d as y,i as v,o as n,n as I}from"./app-C3gvvzwr.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as T}from"./move-left-B7kKQMR8.js";import{G as k}from"./globe-B4udILGN.js";import{C as F}from"./check-BLxk3Z5A.js";import{p as M}from"./parsePhoneNumber-DR0S47Bc.js";import"./Popover-CueE8CKU.js";import"./x-DysaB_8N.js";import"./createLucideIcon-DcEzUACP.js";import"./Copy-2MtTss3I.js";import"./ShineEffect-Bjy7l8nq.js";import"./refresh-ccw-CCOkutNK.js";import"./circle-check-Bpb6vmpJ.js";import"./circle-alert-jW_RoXi8.js";import"./Loader-CenJqq8u.js";import"./Select-DpnAowrL.js";const A={inject:["authState","formState","storeState","notificationState"],components:{Input:P,Button:N,Skeleton:C,SelectCountry:z,Pill:V,Check:F,Globe:k,MoveLeft:T},data(){return{Check:F,Globe:k,MoveLeft:T,searchTerm:null,searchResults:[],lastSearchTerm:null,selectedDomainIndex:null,isSearchingDomains:!1,isPurchasingDomain:!1,suggestionTlds:["com","net","org","ai"],viewMode:"search",selectedDomain:null,formData:{city:"",state:"",email:"",phone:"",country:"",address1:"",last_name:"",first_name:"",postal_code:""}}},watch:{searchTerm(h){h&&h!==this.lastSearchTerm&&this.searchDomains()}},computed:{user(){return this.authState.user},store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)}},methods:{isEmpty:B,isNotEmpty:q,async goBack(){this.viewMode==="search"?this.navigateToShowDomains():(this.viewMode="search",this.selectedDomain=null,this.selectedDomainIndex=null),await this.$router.push({name:"show-domains",query:{store_id:this.store.id}})},async navigateToShowDomains(){await this.$router.push({name:"show-domains",query:{store_id:this.store.id}})},async searchDomains(){var h,t;try{this.formState.hideFormErrors(),this.isSearchingDomains=!0,this.searchResults=[];const a=/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;if(!this.searchTerm||!a.test(this.searchTerm)){this.formState.setFormError("search","Please enter a valid domain name (e.g., example.com)."),this.isSearchingDomains=!1;return}const[,l,e]=this.searchTerm.match(/^([a-zA-Z0-9.-]+)\.([a-zA-Z]{2,})$/)||[];if(!l||!e){this.formState.setFormError("search","Invalid domain format."),this.isSearchingDomains=!1;return}const i=[this.searchTerm];this.suggestionTlds.forEach(s=>{s!==e&&i.push(`${l}.${s}`)}),this.searchResults=i.map(s=>({name:s,min_duration:1,renewal_price:0,regular_price:0,available:!1,is_premium:!1,purchasable:!1,registration_price:0,discount_percentage:0,is_loading_price:!0,is_loading_availability:!0}));const g=i.map(s=>{const[,,m]=s.match(/^([a-zA-Z0-9.-]+)\.([a-zA-Z]{2,})$/)||[];return{tld:m,promise:axios.post("/api/domains/search",{store_id:this.store.id,search:s}).catch(p=>({error:p}))}}),x=Array.from(new Set([e,...this.suggestionTlds])).map(s=>({tld:s,promise:axios.get("/api/domains/pricing",{params:{tld:s,store_id:this.store.id}}).catch(m=>({error:m}))}));g.forEach(({tld:s,promise:m})=>{m.then(p=>{p.error||!p.data.successful?(console.error(`Failed to search domain with TLD ${s}:`,p.error||p.data.message),this.updateDomain(s,{available:!1},"availability")):this.updateDomain(s,p.data.domains[0]||{},"availability")})}),x.forEach(({tld:s,promise:m})=>{m.then(p=>{p.error?(console.error(`Failed to fetch price for TLD ${s}:`,p.error),this.updateDomain(s,{},"pricing")):this.updateDomain(s,p.data,"pricing")})}),Promise.allSettled([...g.map(s=>s.promise),...x.map(s=>s.promise)]).then(()=>{this.isSearchingDomains=!1,this.searchResults.some(s=>s.available&&!s.purchasable)&&this.notificationState.showWarningNotification("Price unavailable for one or more domains. Please try again later or contact support."),this.lastSearchTerm=this.searchTerm})}catch(a){const l=((t=(h=a==null?void 0:a.response)==null?void 0:h.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Something went wrong while searching domains";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(a),console.error("Failed to search domains:",a),this.isSearchingDomains=!1}},updateDomain(h,t,a){this.searchResults=this.searchResults.map(l=>{if(!l.name.endsWith(`.${h}`))return l;const e={...l};return a==="availability"&&(e.is_loading_availability=!1,e.available=t.available||!1,e.is_premium=t.is_premium||!1,t.is_premium&&t.premium_price&&(e.registration_price=t.premium_price,e.discount_percentage=0,e.regular_price=0)),a==="pricing"&&(e.is_loading_price=!1,e.min_duration=t.min_duration||e.min_duration,e.renewal_price=t.renewal_price||e.renewal_price,e.regular_price=t.regular_price||e.regular_price,e.is_premium||(e.registration_price=t.price||e.registration_price,e.discount_percentage=t.discount_percentage||e.discount_percentage)),e.purchasable=e.available&&e.registration_price>0,e})},purchaseDomain(h,t){var a,l,e,i,g,u;this.selectedDomain=h,this.selectedDomainIndex=t,this.formState.hideFormErrors(),this.formData={email:this.user.email||"brandontabona@gmail.com",last_name:this.user.last_name||"Tabona",first_name:this.user.first_name||"Julian",phone:((a=this.user.mobile_number)==null?void 0:a.international)||"+26772882239",city:((l=this.store.address)==null?void 0:l.city)||"Gaborone",state:((e=this.store.address)==null?void 0:e.state)||"South-East",country:((i=this.store.address)==null?void 0:i.country)||"BW",address1:((g=this.store.address)==null?void 0:g.address_line)||"",postal_code:((u=this.store.address)==null?void 0:u.postal_code)||"00000"},this.viewMode="details"},async submitPurchase(){var h,t;try{this.formState.hideFormErrors();const l=["first_name","last_name","email","phone","address1","city","state","postal_code","country"].filter(s=>!this.formData[s]||this.isEmpty(this.formData[s]));if(l.length>0){l.forEach(s=>{this.formState.setFormError(s,`${s.replace("_"," ").replace(/\b\w/g,m=>m.toUpperCase())} is required`)}),this.notificationState.showWarningNotification("Please fill in all required fields.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.formData.email)){this.formState.setFormError("email","Please enter a valid email address"),this.notificationState.showWarningNotification("Please enter a valid email address.");return}const i=M(this.formData.phone);if(!i||!i.isValid()){this.formState.setFormError("phone","Please enter a valid phone number (e.g., +26772000001)"),this.notificationState.showWarningNotification("Please enter a valid phone number.");return}this.isPurchasingDomain=!0;const g={store_id:this.store.id,city:this.formData.city,state:this.formData.state,email:this.formData.email,phone:this.formData.phone,country:this.formData.country,address1:this.formData.address1,last_name:this.formData.last_name,first_name:this.formData.first_name,domain_name:this.selectedDomain.name,postal_code:this.formData.postal_code,domain_price:this.selectedDomain.registration_price},x=(await axios.post("/api/domains/purchase",g)).data.metadata.dpo_payment_url;window.location.href=x}catch(a){const l=((t=(h=a==null?void 0:a.response)==null?void 0:h.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Something went wrong while purchasing domain";this.notificationState.showWarningNotification(l),this.formState.setServerFormErrors(a),console.error("Failed to purchase domain:",a)}finally{this.isPurchasingDomain=!1}}}},L={class:"max-w-2xl mx-auto pt-24 pb-40"},W={key:0,class:"bg-gray-50 border border-gray-300 rounded-lg p-4 mb-4"},j={key:1,class:"space-y-3 mt-4"},Z={class:"flex justify-between items-center"},G={class:"text-sm font-bold"},O={class:"flex items-center space-x-4"},J={class:"flex items-center space-x-1"},H={class:"text-sm font-semibold text-right"},K={key:0,class:"text-sm"},Q={key:0},X={key:1,class:"text-xs"},Y={key:2,class:"text-xs text-gray-500 block"},$={key:2,class:"flex flex-col items-center justify-center bg-gradient-to-br from-indigo-50 to-purple-50 border border-gray-300 shadow-lg rounded-2xl py-16 px-8 space-y-6"},ee={class:"relative"},te={class:"bg-gradient-to-br from-white-50 to-indigo-50 text-indigo-500 rounded-full p-2"},re={key:3},se={class:"border border-blue-300 bg-blue-50 p-4 rounded-xl shadow mb-4"},ae={class:"flex justify-between items-center"},ie={class:"text-sm font-bold"},oe={class:"flex justify-between items-end space-x-4"},ne={class:"text-sm font-semibold text-right"},le={key:0,class:"text-2xl"},me={key:0},ce={key:1,class:"text-xs text-gray-700 block"},de={class:"bg-gray-50 border border-gray-300 rounded-lg p-6 space-y-4 mb-4"},ue={class:"grid grid-cols-2 gap-4"};function he(h,t,a,l,e,i){const g=D("Button"),u=D("Input"),x=D("Skeleton"),s=D("Check"),m=D("Pill"),p=D("Globe"),E=D("SelectCountry");return n(),c("div",L,[f(g,{size:"xs",type:"light",class:"mb-4",action:i.goBack,leftIcon:e.MoveLeft},{default:b(()=>t[11]||(t[11]=[o("span",null,"Back",-1)])),_:1,__:[11]},8,["action","leftIcon"]),e.viewMode==="search"?(n(),c("div",W,[f(u,{type:"search",class:"w-full",debounced:!0,modelValue:e.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=r=>e.searchTerm=r),label:"Search Domains",placeholder:"example.com",skeleton:i.isLoadingStore,onInput:t[1]||(t[1]=r=>e.isSearchingDomains=!0),errorText:i.formState.getFormError("search"),tooltipContent:"Enter a domain name (e.g., example.com) to check availability and pricing for it and related domains (e.g., .net, .org)."},null,8,["modelValue","skeleton","errorText"])])):d("",!0),e.viewMode==="search"&&e.searchResults.length?(n(),c("div",j,[(n(!0),c(w,null,R(e.searchResults,(r,S)=>(n(),c("div",{key:S,class:I([S===0?"bg-orange-50":"bg-white","p-4 shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-300 hover:shadow-lg"])},[o("div",Z,[o("span",G,_(r.name),1),o("div",O,[r.is_loading_availability?(n(),y(x,{key:0,width:"w-16",shine:!0})):(n(),y(m,{key:1,type:r.available?"success":"danger",size:"xs"},{default:b(()=>[o("div",J,[r.available?(n(),y(s,{key:0,size:"12"})):d("",!0),o("span",null,_(r.available?"Available":"Unavailable"),1)])]),_:2},1032,["type"])),r.available&&!r.is_premium&&r.discount_percentage>0?(n(),y(m,{key:2,size:"xs",type:"success"},{default:b(()=>[v(_(r.discount_percentage)+"% OFF ",1)]),_:2},1024)):d("",!0),r.is_loading_price?(n(),y(x,{key:3,width:"w-16",shine:!0})):r.available?(n(),c(w,{key:4},[r.is_premium?(n(),y(m,{key:0,type:"light",size:"xs"},{default:b(()=>t[12]||(t[12]=[v("Premium")])),_:1,__:[12]})):d("",!0),o("div",H,[r.registration_price>0?(n(),c("p",K,[v(" $"+_(r.registration_price.toFixed(2))+" ",1),r.min_duration>1?(n(),c("span",Q,"/"+_(r.min_duration)+"yr",1)):d("",!0)])):(n(),c("span",X,"Price unavailable")),r.renewal_price>0?(n(),c("span",Y," Renews at $"+_(r.renewal_price.toFixed(2))+"/yr ",1)):d("",!0)])],64)):d("",!0),r.available&&r.purchasable?(n(),y(g,{key:5,size:"xs",type:"primary",loading:e.selectedDomainIndex===S,action:()=>i.purchaseDomain(r,S),disabled:e.isPurchasingDomain&&e.selectedDomainIndex!==S},{default:b(()=>t[13]||(t[13]=[o("span",null,"Buy Now",-1)])),_:2,__:[13]},1032,["loading","action","disabled"])):d("",!0)])])],2))),128))])):e.viewMode==="search"&&i.hasSearchTerm&&!e.searchResults.length&&!e.isSearchingDomains?(n(),c("div",$,[o("div",ee,[o("div",te,[f(p,{size:"60"})]),t[14]||(t[14]=o("div",{class:"absolute inset-0 bg-indigo-300 opacity-20 rounded-full animate-ping"},null,-1))]),t[15]||(t[15]=o("div",{class:"text-center"},[o("h3",{class:"text-xl font-semibold text-gray-800"},"No Results Found"),o("span",{class:"text-sm text-gray-600 mt-2 block max-w-sm"}," The domain could not be checked. Please ensure the domain name is valid (e.g., example.com) and try again. ")],-1))])):d("",!0),e.viewMode==="details"?(n(),c("div",re,[o("div",se,[o("div",ae,[o("span",ie,_(e.selectedDomain.name),1),o("div",oe,[e.selectedDomain.is_premium?(n(),y(m,{key:0,type:"primary",size:"xs",class:"mt-1"},{default:b(()=>t[16]||(t[16]=[v("Premium")])),_:1,__:[16]})):d("",!0),e.selectedDomain.available&&!e.selectedDomain.is_premium&&e.selectedDomain.discount_percentage>0?(n(),y(m,{key:1,size:"xs",type:"success"},{default:b(()=>[v(_(e.selectedDomain.discount_percentage)+"% OFF ",1)]),_:1})):d("",!0),o("div",ne,[e.selectedDomain.registration_price>0?(n(),c("p",le,[v(" $"+_(e.selectedDomain.registration_price.toFixed(2))+" ",1),e.selectedDomain.min_duration>1?(n(),c("span",me,"/"+_(e.selectedDomain.min_duration)+"yr",1)):d("",!0)])):d("",!0),e.selectedDomain.renewal_price>0?(n(),c("span",ce," Renews at $"+_(e.selectedDomain.renewal_price.toFixed(2))+"/yr ",1)):d("",!0)])])])]),o("div",de,[t[17]||(t[17]=o("div",{class:"border-b border-gray-300 border-dashed pb-4"},[o("h3",{class:"text-lg font-semibold text-gray-800"},"Domain Owner"),o("h3",{class:"text-sm text-gray-500"},"Provide details that make you the legal owner for this domain")],-1)),o("div",ue,[f(u,{required:"",type:"text",label:"First Name",placeholder:"John",modelValue:e.formData.first_name,"onUpdate:modelValue":t[2]||(t[2]=r=>e.formData.first_name=r),errorText:i.formState.getFormError("first_name")},null,8,["modelValue","errorText"]),f(u,{required:"",type:"text",label:"Last Name",placeholder:"Doe",modelValue:e.formData.last_name,"onUpdate:modelValue":t[3]||(t[3]=r=>e.formData.last_name=r),errorText:i.formState.getFormError("last_name")},null,8,["modelValue","errorText"]),f(u,{required:"",type:"email",label:"Email",modelValue:e.formData.email,"onUpdate:modelValue":t[4]||(t[4]=r=>e.formData.email=r),errorText:i.formState.getFormError("email"),placeholder:"johndoe@example.com"},null,8,["modelValue","errorText"]),f(u,{required:"",type:"text",label:"Phone",modelValue:e.formData.phone,"onUpdate:modelValue":t[5]||(t[5]=r=>e.formData.phone=r),placeholder:"+26772000001",errorText:i.formState.getFormError("phone")},null,8,["modelValue","errorText"]),f(u,{required:"",type:"text",label:"Address",placeholder:"123 Main St",modelValue:e.formData.address1,"onUpdate:modelValue":t[6]||(t[6]=r=>e.formData.address1=r),errorText:i.formState.getFormError("address1")},null,8,["modelValue","errorText"]),f(u,{required:"",type:"text",label:"City",modelValue:e.formData.city,"onUpdate:modelValue":t[7]||(t[7]=r=>e.formData.city=r),placeholder:"Los Angeles",errorText:i.formState.getFormError("city")},null,8,["modelValue","errorText"]),f(u,{required:"",type:"text",placeholder:"CA",label:"State/Province",modelValue:e.formData.state,"onUpdate:modelValue":t[8]||(t[8]=r=>e.formData.state=r),errorText:i.formState.getFormError("state")},null,8,["modelValue","errorText"]),f(u,{required:"",type:"text",label:"Postal Code",placeholder:"90210",modelValue:e.formData.postal_code,"onUpdate:modelValue":t[9]||(t[9]=r=>e.formData.postal_code=r),errorText:i.formState.getFormError("postal_code")},null,8,["modelValue","errorText"]),f(E,{required:"",label:"Country",modelValue:e.formData.country,"onUpdate:modelValue":t[10]||(t[10]=r=>e.formData.country=r),errorText:i.formState.getFormError("country")},null,8,["modelValue","errorText"])])]),f(g,{size:"lg",type:"primary",buttonClass:"w-full",action:i.submitPurchase,loading:e.isPurchasingDomain,disabled:e.isPurchasingDomain},{default:b(()=>t[18]||(t[18]=[o("span",null,"Buy Domain",-1)])),_:1,__:[18]},8,["action","loading","disabled"])])):d("",!0)])}const Re=U(A,[["render",he]]);export{Re as default};
