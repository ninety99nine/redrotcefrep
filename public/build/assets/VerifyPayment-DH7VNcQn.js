import{B as T}from"./Button-Dy6BYOYD.js";import{L as F}from"./Loader-j3Xd9R0O.js";import{P as R}from"./Popover-DUH2qEVS.js";import{c as m,b as a,e as r,a as p,d as y,n as f,t as l,F as g,f as z,g as u,x as _,p as I,r as d,o as i}from"./app-CAsQYp3T.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as B}from"./circle-check-Coc-yKcS.js";import{C as N}from"./circle-alert-BwdAp8OB.js";import{C as x}from"./credit-card-Cz-_xhD7.js";import{C as E}from"./clock-CR3FSS5s.js";import{R as j}from"./refresh-ccw-D7oBzLST.js";import{M as D}from"./move-right-CrSsxVsl.js";import"./ShineEffect-DjmscYxr.js";import"./createLucideIcon-Dd5tvPb0.js";const H={inject:["formState","storeState","notificationState"],components:{Button:T,Loader:F,Popover:R,Clock:E,CreditCard:x,CircleAlert:N,CircleCheck:B},data(){return{MoveRight:D,CreditCard:x,RefreshCcw:j,isPastDate:_,formattedDatetime:I,transaction:null,isVerifyingPayment:!1,isLoadingTransaction:!1,isRenewTransactionPaymentLink:!1}},watch:{store:{handler:async function(o){o&&(await this.showTransaction(),this.verifyPricingPlanPayment())}}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},pricingPlan(){return this.transaction.owner},isPaid(){return this.transaction.payment_status=="paid"},isFailedPayment(){return this.transaction.payment_status=="failed payment"},isPendingPayment(){return this.transaction.payment_status=="pending payment"},dpoPaymentUrl(){return this.transaction.metadata.dpo_payment_url},dpoPaymentLinkHasExpired(){return _(this.transaction.metadata.dpo_payment_url_expires_at)}},methods:{navigateToStoreHome(){this.$router.push({name:"show-store-home",params:{store_id:this.store.id}})},async showTransaction(){var o,s;try{this.isLoadingTransaction=!0;const t=this.$route.query.transaction_id;let c={params:{store_id:this.store.id,_relationships:["owner"].join(",")}};const e=await axios.get(`/api/transactions/${t}`,c);this.transaction=e.data}catch(t){const c=((s=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:s.message)||(t==null?void 0:t.message)||"Something went wrong while fetching transaction";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to fetch transaction:",t)}finally{this.isLoadingTransaction=!1}},makePayment(){this.isRenewTransactionPaymentLink||(this.dpoPaymentLinkHasExpired?this.renewTransactionPaymentLink():(this.isRenewTransactionPaymentLink=!0,window.location.assign(this.dpoPaymentUrl)))},async renewTransactionPaymentLink(){var o,s;try{this.isRenewTransactionPaymentLink=!0;let t={store_id:this.store.id};const e=(await axios.post(`/api/transactions/${this.transaction.id}/renew`,t)).data;window.location.href=e.metadata.dpo_payment_url}catch(t){const c=((s=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:s.message)||(t==null?void 0:t.message)||"Something went wrong while renewing payment link";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to renew payment link:",t)}finally{this.isRenewTransactionPaymentLink=!1}},async verifyPricingPlanPayment(){var o,s;try{this.isVerifyingPayment=!0;const t=this.$route.query.transaction_id;let c={store_id:this.store.id};const e=await axios.post(`/api/pricing-plans/verify-payment/${t}`,c);this.notificationState.showSuccessNotification("Payment verified!"),this.transaction=e.data}catch(t){const c=((s=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:s.message)||(t==null?void 0:t.message)||"Something went wrong while verifying payment";this.notificationState.showWarningNotification(c),this.formState.setServerFormErrors(t),console.error("Failed to verify payment:",t)}finally{this.isVerifyingPayment=!1}}}},M={class:"min-h-screen relative"},W={class:"z-10 pt-32 px-20 relative"},A={key:0,class:"flex flex-col items-center"},q={class:"flex justify-center items-center space-x-2 text-xl text-gray-700 font-semibold mb-4"},U={key:1,class:"flex flex-col items-center justify-center space-y-4 mb-8"},G={class:"flex items-center space-x-2 mb-2"},O={key:0,class:"text-red-600 p-4 bg-red-50 border border-red-300 rounded-lg mb-4"},J={class:"text-sm font-semibold mb-2"},K={key:0,class:"text-xs"},Q={key:1,class:"bg-gray-50 border p-4 rounded-lg mb-4"},X={class:"text-gray-600 text-xs"},Y={class:"flex items-center space-x-2 text-xs mb-2"},Z={class:"text-gray-400"},$={class:"flex items-center space-x-2 text-xs"},tt={class:"text-gray-400"};function et(o,s,t,c,e,n){const w=d("CreditCard"),k=d("Loader"),C=d("CircleCheck"),b=d("Clock"),v=d("CircleAlert"),h=d("Button"),P=d("Popover");return i(),m("div",M,[a("div",W,[e.isLoadingTransaction||e.isVerifyingPayment?(i(),m("div",A,[a("h1",q,[p(w,{size:"24"}),s[0]||(s[0]=a("span",null,"Verifying Payment",-1))]),s[1]||(s[1]=a("p",{class:"w-96 text-sm text-gray-600 text-center mb-8"},"One moment, We are verifying your payment",-1)),p(k,{class:"mb-8"})])):r("",!0),s[5]||(s[5]=a("div",{class:"flex justify-center mb-8"},[a("img",{src:"/images/store-rooftop.png",class:"w-96"})],-1)),e.transaction?(i(),m("div",U,[a("div",{class:f([{"animated-border-green":n.isPaid},{"animated-border-red":n.isFailedPayment},{"animated-border-cyan":n.isPendingPayment},"w-96 bg-white py-4 px-4 shadow-sm rounded-xl"])},[a("div",G,[n.isPaid?(i(),y(C,{key:0,size:"28",class:"text-green-600"})):r("",!0),n.isPendingPayment?(i(),y(b,{key:1,size:"28",class:"text-yellow-600"})):r("",!0),n.isFailedPayment?(i(),y(v,{key:2,size:"28",class:"text-red-600"})):r("",!0),a("h1",{class:f([{"text-green-600":n.isPaid},{"text-red-600":n.isFailedPayment},{"text-yellow-600":n.isPendingPayment},"capitalize text-xl font-bold"])},l(e.transaction.payment_status),3)]),a("h2",{class:f([{"text-green-600":n.isPaid},{"text-red-600":n.isFailedPayment},{"text-yellow-600":n.isPendingPayment},"text-sm mb-4"])},l(e.transaction.description),3),a("h2",{class:f([{"text-green-600":n.isPaid},{"text-red-600":n.isFailedPayment},{"text-yellow-600":n.isPendingPayment},"text-3xl text-gray-700 font-bold space-x-1 mb-4"])},[a("span",null,l(e.transaction.amount.amount_with_currency),1)],2),n.isFailedPayment?(i(),m("div",O,[a("p",J,l(e.transaction.failure_type??"Failure Reason"),1),e.transaction.failure_reason?(i(),m("p",K,l(e.transaction.failure_reason),1)):r("",!0)])):r("",!0),e.transaction.owner.features.length?(i(),m("div",Q,[(i(!0),m(g,null,z(e.transaction.owner.features,(S,L)=>(i(),m("div",{key:L},[a("span",X,l(S),1)]))),128))])):r("",!0),e.isVerifyingPayment?r("",!0):(i(),m(g,{key:2},[n.isPendingPayment?(i(),y(h,{key:0,size:"sm",type:"primary",action:n.makePayment,leftIcon:e.CreditCard,buttonClass:"w-full mb-4",loading:e.isRenewTransactionPaymentLink},{default:u(()=>[...s[2]||(s[2]=[a("span",null,"Make Payment",-1)])]),_:1},8,["action","leftIcon","loading"])):r("",!0),n.isFailedPayment?(i(),y(h,{key:1,size:"sm",type:"primary",action:n.makePayment,leftIcon:e.RefreshCcw,buttonClass:"w-full mb-4",loading:e.isRenewTransactionPaymentLink},{default:u(()=>[...s[3]||(s[3]=[a("span",null,"Retry Payment",-1)])]),_:1},8,["action","leftIcon","loading"])):r("",!0),n.isPaid?(i(),m(g,{key:2},[a("div",Y,[a("span",Z,l(e.formattedDatetime(e.transaction.created_at)),1),p(P,{content:"This is the transaction date",placement:"top"})]),a("div",$,[a("span",tt,l(e.transaction.id),1),p(P,{content:"This is the transaction ID",placement:"top"})])],64)):r("",!0)],64))],2),n.store?(i(),y(h,{key:0,size:"md",buttonClass:"w-96",rightIconSize:"28",rightIcon:e.MoveRight,action:n.navigateToStoreHome,type:n.isPaid?"primary":"light"},{default:u(()=>[...s[4]||(s[4]=[a("span",{class:"mr-2"},"Go Home",-1)])]),_:1},8,["rightIcon","action","type"])):r("",!0)])):r("",!0)]),s[6]||(s[6]=a("img",{src:"/images/clouds.png",class:"absolute top-32"},null,-1))])}const ht=V(H,[["render",et]]);export{ht as default};
