import{c as h,b as r,a as m,d as p,e as g,w as v,F as k,f as E,t as l,g as f,h as F,r as n,o as a,i as b}from"./app-9D_Cw4s4.js";import{P as V}from"./Pill-BFJX92pa.js";import{L}from"./Logo-CC6t2j6Y.js";import{I as T}from"./Input-CaqG3UNa.js";import{B}from"./Button-enl4NEGy.js";import{i as N}from"./stringUtils-Bvzw0-oW.js";import{S as I}from"./StoreLogo-BlTZERCk.js";import{S as C}from"./SocialLinks-B_luMDsA.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{H as j}from"./house-Dc5rO9nA.js";import"./Popover-BYwxVx0y.js";import"./Tooltip-DBg9S1F5.js";import"./Copy-TLmCwI7a.js";import"./ShineEffect-CCEGWZwA.js";import"./createLucideIcon-BjPl0ua2.js";import"./Skeleton-ChnWfFmK.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-sY-Ia2Cp.js";import"./circle-check-gsRbbAn8.js";import"./circle-alert-BncYZhnp.js";import"./x-ByYxaui0.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Loader-BJ_yFh5a.js";import"./plus-BPwoMIzT.js";import"./trash-2-BO5hz549.js";const z={name:"Login",components:{Pill:V,Logo:L,Input:T,Button:B,StoreLogo:I,SocialLinks:C},inject:["authState","formState","storeState","notificationState"],data(){return{House:j,form:{email:"",password:"",type:"email",mobile_number:""},loginTypes:[{label:"Email",value:"email"},{label:"Mobile Number",value:"mobile_number"}],loading:!1,currentYear:new Date().getFullYear(),appName:"Perfect Order"}},computed:{store(){return this.storeState.store}},methods:{isEmpty:N,navigateToStorefront(){this.$router.push({name:"show-storefront",params:{alias:this.store.alias}})},async submit(){var d,e;if(!this.loading&&(this.formState.hideFormErrors(),this.form.type=="email"&&this.isEmpty(this.form.email)?this.formState.setFormError("email","Enter your email"):this.form.type=="mobile_number"&&this.isEmpty(this.form.mobile_number)?this.formState.setFormError("mobile_number","Enter your mobile number"):this.isEmpty(this.form.password)&&this.formState.setFormError("password","Enter your password"),!this.formState.hasErrors)){this.loading=!0;try{const s=await F.post("/api/auth/login",this.form),u=s.data.user,t=s.data.token;await this.authState.setUser(u),this.authState.setTokenOnRequest(t),this.authState.setTokenOnLocalStorage(t);const o=this.$route.query.redirect;o?this.$router.push(o):this.$router.push({name:"show-store-home",params:{store_id:this.store.id}})}catch(s){const u=((e=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:e.message)||(s==null?void 0:s.message)||"Something went wrong while signing in";this.notificationState.showWarningNotification(u),this.formState.setServerFormErrors(s),console.error("Failed to sign in:",s)}finally{this.loading=!1}}}}},U={class:"min-h-screen transition-opacity opacity-100 duration-750 lg:grow starting:opacity-0"},H={class:"flex items-center justify-center py-6 bg-linear-to-b from-blue-100 to-white-100"},O={class:"w-full max-w-md"},Y={class:"flex justify-center mb-4"},q={class:"bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6"},D={class:"flex items-center justify-between mb-4"},M={class:"flex space-x-2"},A={key:2,class:"text-red-500 text-sm mb-3"},R={class:"ml-1"},W={class:"text-sm text-center mb-4"},G={class:"text-sm text-center text-gray-500 mb-16"};function J(d,e,s,u,t,o){const S=n("StoreLogo"),y=n("Button"),x=n("Pill"),c=n("Input"),_=n("router-link"),w=n("SocialLinks");return a(),h("div",U,[r("div",H,[r("div",O,[r("div",Y,[m(S,{size:"w-20 h-20",editable:!1,showButton:!1})]),r("div",q,[r("div",D,[e[4]||(e[4]=r("h1",{class:"text-2xl font-semibold leading-none tracking-tight"},"Sign in",-1)),o.store?(a(),p(y,{key:0,size:"md",type:"bare",leftIconSize:"24",leftIcon:t.House,action:o.navigateToStorefront},null,8,["leftIcon","action"])):g("",!0)]),e[8]||(e[8]=r("h1",{class:"text-sm text-gray-500 mb-4"},"Pick how you would like to sign in",-1)),r("form",{onSubmit:e[3]||(e[3]=v((...i)=>o.submit&&o.submit(...i),["prevent"])),class:"space-y-4 mb-4"},[r("div",M,[(a(!0),h(k,null,E(t.loginTypes,i=>(a(),p(x,{type:t.form.type===i.value?"primary":"light",action:()=>t.form.type=i.value,key:i.value},{default:f(()=>[b(l(i.label),1)]),_:2},1032,["type","action"]))),128))]),t.form.type=="email"?(a(),p(c,{key:0,type:"email",modelValue:t.form.email,"onUpdate:modelValue":e[0]||(e[0]=i=>t.form.email=i),placeholder:"john@gmail.com",errorText:o.formState.getFormError("email")},null,8,["modelValue","errorText"])):t.form.type=="mobile_number"?(a(),p(c,{key:1,type:"text",placeholder:"+26772000001",modelValue:t.form.mobile_number,"onUpdate:modelValue":e[1]||(e[1]=i=>t.form.mobile_number=i),errorText:o.formState.getFormError("mobile_number")},null,8,["modelValue","errorText"])):g("",!0),m(c,{type:"password",modelValue:t.form.password,"onUpdate:modelValue":e[2]||(e[2]=i=>t.form.password=i),placeholder:"******",errorText:o.formState.getFormError("password")},null,8,["modelValue","errorText"]),o.formState.generalErrorText?(a(),h("div",A,l(o.formState.generalErrorText),1)):g("",!0),m(y,{size:"md",type:"primary",action:o.submit,buttonClass:"w-full"},{default:f(()=>[r("span",R,l(t.loading?"Signing in...":"Continue"),1)]),_:1},8,["action"]),r("div",W,[m(_,{to:{name:"register"},class:"text-blue-600 hover:underline"},{default:f(()=>[...e[5]||(e[5]=[b("Create account",-1)])]),_:1}),e[7]||(e[7]=r("span",{class:"text-gray-300 mx-4"},"|",-1)),m(_,{to:{name:"forgot-password"},class:"text-blue-600 hover:underline"},{default:f(()=>[...e[6]||(e[6]=[b("Forgot password?",-1)])]),_:1})])],32),m(w)]),r("p",G,"Â© "+l(t.currentYear)+" "+l(t.appName)+". All rights reserved.",1)])])])}const Se=P(z,[["render",J]]);export{Se as default};
