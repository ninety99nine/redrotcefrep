import{c as u,b as a,a as m,g as p,r as w,h as C,o as d,F as y,f as _,n as T,e as c,w as F,d as U,t as S,i as E}from"./app-BS747Cvj.js";import{i as V}from"./isEqual-D4F7LSaO.js";import{I as P}from"./Input-ChopJmt9.js";import{M as A}from"./Modal-DFgbUQSx.js";import{L as M}from"./Loader-DjOVE8lE.js";import{B as N}from"./Button-DwrvLHoq.js";import{D as L}from"./Dropdown-Dnn4WUjp.js";import{T as B}from"./Table-Bb59c2UX.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as I}from"./Popover-RWMt7bQF.js";import{T as H}from"./trash-2-sbHw9UGk.js";import{P as j}from"./plus-BctgH_yG.js";import"./cloneDeep-DTO5MgNn.js";import"./Copy-CF04rHR8.js";import"./ShineEffect-BJBuBPSg.js";import"./createLucideIcon-48nG323g.js";import"./Skeleton-CTU87mWK.js";import"./Pill-CDGvVlRG.js";import"./Select-oImkjFwu.js";import"./Paginator-BKz7MJWa.js";import"./SelectCountry-DCiHCdqE.js";import"./Datepicker-DaxBmykV.js";import"./chevron-up-BbuZ3xfe.js";import"./Switch-C7NpZjIx.js";import"./vue-draggable-next.esm-bundler-D5YB87j-.js";import"./move-CbjHNjVC.js";import"./rotate-ccw-DNPxJp3z.js";const O={inject:["formState","customerState","storeState","changeHistoryState","notificationState"],components:{Input:P,Modal:A,Loader:M,Button:N,Dropdown:L,Table:B},data(){return{Plus:j,Trash2:H,RefreshCcw:I,notes:null,perPage:"15",checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,latestRequestId:0,filterExpressions:[],sortingExpressions:[],isDeletingProducIds:[],deletableCustomer:null,cancelTokenSource:null,isLoadingCustomers:!1,isUpdatingCustomers:!1,columns:this.prepareColumns(),includeCustomerFieldNames:!0,bulkSelectionOptions:[{label:"Add Customer Notes",action:this.showUpdateCustomersModal},{label:"Delete",action:this.showDeleteCustomersModal}]}},watch:{store(o,t){!t&&o&&this.showCustomers()},selectAll(o){this.checkedRows=this.customerForms.reduce((t,r)=>(t[r.id]=o,t),{})}},computed:{store(){return this.storeState.store},hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""},isDeletingCustomers(){return this.isDeletingProducIds.length>0},totalCheckedRows(){return Object.values(this.checkedRows).filter(o=>o).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0},customerForms(){return this.customerState.customerForms}},methods:{prepareColumns(){const o=["First Name","Last Name","Mobile","Email","Birthday","Notes","Referral Code"],t=["First Name","Last Name","Mobile","Email","Birthday","Notes","Referral Code"];return o.map(r=>({name:r,active:t.includes(r),priority:t.includes(r)}))},showDeleteCustomersModal(){this.$refs.actionDropdown.hideDropdown(),this.$refs.deleteCustomersModal.showModal()},showUpdateCustomersModal(){this.$refs.actionDropdown.hideDropdown(),this.$refs.updateCustomersModal.showModal()},showDeleteConfirmationModal(o){this.deletableCustomer=o,this.$refs.deleteCustomerModal.showModal()},isDeletingCustomer(o){return o==null?!1:this.isDeletingProducIds.findIndex(t=>t==o.id)!=-1},onView(o){this.$router.push({name:"edit-customer",params:{customer_id:o.id},query:{store_id:this.store.id,searchTerm:this.searchTerm,filterExpressions:this.filterExpressions.join("|"),sortingExpressions:this.sortingExpressions.join("|")}})},onAddCustomer(){this.$router.push({name:"create-customer",query:{store_id:this.store.id}})},captureChange(o,t){this.customerForms[o].modified=!0,this.customerState.saveStateDebounced(t)},paginate(o){this.showCustomers(o)},search(o){this.searchTerm=o,this.showCustomers()},updatedColumns(o){this.columns=o},updatedFilters(o){const t=o.map(r=>r.expression);V(this.filterExpressions,t)||(this.filterExpressions=t,this.showCustomers())},updatedSorting(o){const t=o.map(r=>r.expression);V(this.sortingExpressions,t)||(this.sortingExpressions=t,this.showCustomers())},updatedPerPage(o){this.perPage=o,this.showCustomers()},async showCustomers(o=1){var r,n;const t=++this.latestRequestId;try{this.isLoadingCustomers=!0,this.cancelTokenSource&&this.cancelTokenSource.cancel("Request superseded by a newer one"),this.cancelTokenSource=C.CancelToken.source();let s={params:{page:o,per_page:this.perPage,store_id:this.store.id},cancelToken:this.cancelTokenSource.token};this.hasSearchTerm&&(s.params.search=this.searchTerm),this.hasFilterExpressions&&(s.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(s.params._sort=this.sortingExpressions.join("|"));const e=await C.get("/api/customers",s);if(t!==this.latestRequestId)return;this.pagination=e.data;const b=this.pagination.data;this.customerState.setCustomerForms(b),this.checkedRows=this.customerForms.reduce((x,h)=>(x[h.id]=!1,x),{})}catch(s){if(C.isCancel(s)||t!==this.latestRequestId)return;const e=((n=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"Something went wrong while fetching customers";this.notificationState.showWarningNotification(e),this.formState.setServerFormErrors(s),console.error("Failed to fetch customers:",s)}finally{if(t!==this.latestRequestId)return;this.isLoadingCustomers=!1,this.cancelTokenSource=null}},async updateCustomers(o=null){var t,r;try{if(this.isUpdatingCustomers)return;const n={store_id:this.store.id};o==null?n.customers=this.customerForms.filter(e=>e.modified):n.customers=this.customerForms.filter(e=>this.checkedRows[e.id]).map(e=>({id:e.id})),o=="notes"&&(n.notes=this.notes),n.customers.length>0&&(this.isUpdatingCustomers=!0,await C.put("/api/customers",n),this.showCustomers(),this.notificationState.showSuccessNotification("Customers updated")),n.customers.forEach(e=>{this.checkedRows[e.id]!==void 0&&(this.checkedRows[e.id]=!1)}),this.selectAll=!1}catch(n){const s=((r=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:r.message)||(n==null?void 0:n.message)||"Something went wrong while updating customer";this.notificationState.showWarningNotification(s),this.formState.setServerFormErrors(n),console.error("Failed to update customer:",n)}finally{this.isUpdatingCustomers=!1,this.$refs.updateCustomersModal.hideModal()}},async deleteCustomers(){var o,t;try{const r=this.customerForms.filter(s=>this.checkedRows[s.id]).map(s=>s.id).filter(s=>!this.isDeletingProducIds.includes(s));if(r.length===0)return;this.isDeletingProducIds.push(...r);const n={data:{store_id:this.store.id,customer_ids:r}};await C.delete("/api/customers",n),this.notificationState.showSuccessNotification(r==1?"Customer deleted":"Customers deleted"),this.customerState.customerForms=this.customerForms.filter(s=>!r.includes(s.id)),this.customerForms.length==0&&this.showCustomers(),this.isDeletingProducIds=this.isDeletingProducIds.filter(s=>!r.includes(s)),r.forEach(s=>{this.checkedRows[s]!==void 0&&(this.checkedRows[s]=!1)}),this.selectAll=!1}catch(r){const n=((t=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while deleting customers";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(r),console.error("Failed to delete customers:",r)}finally{this.$refs.deleteCustomersModal.hideModal()}},async deleteCustomer(){var o,t;try{if(this.isDeletingProducIds.includes(this.deletableCustomer.id))return;this.isDeletingProducIds.push(this.deletableCustomer.id);const r={data:{store_id:this.store.id}};await C.delete(`/api/customers/${this.deletableCustomer.id}`,r),this.notificationState.showSuccessNotification("Customer deleted"),this.customerState.customerForms=this.customerForms.filter(n=>n.id!=this.deletableCustomer.id),this.customerForms.length==0&&this.showCustomers()}catch(r){const n=((t=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Something went wrong while deleting customer";this.notificationState.showWarningNotification(n),this.formState.setServerFormErrors(r),console.error("Failed to delete customer:",r)}finally{this.isDeletingProducIds.splice(this.isDeletingProducIds.findIndex(r=>r==this.deletableCustomer.id),1),this.$refs.deleteCustomerModal.hideModal()}},setActionButtons(){this.changeHistoryState.removeButtons(),this.changeHistoryState.addDiscardButton(this.onDiscard),this.changeHistoryState.addActionButton("Save Changes",this.updateCustomers,"primary",null)},setCustomerForms(o){this.customerState.customerForms=o}},unmounted(){this.customerState.reset(),this.changeHistoryState.reset()},created(){this.setActionButtons();const o=["undo","redo","jumpToHistory","resetHistoryToCurrent","resetHistoryToOriginal"];for(let t=0;t<o.length;t++){let r=o[t];this.changeHistoryState.listeners[r]=this.setCustomerForms}this.isLoadingCustomers=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.store&&this.showCustomers()}},W={class:"pt-24 px-8 relative select-none"},z={class:"relative bg-white/80 p-4 rounded-md"},Y={class:"flex items-center space-x-2"},Z={scope:"col",class:"whitespace-nowrap align-center px-4 py-4"},G={key:0,scope:"col",class:"whitespace-nowrap align-center pr-4 py-4"},J={key:0,class:"whitespace-nowrap align-center pr-4 py-4"},K={key:1,class:"whitespace-nowrap align-center pr-4 py-4"},Q={key:2,class:"whitespace-nowrap align-center pr-4 py-4"},X={key:3,class:"whitespace-nowrap align-center pr-4 py-4"},$={key:4,class:"whitespace-nowrap align-center pr-4 py-4"},ee={key:5,class:"whitespace-nowrap align-center pr-4 py-4"},te={key:6,class:"whitespace-nowrap align-center pr-4 py-4"},se={key:2,class:"align-center pr-4 py-4"},re={class:"flex items-center space-x-4"},oe=["onClick"],ie=["onClick"],ae={class:"flex justify-between items-end p-10 bg-blue-50 border-t border-blue-200"},ne={class:"space-y-4 mb-8"},le={class:"flex space-x-2 items-center p-4 text-xs bg-red-50 rounded-lg mb-8"},de={class:"text-red-500"},ue={key:0,class:"mb-8"},me={class:"font-bold text-black"};function ce(o,t,r,n,s,e){const b=w("Button"),x=w("Dropdown"),h=w("Input"),D=w("Loader"),R=w("Table"),k=w("Modal");return d(),u("div",W,[t[16]||(t[16]=a("img",{src:"/images/clouds.png",class:"absolute bottom-0"},null,-1)),a("div",z,[t[9]||(t[9]=a("h1",{class:"text-lg text-gray-700 font-semibold mb-4"},"Bulk Edit",-1)),m(R,{onSearch:e.search,columns:s.columns,perPage:s.perPage,resource:"customers",onPaginate:e.paginate,onRefresh:e.showCustomers,searchTerm:s.searchTerm,pagination:s.pagination,isLoading:s.isLoadingCustomers,onUpdatedColumns:e.updatedColumns,onUpdatedFilters:e.updatedFilters,onUpdatedSorting:e.updatedSorting,onUpdatedPerPage:e.updatedPerPage,filterExpressions:s.filterExpressions,sortingExpressions:s.sortingExpressions,searchPlaceholder:"Search by customer name, phone, email or notes"},{afterRefreshButton:p(()=>[a("div",Y,[m(b,{size:"xs",type:"primary",leftIcon:s.Plus,action:e.onAddCustomer},{default:p(()=>t[3]||(t[3]=[a("span",null,"Add Customer",-1)])),_:1,__:[3]},8,["leftIcon","action"])])]),belowToolbar:p(()=>[a("div",{class:T([{hidden:e.totalCheckedRows==0},"bg-gray-50 border border-gray-200 flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[t[4]||(t[4]=a("span",{class:"text-sm"},"Actions: ",-1)),m(x,{ref:"actionDropdown",dropdownClasses:"w-72",options:s.bulkSelectionOptions},{triggerText:p(()=>[a("span",null,"Select Action ("+S(`${e.totalCheckedRows} selected`)+")",1)]),_:1},8,["options"])],2)]),head:p(()=>[a("tr",null,[a("th",Z,[m(h,{type:"checkbox",modelValue:s.selectAll,"onUpdate:modelValue":t[0]||(t[0]=g=>s.selectAll=g)},null,8,["modelValue"])]),(d(!0),u(y,null,_(s.columns,(g,i)=>(d(),u(y,{key:i},[g.active?(d(),u("th",G,S(g.name),1)):c("",!0)],64))),128)),t[5]||(t[5]=a("th",{scope:"col",class:"whitespace-nowrap align-center pr-4 py-4"},null,-1))])]),body:p(()=>[(d(!0),u(y,null,_(e.customerForms,(g,i)=>(d(),u("tr",{key:g.id,class:T([s.checkedRows[g.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer border-b border-blue-100"])},[(d(!0),u(y,null,_(s.columns,(f,v)=>(d(),u(y,{key:v},[v==0?(d(),u("td",{key:0,onClick:t[1]||(t[1]=F(()=>{},["stop"])),class:"whitespace-nowrap align-center px-4 py-4"},[m(h,{type:"checkbox",modelValue:s.checkedRows[g.id],"onUpdate:modelValue":l=>s.checkedRows[g.id]=l},null,8,["modelValue","onUpdate:modelValue"])])):c("",!0),f.active?(d(),u(y,{key:1},[f.name=="First Name"?(d(),u("td",J,[m(h,{type:"text",class:"min-w-40",modelValue:e.customerForms[i].first_name,"onUpdate:modelValue":l=>e.customerForms[i].first_name=l,onInput:l=>e.captureChange(i,"First name changed"),errorText:e.formState.getFormError(`customer.${i}.first_name`)},null,8,["modelValue","onUpdate:modelValue","onInput","errorText"])])):c("",!0),f.name=="Last Name"?(d(),u("td",K,[m(h,{type:"text",class:"min-w-40",modelValue:e.customerForms[i].last_name,"onUpdate:modelValue":l=>e.customerForms[i].last_name=l,onInput:l=>e.captureChange(i,"Last name changed"),errorText:e.formState.getFormError(`customer.${i}.last_name`)},null,8,["modelValue","onUpdate:modelValue","onInput","errorText"])])):c("",!0),f.name=="Mobile"?(d(),u("td",Q,[m(h,{type:"text",class:"min-w-40",modelValue:e.customerForms[i].mobile_number,"onUpdate:modelValue":l=>e.customerForms[i].mobile_number=l,onInput:l=>e.captureChange(i,"Mobile number changed"),errorText:e.formState.getFormError(`customer.${i}.mobile_number`)},null,8,["modelValue","onUpdate:modelValue","onInput","errorText"])])):c("",!0),f.name=="Email"?(d(),u("td",X,[m(h,{type:"text",class:"min-w-60",modelValue:e.customerForms[i].email,"onUpdate:modelValue":l=>e.customerForms[i].email=l,onInput:l=>e.captureChange(i,"Email changed"),errorText:e.formState.getFormError(`customer.${i}.email`)},null,8,["modelValue","onUpdate:modelValue","onInput","errorText"])])):c("",!0),f.name=="Birthday"?(d(),u("td",$,[m(h,{type:"date",class:"min-w-40",modelValue:e.customerForms[i].birthday,"onUpdate:modelValue":l=>e.customerForms[i].birthday=l,onInput:l=>e.captureChange(i,"Birthday changed"),errorText:e.formState.getFormError(`customer.${i}.birthday`)},null,8,["modelValue","onUpdate:modelValue","onInput","errorText"])])):c("",!0),f.name=="Referral Code"?(d(),u("td",ee,[m(h,{type:"text",class:"min-w-40",modelValue:e.customerForms[i].referral_code,"onUpdate:modelValue":l=>e.customerForms[i].referral_code=l,onInput:l=>e.captureChange(i,"Referral code changed"),errorText:e.formState.getFormError(`customer.${i}.referral_code`)},null,8,["modelValue","onUpdate:modelValue","onInput","errorText"])])):c("",!0),f.name=="Notes"?(d(),u("td",te,[m(h,{type:"text",class:"min-w-80",modelValue:e.customerForms[i].notes,"onUpdate:modelValue":l=>e.customerForms[i].notes=l,onInput:l=>e.captureChange(i,"Notes changed"),errorText:e.formState.getFormError(`customer.${i}.notes`)},null,8,["modelValue","onUpdate:modelValue","onInput","errorText"])])):c("",!0)],64)):c("",!0),v==s.columns.length-1?(d(),u("td",se,[a("div",re,[e.isDeletingCustomer(e.customerForms[i])?c("",!0):(d(),u("span",{key:0,onClick:F(l=>e.onView(e.customerForms[i]),["stop","prevent"]),class:"text-sm font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,oe)),e.isDeletingCustomer(e.customerForms[i])?(d(),U(D,{key:1,type:"danger"},{default:p(()=>t[6]||(t[6]=[a("span",{class:"text-xs ml-2"},"Deleting...",-1)])),_:1,__:[6]})):(d(),u("span",{key:2,onClick:F(l=>e.showDeleteConfirmationModal(e.customerForms[i]),["stop","prevent"]),class:"text-sm font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,ie))])])):c("",!0)],64))),128))],2))),128))]),noResults:p(()=>[a("div",ae,[t[8]||(t[8]=a("div",null,[a("h1",{class:"text-2xl font-bold mb-4"}," Ready For Your First Sale? "),a("p",{class:"text-sm text-gray-500"}," Your customers will appear here once customers start shopping. ")],-1)),a("div",null,[m(b,{size:"lg",type:"primary",leftIcon:s.Plus,action:e.onAddCustomer},{default:p(()=>t[7]||(t[7]=[a("span",null,"Add Customer",-1)])),_:1,__:[7]},8,["leftIcon","action"])])])]),_:1},8,["onSearch","columns","perPage","onPaginate","onRefresh","searchTerm","pagination","isLoading","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","filterExpressions","sortingExpressions"])]),m(k,{approveType:"primary",scrollOnContent:!1,ref:"updateCustomersModal",leftApproveIcon:s.RefreshCcw,approveText:"Update Customers",approveLoading:s.isUpdatingCustomers,approveAction:()=>e.updateCustomers("notes")},{content:p(()=>[t[10]||(t[10]=a("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Update Customers",-1)),a("div",ne,[m(h,{rows:"2",class:"w-full",type:"textarea",modelValue:s.notes,"onUpdate:modelValue":t[2]||(t[2]=g=>s.notes=g),label:"Customer Notes",placeholder:`Say something about the ${e.totalCheckedRows==1?"customer":"customers"}`},null,8,["modelValue","placeholder"])])]),_:1},8,["leftApproveIcon","approveLoading","approveAction"]),m(k,{approveType:"danger",ref:"deleteCustomersModal",leftApproveIcon:s.Trash2,approveAction:e.deleteCustomers,approveLoading:e.isDeletingCustomers,approveText:e.totalCheckedRows==1?"Delete Customer":"Delete Customers"},{content:p(()=>[t[12]||(t[12]=a("p",{class:"text-lg font-bold border-b border-gray-300 border-dashed pb-4 mb-4"},"Delete Customers",-1)),a("div",le,[t[11]||(t[11]=a("svg",{class:"w-6 h-6 text-red-500 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})],-1)),a("span",de,"Are you sure you want to delete "+S(e.totalCheckedRows>1?`these ${e.totalCheckedRows} customers`:"this customer")+"?",1)])]),_:1},8,["leftApproveIcon","approveAction","approveLoading","approveText"]),m(k,{approveType:"danger",ref:"deleteCustomerModal",leftApproveIcon:s.Trash2,approveText:"Delete Customer",approveAction:e.deleteCustomer,approveLoading:e.isDeletingCustomer(s.deletableCustomer)},{content:p(()=>[t[15]||(t[15]=a("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Confirm Delete",-1)),s.deletableCustomer?(d(),u("p",ue,[t[13]||(t[13]=E("Are you sure you want to permanently delete ")),a("span",me,S(s.deletableCustomer.name),1),t[14]||(t[14]=E("?"))])):c("",!0)]),_:1},8,["leftApproveIcon","approveAction","approveLoading"])])}const Ie=q(O,[["render",ce]]);export{Ie as default};
