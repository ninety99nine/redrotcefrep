import{c as d,b as s,a as n,t as l,F as k,g as h,w as S,e as _,h as g,r as p,o as c}from"./app-BqBcK2Me.js";import{L as b}from"./Logo-VNDVIJVW.js";import{A as x}from"./Alert-BuzuHOXv.js";import{I as E}from"./Input-DjuOdbF1.js";import{B as v}from"./Button-BNac3Uy4.js";import{i as T}from"./stringUtils-Bvzw0-oW.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as I}from"./createLucideIcon-OabOCuoO.js";import"./circle-check-DQp1AnuL.js";import"./info-DnyE2tTW.js";import"./Copy-Bc6MjpSO.js";import"./ShineEffect-DJP6tw7V.js";import"./Popover-DiVqkWjb.js";import"./Tooltip-BzW-KZ4w.js";import"./Skeleton-BEzu_4lT.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-CRBonytR.js";import"./circle-alert-DCWIbGb_.js";import"./x-PgxH0pkw.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Loader-BgqDxGis.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=I("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]),L={name:"SetupAccount",components:{Logo:b,Alert:x,Input:E,Button:v},inject:["authState","formState","notificationState"],data(){return{LogIn:V,form:{email:"",token:"",password:"",confirm_password:""},loading:!1,tokenError:null,currentYear:new Date().getFullYear(),appName:"Perfect Order"}},methods:{isEmpty:T,goHome(){this.$router.push({name:"login"})},async validateToken(){var m,e;try{await g.post("/api/auth/validate-token",{email:this.form.email,token:this.form.token}),this.tokenError=null}catch(o){const i=((e=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Invalid or expired token.";this.tokenError=i,this.notificationState.showWarningNotification(i)}},async submit(){var m,e;if(!this.loading&&(this.formState.hideFormErrors(),this.isEmpty(this.form.email)&&this.formState.setFormError("email","Email is required"),this.isEmpty(this.form.password)&&this.formState.setFormError("password","Password is required"),this.isEmpty(this.form.confirm_password)&&this.formState.setFormError("confirm_password","Confirm password"),this.form.password!==this.form.confirm_password&&this.formState.setFormError("confirm_password","Passwords do not match"),!this.formState.hasErrors)){this.loading=!0;try{const o=await g.post("/api/auth/setup-password",this.form),i=o.data.user,t=o.data.token;await this.authState.setUser(i),this.authState.setTokenOnRequest(t),this.authState.setTokenOnLocalStorage(t),this.$router.push({name:"show-stores"}),this.notificationState.showSuccessNotification("Password set successfully!")}catch(o){const i=((e=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Something went wrong while setting your password";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(o),console.error("Failed to set password:",o)}finally{this.loading=!1}}}},async mounted(){this.form.email=this.$route.query.email||"",this.form.token=this.$route.query.token||"",this.form.email&&this.form.token?await this.validateToken():(this.tokenError="Invalid or missing email/token.",this.notificationState.showWarningNotification("Invalid or missing email/token."))}},N={class:"min-h-screen grid grid-cols-1 lg:grid-cols-2 transition-opacity opacity-100 duration-750 lg:grow starting:opacity-0"},P={class:"flex items-center justify-center p-6 bg-linear-to-b from-blue-100 to-white-100"},A={class:"w-full max-w-md"},C={class:"bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6"},B={class:"text-2xl font-semibold leading-none tracking-tight mb-4"},j={class:"text-sm text-gray-500 mb-4"},q={key:0,class:"text-red-500 text-sm mb-3"},U={class:"ml-1"},H={class:"text-sm text-center text-gray-500"};function Y(m,e,o,i,t,r){const w=p("Logo"),y=p("Alert"),f=p("Button"),u=p("Input");return c(),d("div",N,[s("div",P,[s("div",A,[n(w,{height:"h-20 mx-auto mb-4"}),s("div",C,[s("h1",B,l(t.tokenError?t.tokenError.includes("expired")?"Setup Link Expired":"Setup Link Invalid":"Set Up Your Account"),1),s("h1",j,l(t.tokenError?t.tokenError.includes("expired")?"The link to set up your account has expired. Contact your administrator to assist.":"The link to set up your account is invalid. Contact your administrator to assist.":"Please set your password to activate your account."),1),t.tokenError?(c(),d(k,{key:0},[n(y,{title:t.tokenError,type:"danger",dismissable:!1,class:"mb-8"},null,8,["title"]),n(f,{type:"primary",size:"lg",action:r.goHome,buttonClass:"w-full"},{default:h(()=>[...e[4]||(e[4]=[s("span",null,"Go Home",-1)])]),_:1},8,["action"])],64)):(c(),d("form",{key:1,onSubmit:e[3]||(e[3]=S((...a)=>r.submit&&r.submit(...a),["prevent"])),class:"space-y-4"},[n(u,{disabled:"",type:"email",label:"Email",modelValue:t.form.email,"onUpdate:modelValue":e[0]||(e[0]=a=>t.form.email=a),errorText:r.formState.getFormError("email")},null,8,["modelValue","errorText"]),n(u,{type:"password",label:"Password",modelValue:t.form.password,"onUpdate:modelValue":e[1]||(e[1]=a=>t.form.password=a),errorText:r.formState.getFormError("password")},null,8,["modelValue","errorText"]),n(u,{type:"password",label:"Confirm Password",modelValue:t.form.confirm_password,"onUpdate:modelValue":e[2]||(e[2]=a=>t.form.confirm_password=a),errorText:r.formState.getFormError("confirm_password")},null,8,["modelValue","errorText"]),r.formState.generalErrorText?(c(),d("div",q,l(r.formState.generalErrorText),1)):_("",!0),n(f,{size:"md",type:"primary",class:"w-full",action:r.submit,leftIcon:t.LogIn,disabled:t.loading},{default:h(()=>[s("span",U,l(t.loading?"Setting Password...":"Set Password"),1)]),_:1},8,["action","leftIcon","disabled"])],32))]),s("p",H,"Â© "+l(t.currentYear)+" "+l(t.appName)+". All rights reserved.",1)])]),e[5]||(e[5]=s("div",{class:"hidden lg:block"},[s("img",{src:"/images/lady-with-laptop.jpg",class:"w-full h-full object-cover",alt:"Lady holding boxes"})],-1))])}const mt=F(L,[["render",Y]]);export{mt as default};
