import{c as m,a,g as p,d as F,e as f,b as o,F as w,f as x,t as _,h as L,r as d,o as n}from"./app-BqBcK2Me.js";import{I as k}from"./Input-DjuOdbF1.js";import{B as R}from"./Button-BNac3Uy4.js";import{L as E}from"./Loader-BgqDxGis.js";import{S as B}from"./Skeleton-BEzu_4lT.js";import{i as V}from"./stringUtils-Bvzw0-oW.js";import{B as T}from"./BackdropLoader-9ZqWwWJr.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as v}from"./move-left-DHBxHM8D.js";import{S as h}from"./star-DxS36cg6.js";import"./Copy-Bc6MjpSO.js";import"./ShineEffect-DJP6tw7V.js";import"./createLucideIcon-OabOCuoO.js";import"./Popover-DiVqkWjb.js";import"./Tooltip-BzW-KZ4w.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-CRBonytR.js";import"./circle-check-DQp1AnuL.js";import"./circle-alert-DCWIbGb_.js";import"./x-PgxH0pkw.js";import"./parsePhoneNumber-xMTQFMCS.js";const C={inject:["formState","reviewState","storeState","notificationState"],components:{Input:k,Button:R,Loader:E,Skeleton:B,BackdropLoader:T,Star:h,MoveLeft:v},data(){return{Star:h,MoveLeft:v,isSubmitting:!1,isLoadingUser:!1}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},reviewForm(){return this.reviewState.reviewForm}},watch:{store(s,e){!e&&s&&this.setup()}},methods:{isEmpty:V,async setup(){this.store&&this.reviewState.setReviewForm(null,!0)},navigateToShowShopReviews(){this.$router.push({name:"show-shop-reviews",query:{alias:this.store.alias}})},setRating(s){this.reviewForm.rating=s},async createReview(){var s,e;try{if(this.isSubmitting||(this.formState.hideFormErrors(),this.isEmpty(this.reviewForm.rating)&&this.formState.setFormError("rating","The rating is required"),(this.reviewForm.rating<1||this.reviewForm.rating>5)&&this.formState.setFormError("rating","Rating must be between 1 and 5"),this.formState.hasErrors))return;this.isSubmitting=!0;const r={...this.reviewForm,store_id:this.store.id},u=await L.post("/api/reviews",r);this.notificationState.showSuccessNotification("Review submitted! It will be visible after approval."),await this.navigateToShowShopReviews(),this.reviewState.reset()}catch(r){const u=((e=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Something went wrong while submitting your review";this.notificationState.showWarningNotification(u),this.formState.setServerFormErrors(r),console.error("Failed to create review:",r)}finally{this.isSubmitting=!1}}},created(){this.setup()},beforeRouteLeave(s,e,r){if(this.reviewState.reviewForm&&(this.reviewForm.rating||this.reviewForm.comment||this.reviewForm.name||this.reviewForm.mobile_number)&&!window.confirm("You have unsaved changes. Are you sure you want to leave?"))return r(!1);this.reviewState.reset(),r()}},N={class:"max-w-4xl mx-auto pb-40"},U={key:0,class:"pt-8 flex items-center justify-center"},M={key:1,class:"select-none relative bg-white rounded-lg space-y-4 p-4"},j={class:"flex items-center space-x-4"},z={class:"grid grid-cols-1 md:grid-cols-2 gap-4 border border-gray-300 shadow rounded-lg p-4 space-y-4"},A={class:"border border-gray-300 shadow rounded-lg p-4 space-y-4"},q={class:"flex space-x-1 mt-2"},W={key:0,class:"mt-1 text-sm text-red-600"},Y={class:"flex justify-end"};function D(s,e,r,u,l,t){const S=d("Loader"),b=d("BackdropLoader"),g=d("Button"),c=d("Input"),y=d("Star");return n(),m("div",N,[t.isLoadingStore||l.isLoadingUser?(n(),m("div",U,[a(S,null,{default:p(()=>[...e[3]||(e[3]=[o("span",{class:"text-sm ml-2"},"Loading...",-1)])]),_:1})])):(n(),m("div",M,[l.isSubmitting?(n(),F(b,{key:0,showSpinningLoader:!1,class:"rounded-lg"})):f("",!0),o("div",j,[a(g,{size:"xs",type:"light",action:t.navigateToShowShopReviews,leftIcon:l.MoveLeft},{default:p(()=>[...e[4]||(e[4]=[o("span",null,"Reviews",-1)])]),_:1},8,["action","leftIcon"]),e[5]||(e[5]=o("h1",{class:"sm:text-lg text-xl font-semibold"},"Write A Review",-1))]),t.reviewForm?(n(),m(w,{key:1},[o("div",z,[a(c,{type:"text",label:"Name",placeholder:"Your name",modelValue:t.reviewForm.name,"onUpdate:modelValue":e[0]||(e[0]=i=>t.reviewForm.name=i),secondaryLabel:"(optional)",errorText:t.formState.getFormError("name")},null,8,["modelValue","errorText"]),a(c,{type:"text",label:"Mobile Number",placeholder:"+26772000001",secondaryLabel:"(optional)",modelValue:t.reviewForm.mobile_number,"onUpdate:modelValue":e[1]||(e[1]=i=>t.reviewForm.mobile_number=i),errorText:t.formState.getFormError("mobile_number")},null,8,["modelValue","errorText"])]),o("div",A,[o("div",null,[e[6]||(e[6]=o("label",{class:"text-sm leading-6 font-medium text-gray-900"},"Rating",-1)),o("div",q,[(n(),m(w,null,x(5,i=>a(y,{size:32,key:i,class:"cursor-pointer",onClick:G=>t.setRating(i),fill:i<=t.reviewForm.rating?"gold":"none",stroke:i<=t.reviewForm.rating?"gold":"gray"},null,8,["onClick","fill","stroke"])),64))]),t.formState.getFormError("rating")?(n(),m("p",W,_(t.formState.getFormError("rating")),1)):f("",!0)]),a(c,{rows:"2",type:"textarea",label:"Comment",modelValue:t.reviewForm.comment,"onUpdate:modelValue":e[2]||(e[2]=i=>t.reviewForm.comment=i),placeholder:"Share your experience...",errorText:t.formState.getFormError("comment"),tooltipContent:"A short description of your feedback"},null,8,["modelValue","errorText"]),o("div",Y,[a(g,{size:"sm",type:"primary",leftIcon:l.Star,action:t.createReview,loading:l.isSubmitting},{default:p(()=>[...e[7]||(e[7]=[o("span",null,"Send Review",-1)])]),_:1},8,["leftIcon","action","loading"])])])],64)):f("",!0)]))])}const ce=I(C,[["render",D]]);export{ce as default};
