import{Q as R}from"./browser-deva_LZm.js";import{a as W,C as N}from"./Copy-BivnTeSq.js";import{B as U}from"./Button-CPqWnTAQ.js";import{S as z}from"./Skeleton-TldU7eME.js";import{V as B}from"./vue-slide-up-down-4RuTXzVy.js";import{S as Q}from"./StoreLogo-oGjJYh_S.js";import{a as j}from"./stringUtils-Bvzw0-oW.js";import{W as E}from"./WhatsappIcon-BIJZY_lP.js";import{W as A}from"./WhatsappMessage-CNBjsk3B.js";import{c as n,b as o,d as g,e as y,t as _,a as d,i as x,F as w,g as m,f as D,r as l,o as r,k as S,w as P}from"./app-qohHnai2.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as V,a as F}from"./chevron-up-C4ADKmmn.js";import{R as G}from"./receipt-text-CHYYPWaR.js";import{A as H}from"./arrow-left-Clyj-luM.js";import"./ShineEffect-bdFyZnCD.js";import"./createLucideIcon-DFF6csNE.js";import"./Loader-BkdSj3Qz.js";import"./plus-Dn-tsknJ.js";const J={inject:["formState","storeState","orderState","notificationState"],components:{Copy:W,Button:U,Skeleton:z,VueSlideUpDown:B,ReceiptText:G,ChevronUp:F,ChevronDown:V,StoreLogo:Q,WhatsappIcon:E,WhatsappMessage:A},data(){return{CopyIcon:N,ArrowLeft:H,qrCode:null,clicked:!1,accordions:[{label:"Open in external browser",expanded:!1},{label:"Send order details manually",expanded:!1},{label:"Scan QR code to open this page on your mobile",expanded:!1}]}},watch:{order(s,e){!e&&s&&this.setup()}},computed:{store(){return this.storeState.store},order(){return this.orderState.order},isLoadingStore(){return this.storeState.isLoadingStore},isLoadingOrder(){return this.orderState.isLoadingOrder},paymentMethod(){return this.$route.query.payment_method??null},orderUrl(){return`${window.location.origin+this.$router.resolve({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}}).href}`},currentPageUrl(){return window.location.origin+this.$router.resolve({name:"show-shop-confirming-payment",params:{alias:this.store.alias,order_id:this.order.id}}).href},whatsappMessage(){if(this.order){let s="";s+=`*Order #${this.order.number}*
`;for(let i=0;i<this.order.order_products.length;i++){const t=this.order.order_products[i];s+=`
*${t.quantity}x* ${t.name} ${t.grand_total.amount_with_currency}`}s+=`

*Grand Total: ${this.order.grand_total.amount_with_currency}* (Qty: ${this.order.total_uncancelled_product_quantities})
`;const e=this.isNotEmpty(this.order.customer_name),a=this.isNotEmpty(this.order.customer_email),p=this.isNotEmpty(this.order.customer_mobile_number);return e&&(s+=`
Name: ${this.order.customer_name}`),p&&(s+=`
Mobile: ${this.order.customer_mobile_number.international}`),a&&(s+=`
Email: ${this.order.customer_email}`),(e||p||a)&&(s+=`
`),this.paymentMethod!=null&&(s+=`
Payment : ${this.paymentMethod} (Confirm Payment)
`),this.order.delivery_method!=null&&(s+=`
Delivery: ${this.order.delivery_method.name}`),this.order.paymentMethod!=null&&(s+=`
Address: ${this.order.delivery_address.complete_address}`),s+=`

See invoice ${this.orderUrl}`,s}return null}},methods:{isNotEmpty:j,setup(){this.store&&this.order&&(this.generateQRCode(),["paid","waiting confirmation"].includes(this.order.payment_status)||this.updateOrder())},toggleAccordian(s){for(let e=0;e<this.accordions.length;e++)e==s?this.accordions[e].expanded=!this.accordions[e].expanded:this.accordions[e].expanded=!1},async generateQRCode(){try{this.qrCode=await R.toDataURL(this.currentPageUrl,{margin:2,width:150,color:{dark:"#000000",light:"#ffffff"}})}catch(s){console.error("Failed to generate QR code:",s)}},async navigateToShowShopOrder(){await this.$router.push({name:"show-shop-order",params:{alias:this.store.alias,order_id:this.order.id}})},async navigateToStorefront(){await this.$router.push({name:"show-storefront",params:{alias:this.store.alias}})},sendUsingWhatsapp(){const s=this.store.whatsapp_mobile_number?`phone=${this.store.whatsapp_mobile_number.international.replace("+","")}&`:"";window.open(`https://wa.me/?${s}text=${encodeURIComponent(this.whatsappMessage)}`,"_blank"),this.clicked=!0},async updateOrder(){var s,e;try{const a="waiting confirmation",p={payment_status:a,store_id:this.store.id};await axios.put(`/api/orders/${this.order.id}`,p),this.orderState.order.payment_status=a}catch(a){const p=((e=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Something went wrong while updating order";this.notificationState.showWarningNotification(p),this.formState.setServerFormErrors(a),console.error("Failed to update order changes:",a)}}},created(){this.setup()}},K={class:"select-none max-w-xl mx-auto pt-16"},X={class:"p-4 flex items-center space-x-4"},Y={class:"w-full flex justify-between space-x-4"},Z={class:"w-full"},$={key:1,class:"text-gray-700 font-semibold text-sm"},ee={key:3,class:"text-gray-500 text-sm"},te={key:1,class:"text-right text-gray-400 text-xs"},oe={class:"w-full bg-gray-50 border border-gray-100 shadow rounded-xl p-10"},se={class:"w-16 h-16 mx-auto flex items-center justify-center bg-green-100 text-green-500 rounded-full mb-4"},re={class:"flex justify-center space-x-2 mb-4"},ae={key:0},ne=["onClick"],ie={class:"text-sm text-gray-700"},de={key:1,class:"p-4 space-y-2"},le={key:0,class:"flex items-center justify-between"},ce={class:"text-gray-700 font-semibold text-xs"},me={class:"flex items-center justify-end"},pe=["src"],he={key:1,class:"flex justify-center"},ue={class:"flex items-center space-x-1"};function ge(s,e,a,p,i,t){const C=l("StoreLogo"),b=l("Skeleton"),k=l("ReceiptText"),f=l("Button"),L=l("ChevronUp"),O=l("ChevronDown"),v=l("Copy"),T=l("WhatsappMessage"),I=l("vue-slide-up-down"),M=l("WhatsappIcon");return r(),n("div",K,[o("div",{onClick:e[0]||(e[0]=(...h)=>t.navigateToShowShopOrder&&t.navigateToShowShopOrder(...h)),class:"w-full bg-white border border-gray-100 shadow-sm rounded-xl cursor-pointer hover:bg-gray-50 hover:scale-105 active:opacity-80 active:scale-100 transition-all duration-300 mb-4"},[o("div",X,[t.store&&t.store.logo?(r(),g(C,{key:0,size:"w-10 h-10",showButton:!1})):y("",!0),o("div",Y,[o("div",Z,[t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:0,width:"w-40",height:"h-2",shine:!0})):(r(),n("p",$,_(t.order.customer_name),1)),t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:2,width:"w-2/3",height:"h-2",shine:!0})):(r(),n("p",ee,_(t.order.summary),1))]),t.isLoadingStore||t.isLoadingOrder?(r(),g(b,{key:0,width:"w-2/3",height:"h-2",shine:!0})):(r(),n("p",te,"Order #"+_(t.order.number),1))])])]),o("div",oe,[o("div",se,[d(k,{size:"24"})]),e[11]||(e[11]=o("p",{class:"text-xl font-semibold text-center mb-2"},"Confirming Payment",-1)),e[12]||(e[12]=o("p",{class:"text-sm text-gray-500 text-center mb-8"},[x(" Our team will confirm your payment and process your order. "),o("br"),x(" Send us a message to stay in touch. ")],-1)),i.clicked?(r(),n(w,{key:0},[o("div",re,[d(f,{size:"md",type:"light",leftIcon:i.ArrowLeft,action:t.navigateToStorefront},{default:m(()=>[...e[1]||(e[1]=[o("span",{class:"text-xs"},"Back to shop",-1)])]),_:1},8,["leftIcon","action"]),d(f,{size:"md",type:"success",action:t.navigateToShowShopOrder},{default:m(()=>[...e[2]||(e[2]=[o("span",{class:"text-xs"},"Go to invoice",-1)])]),_:1},8,["action"])]),!t.isLoadingStore&&!t.isLoadingOrder?(r(),n("div",ae,[e[9]||(e[9]=o("p",{class:"text-sm text-red-500 text-center mt-8 mb-4"},"WhatsApp is not opening?",-1)),(r(!0),n(w,null,D(i.accordions,(h,c)=>(r(),n("div",{key:c,onClick:P(()=>t.toggleAccordian(c),["stop"]),class:S(["border border-gray-300",{"rounded-t-lg":c==0},{"rounded-b-lg":c==i.accordions.length-1}])},[o("div",{class:S(["flex items-center justify-between bg-gray-50 hover:bg-gray-100 p-2 cursor-pointer",{shadow:h.expanded},{"rounded-t-lg":c==0},{"rounded-b-lg":c==i.accordions.length-1&&!h.expanded}])},[o("p",ie,_(h.label),1),h.expanded?(r(),g(L,{key:0,size:"16"})):(r(),g(O,{key:1,size:"16"}))],2),d(I,{active:h.expanded},{default:m(()=>[c==0?(r(),n(w,{key:0},[e[3]||(e[3]=o("p",{class:"text-xs text-gray-500 p-4 mb-4"},[x(" Look for the option called "),o("span",{class:"font-bold"},'"Open in external browser"')],-1)),e[4]||(e[4]=o("img",{src:"/images/open_in_external_browser.png",class:"max-w-80 rounded-lg overflow-hidden m-4 mx-auto"},null,-1))],64)):c==1?(r(),n("div",de,[e[7]||(e[7]=o("p",{class:"text-xs text-gray-500 mb-4"},[x(" Copy order details below and send to our "),o("span",{class:"font-bold"},"Whatsapp number")],-1)),t.store.whatsapp_mobile_number?(r(),n("div",le,[o("span",ce,_(t.store.whatsapp_mobile_number.international),1),d(v,{showText:!1,text:t.store.whatsapp_mobile_number.international},{trigger:m(u=>[d(f,{size:"xs",type:"light",leftIconSize:"14",leftIcon:i.CopyIcon,action:()=>u.loading?u.copyToClipboardNotReady():u.copyToClipboard()},{default:m(()=>[...e[5]||(e[5]=[o("span",{class:"text-xs ml-1"},"copy our whatsapp number",-1)])]),_:1},8,["leftIcon","action"])]),_:1},8,["text"])])):y("",!0),t.whatsappMessage?(r(),n(w,{key:1},[o("div",me,[d(v,{showText:!1,text:t.whatsappMessage},{trigger:m(u=>[d(f,{size:"xs",type:"light",leftIconSize:"14",leftIcon:i.CopyIcon,action:()=>u.loading?u.copyToClipboardNotReady():u.copyToClipboard()},{default:m(()=>[...e[6]||(e[6]=[o("span",{class:"text-xs ml-1"},"copy order details",-1)])]),_:1},8,["leftIcon","action"])]),_:1},8,["text"])]),d(T,{message:t.whatsappMessage},null,8,["message"])],64)):y("",!0)])):c==2?(r(),n(w,{key:2},[e[8]||(e[8]=o("p",{class:"text-xs text-gray-500 p-4 mb-4"},[x(" Use your mobile camera to scan this "),o("span",{class:"font-bold"},"QR Code")],-1)),o("img",{src:i.qrCode,alt:"QR Code",class:"my-4 mx-auto border border-gray-300 rounded-lg shadow max-w-60"},null,8,pe)],64)):y("",!0)]),_:2},1032,["active"])],10,ne))),128))])):y("",!0)],64)):(r(),n("div",he,[d(f,{size:"xs",type:"success",action:t.sendUsingWhatsapp},{default:m(()=>[o("div",ue,[d(M,{color:"#ffffff",class:"mx-2"}),e[10]||(e[10]=o("span",{class:"text-xs"},"Send using Whatsapp",-1))])]),_:1},8,["action"])]))])])}const Ue=q(J,[["render",ge]]);export{Ue as default};
