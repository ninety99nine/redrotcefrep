import{I as x}from"./Input-QwDj8T87.js";import{S as y}from"./Switch-TKSotGnN.js";import{B as w}from"./Button-Dy6BYOYD.js";import{S as v}from"./Skeleton-BfdDUyfM.js";import{S as F}from"./SelectTags-_yNp-GeU.js";import{c as u,e as f,b as n,t as p,a as m,r as c,o as S}from"./app-CAsQYp3T.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Copy-B_MLEMQD.js";import"./ShineEffect-DjmscYxr.js";import"./createLucideIcon-Dd5tvPb0.js";import"./Popover-DUH2qEVS.js";import"./Tooltip-Gwe3QXsJ.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-D7oBzLST.js";import"./circle-check-Coc-yKcS.js";import"./circle-alert-BwdAp8OB.js";import"./x-ICmzimgK.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Loader-j3Xd9R0O.js";import"./stringUtils-Bvzw0-oW.js";import"./vue-draggable-next.esm-bundler-D8Jtphk6.js";const b={inject:["formState","storeState","changeHistoryState","notificationState"],components:{Input:x,Switch:y,Button:w,Skeleton:v,SelectTags:F},data(){return{}},watch:{store(o,e){!e&&o&&this.setup()}},computed:{store(){return this.storeState.store},storeForm(){return this.storeState.storeForm},isLoadingStore(){return this.storeState.isLoadingStore},previewTitle(){return this.storeForm.seo_title||this.store.name||"Store Title"},previewDescription(){return this.storeForm.seo_description||this.store.description||"Store description goes here."},previewUrl(){return`${window.location.origin}/${this.store.alias}`},previewImage(){var o,e,r,a,i,t;return((e=(o=this.storeForm.seo_image)==null?void 0:o[0])==null?void 0:e.path)||((a=(r=this.storeForm.logo)==null?void 0:r[0])==null?void 0:a.path)||null||((t=(i=this.storeForm.logo)==null?void 0:i[0])==null?void 0:t.path)||"/images/logo-black-transparent.png"}},methods:{setup(){this.store?this.storeState.setStoreForm(this.store,!0):this.storeState.setStoreForm(null,!1)},setActionButtons(){this.changeHistoryState.removeButtons(),this.changeHistoryState.addDiscardButton(),this.changeHistoryState.addActionButton("Save Changes",this.updateStore,"primary",null)},async updateStore(){var o,e;try{if(this.storeState.isUpdatingStore)return;this.storeState.isUpdatingStore=!0,this.changeHistoryState.actionButtons[1].loading=!0;const r={...this.storeForm,store_id:this.store.id};await axios.put(`/api/stores/${this.store.id}`,r),this.storeForm.seo_image.length&&await this.uploadImages(),this.notificationState.showSuccessNotification("Store updated"),this.storeState.saveOriginalState("Original store")}catch(r){const a=((e=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Something went wrong while updating store";this.notificationState.showWarningNotification(a),this.formState.setServerFormErrors(r),console.error("Failed to update store:",r)}finally{this.storeState.isUpdatingStore=!1,this.changeHistoryState.actionButtons[1].loading=!1}},async uploadImages(o=null){let e=this.storeForm.seo_image,r=[];for(let a=0;a<e.length;a++){let i=e[a];i.id==null&&i.uploading==!1&&(i.uploaded===null||i.uploaded===!1)&&(o==null||o==a)&&r.push(this.uploadSingleImage(e[a],a))}if(r.length===0){this.storeState.isUploading=!1;return}return this.storeState.isUploading=!0,Promise.allSettled(r).then(a=>{let i=a.filter(t=>t.status==="rejected").length;i>0&&this.notificationState.showWarningNotification(`⚠️ ${i} image(s) failed to upload. Try again or change the image.`),this.storeState.isUploading=!1})},async uploadSingleImage(o,e,r=0,a=null){var i,t,d;try{if(r>2)return console.log(`❌ Image ${e+1} permanently failed after 3 attempts.`),o.uploaded=!1,o.uploading=!1,o.error_message=((t=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Upload failed",Promise.reject("Failed after 3 attempts");let l=new FormData;l.append("file",o.file_ref),l.append("mediable_type","store"),l.append("store_id",this.store.id),l.append("mediable_id",this.store.id),l.append("upload_folder_name","store_seo_image"),o.uploading=!0,o.error_message=null;const s={headers:{"Content-Type":"multipart/form-data"}},g=await axios.post("/api/media-files",l,s),h=g.data.media_file;return o.uploaded=!0,o.uploading=!1,o.id=h.id,o.path=h.path,console.log(`✅ Image ${e+1} uploaded successfully.`),g}catch(l){return console.error(`⚠️ Image ${e+1} upload attempt ${r+1} failed.`,l),l.code==="ECONNABORTED"||((d=l.response)==null?void 0:d.status)===504?void 0:this.uploadSingleImage(o,e,r+1,l)}},setStoreForm(o){this.storeState.storeForm=o}},created(){this.setup(),this.setActionButtons();const o=["undo","redo","jumpToHistory","resetHistoryToCurrent","resetHistoryToOriginal"];for(let e=0;e<o.length;e++){let r=o[e];this.changeHistoryState.listeners[r]=this.setStoreForm}}},k={class:"max-w-2xl mx-auto pt-24 pb-40"},T={key:0,class:"bg-white p-8 shadow-sm rounded-xl mb-2"},I={class:"border rounded-lg border-gray-300 p-4 flex"},V={key:0,class:"mr-4 flex-shrink-0"},D=["src"],E={class:"flex-1"},U={class:"text-blue-600 font-medium mb-1 truncate",style:{"max-width":"536px"}},C={class:"text-green-700 text-sm mb-1"},O={class:"text-gray-600 text-sm line-clamp-2",style:{"max-width":"536px"}},B={class:"bg-white p-8 shadow-sm rounded-xl mb-2"},L={class:"space-y-4"};function H(o,e,r,a,i,t){const d=c("Input"),l=c("SelectTags");return S(),u("div",k,[t.store?(S(),u("div",T,[e[16]||(e[16]=n("h1",{class:"text-lg font-bold mb-2"},"Google Search Preview",-1)),e[17]||(e[17]=n("p",{class:"text-xs text-gray-500 mb-4"},"This is an approximation of how your store might appear in Google search results.",-1)),n("div",I,[t.previewImage?(S(),u("div",V,[n("img",{src:t.previewImage,alt:"SEO Image Preview",class:"w-16 h-16 object-cover rounded",style:{"max-width":"64px","max-height":"64px"}},null,8,D)])):f("",!0),n("div",E,[n("div",U,p(t.previewTitle),1),n("div",C,p(t.previewUrl)+" ▾ ",1),n("div",O,p(t.previewDescription),1)])])])):f("",!0),n("div",B,[e[18]||(e[18]=n("h1",{class:"text-lg font-bold mb-4"},"SEO Settings",-1)),e[19]||(e[19]=n("p",{class:"text-xs text-gray-500 mb-4"},"Improve how your business appears on Google searches and enable tracking.",-1)),n("div",L,[m(d,{type:"text",maxlength:"60",label:"SEO Title",modelValue:t.storeForm.seo_title,"onUpdate:modelValue":e[0]||(e[0]=s=>t.storeForm.seo_title=s),showCharacterLengthCounter:!0,skeleton:t.isLoadingStore||!t.store,errorText:t.formState.getFormError("seo_title"),onChange:e[1]||(e[1]=s=>t.storeState.saveStateDebounced("SEO title changed"))},null,8,["modelValue","skeleton","errorText"]),m(d,{rows:"2",type:"textarea",maxlength:"160",label:"SEO Description",showCharacterLengthCounter:!0,modelValue:t.storeForm.seo_description,"onUpdate:modelValue":e[2]||(e[2]=s=>t.storeForm.seo_description=s),skeleton:t.isLoadingStore||!t.store,errorText:t.formState.getFormError("seo_description"),onChange:e[3]||(e[3]=s=>t.storeState.saveStateDebounced("SEO description changed"))},null,8,["modelValue","skeleton","errorText"]),m(d,{type:"file",maxFiles:1,imagePreviewGridCols:1,modelValue:t.storeForm.seo_image,"onUpdate:modelValue":e[4]||(e[4]=s=>t.storeForm.seo_image=s),onRetryUploads:e[5]||(e[5]=s=>t.uploadImages()),onRetryUpload:e[6]||(e[6]=(s,g)=>t.uploadImages(g)),onChange:e[7]||(e[7]=s=>t.storeState.saveStateDebounced("SEO image changed"))},null,8,["modelValue"]),m(l,{showOptions:!1,label:"SEO Keywords",placeholder:"Type keyword",modelValue:t.storeForm.seo_keywords,"onUpdate:modelValue":e[8]||(e[8]=s=>t.storeForm.seo_keywords=s),skeleton:t.isLoadingStore||!t.store,errorText:t.formState.getFormError("seo_keywords"),onChange:e[9]||(e[9]=s=>t.storeState.saveStateDebounced("SEO keywords changed"))},null,8,["modelValue","skeleton","errorText"]),m(d,{type:"text",label:"Google Analytics ID",secondaryLabel:"(e.g., G-XXXXXXX)",skeleton:t.isLoadingStore||!t.store,modelValue:t.storeForm.google_analytics_id,"onUpdate:modelValue":e[10]||(e[10]=s=>t.storeForm.google_analytics_id=s),errorText:t.formState.getFormError("google_analytics_id"),onChange:e[11]||(e[11]=s=>t.storeState.saveStateDebounced("Google Analytics ID changed"))},null,8,["skeleton","modelValue","errorText"]),m(d,{type:"text",label:"Meta Pixel ID",modelValue:t.storeForm.meta_pixel_id,"onUpdate:modelValue":e[12]||(e[12]=s=>t.storeForm.meta_pixel_id=s),secondaryLabel:"(e.g., 1234567890)",skeleton:t.isLoadingStore||!t.store,errorText:t.formState.getFormError("meta_pixel_id"),onChange:e[13]||(e[13]=s=>t.storeState.saveStateDebounced("Meta Pixel ID changed"))},null,8,["modelValue","skeleton","errorText"]),m(d,{type:"text",label:"TikTok Pixel ID",modelValue:t.storeForm.tiktok_pixel_id,"onUpdate:modelValue":e[14]||(e[14]=s=>t.storeForm.tiktok_pixel_id=s),skeleton:t.isLoadingStore||!t.store,secondaryLabel:"(e.g., ABCDEF123456)",errorText:t.formState.getFormError("tiktok_pixel_id"),onChange:e[15]||(e[15]=s=>t.storeState.saveStateDebounced("TikTok Pixel ID changed"))},null,8,["modelValue","skeleton","errorText"])])])])}const se=_(b,[["render",H]]);export{se as default};
