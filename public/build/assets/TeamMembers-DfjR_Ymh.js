import{p as F,q as V,c as m,b as a,a as c,g as l,h as v,r as h,o as n,F as b,f as R,k as I,w as x,e as g,t as u,d as y,i as T}from"./app-CGNgl8eN.js";import{i as A}from"./index-ZeDnS8SV.js";import{P as U}from"./Pill-CuSw6nga.js";import{I as j}from"./Input-DBnU4wzW.js";import{M as B}from"./Modal-OgCr3eB2.js";import{L as z}from"./Loader-DZWJgCmt.js";import{B as J}from"./Button-B134edVj.js";import{P as O}from"./Popover-BZ2E_DR-.js";import{D as W}from"./Dropdown-C_bLQQlo.js";import{T as Z}from"./Table-DewgApB0.js";import{a as H}from"./stringUtils-Bvzw0-oW.js";import{N as G}from"./NoDataPlaceholder-f0RNGrk9.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as N}from"./plus-B1hMjDDg.js";import{M as Q}from"./move-DR2tcvbS.js";import{T as X}from"./trash-2-Bff_GbSw.js";import"./Tooltip-BCHxPPLL.js";import"./Copy-Bp4ENaQe.js";import"./ShineEffect-D1V-RWKB.js";import"./createLucideIcon-BakIve7O.js";import"./Skeleton-Dmr_VmHU.js";import"./capitalize-ChUSrr1V.js";import"./refresh-ccw-DblrTBks.js";import"./circle-check-Bkm_qb2i.js";import"./circle-alert-uARVagVJ.js";import"./x-DHw5U7EU.js";import"./parsePhoneNumber-xMTQFMCS.js";import"./Select-BriLwhlS.js";import"./Paginator-BBPGZDpQ.js";import"./Drawer-DpkWEHvn.js";import"./SelectCountry-CXCLL9t7.js";import"./Datepicker-_--OBDZR.js";import"./chevron-down-wPajd1_B.js";import"./chevron-up-DDBk_8YV.js";import"./Switch-Ce3EJdoe.js";import"./vue-draggable-next.esm-bundler-BhuNrD5X.js";import"./rotate-ccw-Be2slp2o.js";const Y={inject:["formState","storeState","notificationState"],components:{Move:Q,Plus:N,Pill:U,Input:j,Modal:B,Loader:z,Button:J,Popover:O,Dropdown:W,Table:Z,NoDataPlaceholder:G},data(){return{Plus:N,Trash2:X,teamMembers:[],perPage:"15",checkedRows:[],pagination:null,searchTerm:null,selectAll:!1,latestRequestId:0,filterExpressions:[],sortingExpressions:[],removableTeamMember:null,cancelTokenSource:null,isRemovingTeamMemberIds:[],isLoadingTeamMembers:!1,columns:this.prepareColumns(),bulkSelectionOptions:[{label:"Remove",action:this.showRemoveTeamMembersModal}]}},watch:{store(o,e){!e&&o&&this.showTeamMembers()},selectAll(o){this.checkedRows=this.teamMembers.reduce((e,t)=>(e[t.id]=o,e),{})}},computed:{store(){return this.storeState.store},hasSearchTerm(){return this.isNotEmpty(this.searchTerm)},isRemovingTeamMembers(){return this.isRemovingTeamMemberIds.length>0},totalCheckedRows(){return Object.values(this.checkedRows).filter(o=>o).length},hasFilterExpressions(){return this.filterExpressions.length>0},hasSortingExpressions(){return this.sortingExpressions.length>0}},methods:{isNotEmpty:H,formattedDatetime:V,formattedRelativeDate:F,prepareColumns(){const o=["Name","Email","Role","Joined Date"],e=["Name","Email","Role","Joined Date"];return o.map(t=>({name:t,active:e.includes(t),priority:e.includes(t)}))},showRemoveTeamMembersModal(){this.$refs.actionDropdown.hideDropdown(),this.$refs.removeTeamMembersModal.showModal()},showRemoveConfirmationModal(o){this.removableTeamMember=o,this.$refs.removeTeamMemberModal.showModal()},isRemovingTeamMember(o){return o==null?!1:this.isRemovingTeamMemberIds.findIndex(e=>e==o.id)!=-1},onView(o){this.$router.push({name:"edit-team-member",params:{team_member_id:o.id},query:{store_id:this.store.id,searchTerm:this.searchTerm,filterExpressions:this.filterExpressions.join("|"),sortingExpressions:this.sortingExpressions.join("|")}})},onAddTeamMember(){this.$router.push({name:"add-team-member",query:{store_id:this.store.id}})},paginate(o){this.showTeamMembers(o)},search(o){this.searchTerm=o,this.showTeamMembers()},updatedColumns(o){this.columns=o},updatedFilters(o){const e=o.map(t=>t.expression);A(this.filterExpressions,e)||(this.filterExpressions=e,this.showTeamMembers())},updatedSorting(o){const e=o.map(t=>t.expression);A(this.sortingExpressions,e)||(this.sortingExpressions=e,this.showTeamMembers())},updatedPerPage(o){this.perPage=o,this.showTeamMembers()},async showTeamMembers(o=1){var t,d;const e=++this.latestRequestId;try{this.isLoadingTeamMembers=!0,this.cancelTokenSource&&this.cancelTokenSource.cancel("Request superseded by a newer one"),this.cancelTokenSource=v.CancelToken.source();let s={params:{page:o,per_page:this.perPage,store_id:this.store.id,_relationships:["user","role"].join(",")},cancelToken:this.cancelTokenSource.token};this.hasSearchTerm&&(s.params.search=this.searchTerm),this.hasFilterExpressions&&(s.params._filters=this.filterExpressions.join("|")),this.hasSortingExpressions&&(s.params._sort=this.sortingExpressions.join("|"));const i=await v.get("/api/team-members",s);if(e!==this.latestRequestId)return;this.pagination=i.data,this.teamMembers=this.pagination.data,this.checkedRows=this.teamMembers.reduce((w,k)=>(w[k.id]=!1,w),{})}catch(s){if(v.isCancel(s)||e!==this.latestRequestId)return;const i=((d=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:d.message)||(s==null?void 0:s.message)||"Something went wrong while fetching team members";this.notificationState.showWarningNotification(i),this.formState.setServerFormErrors(s),console.error("Failed to fetch team members:",s)}finally{if(e!==this.latestRequestId)return;this.isLoadingTeamMembers=!1,this.cancelTokenSource=null}},async removeTeamMembers(){var o,e;try{const t=this.teamMembers.filter(s=>this.checkedRows[s.id]).map(s=>s.id).filter(s=>!this.isRemovingTeamMemberIds.includes(s));if(t.length===0)return;this.isRemovingTeamMemberIds.push(...t);const d={data:{store_id:this.store.id,team_member_ids:t}};await v.delete("/api/team-members",d),this.storeState.silentUpdate(),this.notificationState.showSuccessNotification(t.length==1?"Team member removed":"Team members removed"),this.teamMembers=this.teamMembers.filter(s=>!t.includes(s.id)),this.teamMembers.length==0&&this.showTeamMembers(),this.isRemovingTeamMemberIds=this.isRemovingTeamMemberIds.filter(s=>!t.includes(s)),t.forEach(s=>{this.checkedRows[s]!==void 0&&(this.checkedRows[s]=!1)}),this.selectAll=!1}catch(t){const d=((e=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Something went wrong while removing team members";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(t),console.error("Failed to remove team members:",t)}finally{this.$refs.removeTeamMembersModal.hideModal()}},async removeTeamMember(){var o,e;try{if(this.isRemovingTeamMemberIds.includes(this.removableTeamMember.id))return;this.isRemovingTeamMemberIds.push(this.removableTeamMember.id);const t={data:{store_id:this.store.id}};await v.delete(`/api/team-members/${this.removableTeamMember.id}`,t),this.storeState.silentUpdate(),this.notificationState.showSuccessNotification("Team member removed"),this.teamMembers=this.teamMembers.filter(d=>d.id!=this.removableTeamMember.id),this.teamMembers.length==0&&this.showTeamMembers()}catch(t){const d=((e=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Something went wrong while removing team member";this.notificationState.showWarningNotification(d),this.formState.setServerFormErrors(t),console.error("Failed to remove team member:",t)}finally{this.isRemovingTeamMemberIds.splice(this.isRemovingTeamMemberIds.findIndex(t=>t==this.removableTeamMember.id),1),this.$refs.removeTeamMemberModal.hideModal()}}},created(){this.isLoadingTeamMembers=!0,this.searchTerm=this.$route.query.searchTerm,this.$route.query.filterExpressions&&(this.filterExpressions=this.$route.query.filterExpressions.split("|")),this.$route.query.sortingExpressions&&(this.sortingExpressions=this.$route.query.sortingExpressions.split("|")),this.store&&this.showTeamMembers()}},$={class:"pt-24 px-8 relative select-none"},ee={class:"relative bg-white/80 p-4 rounded-md mb-60"},se={class:"flex items-center space-x-2"},te={scope:"col",class:"whitespace-nowrap align-center px-4 py-4"},oe={key:0,scope:"col",class:"whitespace-nowrap align-center pr-4 py-4"},re=["onClick"],ie={key:0,class:"whitespace-nowrap align-center pr-4 py-4 text-sm"},ne={key:1,class:"whitespace-nowrap align-center pr-4 py-4 text-sm"},ae={key:2,class:"align-center pr-4 py-4 text-sm"},me={key:3,class:"whitespace-nowrap align-center pr-4 py-4 text-sm"},le={key:0,class:"flex space-x-1 items-center"},de={key:2,class:"align-center pr-4 py-4"},pe={class:"flex items-center space-x-4"},ce=["onClick"],he=["onClick"],ue={class:"flex space-x-2 items-center p-4 text-xs bg-red-50 rounded-lg mb-8"},ge={class:"text-red-500"},fe={key:0,class:"mb-8"},be={class:"font-bold text-black"};function ve(o,e,t,d,s,i){const w=h("Button"),k=h("Dropdown"),E=h("Input"),M=h("Pill"),q=h("Popover"),D=h("Loader"),L=h("Table"),S=h("Modal");return n(),m("div",$,[a("div",ee,[e[8]||(e[8]=a("h1",{class:"text-lg font-semibold mb-4"},"Team Members",-1)),c(L,{onSearch:i.search,columns:s.columns,perPage:s.perPage,onPaginate:i.paginate,resource:"team-members",searchTerm:s.searchTerm,pagination:s.pagination,onRefresh:i.showTeamMembers,isLoading:s.isLoadingTeamMembers,onUpdatedColumns:i.updatedColumns,onUpdatedFilters:i.updatedFilters,onUpdatedSorting:i.updatedSorting,onUpdatedPerPage:i.updatedPerPage,filterExpressions:s.filterExpressions,sortingExpressions:s.sortingExpressions,searchPlaceholder:"Team member name or email"},{afterRefreshButton:l(()=>[a("div",se,[c(w,{size:"xs",type:"primary",leftIcon:s.Plus,action:i.onAddTeamMember},{default:l(()=>[...e[2]||(e[2]=[a("span",null,"Add Team Member",-1)])]),_:1},8,["leftIcon","action"])])]),belowToolbar:l(()=>[a("div",{class:I([{hidden:i.totalCheckedRows==0},"bg-gray-50 border border-gray-200 flex items-center mb-2 p-4 rounded-lg shadow space-x-2"])},[e[3]||(e[3]=a("span",{class:"text-sm"},"Actions: ",-1)),c(k,{ref:"actionDropdown",dropdownClasses:"w-72",options:s.bulkSelectionOptions},{triggerText:l(()=>[a("span",null,"Select Action ("+u(`${i.totalCheckedRows} selected`)+")",1)]),_:1},8,["options"])],2)]),head:l(()=>[a("tr",null,[a("th",te,[c(E,{type:"checkbox",modelValue:s.selectAll,"onUpdate:modelValue":e[0]||(e[0]=r=>s.selectAll=r)},null,8,["modelValue"])]),(n(!0),m(b,null,R(s.columns,(r,p)=>(n(),m(b,{key:p},[r.active?(n(),m("th",oe,u(r.name),1)):g("",!0)],64))),128)),e[4]||(e[4]=a("th",{scope:"col",class:"whitespace-nowrap align-center pr-4 py-4"},null,-1))])]),body:l(()=>[(n(!0),m(b,null,R(s.teamMembers,r=>(n(),m("tr",{key:r.id,onClick:x(p=>i.onView(r),["stop"]),class:I([s.checkedRows[r.id]?"bg-blue-50":"bg-white hover:bg-gray-50","group cursor-pointer border-b border-blue-100"])},[(n(!0),m(b,null,R(s.columns,(p,f)=>{var C,P;return n(),m(b,{key:f},[f==0?(n(),m("td",{key:0,onClick:e[1]||(e[1]=x(()=>{},["stop"])),class:"whitespace-nowrap align-center px-4 py-4"},[c(E,{type:"checkbox",modelValue:s.checkedRows[r.id],"onUpdate:modelValue":_=>s.checkedRows[r.id]=_},null,8,["modelValue","onUpdate:modelValue"])])):g("",!0),p.active?(n(),m(b,{key:1},[p.name=="Name"?(n(),m("td",ie,[a("span",null,u(((C=r==null?void 0:r.user)==null?void 0:C.name)??(r==null?void 0:r.first_name)),1)])):p.name=="Email"?(n(),m("td",ne,[a("span",null,u(((P=r==null?void 0:r.user)==null?void 0:P.email)??(r==null?void 0:r.email)),1)])):p.name=="Role"?(n(),m("td",ae,[r.creator?(n(),y(M,{key:0,type:"success",size:"xs",class:"ml-1"},{default:l(()=>[...e[5]||(e[5]=[T("creator",-1)])]),_:1})):(n(),y(M,{key:1,type:"light",size:"xs"},{default:l(()=>[T(u(r.role.name),1)]),_:2},1024))])):p.name=="Joined Date"?(n(),m("td",me,[r.joined_at?(n(),m("div",le,[a("span",null,u(i.formattedDatetime(r.joined_at)),1),c(q,{placement:"top",class:"opacity-0 group-hover:opacity-100",content:i.formattedRelativeDate(r.joined_at)},null,8,["content"])])):(n(),y(M,{key:1,type:"warning",size:"xs",class:"ml-1"},{default:l(()=>[...e[6]||(e[6]=[T("invitation sent",-1)])]),_:1}))])):g("",!0)],64)):g("",!0),f==s.columns.length-1?(n(),m("td",de,[a("div",pe,[i.isRemovingTeamMember(r)?g("",!0):(n(),m("span",{key:0,onClick:x(_=>i.onView(r),["stop","prevent"]),class:"text-sm font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,ce)),i.isRemovingTeamMember(r)?(n(),y(D,{key:1,type:"danger"},{default:l(()=>[...e[7]||(e[7]=[a("span",{class:"text-xs ml-2"},"Removing...",-1)])]),_:1})):(n(),m("span",{key:2,onClick:x(_=>i.showRemoveConfirmationModal(r),["stop","prevent"]),class:"text-sm font-medium text-red-600 dark:text-red-500 hover:underline"},"Remove",8,he))])])):g("",!0)],64)}),128))],10,re))),128))]),_:1},8,["onSearch","columns","perPage","onPaginate","searchTerm","pagination","onRefresh","isLoading","onUpdatedColumns","onUpdatedFilters","onUpdatedSorting","onUpdatedPerPage","filterExpressions","sortingExpressions"])]),c(S,{approveType:"danger",ref:"removeTeamMembersModal",leftApproveIcon:s.Trash2,approveAction:i.removeTeamMembers,approveLoading:i.isRemovingTeamMembers,approveText:i.totalCheckedRows==1?"Remove Team Member":"Remove Team Members"},{content:l(()=>[e[10]||(e[10]=a("p",{class:"text-lg font-bold border-b border-gray-300 border-dashed pb-4 mb-4"},"Remove Team Members",-1)),a("div",ue,[e[9]||(e[9]=a("svg",{class:"w-6 h-6 text-red-500 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})],-1)),a("span",ge,"Are you sure you want to remove "+u(i.totalCheckedRows>1?`these ${i.totalCheckedRows} team members`:"this team member")+"?",1)])]),_:1},8,["leftApproveIcon","approveAction","approveLoading","approveText"]),c(S,{approveType:"danger",ref:"removeTeamMemberModal",leftApproveIcon:s.Trash2,approveText:"Remove Team Member",approveAction:i.removeTeamMember,approveLoading:i.isRemovingTeamMember(s.removableTeamMember)},{content:l(()=>{var r,p,f;return[e[13]||(e[13]=a("p",{class:"text-lg font-bold border-b border-dashed border-gray-200 pb-4 mb-4"},"Confirm Remove",-1)),s.removableTeamMember?(n(),m("p",fe,[e[11]||(e[11]=T("Are you sure you want to remove ",-1)),a("span",be,u(((p=(r=s.removableTeamMember)==null?void 0:r.user)==null?void 0:p.name)??((f=s.removableTeamMember)==null?void 0:f.first_name)),1),e[12]||(e[12]=T("?",-1))])):g("",!0)]}),_:1},8,["leftApproveIcon","approveAction","approveLoading"])])}const ts=K(Y,[["render",ve]]);export{ts as default};
